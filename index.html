<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step By Step Game - Olympus Event</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#8b5cf6',
                        accent: '#f59e0b',
                        ice: '#00d2ff',
                        olympus: '#fbbf24',
                    },
                    fontFamily: {
                        greek: ['Cinzel', 'serif'],
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulseGlow { 0%, 100% { box-shadow: 0 0 10px rgba(251,191,36,0.3); } 50% { box-shadow: 0 0 30px rgba(251,191,36,0.8); } }
        .pulse-glow { animation: pulseGlow 2s ease-in-out infinite; }
        .glass { background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .olympus-glass { background: rgba(0, 0, 0, 0.75); border: 2px solid #fbbf24; box-shadow: 0 0 20px rgba(251,191,36,0.3); }
        .roulette-container { position: relative; width: 100%; height: 160px; overflow: hidden; background: rgba(0,0,0,0.4); border-radius: 16px; border: 2px solid rgba(255,255,255,0.1); margin: 20px 0; }
        .roulette-inner { display: flex; position: absolute; left: 0; top: 20px; transition: transform 6.5s cubic-bezier(0.1, 0, 0.1, 1); will-change: transform; }
        .roulette-item { width: 120px; height: 120px; flex-shrink: 0; margin: 0 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05)); border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); }
        .roulette-item .emoji { font-size: 3.5rem; }
        .roulette-item .name { font-size: 11px; opacity: 0.8; text-align: center; margin-top: 4px; }
        .roulette-pointer { position: absolute; left: 50%; top: 0; bottom: 0; width: 4px; background: #ff4757; z-index: 20; transform: translateX(-50%); box-shadow: 0 0 20px #ff4757; }
        .roulette-pointer::before { content: ''; position: absolute; top: -5px; left: 50%; transform: translateX(-50%); border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 15px solid #ff4757; }
        .roulette-pointer::after { content: ''; position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%); border-left: 10px solid transparent; border-right: 10px solid transparent; border-bottom: 15px solid #ff4757; }
        .line-through { text-decoration: line-through; opacity: 0.6; color: #ef4444; }
        .fullscreen-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 100; overflow-y: auto; }
        .bright-label { color: #fbbf24; text-shadow: 0 0 10px rgba(251,191,36,1), 0 0 20px rgba(251,191,36,0.5); font-weight: 900; letter-spacing: 0.05em; }
        .neon-red { color: #ff4d4d; text-shadow: 0 0 10px #ff4d4d; font-weight: bold; }
        .ladder-item { transition: all 0.3s ease; }
        .ladder-item.completed { border-color: #22c55e; background: rgba(34, 197, 94, 0.2); }
        .ladder-item.current { border-color: #fbbf24; box-shadow: 0 0 15px rgba(251,191,36,0.5); }
        .round-box { width: 30px; height: 30px; border-radius: 6px; border: 2px solid rgba(255,255,255,0.3); display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; margin: 0 3px; transition: all 0.3s; }
        .round-box.completed { background: linear-gradient(135deg, #22c55e, #16a34a); border-color: #22c55e; box-shadow: 0 0 10px #22c55e; }
        .round-box.current { background: linear-gradient(135deg, #fbbf24, #f59e0b); border-color: #fbbf24; box-shadow: 0 0 10px #fbbf24; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    </style>
</head>
<body class="bg-black min-h-screen text-white overflow-x-hidden font-sans">
    <div id="root"></div>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        const firebaseConfig = {
            apiKey: "AIzaSyDZPRiByz69HQa8b7GFMCJeqq56J3Y-bOY",
            authDomain: "step-by-step-279df.firebaseapp.com",
            databaseURL: "https://step-by-step-279df-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "step-by-step-279df",
            storageBucket: "step-by-step-279df.firebasestorage.app",
            messagingSenderId: "302641152597",
            appId: "1:302641152597:web:6479b9ae03104666cd8adc"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const TelegramWebApp = window.Telegram?.WebApp;
        
        const INITIAL_CASES = {
            daily: { id: 'daily', name: '–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π', emoji: 'üóìÔ∏è', price: 0, color: 'from-cyan-400 to-teal-600', locked: false, freeCount: 1, type: 'special', lastOpened: 0 },
            collector: { id: 'collector', name: '–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä', emoji: 'üé©', price: 650, color: 'from-rose-600 to-pink-800', locked: true, freeCount: 0, type: 'special' },
            cardboard: { id: 'cardboard', name: '–ö–∞—Ä—Ç–æ–Ω', emoji: 'üì¶', price: 3, color: 'from-amber-800 to-amber-900', locked: false, freeCount: 0 },
            coal: { id: 'coal', name: '–£–≥–æ–ª—ë–∫', emoji: 'ü™®', price: 27, color: 'from-gray-600 to-gray-800', locked: false, freeCount: 0 },
            platinum: { id: 'platinum', name: '–ü–ª–∞—Ç–∏–Ω–∞', emoji: 'üíé', price: 100, color: 'from-gray-300 to-gray-500', locked: false, freeCount: 0 },
            gold: { id: 'gold', name: '–ó–æ–ª–æ—Ç–æ–π', emoji: 'üëë', price: 250, color: 'from-yellow-400 to-yellow-600', locked: false, freeCount: 0 },
            money: { id: 'money', name: '–î–µ–Ω–µ–∂–Ω—ã–π', emoji: 'üíµ', price: 350, color: 'from-green-400 to-green-600', locked: false, freeCount: 0 },
            elite: { id: 'elite', name: '–≠–ª–∏—Ç–∞', emoji: 'üéñ', price: 500, color: 'from-red-400 to-red-600', locked: false, freeCount: 0 },
            diamond: { id: 'diamond', name: '–ê–ª–º–∞–∑', emoji: 'üíé', price: 50, color: 'from-blue-400 to-blue-600', locked: false, freeCount: 0 },
            major: { id: 'major', name: '–ú–∞–∂–æ—Ä', emoji: 'ü§¥', price: 800, color: 'from-purple-500 to-indigo-700', locked: true, freeCount: 0 },
            star: { id: 'star', name: '–ó–≤–µ–∑–¥–Ω—ã–π', emoji: '‚≠êÔ∏è', price: 30, discountPrice: 23, color: 'from-yellow-400 to-amber-500', locked: false, freeCount: 0 }
        };
        const CASE_REWARDS = {
            daily: [
                { id: 'stars_1', name: '1 ‚≠êÔ∏è', emoji: '‚≠êÔ∏è', type: 'stars', value: 1, realChance: 50, displayChance: '50%' },
                { id: 'stars_3', name: '3 ‚≠êÔ∏è', emoji: '‚≠êÔ∏è', type: 'stars', value: 3, realChance: 35, displayChance: '35%' },
                { id: 'stars_15', name: '15 ‚≠êÔ∏è', emoji: '‚≠êÔ∏è', type: 'stars', value: 15, realChance: 10, displayChance: '10%' },
                { id: 'pickaxe', name: '–ö–∏—Ä–∫–∞ ‚õèÔ∏è', emoji: '‚õèÔ∏è', type: 'item', sellPrice: 22, realChance: 4, displayChance: '4%' },
                { id: 'random_case_box', name: '–°–ª—É—á–∞–π–Ω—ã–π –∫–µ–π—Å', emoji: 'üì¶', type: 'random_case_box', realChance: 1, displayChance: '1%' },
            ],
            cardboard: [
                { id: 'stars_0_25', name: '0.25 ‚≠êÔ∏è', displayChance: '80%', realChance: 80, type: 'stars', value: 0.25, emoji: '‚≠êÔ∏è' },
                { id: 'stars_0_75', name: '0.75 ‚≠êÔ∏è', displayChance: '10%', realChance: 10, type: 'stars', value: 0.75, emoji: '‚≠êÔ∏è' },
                { id: 'stars_1_5', name: '1.5 ‚≠êÔ∏è', displayChance: '6%', realChance: 6, type: 'stars', value: 1.5, emoji: '‚≠êÔ∏è' },
                { id: 'bear', name: 'üß∏', displayChance: '4%', realChance: 4, type: 'item', sellPrice: 20, emoji: 'üß∏' }
            ],
            olympus: [
                { id: 'persephone', name: '–ü–µ—Ä—Å–µ—Ñ–æ–Ω–∞üå∫', emoji: 'üå∫', type: 'olymp_item', sellPrice: 20, realChance: 40, displayChance: '40%' },
                { id: 'ares', name: '–ê—Ä–µ—Åüó°Ô∏è', emoji: 'üó°Ô∏è', type: 'olymp_item', sellPrice: 28, realChance: 20, displayChance: '20%' },
                { id: 'hermes', name: '–ì–µ—Ä–º–µ—Åüìà', emoji: 'üìà', type: 'olymp_special', effect: 'slot', realChance: 15, displayChance: '15%' },
                { id: 'dionysus', name: '–î–∏–æ–Ω–∏—Åüç∑', emoji: 'üç∑', type: 'olymp_exchange', value: 80, realChance: 10, displayChance: '10%' },
                { id: 'apollo', name: '–ê–ø–æ–ª–ª–æ–Ω‚òÄÔ∏è', emoji: '‚òÄÔ∏è', type: 'olymp_cases', caseType: 'star', count: 5, realChance: 8, displayChance: '8%' },
                { id: 'poseidon', name: '–ü–æ—Å–µ–π–¥–æ–Ωüî±', emoji: 'üî±', type: 'olymp_choice_poseidon', realChance: 5, displayChance: '5%' },
                { id: 'hades', name: '–ê–∏–¥üî•', emoji: 'üî•', type: 'olymp_choice_hades', realChance: 1.9, displayChance: '1.9%' },
                { id: 'zeus', name: '–ó–µ–≤—Å‚ö°Ô∏è', emoji: '‚ö°Ô∏è', type: 'olymp_zeus', realChance: 0.1, displayChance: '0.1%' }
            ],
            coal: [ { id: 'stars_5', name: '5 ‚≠êÔ∏è', realChance: 70, type: 'stars', value: 5, emoji: '‚≠êÔ∏è' }, { id: 'material', name: 'üß± –ú–∞—Ç–µ—Ä–∏–∞–ª', realChance: 30, type: 'item', sellPrice: 80, emoji: 'üß±' } ],
            platinum: [ { id: 'stars_35', name: '35 ‚≠êÔ∏è', realChance: 90, type: 'stars', value: 35, emoji: '‚≠êÔ∏è' }, { id: 'ring', name: 'üíç', realChance: 10, type: 'collectible', emoji: 'üíç' } ],
            gold: [ { id: 'stars_50', name: '50 ‚≠êÔ∏è', realChance: 80, type: 'stars', value: 50, emoji: '‚≠êÔ∏è' }, { id: 'icecream', name: 'Ice Cream üç¶', realChance: 20, type: 'collectible', emoji: 'üç¶' } ],
            money: [ { id: 'stars_150', name: '150 ‚≠êÔ∏è', realChance: 70, type: 'stars', value: 150, emoji: '‚≠êÔ∏è' }, { id: 'trophy', name: 'üèÜ', realChance: 30, type: 'collectible', emoji: 'üèÜ' } ],
            elite: [ { id: 'stars_200', name: '200 ‚≠êÔ∏è', realChance: 80, type: 'stars', value: 200, emoji: '‚≠êÔ∏è' }, { id: 'socks', name: 'üß¶', realChance: 20, type: 'collectible', emoji: 'üß¶' } ],
            diamond: [ { id: 'stars_8', name: '8 ‚≠êÔ∏è', realChance: 90, type: 'stars', value: 8, emoji: '‚≠êÔ∏è' }, { id: 'diamond_pro', name: 'üíé PRO', realChance: 10, type: 'collectible', emoji: 'üíé' } ],
            star: [ { id: 'stars_5', name: '5 ‚≠êÔ∏è', realChance: 100, type: 'stars', value: 5, emoji: '‚≠êÔ∏è' } ],
            major: [ { id: 'stars_500', name: '500 ‚≠êÔ∏è', realChance: 100, type: 'stars', value: 500, emoji: '‚≠êÔ∏è' } ]
        };
        const OLYMP_LADDER = [
            { req: 3, reward: { type: 'case', id: 'star', count: 3 }, label: '3 –ó–≤–µ–∑–¥–Ω—ã—Ö‚≠êÔ∏è' },
            { req: 7, reward: { type: 'case', id: 'gold', count: 1 }, label: '1 –ó–æ–ª–æ—Ç–æ–πüëë' },
            { req: 15, reward: { type: 'case', id: 'elite', count: 1 }, label: '1 –≠–ª–∏—Ç–∞üéñÔ∏è' },
            { req: 20, reward: { type: 'stars', value: 150 }, label: '150‚≠êÔ∏è' },
            { req: 25, reward: { type: 'case', id: 'money', count: 3 }, label: '3 –î–µ–Ω–µ–∂–Ω—ã—Öüíµ' },
            { req: 30, reward: { type: 'item', name: '–ü–æ–¥–∞—Ä–æ–∫ –ê–∏–¥üî•', emoji: 'üî•' }, label: '–ü–æ–¥–∞—Ä–æ–∫ –ê–∏–¥üî•' },
            { req: 50, reward: { type: 'item', name: '–ü–æ–¥–∞—Ä–æ–∫ –ó–µ–≤—Å‚ö°Ô∏è', emoji: '‚ö°Ô∏è' }, label: '–ü–æ–¥–∞—Ä–æ–∫ –ó–µ–≤—Å‚ö°Ô∏è' },
            { req: 150, reward: { type: 'hybrid', caseId: 'star', caseCount: 25, stars: 1000 }, label: '25‚≠êÔ∏è –∫–µ–π—Å–æ–≤ + 1000‚≠êÔ∏è' }
        ];
        const GERAKL_MULTIPLIERS = [1.0, 1.1, 1.4, 1.9, 2.3, 2.6, 3.8, 4.5, 5.5, 6.0, 10.0];
        const GERAKL_ICE_CHANCES = [0.15, 0.18, 0.18, 0.20, 0.30, 0.35, 0.45, 0.45, 0.45, 0.50, 0.53];
        function App() {
            const [currentScreen, setCurrentScreen] = useState('cases');
            const [eventSubScreen, setEventSubScreen] = useState('main');
            const [balance, setBalance] = useState(0);
            const [cases, setCases] = useState(INITIAL_CASES);
            const [inventory, setInventory] = useState([]);
            const [inventorySlots, setInventorySlots] = useState(5);
            const [tasks, setTasks] = useState({ subscribe: { completed: false }, deposit: { completed: false }, depositMajor: { completed: false }, openCardboard: { count: 0, required: 7, completed: false }, deposit50: { completed: false } });
            const [olympOpenCount, setOlympOpenCount] = useState(0);
            const [olympLadderClaimed, setOlympLadderClaimed] = useState([]);
            const [lastExchangeTime, setLastExchangeTime] = useState(0);
            const [user, setUser] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [selectedCase, setSelectedCase] = useState(null);
            const [isSpinning, setIsSpinning] = useState(false);
            const [spinResult, setSpinResult] = useState(null);
            const [rouletteOffset, setRouletteOffset] = useState(0);
            const [fakeItems, setFakeItems] = useState([]);
            const [rouletteKey, setRouletteKey] = useState(0);
            const [adminClicks, setAdminClicks] = useState(0);
            const [showAdminLogin, setShowAdminLogin] = useState(false);
            const [isAdmin, setIsAdmin] = useState(false);
            const [adminLogin, setAdminLogin] = useState('');
            const [adminPassword, setAdminPassword] = useState('');
            const [olympLeaderboard, setOlympLeaderboard] = useState([]);
            const [currentGame, setCurrentGame] = useState(null);
            const [geraklGameActive, setGeraklGameActive] = useState(false);
            const [geraklRound, setGeraklRound] = useState(0);
            const [geraklBet, setGeraklBet] = useState(25);
            const [geraklResult, setGeraklResult] = useState(null);
            const [showChoiceModal, setShowChoiceModal] = useState(null);
            const [showZeusModal, setShowZeusModal] = useState(false);
            const [promoCode, setPromoCode] = useState('');
            const [usedPromos, setUsedPromos] = useState([]);
            const rouletteContainerRef = useRef(null);
            useEffect(() => {
                const initApp = async () => {
                    let userId = TelegramWebApp?.initDataUnsafe?.user?.id?.toString() || localStorage.getItem('sbs_uid') || 'guest_' + Date.now();
                    localStorage.setItem('sbs_uid', userId);
                    const snap = await db.ref('users/' + userId).once('value');
                    const d = snap.val();
                    if (d) {
                        setBalance(d.balance || 0);
                        setInventory(d.inventory || []);
                        setInventorySlots(d.inventorySlots || 5);
                        setTasks(d.tasks || tasks);
                        setOlympOpenCount(d.olympOpenCount || 0);
                        setOlympLadderClaimed(d.olympLadderClaimed || []);
                        setLastExchangeTime(d.lastExchangeTime || 0);
                        setUsedPromos(d.usedPromos || []);
                        setCases(p => {
                            let nc = { ...p };
                            if (d.cases) Object.keys(d.cases).forEach(k => { if(nc[k]) nc[k].freeCount = d.cases[k].freeCount; nc[k].locked = d.cases[k].locked; });
                            return nc;
                        });
                        setUser({ id: userId, name: TelegramWebApp?.initDataUnsafe?.user?.first_name || '–ò–≥—Ä–æ–∫' });
                    } else {
                        const newUser = { balance: 0, inventorySlots: 5, olympOpenCount: 0, cases: { olymp: { freeCount: 2 }, cardboard: { freeCount: 0 }, diamond: { freeCount: 0 } } };
                        await db.ref('users/' + userId).set(newUser);
                        setUser({ id: userId, name: TelegramWebApp?.initDataUnsafe?.user?.first_name || '–ò–≥—Ä–æ–∫' });
                        setCases(p => ({ ...p, olymp: { freeCount: 2 } }));
                    }
                    setIsLoading(false);
                };
                initApp();
            }, []);
            useEffect(() => {
                if (user?.id) {
                    db.ref('users/' + user.id).update({ 
                        balance, inventory, inventorySlots, tasks, olympOpenCount, olympLadderClaimed, lastExchangeTime, usedPromos,
                        cases: Object.keys(cases).reduce((acc, k) => ({ ...acc, [k]: { freeCount: cases[k].freeCount || 0, locked: !!cases[k].locked } }), {})
                    });
                }
            }, [balance, inventory, inventorySlots, tasks, olympOpenCount, olympLadderClaimed, lastExchangeTime, usedPromos, cases]);
            useEffect(() => {
                if (currentScreen === 'events' && eventSubScreen === 'heroes') {
                    db.ref('users').orderByChild('olympOpenCount').limitToLast(5).once('value', snap => {
                        let list = [];
                        snap.forEach(c => { list.push({ id: c.key, count: c.val().olympOpenCount || 0, name: c.val().name || '–ê–Ω–æ–Ω–∏–º' }); });
                        setOlympLeaderboard(list.reverse());
                    });
                }
            }, [currentScreen, eventSubScreen]);
            const handleTitleClick = () => {
                const next = adminClicks + 1;
                setAdminClicks(next);
                if (next >= 12) { setShowAdminLogin(true); setAdminClicks(0); }
            };
            const checkAdmin = () => {
                if (adminLogin === '*^BAGUETTE_642819_6281' && adminPassword === '3628874910ZTWMI') {
                    setIsAdmin(true); setShowAdminLogin(false);
                } else alert('–û—à–∏–±–∫–∞');
            };
            const checkPromo = () => {
                const c = promoCode.toUpperCase().trim();
                if (c === 'OLIMP' && !usedPromos.includes('OLIMP')) {
                    setBalance(b => b + 130);
                    setUsedPromos(p => [...p, 'OLIMP']);
                    alert('–ù–∞—á–∏—Å–ª–µ–Ω–æ 130‚≠êÔ∏è!');
                    setPromoCode('');
                } else alert('–ù–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω');
            };
            const buyStars = (amount) => {
                setBalance(b => b + amount);
                if (amount >= 50 && !tasks.deposit50.completed) {
                    setTasks(p => ({ ...p, deposit50: { completed: true } }));
                    setBalance(b => b + 50);
                    alert('–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! +50‚≠êÔ∏è');
                }
            };
            const openCase = async (ct) => {
                const c = ct === 'olymp' ? { id: 'olymp', name: '–û–ª–∏–º–ø‚ö°Ô∏è', emoji: '‚ö°Ô∏è', price: 77, freeCount: cases.olymp?.freeCount || 0 } : cases[ct];
                const isFree = (c.freeCount || 0) > 0;
                if (!isFree && balance < (c.discountPrice || c.price)) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ‚≠êÔ∏è');
                
                if (isFree) {
                    setCases(p => ({ ...p, [ct]: { ...p[ct], freeCount: p[ct].freeCount - 1 } }));
                } else {
                    setBalance(b => b - (c.discountPrice || c.price));
                }
                setIsSpinning(true); setSpinResult(null); setRouletteKey(k => k + 1);
                const rewards = CASE_REWARDS[ct];
                let won = rewards[0], r = Math.random() * 100, cum = 0;
                for (let i of rewards) { cum += i.realChance; if (r <= cum) { won = i; break; } }
                
                const tape = [];
                for (let i = 0; i < 80; i++) tape.push(i === 70 ? won : rewards[Math.floor(Math.random() * rewards.length)]);
                setFakeItems(tape);
                
                setTimeout(() => {
                    const cw = rouletteContainerRef.current?.offsetWidth || window.innerWidth;
                    setRouletteOffset(-(70 * 136 + 68 - cw / 2));
                }, 50);
                setTimeout(() => {
                    setSpinResult(won); setIsSpinning(false);
                    if (ct === 'olymp') {
                        setOlympOpenCount(prev => {
                            const next = prev + 1;
                            OLYMP_LADDER.forEach((step, idx) => {
                                if (next >= step.req && !olympLadderClaimed.includes(idx)) {
                                    claimLadder(idx);
                                }
                            });
                            return next;
                        });
                    }
                    if (ct === 'cardboard') {
                        setTasks(p => {
                            const nextCount = p.openCardboard.count + 1;
                            if (nextCount >= 7 && !p.openCardboard.completed) {
                                setCases(c => ({ ...c, diamond: { ...c.diamond, freeCount: (c.diamond.freeCount || 0) + 1 } }));
                                return { ...p, openCardboard: { ...p.openCardboard, count: 7, completed: true } };
                            }
                            return { ...p, openCardboard: { ...p.openCardboard, count: nextCount } };
                        });
                    }
                    handleReward(won);
                }, 6600);
            };
            const handleReward = (won) => {
                if (won.type === 'stars') setBalance(b => b + won.value);
                else if (won.type === 'olymp_exchange') setBalance(b => b + won.value);
                else if (won.type === 'olymp_cases') setCases(p => ({ ...p, [won.caseType]: { ...p[won.caseType], freeCount: (p[won.caseType].freeCount || 0) + won.count } }));
                else if (won.type === 'olymp_special' && won.effect === 'slot') setInventorySlots(s => s + 1);
                else if (won.type === 'olymp_choice_poseidon') setShowChoiceModal('poseidon');
                else if (won.type === 'olymp_choice_hades') setShowChoiceModal('hades');
                else if (won.type === 'olymp_zeus') setShowZeusModal(true);
                else addToInventory(won);
            };
            const addToInventory = (item) => {
                if (inventory.length >= inventorySlots) return alert('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø–æ–ª–æ–Ω');
                setInventory(p => [...p, { ...item, uid: Date.now() }]);
            };
            const claimLadder = (idx) => {
                const step = OLYMP_LADDER[idx];
                setOlympLadderClaimed(p => [...p, idx]);
                if (step.reward.type === 'case') setCases(c => ({ ...c, [step.reward.id]: { ...c[step.reward.id], freeCount: (c[step.reward.id].freeCount || 0) + step.reward.count } }));
                else if (step.reward.type === 'stars') setBalance(b => b + step.reward.value);
                else if (step.reward.type === 'hybrid') {
                    setCases(c => ({ ...c, [step.reward.caseId]: { ...c[step.reward.caseId], freeCount: (c[step.reward.caseId].freeCount || 0) + step.reward.caseCount } }));
                    setBalance(b => b + step.reward.stars);
                } else addToInventory(step.reward);
            };
            const exchangeItem = (item) => {
                const now = Date.now();
                if (now - lastExchangeTime < 180000) return alert('–ü–æ–¥–æ–∂–¥–∏—Ç–µ 3 –º–∏–Ω—É—Ç—ã');
                const map = {
                    '‚öΩÔ∏è': { r: 'case', id: 'coal', count: 1 },
                    'üèê': { r: 'case', id: 'star', count: 1 },
                    'ü•ä': { r: 'slot', count: 1 },
                    'ü•©': { r: 'stars', value: 100 },
                    'ü¶Å': { r: 'case', id: 'gold', count: 2 },
                    'üê∫': { r: 'unlock_collector', count: 2 },
                    'üßä': { r: 'choice_ice' },
                    'üíé': { r: 'stars', value: 125 },
                    'üß±': { r: 'stars', value: 130 }
                };
                const res = map[item.emoji];
                if (!res) return alert('–ü—Ä–µ–¥–º–µ—Ç –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–±–º–µ–Ω–∞');
                
                setInventory(p => p.filter(i => i.uid !== item.uid));
                setLastExchangeTime(now);
                if (res.r === 'case') setCases(c => ({ ...c, [res.id]: { ...c[res.id], freeCount: (c[res.id].freeCount || 0) + res.count } }));
                else if (res.r === 'stars') setBalance(b => b + res.value);
                else if (res.r === 'slot') setInventorySlots(s => s + 1);
                else if (res.r === 'unlock_collector') setCases(c => ({ ...c, collector: { ...c.collector, locked: false, freeCount: (c.collector.freeCount || 0) + res.count } }));
                else if (res.r === 'choice_ice') setShowChoiceModal('ice');
                alert('–û–±–º–µ–Ω —É—Å–ø–µ—à–Ω–æ —Å–æ–≤–µ—Ä—à–µ–Ω!');
            };
            const startGerakl = () => {
                if (balance < geraklBet) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ‚≠êÔ∏è');
                setBalance(b => b - geraklBet);
                setGeraklRound(0); setGeraklGameActive(true); setGeraklResult(null);
            };
            const nextGerakl = () => {
                if (Math.random() < GERAKL_ICE_CHANCES[geraklRound]) {
                    setGeraklResult('ice'); setGeraklGameActive(false);
                } else {
                    if (geraklRound >= 10) cashoutGerakl();
                    else setGeraklRound(r => r + 1);
                }
            };
            const cashoutGerakl = () => {
                const win = Math.floor(geraklBet * GERAKL_MULTIPLIERS[geraklRound]);
                setBalance(b => b + win);
                setGeraklResult('win'); setGeraklGameActive(false);
            };
            const renderOlympScreen = () => {
                if (eventSubScreen === 'main') return (
                    <div className="relative min-h-screen bg-cover bg-center" style={{backgroundImage: "url('event.jpg')"}}>
                        <div className="absolute inset-0 bg-black/40"></div>
                        <div className="relative z-10 flex flex-col items-center pt-10 px-4">
                            <h2 className="font-greek text-4xl mb-20 bright-label text-center">–ò–≤–µ–Ω—Ç –û–ª–∏–º–ø‚ö°Ô∏è</h2>
                            <button onClick={() => setEventSubScreen('heroes')} className="w-full max-w-xs py-4 mb-10 olympus-glass rounded-xl font-greek text-2xl bright-label animate-pulse">–ì–µ—Ä–æ–∏ –û–ª–∏–º–ø–∞üèÜ</button>
                            <div className="flex w-full max-w-sm justify-between mt-20">
                                <button onClick={() => setEventSubScreen('treasure')} className="w-40 py-6 olympus-glass rounded-xl font-greek text-xl bright-label">–°–æ–∫—Ä–æ–≤–∏—â–µ –û–ª–∏–º–ø–∞‚ö°Ô∏è</button>
                                <button onClick={() => setEventSubScreen('shop')} className="w-40 py-6 olympus-glass rounded-xl font-greek text-xl bright-label">–õ–∞–≤–∫–∞ –ì–µ—Ñ–µ—Å—Ç–∞üèµÔ∏è</button>
                            </div>
                        </div>
                    </div>
                );
                if (eventSubScreen === 'treasure') return (
                    <div className="min-h-screen bg-cover bg-center p-4" style={{backgroundImage: "url('case.jpg')"}}>
                        <div className="flex justify-between items-center mb-6">
                            <button onClick={() => setEventSubScreen('main')} className="bg-black/50 p-2 rounded-lg font-bold">‚Üê –ù–∞–∑–∞–¥</button>
                            <h2 className="font-greek text-2xl bright-label">–°–æ–∫—Ä–æ–≤–∏—â–µ –û–ª–∏–º–ø–∞‚ö°Ô∏è</h2>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="olympus-glass p-6 rounded-2xl text-center">
                                <div className="text-7xl mb-4 drop-shadow-lg">‚ö°Ô∏è</div>
                                <h3 className="font-greek text-3xl mb-2 bright-label">–ö–µ–π—Å –û–ª–∏–º–ø‚ö°Ô∏è</h3>
                                <p className="mb-4 text-yellow-100 text-lg">–¶–µ–Ω–∞: {cases.olymp?.freeCount > 0 ? '–ë–ï–°–ü–õ–ê–¢–ù–û' : '77‚≠êÔ∏è'}</p>
                                <button onClick={() => setSelectedCase({id: 'olymp', name: '–û–ª–∏–º–ø‚ö°Ô∏è', emoji: '‚ö°Ô∏è'})} className="w-full py-4 bg-gradient-to-r from-yellow-600 to-yellow-400 rounded-xl font-bold text-xl shadow-lg hover:scale-105 transition">–û–¢–ö–†–´–¢–¨‚≠êÔ∏è</button>
                                {cases.olymp?.freeCount > 0 && <p className="mt-2 text-green-400 font-bold">–û—Å—Ç–∞–ª–æ—Å—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö: {cases.olymp.freeCount}</p>}
                            </div>
                            <div className="olympus-glass p-4 rounded-2xl overflow-y-auto max-h-[60vh]">
                                <h4 className="font-greek text-xl mb-4 text-center bright-label border-b border-yellow-500/30 pb-2">–õ–µ—Å—Ç–Ω–∏—Ü–∞ –ù–∞–≥—Ä–∞–¥</h4>
                                <div className="space-y-3">
                                    {OLYMP_LADDER.map((s, i) => (
                                        <div key={i} className={`flex justify-between items-center p-3 rounded-xl border-2 ${olympLadderClaimed.includes(i) ? 'border-green-500 bg-green-500/20' : olympOpenCount >= s.req ? 'border-yellow-400 bg-yellow-400/10' : 'border-white/10 bg-black/20'}`}>
                                            <div className="flex items-center gap-3">
                                                <div className="w-8 h-8 rounded-full bg-yellow-500 flex items-center justify-center font-bold text-black">{s.req}</div>
                                                <span className="text-sm font-bold">{s.label}</span>
                                            </div>
                                            {olympLadderClaimed.includes(i) ? <span className="text-green-400">‚úÖ</span> : olympOpenCount >= s.req ? <span className="text-yellow-400">–ì–û–¢–û–í–û</span> : <span className="text-white/30">{olympOpenCount}/{s.req}</span>}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                );
                if (eventSubScreen === 'shop') return (
                    <div className="min-h-screen bg-cover bg-center p-4" style={{backgroundImage: "url('gefest.jpg')"}}>
                        <div className="flex justify-between items-center mb-6">
                            <button onClick={() => setEventSubScreen('main')} className="bg-black/50 p-2 rounded-lg font-bold">‚Üê –ù–∞–∑–∞–¥</button>
                            <h2 className="font-greek text-2xl bright-label">–õ–∞–≤–∫–∞ –ì–µ—Ñ–µ—Å—Ç–∞üèµÔ∏è</h2>
                        </div>
                        <div className="olympus-glass p-6 rounded-2xl text-center mb-6">
                            <h3 className="font-greek text-2xl mb-2 bright-label">–û–ë–ú–ï–ù–Ø–ô –ü–†–ï–î–ú–ï–¢–´ –ù–ê –¶–ï–ù–ù–û–°–¢–òüíé</h3>
                            <p className="text-yellow-100 text-sm">–û–±–º–µ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω —Ä–∞–∑ –≤ 3 –º–∏–Ω—É—Ç—ã</p>
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            {inventory.length === 0 ? <p className="col-span-2 text-center text-xl font-greek py-10 bright-label">–ü—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω!</p> :
                                inventory.map(item => (
                                    <div key={item.uid} className="olympus-glass p-4 rounded-xl text-center flex flex-col items-center">
                                        <div className="text-5xl mb-2">{item.emoji}</div>
                                        <div className="font-bold text-sm mb-3 h-8 flex items-center">{item.name}</div>
                                        <button onClick={() => exchangeItem(item)} className="w-full py-2 bg-yellow-500 text-black rounded-lg font-bold text-xs uppercase tracking-tighter">–û–±–º–µ–Ω—è—Ç—å</button>
                                        {item.emoji === 'üß±' && <span className="neon-red text-[10px] mt-1 uppercase">–í—ã–≥–æ–¥–Ω–æ!</span>}
                                    </div>
                                ))
                            }
                        </div>
                    </div>
                );
                if (eventSubScreen === 'heroes') return (
                    <div className="min-h-screen bg-cover bg-center p-4" style={{backgroundImage: "url('hero.jpg')"}}>
                        <button onClick={() => setEventSubScreen('main')} className="bg-black/50 p-2 rounded-lg font-bold mb-6">‚Üê –ù–∞–∑–∞–¥</button>
                        <div className="olympus-glass p-6 rounded-3xl">
                            <h2 className="font-greek text-3xl mb-8 text-center bright-label">–ì–µ—Ä–æ–∏ –û–ª–∏–º–ø–∞üèÜ</h2>
                            <div className="space-y-4">
                                {olympLeaderboard.map((p, i) => (
                                    <div key={p.id} className="flex items-center justify-between p-4 bg-black/40 rounded-2xl border-2 border-yellow-500/30">
                                        <div className="flex items-center gap-4">
                                            <span className="text-2xl">{i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : i + 1}</span>
                                            <div className="w-12 h-12 rounded-full bg-gradient-to-br from-yellow-400 to-orange-600 flex items-center justify-center text-xl font-bold">{p.name[0]}</div>
                                            <span className="font-bold text-lg">{p.name}</span>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-yellow-400 font-bold text-xl">{p.count}</div>
                                            <div className="text-[10px] uppercase opacity-50">–ö–µ–π—Å–æ–≤</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                            <p className="mt-10 text-center text-yellow-200 font-greek text-sm italic">–¢–æ–ø 3 –ø–æ–ª—É—á–∞—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã –≤ –∫–æ–Ω—Ü–µ –∏–≤–µ–Ω—Ç–∞!</p>
                        </div>
                    </div>
                );
            };
            if (isLoading) return <div className="min-h-screen flex items-center justify-center bg-black"><div className="w-16 h-16 border-4 border-yellow-500 border-t-transparent rounded-full animate-spin"></div></div>;
            return (
                <div className="min-h-screen pb-24 max-w-lg mx-auto bg-gray-950 relative">
                    <header className="p-4 flex justify-between items-center glass sticky top-0 z-50">
                        <h1 onClick={handleTitleClick} className="text-xl font-bold cursor-pointer select-none hover:text-yellow-400 transition font-greek tracking-widest uppercase">Step By Step</h1>
                        <button onClick={() => setCurrentScreen('profile')} className="bg-gradient-to-r from-yellow-400 to-orange-500 px-4 py-2 rounded-full font-bold text-gray-900 shadow-lg text-sm">{balance.toFixed(0)} ‚≠êÔ∏è</button>
                    </header>
                    {showAdminLogin && (
                        <div className="fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-4">
                            <div className="glass rounded-2xl p-6 w-full">
                                <h2 className="text-xl font-bold text-center mb-4">üîê –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                                <input type="text" placeholder="–õ–æ–≥–∏–Ω" value={adminLogin} onChange={e => setAdminLogin(e.target.value)} className="w-full bg-gray-800 rounded-lg px-4 py-3 mb-3" />
                                <input type="password" placeholder="–ü–∞—Ä–æ–ª—å" value={adminPassword} onChange={e => setAdminPassword(e.target.value)} className="w-full bg-gray-800 rounded-lg px-4 py-3 mb-4" />
                                <button onClick={checkAdmin} className="w-full bg-yellow-600 py-3 rounded-xl font-bold mb-2">–í–æ–π—Ç–∏</button>
                                <button onClick={() => setShowAdminLogin(false)} className="w-full bg-gray-700 py-2 rounded-xl text-sm">–û—Ç–º–µ–Ω–∞</button>
                            </div>
                        </div>
                    )}
                    {isAdmin && (
                        <div className="fixed inset-0 bg-gray-900 z-[110] p-4 overflow-y-auto">
                            <div className="flex justify-between mb-6">
                                <h2 className="text-2xl font-bold">üõ† –ê–¥–º–∏–Ω</h2>
                                <button onClick={() => setIsAdmin(false)}>–ó–∞–∫—Ä—ã—Ç—å</button>
                            </div>
                            <div className="space-y-4">
                                <button onClick={() => setBalance(b => b + 1000)} className="w-full bg-green-600 p-4 rounded-xl">+1000 ‚≠êÔ∏è</button>
                                <button onClick={() => setCases(c => ({...c, olymp: {freeCount: (c.olymp.freeCount||0)+10}}))} className="w-full bg-yellow-600 p-4 rounded-xl">+10 –û–ª–∏–º–ø</button>
                                <button onClick={() => { if(confirm('–û—á–∏—Å—Ç–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç?')) { localStorage.clear(); window.location.reload(); } }} className="w-full bg-red-600 p-4 rounded-xl">–°–ë–†–û–° –ê–ö–ö–ê–£–ù–¢–ê</button>
                            </div>
                        </div>
                    )}
                    <main className="p-4">
                        {currentScreen === 'cases' && (
                            <div className="space-y-6">
                                <h2 className="text-2xl font-bold text-center bright-label">üé∞ –ú–∞–≥–∞–∑–∏–Ω</h2>
                                <div className="grid grid-cols-2 gap-4">
                                    {Object.values(cases).filter(c => !c.locked).map(c => (
                                        <div key={c.id} className="glass rounded-2xl p-4 text-center border border-white/10 hover:border-yellow-500/50 transition transform active:scale-95" onClick={() => setSelectedCase(c)}>
                                            <div className="text-5xl mb-3 drop-shadow-md">{c.emoji}</div>
                                            <div className="font-bold text-sm mb-1">{c.name}</div>
                                            <div className="text-yellow-400 font-bold text-xs">{c.freeCount > 0 ? '–ë–ï–°–ü–õ–ê–¢–ù–û' : `${c.discountPrice || c.price} ‚≠êÔ∏è`}</div>
                                            {c.discountPrice && <div className="text-[10px] line-through text-red-500">{c.price}‚≠êÔ∏è</div>}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        {currentScreen === 'events' && renderOlympScreen()}
                        {currentScreen === 'tasks' && (
                            <div className="space-y-4">
                                <h2 className="text-2xl font-bold text-center mb-6">üìã –ó–∞–¥–∞–Ω–∏—è</h2>
                                <div className="glass p-4 rounded-xl border border-white/10 flex justify-between items-center">
                                    <div>
                                        <div className="font-bold">–ü—Ä–æ–∫—Ä—É—Ç–∏ –∫–µ–π—Å ¬´–ö–∞—Ä—Ç–æ–Ωüì¶¬ª 7 —Ä–∞–∑</div>
                                        <div className="text-xs text-blue-400">–ù–∞–≥—Ä–∞–¥–∞: 1 –∫–µ–π—Å ¬´–ê–ª–º–∞–∑üíé¬ª</div>
                                        <div className="text-[10px] opacity-50 mt-1">–ü—Ä–æ–≥—Ä–µ—Å—Å: {tasks.openCardboard.count}/7</div>
                                    </div>
                                    {tasks.openCardboard.completed ? <span className="text-green-400">‚úÖ</span> : <span className="text-yellow-500">‚è≥</span>}
                                </div>
                                <div className="glass p-4 rounded-xl border border-white/10 flex justify-between items-center">
                                    <div>
                                        <div className="font-bold">–ü–æ–ø–æ–ª–Ω–∏ –±–∞–ª–∞–Ω—Å –Ω–∞ 50‚≠êÔ∏è</div>
                                        <div className="text-xs text-blue-400">–ù–∞–≥—Ä–∞–¥–∞: 50‚≠êÔ∏è</div>
                                    </div>
                                    {tasks.deposit50.completed ? <span className="text-green-400">‚úÖ</span> : <button onClick={() => buyStars(50)} className="bg-blue-600 px-3 py-1 rounded-lg text-xs">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>}
                                </div>
                            </div>
                        )}
                        {currentScreen === 'games' && !currentGame && (
                            <div className="space-y-4">
                                <div className="relative h-48 rounded-2xl overflow-hidden cursor-pointer group" onClick={() => setCurrentGame('gerakl')} style={{backgroundImage: "url('gerakl.jpg')", backgroundSize: 'cover'}}>
                                    <div className="absolute inset-0 bg-black/50 group-hover:bg-black/30 transition"></div>
                                    <div className="absolute inset-0 flex flex-col items-center justify-center">
                                        <h3 className="font-greek text-2xl bright-label">13 –ü–æ–¥–≤–∏–≥ –ì–µ—Ä–∞–∫–ª–∞ üåä</h3>
                                        <p className="text-xs text-yellow-100 mt-2 tracking-widest uppercase">–°–æ–≤–µ—Ä—à–∏ –ø–æ–¥–≤–∏–≥!</p>
                                    </div>
                                </div>
                            </div>
                        )}
                        {currentGame === 'gerakl' && (
                            <div className="fixed inset-0 bg-gray-900 z-[60] p-4 flex flex-col">
                                <div className="flex justify-between items-center mb-10">
                                    <h3 className="font-greek text-xl bright-label">13 –ü–æ–¥–≤–∏–≥ –ì–µ—Ä–∞–∫–ª–∞ üåä</h3>
                                    <button onClick={() => { setCurrentGame(null); setGeraklGameActive(false); }} className="text-3xl">√ó</button>
                                </div>
                                {!geraklGameActive && !geraklResult ? (
                                    <div className="flex-1 flex flex-col items-center justify-center">
                                        <div className="text-8xl mb-6">ü™¨</div>
                                        <div className="text-center mb-10">
                                            <p className="text-gray-400 mb-2">–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞:</p>
                                            <input type="number" value={geraklBet} onChange={e => setGeraklBet(Math.max(25, Number(e.target.value)))} className="bg-gray-800 text-3xl font-bold text-center w-32 py-2 rounded-xl" />
                                        </div>
                                        <button onClick={startGerakl} className="w-full max-w-xs py-4 bg-orange-600 rounded-2xl font-bold text-xl shadow-lg">–ù–ê–ß–ê–¢–¨ (25‚≠êÔ∏è –º–∏–Ω)</button>
                                    </div>
                                ) : (
                                    <div className="flex-1 flex flex-col items-center justify-center">
                                        {geraklResult === 'ice' ? (
                                            <div className="text-center">
                                                <div className="text-8xl mb-6">üßä</div>
                                                <h2 className="text-4xl font-bold text-blue-400 mb-4 uppercase">–õ–Å–î!</h2>
                                                <button onClick={() => setGeraklResult(null)} className="px-10 py-3 bg-gray-700 rounded-xl font-bold">–ü–û–ü–†–û–ë–û–í–ê–¢–¨ –°–ù–û–í–ê</button>
                                            </div>
                                        ) : geraklResult === 'win' ? (
                                            <div className="text-center">
                                                <div className="text-8xl mb-6">üî•</div>
                                                <h2 className="text-4xl font-bold text-green-400 mb-4 uppercase">–ü–û–ë–ï–î–ê!</h2>
                                                <p className="text-2xl mb-10">+{Math.floor(geraklBet * GERAKL_MULTIPLIERS[geraklRound])}‚≠êÔ∏è</p>
                                                <button onClick={() => setGeraklResult(null)} className="px-10 py-3 bg-gray-700 rounded-xl font-bold">–ó–ê–í–ï–†–®–ò–¢–¨</button>
                                            </div>
                                        ) : (
                                            <>
                                                <div className="text-6xl font-bold text-yellow-400 mb-2">{GERAKL_MULTIPLIERS[geraklRound]}x</div>
                                                <div className="text-xl text-gray-400 mb-10">–í—ã–∏–≥—Ä—ã—à: {Math.floor(geraklBet * GERAKL_MULTIPLIERS[geraklRound])}‚≠êÔ∏è</div>
                                                <div className="flex gap-3 mb-10">
                                                    {[...Array(11)].map((_, i) => (
                                                        <div key={i} className={`w-3 h-8 rounded-full ${i <= geraklRound ? 'bg-orange-500' : 'bg-gray-800'}`}></div>
                                                    ))}
                                                </div>
                                                <div className="flex w-full gap-4 max-w-sm">
                                                    <button onClick={nextGerakl} className="flex-1 py-4 bg-orange-600 rounded-2xl font-bold text-lg">–û–ì–û–ù–¨ üî•</button>
                                                    <button onClick={cashoutGerakl} className="flex-1 py-4 bg-blue-600 rounded-2xl font-bold text-lg">–ó–ê–ë–†–ê–¢–¨ üßä</button>
                                                </div>
                                            </>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}
                        {currentScreen === 'profile' && (
                            <div className="space-y-6">
                                <div className="glass p-6 rounded-3xl text-center">
                                    <div className="w-24 h-24 mx-auto rounded-full bg-gradient-to-br from-yellow-400 to-orange-500 mb-4 flex items-center justify-center text-4xl font-bold border-4 border-white/10">{user?.name[0]}</div>
                                    <h2 className="text-2xl font-bold mb-1">{user?.name}</h2>
                                    <p className="text-yellow-500 font-bold mb-6 text-xl">{balance.toFixed(0)} ‚≠êÔ∏è</p>
                                    <div className="flex gap-2">
                                        <button onClick={() => { if(tasks.depositMajor?.completed) alert('–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—ã–≤–æ–¥–∞ –ø—Ä–∏–∑–æ–≤!'); else alert('–ß—Ç–æ–±—ã –≤—ã–≤–µ—Å—Ç–∏ NFT –ø—Ä–∏–∑—ã, –∑–≤–µ–∑–¥—ã –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ ‚Äû–ü–æ–ø–æ–ª–Ω–∏ –Ω–∞ 350‚≠êÔ∏è‚Äú'); }} className="flex-1 py-3 bg-purple-600 rounded-xl font-bold text-sm">–í—ã–≤–µ—Å—Ç–∏ –ø—Ä–∏–∑—ãüìä</button>
                                    </div>
                                </div>
                                <div className="glass p-4 rounded-xl">
                                    <h3 className="font-bold mb-3 flex justify-between">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å <span className="text-xs opacity-50">{inventory.length}/{inventorySlots}</span></h3>
                                    <div className="grid grid-cols-5 gap-2">
                                        {[...Array(inventorySlots)].map((_, i) => (
                                            <div key={i} className="aspect-square bg-white/5 rounded-lg border border-white/5 flex items-center justify-center text-3xl">
                                                {inventory[i] ? <span onClick={() => { if(confirm(`–ü—Ä–æ–¥–∞—Ç—å ${inventory[i].name} –∑–∞ ${inventory[i].sellPrice || 0}‚≠êÔ∏è?`)) { setBalance(b => b + (inventory[i].sellPrice || 0)); setInventory(p => p.filter(it => it.uid !== inventory[i].uid)); } }} className="hover:scale-110 transition cursor-pointer">{inventory[i].emoji}</span> : null}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="glass p-4 rounded-xl">
                                    <h3 className="font-bold mb-2 text-sm uppercase">–ü—Ä–æ–º–æ–∫–æ–¥</h3>
                                    <div className="flex gap-2">
                                        <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥" value={promoCode} onChange={e => setPromoCode(e.target.value)} className="flex-1 bg-white/5 rounded-lg px-4 border border-white/10 uppercase" />
                                        <button onClick={checkPromo} className="bg-yellow-600 px-6 py-2 rounded-lg font-bold">–û–ö</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                    {selectedCase && (
                        <div className="fixed inset-0 bg-black/95 z-[90] flex items-center justify-center p-4">
                            <div className="w-full max-w-lg" ref={rouletteContainerRef}>
                                <div className="flex justify-between items-center mb-6 px-4">
                                    <h3 className="text-2xl font-bold flex items-center gap-2">{selectedCase.emoji} {selectedCase.name}</h3>
                                    <button onClick={() => { setSelectedCase(null); setSpinResult(null); setFakeItems([]); }} className="text-4xl">√ó</button>
                                </div>
                                <div className="roulette-container mb-10">
                                    <div className="roulette-pointer"></div>
                                    <div key={rouletteKey} className="roulette-inner" style={{ transform: `translateX(${rouletteOffset}px)` }}>
                                        {fakeItems.length > 0 ? fakeItems.map((item, i) => (
                                            <div key={i} className="roulette-item">
                                                <div className="emoji">{item.emoji}</div>
                                                <div className="name">{item.name}</div>
                                            </div>
                                        )) : [...Array(80)].map((_, i) => <div key={i} className="roulette-item"><div className="emoji">?</div></div>)}
                                    </div>
                                </div>
                                <div className="px-4">
                                    {spinResult ? (
                                        <div className="text-center">
                                            <p className="text-2xl font-bold mb-6 bright-label">–í—ã–ø–∞–ª–æ: {spinResult.name}!</p>
                                            <button onClick={() => { setSpinResult(null); openCase(selectedCase.id); }} className="w-full py-4 bg-green-600 rounded-xl font-bold text-lg mb-3">–û–¢–ö–†–´–¢–¨ –ï–©–ï</button>
                                            <button onClick={() => { setSelectedCase(null); setSpinResult(null); }} className="w-full py-3 bg-gray-700 rounded-xl font-bold text-sm">–ó–ê–ö–†–´–¢–¨</button>
                                        </div>
                                    ) : (
                                        <button onClick={() => openCase(selectedCase.id)} disabled={isSpinning} className="w-full py-5 bg-gradient-to-r from-yellow-600 to-yellow-400 rounded-2xl font-bold text-xl shadow-xl disabled:opacity-50">
                                            {isSpinning ? '–£–î–ê–ß–ê –ë–õ–ò–ó–ö–û...' : `–û–¢–ö–†–´–¢–¨ –ó–ê ${cases[selectedCase.id]?.freeCount > 0 ? '–ë–ï–°–ü–õ–ê–¢–ù–û' : (selectedCase.discountPrice || selectedCase.price) + ' ‚≠êÔ∏è'}`}
                                        </button>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                    {showChoiceModal && (
                        <div className="fixed inset-0 bg-black/95 z-[120] flex items-center justify-center p-4 text-center">
                            <div className="olympus-glass p-8 rounded-3xl max-w-sm w-full">
                                <h2 className="font-greek text-3xl mb-6 bright-label">–í–´–ë–û–† –ë–û–ì–û–í</h2>
                                {showChoiceModal === 'poseidon' && (
                                    <>
                                        <p className="mb-8">–ü–æ—Å–µ–π–¥–æ–Ωüî± –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ç–µ–±–µ –¥–∞—Ä. –í—ã–±–∏—Ä–∞–π —Å —É–º–æ–º:</p>
                                        <div className="space-y-4">
                                            <button onClick={() => { setBalance(b => b + 200); setShowChoiceModal(null); }} className="w-full py-4 bg-yellow-600 rounded-xl font-bold">200 ‚≠êÔ∏è</button>
                                            <button onClick={() => { setCases(c => ({...c, platinum: {freeCount: (c.platinum.freeCount||0)+5}})); setShowChoiceModal(null); }} className="w-full py-4 bg-blue-600 rounded-xl font-bold">5 –ö–µ–π—Å–æ–≤ –ü–ª–∞—Ç–∏–Ω–∞üíç</button>
                                        </div>
                                    </>
                                )}
                                {showChoiceModal === 'hades' && (
                                    <>
                                        <p className="mb-8">–ê–∏–¥üî• –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å–¥–µ–ª–∫—É:</p>
                                        <div className="space-y-4">
                                            <button onClick={() => { setBalance(b => b + 250); setShowChoiceModal(null); }} className="w-full py-4 bg-red-600 rounded-xl font-bold">250 ‚≠êÔ∏è</button>
                                            <button onClick={() => { setCases(c => ({...c, collector: {locked: false}})); setShowChoiceModal(null); }} className="w-full py-4 bg-purple-600 rounded-xl font-bold">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å ¬´–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä¬ªüé©</button>
                                        </div>
                                    </>
                                )}
                                {showChoiceModal === 'ice' && (
                                    <>
                                        <p className="mb-8">–õ–µ–¥—è–Ω–æ–π –∫—Ä–∏—Å—Ç–∞–ª–ª üßä –æ—á–µ–Ω—å —Ü–µ–Ω–µ–Ω:</p>
                                        <div className="space-y-4">
                                            <button onClick={() => { setBalance(b => b + 500); setShowChoiceModal(null); }} className="w-full py-4 bg-cyan-600 rounded-xl font-bold">500 ‚≠êÔ∏è</button>
                                            <button onClick={() => { setCases(c => ({...c, star: {freeCount: (c.star.freeCount||0)+25}})); setShowChoiceModal(null); }} className="w-full py-4 bg-yellow-600 rounded-xl font-bold">25 –ö–µ–π—Å–æ–≤ –ó–≤–µ–∑–¥–Ω—ã–π‚≠êÔ∏è</button>
                                        </div>
                                    </>
                                )}
                            </div>
                        </div>
                    )}
                    {showZeusModal && (
                        <div className="fixed inset-0 bg-black/95 z-[120] flex items-center justify-center p-4 text-center">
                            <div className="olympus-glass p-8 rounded-3xl max-w-sm w-full">
                                <div className="text-7xl mb-6">‚ö°Ô∏è</div>
                                <h2 className="font-greek text-3xl mb-6 bright-label">–ó–ï–í–°‚ö°Ô∏è –ü–†–û–°–ù–£–õ–°–Ø</h2>
                                <p className="mb-8 text-sm leading-relaxed">–†–∞–∑–±—É–¥–∏—Ç–µ –ó–µ–≤—Å–∞‚ö°Ô∏è —Å–µ–π—á–∞—Å –∏ –ø–æ–ª—É—á–∏—Ç–µ 2 –ö–µ–π—Å–∞ ‚Äû–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä‚Äú (+—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞) –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –∏ –ø–æ–ª—É—á–∏—Ç–µ –Ω–∞–≥—Ä–∞–¥—É –ª—É—á—à–µ –ø–æ–∑–∂–µ!</p>
                                <div className="space-y-4">
                                    <button onClick={() => { setCases(c => ({...c, collector: {locked: false, freeCount: (c.collector.freeCount||0)+2}})); setShowZeusModal(false); alert('–í—ã –ø—Ä–æ–±—É–¥–∏–ª–∏ –º–æ—â—å –ó–µ–≤—Å–∞! +2 –∫–µ–π—Å–∞ –ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä'); }} className="w-full py-4 bg-yellow-500 text-black rounded-xl font-black">–†–ê–ó–ë–£–î–ò–¢–¨‚ö°Ô∏è</button>
                                    <button onClick={() => { addToInventory({id:'zeus_item', name:'–ó–µ–≤—Å‚ö°Ô∏è (–°–ø—è—â–∏–π)', emoji:'‚ö°Ô∏è', sellPrice: 0}); setShowZeusModal(false); alert('–ó–µ–≤—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å–≤–æ–π —Å–æ–Ω...'); }} className="w-full py-4 bg-gray-700 rounded-xl font-bold">–û–°–¢–ê–í–ò–¢–¨üí§</button>
                                </div>
                            </div>
                        </div>
                    )}
                    <nav className="fixed bottom-0 left-0 right-0 glass border-t border-white/10 p-2 z-40 max-w-lg mx-auto">
                        <div className="flex justify-around">
                            {[ 
                                { id: 'tasks', emoji: 'üìã', label: '–ó–∞–¥–∞–Ω–∏—è' }, 
                                { id: 'cases', emoji: 'üéÅ', label: '–ö–µ–π—Å—ã' }, 
                                { id: 'events', emoji: 'üèõÔ∏è', label: '–ò–≤–µ–Ω—Ç—ã' }, 
                                { id: 'games', emoji: 'üéÆ', label: '–ò–≥—Ä—ã' }, 
                                { id: 'profile', emoji: 'üë§', label: '–ü—Ä–æ—Ñ–∏–ª—å' } 
                            ].map(s => (
                                <button key={s.id} onClick={() => { setCurrentScreen(s.id); setEventSubScreen('main'); }} className={`flex flex-col items-center p-2 rounded-lg transition ${currentScreen === s.id ? 'text-yellow-400 scale-110' : 'text-gray-400'}`}>
                                    <span className="text-2xl">{s.emoji}</span>
                                    <span className="text-[10px] font-bold uppercase tracking-tighter">{s.label}</span>
                                </button>
                            ))}
                        </div>
                    </nav>
                </div>
            );
        }
        
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
