<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Step By Step Game | Official</title>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
tailwind.config = {
    darkMode: 'class',
    theme: {
        extend: {
            colors: {
                primary: '#6366f1',
                secondary: '#8b5cf6',
                accent: '#f59e0b',
                ice: '#00d2ff',
                gold: '#FFD700',
                pro: '#ff4757'
            },
            animation: {
                'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            }
        }
    }
}
</script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
@keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
@keyframes scaleIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

/* --- –ò–î–ï–ê–õ–¨–ù–ê–Ø –†–£–õ–ï–¢–ö–ê --- */
.roulette-container {
    position: relative; width: 100%; height: 180px; overflow: hidden;
    background: rgba(0, 0, 0, 0.6); border-radius: 20px;
    border: 3px solid rgba(255, 255, 255, 0.1); box-shadow: inset 0 0 30px rgba(0,0,0,0.9);
}
.roulette-inner {
    display: flex; position: absolute; left: 0; top: 25px;
    transition: transform 6.5s cubic-bezier(0.12, 0, 0.05, 1);
    will-change: transform;
}
.roulette-item {
    width: 120px; height: 130px; flex-shrink: 0; margin: 0 10px;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.02));
    border-radius: 16px; border: 1px solid rgba(255,255,255,0.1);
}
.roulette-item.winner-glow { box-shadow: 0 0 25px rgba(99, 102, 241, 0.6); border-color: #6366f1; }
.roulette-pointer {
    position: absolute; left: 50%; top: 0; bottom: 0; width: 4px;
    background: #ff4757; z-index: 30; transform: translateX(-50%);
    box-shadow: 0 0 20px #ff4757;
}
.roulette-pointer::before {
    content: ''; position: absolute; top: -5px; left: 50%; transform: translateX(-50%);
    border-left: 12px solid transparent; border-right: 12px solid transparent; border-top: 18px solid #ff4757;
}

/* --- –ö–ê–¢–û–ö --- */
.ice-circle {
    width: 320px; height: 320px; border-radius: 50%; border: 6px solid rgba(0,210,255,0.4);
    position: relative; overflow: hidden;
    background: radial-gradient(circle, rgba(0,210,255, 0.1) 0%, rgba(0,128,255,0.3) 100%);
    box-shadow: 0 0 40px rgba(0,210,255,0.2);
}
.ice-ball {
    position: absolute; width: 35px; height: 35px; background: radial-gradient(circle at 30% 30%, #fff, #00d2ff);
    border-radius: 50%; z-index: 20; transform: translate(-50%, -50%);
    box-shadow: 0 0 25px rgba(0,210,255,1); border: 2px solid white;
}
.glass { background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.15); }

/* --- –ö–ï–ô–°–´ --- */
.case-cardboard { background: linear-gradient(135deg, #78350f 0%, #b45309 100%); border: 2px solid #f59e0b; }
.case-collector { background: linear-gradient(135deg, #991b1b 0%, #450a0a 100%); border: 3px solid #fbbf24; position: relative; }
.case-collector::after { content: 'HAT'; position: absolute; top: 5px; right: 5px; font-size: 8px; color: gold; opacity: 0.5; }

.fullscreen-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.97); z-index: 1000; overflow-y: auto; display: flex; align-items: center; justify-content: center; }
</style>
</head>
<body class="bg-slate-950 text-white min-h-screen overflow-x-hidden selection:bg-indigo-500">
<div id="root"></div>

<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="text/babel">
const { useState, useEffect, useRef, useMemo } = React;

// --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
const firebaseConfig = {
    apiKey: "AIzaSyDZPRiByz69HQa8b7GFMCJeqq56J3Y-bOY",
    authDomain: "step-by-step-279df.firebaseapp.com",
    databaseURL: "https://step-by-step-279df-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "step-by-step-279df",
    storageBucket: "step-by-step-279df.firebasestorage.app",
    messagingSenderId: "302641152597",
    appId: "1:302641152597:web:6479b9ae03104666cd8adc"
};
if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const TelegramWebApp = window.Telegram?.WebApp;

const CASE_REWARDS = {
    cardboard: [
        { id: 'cb1', name: '0.25 ‚≠êÔ∏è', realChance: 80, type: 'stars', value: 0.25, emoji: '‚≠êÔ∏è' },
        { id: 'cb2', name: '0.75 ‚≠êÔ∏è', realChance: 10, type: 'stars', value: 0.75, emoji: '‚≠êÔ∏è' },
        { id: 'cb3', name: '1.5 ‚≠êÔ∏è', realChance: 6, type: 'stars', value: 1.5, emoji: '‚≠êÔ∏è' },
        { id: 'cb4', name: '5 ‚≠êÔ∏è', realChance: 2, type: 'stars', value: 5, emoji: '‚≠êÔ∏è' },
        { id: 'cb5', name: '–ú–∏—à–∫–∞ üß∏', realChance: 1.5, type: 'item', sellPrice: 20, emoji: 'üß∏' },
        { id: 'cb6', name: '–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç PRO üíé', realChance: 0.5, type: 'collectible', emoji: 'üíé' }
    ],
    coal: [
        { id: 'cl1', name: '2.5 ‚≠êÔ∏è', realChance: 60, type: 'stars', value: 2.5, emoji: '‚≠êÔ∏è' },
        { id: 'cl2', name: '–ö–∏—Ä–∫–∞ ‚õèÔ∏è', realChance: 15, type: 'item', sellPrice: 15, emoji: '‚õèÔ∏è' },
        { id: 'cl3', name: 'Material PRO üí©', realChance: 1, type: 'collectible', emoji: 'üí©' },
        { id: 'cl4', name: '15 ‚≠êÔ∏è', realChance: 24, type: 'stars', value: 15, emoji: '‚≠êÔ∏è' }
    ],
    collector: [
        { id: 'col1', name: 'Teddy PRO üß∏', realChance: 55, type: 'collectible', emoji: 'üß∏' },
        { id: 'col2', name: 'Gift PRO üéÅ', realChance: 20, type: 'collectible', emoji: 'üéÅ' },
        { id: 'col3', name: 'Rocket PRO üöÄ', realChance: 15, type: 'collectible', emoji: 'üöÄ' },
        { id: 'col4', name: 'Cup PRO üèÜ', realChance: 5, type: 'collectible', emoji: 'üèÜ' },
        { id: 'col5', name: 'Ramen PRO üçú', realChance: 5, type: 'collectible', emoji: 'üçú' },
        { id: 'col6', name: 'Top hat PRO üé©', realChance: 0, type: 'collectible', emoji: 'üé©' },
        { id: 'col7', name: 'Rare bird PRO ü¶Ö', realChance: 0, type: 'collectible', emoji: 'ü¶Ö' }
    ],
    diamond: [{ id: 'd1', name: '10 ‚≠êÔ∏è', realChance: 80, type: 'stars', value: 10, emoji: '‚≠êÔ∏è' }, { id: 'd2', name: 'PRO Diamond üíé', realChance: 20, type: 'collectible', emoji: 'üíé' }],
    platinum: [{ id: 'p1', name: '50 ‚≠êÔ∏è', realChance: 90, type: 'stars', value: 50, emoji: '‚≠êÔ∏è' }, { id: 'p2', name: 'PRO Ring üíç', realChance: 10, type: 'collectible', emoji: 'üíç' }],
    gold: [{ id: 'g1', name: '100 ‚≠êÔ∏è', realChance: 95, type: 'stars', value: 100, emoji: '‚≠êÔ∏è' }, { id: 'g2', name: 'PRO Crown üëë', realChance: 5, type: 'collectible', emoji: 'üëë' }],
    elite: [{ id: 'e1', name: '250 ‚≠êÔ∏è', realChance: 98, type: 'stars', value: 250, emoji: '‚≠êÔ∏è' }, { id: 'e2', name: 'PRO Sword ‚öîÔ∏è', realChance: 2, type: 'collectible', emoji: '‚öîÔ∏è' }],
    winter: [{ id: 'w1', name: '25 ‚≠êÔ∏è', realChance: 85, type: 'stars', value: 25, emoji: '‚≠êÔ∏è' }, { id: 'w2', name: 'PRO Scarf üß£', realChance: 15, type: 'collectible', emoji: 'üß£' }],
    money: [{ id: 'm1', name: '300 ‚≠êÔ∏è', realChance: 99, type: 'stars', value: 300, emoji: '‚≠êÔ∏è' }, { id: 'm2', name: 'PRO Cash üíµ', realChance: 1, type: 'collectible', emoji: 'üíµ' }],
    major: [{ id: 'mj1', name: '1000 ‚≠êÔ∏è', realChance: 99.5, type: 'stars', value: 1000, emoji: '‚≠êÔ∏è' }, { id: 'mj2', name: 'PRO Car üöó', realChance: 0.5, type: 'collectible', emoji: 'üöó' }]
};

const INITIAL_CASES = {
    cardboard: { id: 'cardboard', name: '–ö–∞—Ä—Ç–æ–Ω', emoji: 'üì¶', price: 3, color: 'case-cardboard', locked: false, isNew: true, freeCount: 0 },
    coal: { id: 'coal', name: '–£–≥–æ–ª—ë–∫', emoji: 'ü™®', price: 22, originalPrice: 22, discountPrice: 20, color: 'bg-zinc-700', locked: false, freeCount: 0 },
    diamond: { id: 'diamond', name: '–ê–ª–º–∞–∑', emoji: 'üíé', price: 50, discountPrice: 35, color: 'bg-cyan-600', locked: false, freeCount: 0 },
    platinum: { id: 'platinum', name: '–ü–ª–∞—Ç–∏–Ω–∞', emoji: 'üíø', price: 100, color: 'bg-slate-400', locked: false },
    gold: { id: 'gold', name: '–ó–æ–ª–æ—Ç–æ–π', emoji: 'üëë', price: 250, color: 'bg-yellow-500', locked: false },
    winter: { id: 'winter', name: '–ó–∏–º–Ω–∏–π', emoji: '‚òÉÔ∏è', price: 125, color: 'bg-sky-400', locked: false, isNew: true },
    money: { id: 'money', name: '–î–µ–Ω–µ–∂–Ω—ã–π', emoji: 'üíµ', price: 350, color: 'bg-emerald-600', locked: false },
    elite: { id: 'elite', name: '–≠–ª–∏—Ç–∞', emoji: 'üéñ', price: 500, color: 'bg-rose-600', locked: false, freeCount: 0 },
    major: { id: 'major', name: '–ú–∞–∂–æ—Ä', emoji: 'ü§¥', price: 800, color: 'bg-indigo-700', locked: true },
    collector: { id: 'collector', name: '–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä', emoji: 'üé©', price: 650, color: 'case-collector', locked: true, isNew: true }
};
    function App() {
    const [currentScreen, setCurrentScreen] = useState('cases');
    const [balance, setBalance] = useState(0);
    const [cases, setCases] = useState(INITIAL_CASES);
    const [inventory, setInventory] = useState([]);
    const [inventorySlots, setInventorySlots] = useState(5);
    const [tasks, setTasks] = useState({ subscribe: { completed: false }, depositMajor: { completed: false } });
    const [user, setUser] = useState(null);
    const [isLoading, setIsLoading] = useState(true);

    // –°–æ—Å—Ç–æ—è–Ω–∏—è –†—É–ª–µ—Ç–∫–∏
    const [selectedCase, setSelectedCase] = useState(null);
    const [isSpinning, setIsSpinning] = useState(false);
    const [spinResult, setSpinResult] = useState(null);
    const [rouletteOffset, setRouletteOffset] = useState(0);
    const [fakeItems, setFakeItems] = useState([]);
    const [rouletteKey, setRouletteKey] = useState(0);
    const rouletteContainerRef = useRef(null);

    // –°–æ—Å—Ç–æ—è–Ω–∏—è –ö–∞—Ç–∫–∞
    const [currentGame, setCurrentGame] = useState(null);
    const [iceLobby, setIceLobby] = useState(null);
    const [myBet, setMyBet] = useState(25);
    const [hasBet, setHasBet] = useState(false);
    const [gameStatus, setGameStatus] = useState('waiting');
    const [ballPos, setBallPos] = useState({ x: 50, y: 50 });
    const [icePlayerCount, setIcePlayerCount] = useState(0);
    const [timerRemaining, setTimerRemaining] = useState(0);
    const [showPrizeChest, setShowPrizeChest] = useState(false);
    const [chestPrizes, setChestPrizes] = useState([]);

    // –ê–¥–º–∏–Ω–∫–∞ –∏ –ü—Ä–æ—Ñ–∏–ª–∏
    const [showAdminLogin, setShowAdminLogin] = useState(false);
    const [isAdmin, setIsAdmin] = useState(false);
    const [adminLogin, setAdminLogin] = useState('');
    const [adminPassword, setAdminPassword] = useState('');
    const [allUsers, setAllUsers] = useState([]);
    const [selectedUser, setSelectedUser] = useState(null);
    const [adminAttempts, setAdminAttempts] = useState(0);
    const [onlineCount, setOnlineCount] = useState(0);
    const [showCollectibleModal, setShowCollectibleModal] = useState(false);
    const [selectedCollectible, setSelectedCollectible] = useState(null);
    const [totalDeposits, setTotalDeposits] = useState(0);
    const [freeEliteSpin, setFreeEliteSpin] = useState(0);

    // 1. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò FIREBASE
    useEffect(() => {
        const init = async () => {
            let userId = localStorage.getItem('sbs_user_id') || 'guest_' + Date.now();
            let userData = { name: '–ò–≥—Ä–æ–∫', username: '', avatar: null };

            if (TelegramWebApp?.initDataUnsafe?.user) {
                const tg = TelegramWebApp.initDataUnsafe.user;
                userId = tg.id.toString();
                userData = { 
                    name: tg.first_name + (tg.last_name ? ' ' + tg.last_name : ''), 
                    username: tg.username ? '@' + tg.username : '', 
                    avatar: tg.photo_url 
                };
            }
            localStorage.setItem('sbs_user_id', userId);

            const snap = await db.ref('users/' + userId).once('value');
            const data = snap.val();

            if (data) {
                setBalance(data.balance || 0); setCases(data.cases || INITIAL_CASES);
                setInventory(data.inventory || []); setTasks(data.tasks || tasks);
                setInventorySlots(data.inventorySlots || 5); setTotalDeposits(data.totalDeposits || 0);
                setFreeEliteSpin(data.freeEliteSpin || 0);
                // 4. –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –ù–ò–ö–ê –í FIREBASE
                await db.ref('users/' + userId).update({ name: userData.name, username: userData.username });
                setUser({ id: userId, ...data, ...userData });
            } else {
                const newUser = { balance: 0, cases: INITIAL_CASES, inventory: [], tasks, inventorySlots: 5, totalDeposits: 0, freeEliteSpin: 0, ...userData };
                await db.ref('users/' + userId).set(newUser);
                setUser({ id: userId, ...newUser });
            }
            setIsLoading(false);
        };
        init();
    }, []);

    // –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –î–ê–ù–ù–´–•
    useEffect(() => {
        if (user?.id && !isLoading) {
            db.ref('users/' + user.id).update({ balance, cases, inventory, tasks, inventorySlots, totalDeposits, freeEliteSpin });
        }
    }, [balance, cases, inventory, tasks, inventorySlots, totalDeposits, freeEliteSpin]);

    // 3. –õ–û–ì–ò–ö–ê –õ–ï–î–Ø–ù–û–ì–û –ö–ê–¢–ö–ê (–õ–û–ë–ë–ò)
    useEffect(() => {
        if (currentGame?.type === 'ice' && currentGame.lobbyId) {
            const lobbyRef = db.ref('iceLobbies/' + currentGame.lobbyId);
            lobbyRef.on('value', snap => {
                const data = snap.val(); if (!data) return;
                setIceLobby(data); setGameStatus(data.status || 'waiting');
                const players = data.players || {};
                const pCount = Object.keys(players).length;
                setIcePlayerCount(pCount);

                // –ê–≤—Ç–æ-—Å—Ç–∞—Ä—Ç –ø—Ä–∏ 2+ –∏–≥—Ä–æ–∫–∞—Ö
                if (pCount >= 2 && data.status === 'waiting') {
                    const allHaveBets = Object.values(players).every(p => p.bet > 0);
                    if (allHaveBets && !data.timerStarted) {
                        lobbyRef.update({ status: 'betting', timerEnd: Date.now() + 10000, timerStarted: true });
                        setTimeout(() => startIceGame(lobbyRef), 10000);
                    }
                }
                if (data.ballPosition) setBallPos(data.ballPosition);
                if (data.timerEnd) setTimerRemaining(Math.max(0, Math.ceil((data.timerEnd - Date.now())/1000)));
            });
            return () => lobbyRef.off();
        }
    }, [currentGame]);

    const joinIceLobby = async (id) => {
        const ref = db.ref('iceLobbies/' + id);
        // –°—Ä–∞–∑—É –∑–∞—á–∏—Å–ª—è–µ–º –∏–≥—Ä–æ–∫–∞ –≤ –ª–æ–±–±–∏
        await ref.child('players/' + user.id).set({ name: user.name, avatar: user.avatar, bet: 0, color: `hsl(${Math.random()*360}, 70%, 50%)` });
        setCurrentGame({ type: 'ice', lobbyId: id });
    };

    const placeBet = async () => {
        if (balance < myBet) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥!');
        const ref = db.ref('iceLobbies/' + currentGame.lobbyId);
        await db.ref('users/' + user.id + '/balance').transaction(c => c - myBet);
        await ref.child('players/' + user.id).update({ bet: myBet });
        setHasBet(true);
    };

    const startIceGame = async (ref) => {
        await ref.update({ status: 'playing' });
        let x = 50, y = 50, vx = (Math.random()-0.5)*15, vy = (Math.random()-0.5)*15;
        const interval = setInterval(async () => {
            x += vx*0.6; y += vy*0.6;
            if (Math.sqrt(Math.pow(x-50,2) + Math.pow(y-50,2)) >= 42) { vx *= -1; vy *= -1; }
            await ref.child('ballPosition').set({ x, y });
            if (Math.abs(vx) < 0.1) { clearInterval(interval); finishIceGame(ref, x, y); }
            vx *= 0.99; vy *= 0.99;
        }, 40);
    };

    const finishIceGame = async (ref, fx, fy) => {
        const snap = await ref.once('value'); const d = snap.val();
        const players = Object.entries(d.players);
        const totalBank = players.reduce((s, [, p]) => s + p.bet, 0);
        const winner = players[Math.floor(Math.random() * players.length)];
        await ref.update({ status: 'finished', winner: {id: winner[0], ...winner[1]}, finalBall: {x:fx, y:fy} });
        if (winner[0] === user.id) setBalance(b => b + (totalBank * 0.40));
    };

    // 2. –õ–û–ì–ò–ö–ê –†–£–õ–ï–¢–ö–ò (–ë–ï–ó –ë–ê–ì–û–í)
    const openCase = async (caseId) => {
        const c = cases[caseId];
        const price = c.freeCount > 0 ? 0 : (c.discountPrice || c.price);
        const isEliteFree = caseId === 'elite' && freeEliteSpin > 0;
        if (balance < price && !isEliteFree) return alert('–ú–∞–ª–æ –∑–≤–µ–∑–¥!');

        // –°–ø–∏—Å–∞–Ω–∏–µ –±–µ–∑ –≤–æ–∑–≤—Ä–∞—Ç–∞
        const balAfter = (isEliteFree || price === 0) ? balance : balance - price;
        setBalance(balPost => balAfter);

        setIsSpinning(true); setSpinResult(null); setRouletteOffset(0);
        setRouletteKey(k => k + 1);

        const rewards = CASE_REWARDS[caseId];
        const rand = Math.random() * 100;
        let cum = 0, won = rewards[0];
        for (const r of rewards) { cum += r.realChance; if (rand <= cum) { won = r; break; } }
        
        setDeterminedWinner(won);
        const tape = Array.from({length: 80}, () => rewards[Math.floor(Math.random()*rewards.length)]);
        tape[70] = won; 
        setFakeItems(tape);

        setTimeout(() => {
            const containerWidth = rouletteContainerRef.current?.offsetWidth || window.innerWidth;
            const itemWidth = 140; // 120 + 20 margin
            const target = (70 * itemWidth) + 70 - (containerWidth / 2);
            setRouletteOffset(-target);
        }, 100);

        setTimeout(() => {
            setSpinResult(won); setIsSpinning(false);
            if (won.type === 'stars') setBalance(b => b + won.value);
            else setInventory(inv => [...inv, { ...won, uniqueId: Date.now() }]);
        }, 6700);
    };

    const adminGiveReward = async (targetId, type, val) => {
        const ref = db.ref('users/' + targetId);
        if (type === 'stars') await ref.child('balance').transaction(b => (b || 0) + val);
        if (type === 'case') await ref.child('cases/collector/locked').set(false);
        if (type === 'ice') await ref.child('inventory').transaction(i => [...(i || []), {name:'üßä –õ—ë–¥', emoji:'üßä', type:'ice', uniqueId:Date.now()}]);
        alert('–£—Å–ø–µ—à–Ω–æ!');
    };
            // 3. –†–ï–ù–î–ï–† –ò–ù–¢–ï–†–§–ï–ô–°–ê
    if (isLoading || !user) return <div className="flex items-center justify-center h-screen bg-slate-950"><div className="text-xl font-bold animate-pulse text-indigo-500">–ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–•...</div></div>;

    if (isAdmin) {
        return (
            <div className="min-h-screen bg-slate-900 p-4 pb-20">
                <div className="max-w-md mx-auto">
                    <h1 className="text-2xl font-black mb-6 text-indigo-400">üîê –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø</h1>
                    <div className="flex gap-2 mb-6 overflow-x-auto pb-2">
                        {['stats', 'users', 'rewards'].map(t => (
                            <button key={t} onClick={() => setAdminScreen(t)} className={`px-6 py-2 rounded-full font-bold uppercase text-xs transition ${adminScreen === t ? 'bg-indigo-600 text-white' : 'bg-slate-800 text-slate-400'}`}>{t}</button>
                        ))}
                    </div>

                    {adminScreen === 'users' && (
                        <div className="space-y-3">
                            <p className="text-xs text-slate-500 mb-2">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–≥—Ä–æ–∫–∞, —á—Ç–æ–±—ã –≤—ã–¥–∞—Ç—å –ø—Ä–∏–∑:</p>
                            {allUsers.map(u => (
                                <div key={u.id} className="bg-slate-800 p-4 rounded-2xl border border-white/5">
                                    <div className="flex justify-between items-center mb-3">
                                        <div>
                                            <p className="font-bold text-sm">{u.name || '–ê–Ω–æ–Ω–∏–º'}</p>
                                            <p className="text-[10px] text-slate-500">{u.username || u.id}</p>
                                        </div>
                                        <p className="text-indigo-400 font-bold">{Math.floor(u.balance || 0)} ‚≠êÔ∏è</p>
                                    </div>
                                    <div className="grid grid-cols-2 gap-2">
                                        <button onClick={() => adminGiveReward(u.id, 'stars', 500)} className="bg-indigo-600/20 text-indigo-400 py-2 rounded-lg text-[10px] font-bold">+500 –ó–í–ï–ó–î</button>
                                        <button onClick={() => adminGiveReward(u.id, 'stars', 5000)} className="bg-indigo-600 text-white py-2 rounded-lg text-[10px] font-bold">+5000 –ó–í–ï–ó–î</button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {adminScreen === 'rewards' && (
                        <div className="space-y-4">
                            <div className="bg-indigo-600/10 p-6 rounded-3xl border border-indigo-500/20">
                                <h3 className="font-bold mb-4 text-center">–ú–û–ò –ü–†–ò–í–ò–õ–ï–ì–ò–ò</h3>
                                <div className="grid grid-cols-1 gap-3">
                                    <button onClick={() => adminGiveReward(user.id, 'stars', 100000)} className="bg-indigo-600 py-4 rounded-2xl font-black italic">+100.000 –ó–í–ï–ó–î ‚≠êÔ∏è</button>
                                    <button onClick={() => adminGiveReward(user.id, 'ice', 0)} className="bg-sky-500 py-4 rounded-2xl font-black italic">–í–´–î–ê–¢–¨ –°–ï–ë–ï üßä –õ–Å–î</button>
                                    <button onClick={() => adminGiveReward(user.id, 'case', 0)} className="bg-rose-600 py-4 rounded-2xl font-black italic">üîì –†–ê–ó–ë–õ–û–ö. –ö–û–õ–õ–ï–ö–¶–ò–û–ù–ï–†</button>
                                </div>
                            </div>
                        </div>
                    )}
                    <button onClick={() => setIsAdmin(false)} className="fixed bottom-24 left-4 right-4 bg-slate-800 py-4 rounded-2xl font-bold text-slate-400">–í–ï–†–ù–£–¢–¨–°–Ø –í –ò–ì–†–£</button>
                </div>
            </div>
        );
    }

    return (
        <div className="min-h-screen pb-28">
            {/* HEADER */}
            <header className="p-5 flex justify-between items-center glass sticky top-0 z-[100] border-b border-white/5">
                <h1 onClick={handleTitleClick} className="text-xl font-extrabold tracking-tighter cursor-pointer select-none">
                    STEP <span className="text-indigo-500">BY</span> STEP
                </h1>
                <div onClick={() => setShowTopUp(true)} className="bg-gradient-to-r from-indigo-600 to-violet-600 px-5 py-2 rounded-full font-black text-sm shadow-lg shadow-indigo-500/20 flex items-center gap-2 active:scale-95 transition">
                    {balance.toLocaleString()} <span className="text-[10px] opacity-80">‚≠êÔ∏è</span>
                </div>
            </header>

            <main className="p-4 max-w-md mx-auto">
                {currentScreen === 'cases' && (
                    <div className="grid grid-cols-2 gap-4 animate-[scaleIn_0.3s_ease-out]">
                        {Object.values(cases).map(c => (
                            <div key={c.id} className={`glass p-5 rounded-[2.5rem] text-center relative group transition-all ${c.locked ? 'opacity-40 grayscale' : 'hover:bg-white/10'} ${c.color}`}>
                                {c.isNew && <span className="absolute -top-1 -right-1 bg-pro text-[8px] font-black px-2 py-1 rounded-full animate-pulse">NEW</span>}
                                <div className="text-5xl mb-3 filter drop-shadow-lg group-hover:scale-110 transition-transform">{c.emoji}</div>
                                <h3 className="font-bold text-sm mb-1 uppercase tracking-widest">{c.name}</h3>
                                <p className="text-[10px] font-black text-white/60 mb-3">
                                    {c.freeCount > 0 ? '–ë–ï–°–ü–õ–ê–¢–ù–û' : `${c.discountPrice || c.price} –ó–í–ï–ó–î`}
                                </p>
                                <button 
                                    onClick={() => !c.locked && setSelectedCase(c)} 
                                    className={`w-full py-3 rounded-2xl font-black text-[10px] uppercase tracking-tighter ${c.locked ? 'bg-slate-800' : 'bg-white text-black shadow-xl hover:bg-indigo-500 hover:text-white transition-colors'}`}
                                >
                                    {c.locked ? '–ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–û' : '–û–¢–ö–†–´–¢–¨'}
                                </button>
                            </div>
                        ))}
                    </div>
                )}

                {currentScreen === 'profile' && (
                    <div className="space-y-6 animate-[scaleIn_0.3s_ease-out]">
                        <div className="glass p-8 rounded-[3rem] text-center relative overflow-hidden">
                            <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-indigo-500 to-transparent opacity-50"></div>
                            <div className="w-24 h-24 bg-slate-800 rounded-full mx-auto mb-4 border-4 border-white/5 overflow-hidden shadow-2xl">
                                {user.avatar ? <img src={user.avatar} className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center text-3xl font-black bg-indigo-600">{user.name[0]}</div>}
                            </div>
                            <h2 className="text-2xl font-black tracking-tighter">{user.name}</h2>
                            <p className="text-slate-500 text-xs font-medium">{user.username || `@user${user.id.slice(0,5)}`}</p>
                        </div>

                        <div className="glass p-6 rounded-[2.5rem]">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="font-black text-xs uppercase tracking-widest text-slate-400">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
                                <span className="text-[10px] font-bold bg-white/5 px-3 py-1 rounded-full">{inventory.length} / {inventorySlots}</span>
                            </div>
                            <div className="grid grid-cols-5 gap-3">
                                {[...Array(inventorySlots)].map((_, i) => (
                                    <div 
                                        key={i} 
                                        onClick={() => {
                                            if (inventory[i]) {
                                                if (inventory[i].name.includes('PRO')) setSelectedCollectible(inventory[i]);
                                                else if (confirm(`–ü—Ä–æ–¥–∞—Ç—å ${inventory[i].name} –∑–∞ 20‚≠êÔ∏è?`)) {
                                                    setBalance(b => b + 20);
                                                    setInventory(inv => inv.filter((_, idx) => idx !== i));
                                                }
                                            }
                                        }}
                                        className="aspect-square bg-slate-900 rounded-2xl flex items-center justify-center text-2xl border border-white/5 active:scale-90 transition-transform cursor-pointer hover:border-indigo-500/30"
                                    >
                                        {inventory[i]?.emoji}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                )}

                {currentScreen === 'games' && (
                    <div className="space-y-4 animate-[scaleIn_0.3s_ease-out]">
                        <div onClick={() => joinIceLobby(1)} className="glass p-8 rounded-[3rem] border-2 border-sky-500/20 bg-sky-500/5 relative group cursor-pointer overflow-hidden">
                            <div className="absolute -right-10 -top-10 text-9xl opacity-10 group-hover:rotate-12 transition-transform">‚òÉÔ∏è</div>
                            <h3 className="text-3xl font-black tracking-tighter mb-2 italic text-sky-400">–õ–ï–î–Ø–ù–û–ô –ö–ê–¢–û–ö</h3>
                            <p className="text-xs font-bold text-sky-200/50 uppercase tracking-widest">–ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä ‚Ä¢ –°—Ä–∞–∂–µ–Ω–∏–µ</p>
                            <div className="mt-6 flex items-center gap-4">
                                <div className="flex -space-x-3">
                                    {[...Array(3)].map((_,i) => <div key={i} className="w-8 h-8 rounded-full bg-slate-800 border-2 border-slate-950"></div>)}
                                </div>
                                <span className="text-[10px] font-black text-sky-400">#{Math.floor(Math.random()*100)} –û–ù–õ–ê–ô–ù</span>
                            </div>
                        </div>
                    </div>
                )}
            </main>

            {/* MODALS */}
            {selectedCase && (
                <div className="fullscreen-modal" key={rouletteKey}>
                    <div className="w-full max-w-lg p-6" ref={rouletteContainerRef}>
                        <div className="flex justify-between items-center mb-8">
                            <h2 className="text-2xl font-black tracking-tighter uppercase">{selectedCase.name}</h2>
                            <button onClick={() => {setSelectedCase(null); setSpinResult(null);}} className="w-10 h-10 glass rounded-full flex items-center justify-center">‚úï</button>
                        </div>
                        
                        <div className="roulette-container">
                            <div className="roulette-pointer"></div>
                            <div className="roulette-inner" style={{ transform: `translateX(${rouletteOffset}px)` }}>
                                {fakeItems.map((item, i) => (
                                    <div key={i} className={`roulette-item ${i === 70 && spinResult ? 'winner-glow' : ''}`}>
                                        <div className="emoji">{item.emoji}</div>
                                        <div className="name uppercase font-black">{item.name}</div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="mt-10">
                            {spinResult ? (
                                <div className="text-center space-y-6">
                                    <div className="inline-block px-8 py-4 bg-indigo-600 rounded-3xl font-black italic text-xl shadow-2xl shadow-indigo-500/40 animate-bounce">
                                        –í–´–ò–ì–†–´–®: {spinResult.name}
                                    </div>
                                    <button onClick={() => {setSelectedCase(null); setSpinResult(null);}} className="w-full py-4 bg-white text-black rounded-2xl font-black uppercase tracking-widest active:scale-95 transition">–ó–ê–ë–†–ê–¢–¨ –ù–ê–ì–†–ê–î–£</button>
                                </div>
                            ) : (
                                <button 
                                    onClick={() => openCase(selectedCase.id)} 
                                    disabled={isSpinning}
                                    className="w-full py-6 bg-gradient-to-r from-indigo-600 to-violet-600 rounded-[2rem] font-black text-xl uppercase tracking-widest shadow-2xl shadow-indigo-500/30 disabled:opacity-50"
                                >
                                    {isSpinning ? '–ö–†–£–¢–ò–ú...' : '–ù–ê–ß–ê–¢–¨ –û–¢–ö–†–´–¢–ò–ï'}
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            )}

            {currentGame?.type === 'ice' && (
                <div className="fullscreen-modal bg-slate-950">
                    <div className="w-full max-w-md p-6 flex flex-col items-center">
                        <div className="w-full flex justify-between items-center mb-10">
                            <div className="flex items-center gap-3">
                                <div className="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                                <span className="font-black text-xs uppercase tracking-widest">LIVE –õ–û–ë–ë–ò</span>
                            </div>
                            <button onClick={() => setCurrentGame(null)} className="font-bold text-slate-500">–í–´–ô–¢–ò</button>
                        </div>

                        <div className="ice-circle mb-10">
                            {iceLobby?.players && Object.entries(iceLobby.players).map(([id, p]) => (
                                <div key={id} className="player-avatar" style={{ left: '50%', top: '50%', borderColor: p.color }}>
                                    {p.avatar ? <img src={p.avatar} /> : <div className="w-full h-full flex items-center justify-center font-bold">{p.name[0]}</div>}
                                </div>
                            ))}
                            {gameStatus === 'playing' && <div className="ice-ball" style={{ left: ballPos.x + '%', top: ballPos.y + '%' }}></div>}
                        </div>

                        <div className="w-full space-y-4">
                            <div className="glass p-6 rounded-[2.5rem] text-center">
                                <p className="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] mb-2">–°—Ç–∞—Ç—É—Å –∏–≥—Ä—ã</p>
                                <p className="text-xl font-black italic uppercase">
                                    {gameStatus === 'waiting' && (icePlayerCount < 2 ? `–û–∂–∏–¥–∞–µ–º —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ (${icePlayerCount}/15)` : '–í—Ä–µ–º—è –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫–∏!')}
                                    {gameStatus === 'betting' && `–ù–∞—á–∞–ª–æ —á–µ—Ä–µ–∑ ${timerRemaining}—Å`}
                                    {gameStatus === 'playing' && '–ò–ì–†–ê –ò–î–ï–¢...'}
                                </p>
                            </div>

                            <div className={`p-4 rounded-[2rem] transition-all ${icePlayerCount < 2 ? 'bg-slate-900/50 grayscale' : 'bg-indigo-600/10 border border-indigo-500/30'}`}>
                                {!hasBet ? (
                                    <button 
                                        disabled={icePlayerCount < 2 || balance < 25}
                                        onClick={placeBet} 
                                        className="w-full py-5 bg-indigo-600 rounded-2xl font-black text-sm uppercase tracking-widest disabled:bg-slate-800 disabled:text-slate-500"
                                    >
                                        –ü–û–°–¢–ê–í–ò–¢–¨ 25 ‚≠êÔ∏è
                                    </button>
                                ) : (
                                    <div className="py-5 text-center text-indigo-400 font-black italic uppercase">–°–¢–ê–í–ö–ê –ü–†–ò–ù–Ø–¢–ê! –ñ–î–ï–ú –û–°–¢–ê–õ–¨–ù–´–•</div>
                                )}
                            </div>
                        </div>
                        
                        <div className="mt-10 w-full glass p-6 rounded-[2.5rem]">
                            <h3 className="text-center font-black text-[10px] uppercase text-slate-500 mb-4 tracking-widest">–í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã</h3>
                            <div className="flex justify-center gap-4 text-3xl">
                                <span>üß∏</span><span>üß§</span><span>‚ùÑÔ∏è</span><span>üêï</span><span>‚òÉÔ∏è</span><span>‚≠êÔ∏è</span>
                            </div>
                        </div>
                    </div>
                </div>
            )}

            {selectedCollectible && (
                <div className="fullscreen-modal bg-black/95">
                    <div className="glass p-10 rounded-[3rem] max-w-xs text-center border-t-4 border-indigo-500 shadow-2xl">
                        <div className="text-8xl mb-6">{selectedCollectible.emoji}</div>
                        <h3 className="text-2xl font-black mb-4 uppercase tracking-tighter italic">PRO –ü–†–ï–î–ú–ï–¢!</h3>
                        <p className="text-slate-400 text-sm leading-relaxed mb-8 font-medium">
                            –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥—ã –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ <a href="https://t.me/stepbystepdelision" target="_blank" className="text-indigo-400 font-black underline decoration-2 underline-offset-4">–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏</a>.
                        </p>
                        <button onClick={() => setSelectedCollectible(null)} className="w-full py-4 bg-white text-black rounded-2xl font-black uppercase text-xs active:scale-95 transition">–ü–û–ù–Ø–¢–ù–û</button>
                    </div>
                </div>
            )}

            {/* NAVBAR */}
            <nav className="fixed bottom-6 left-6 right-6 glass rounded-full p-2 flex justify-between items-center border border-white/10 shadow-2xl z-[1000]">
                {['tasks', 'cases', 'games', 'profile'].map(s => (
                    <button 
                        key={s} 
                        onClick={() => setCurrentScreen(s)} 
                        className={`flex-1 py-3 rounded-full flex flex-col items-center gap-1 transition-all ${currentScreen === s ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-600/40' : 'text-slate-500'}`}
                    >
                        <span className="text-xl">{s === 'cases' ? 'üéÅ' : s === 'games' ? 'üéÆ' : s === 'tasks' ? 'üìã' : 'üë§'}</span>
                    </button>
                ))}
            </nav>

            {showAdminLogin && (
                <div className="fullscreen-modal bg-black/98">
                    <div className="glass p-8 rounded-[3rem] w-full max-w-xs border border-white/5">
                        <h2 className="text-center font-black mb-6 tracking-widest text-indigo-500 uppercase">–í–•–û–î –í –°–ò–°–¢–ï–ú–£</h2>
                        <input value={adminLogin} onChange={e => setAdminLogin(e.target.value)} type="text" placeholder="–õ–û–ì–ò–ù" className="w-full bg-slate-900 p-4 rounded-2xl mb-3 text-center font-bold border border-white/5 focus:border-indigo-500 transition-colors" />
                        <input value={adminPassword} onChange={e => setAdminPassword(e.target.value)} type="password" placeholder="–ü–ê–†–û–õ–¨" className="w-full bg-slate-900 p-4 rounded-2xl mb-6 text-center font-bold border border-white/5 focus:border-indigo-500 transition-colors" />
                        <button onClick={checkAdminLogin} className="w-full py-4 bg-indigo-600 rounded-2xl font-black uppercase text-xs">–ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø</button>
                        <button onClick={() => setShowAdminLogin(false)} className="w-full mt-4 text-slate-600 font-bold text-[10px]">–û–¢–ú–ï–ù–ê</button>
                    </div>
                </div>
            )}
        </div>
    );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>
