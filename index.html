<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Step By Step Game v4.5 - FULL EDITION</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
tailwind.config = {
  darkMode: 'class',
  theme: {
    extend: {
      colors: { primary: '#6366f1', secondary: '#8b5cf6', accent: '#f59e0b', ice: '#00d2ff' }
    }
  }
}
</script>
<style>
@keyframes spin-slow { from { transform: translateX(0); } to { transform: translateX(-50%); } }
@keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
.roulette-container { mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent); }
.glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
.line-through { text-decoration: line-through; opacity: 0.5; }
.fullscreen-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 100; overflow-y: auto; display:flex; flex-direction:column; align-items:center; justify-content:center; }
.ice-circle { width: 320px; height: 320px; border-radius: 50%; border: 4px solid rgba(0,210,255,0.5); position: relative; overflow: hidden; background: radial-gradient(circle, rgba(0,210,255, 0%), rgba(0,128,255,0.2) 160px, rgba(0,128,255,0.4) 100%); box-shadow: 0 0 30px rgba(0,210,255,0.3); }
.ice-ball { position: absolute; width: 40px; height: 40px; background: radial-gradient(circle at 30% 30%, #fff, #00d2ff); border-radius: 50%; box-shadow: 0 0 20px rgba(0,210,255,0.8); z-index: 10; transform: translate(-50%, -50%); border: 2px solid rgba(255,255,255,0.5); transition: left 0.025s linear, top 0.025s linear; }
.player-avatar { position: absolute; width: 40px; height: 40px; border-radius: 50%; border: 2px solid white; overflow: hidden; transform: translate(-50%, -50%); z-index: 5; }
.case-cardboard { background: linear-gradient(135deg, #8B4513 0%, #D2691E 50%, #8B4513 100%); border: 3px solid #A0522D; }
.case-collector { background: linear-gradient(135deg, #DC143C 0%, #FF1493 50%, #8B008B 100%); border: 3px solid #FFD700; }

/* –ù–û–í–ê–Ø –ê–ù–ò–ú–ê–¶–ò–Ø –†–£–õ–ï–¢–ö–ò */
.roulette-window { width: 100%; height: 140px; overflow: hidden; position: relative; background: #020617; border-radius: 16px; border: 2px solid #6366f1; }
.roulette-line { position: absolute; left: 50%; top: 0; bottom: 0; width: 4px; background: #fbbf24; z-index: 30; transform: translateX(-50%); box-shadow: 0 0 15px #fbbf24; }
.roulette-track { display: flex; height: 100%; align-items: center; will-change: transform; }
.roulette-item { min-width: 110px; height: 110px; margin: 0 5px; background: #1e293b; border-radius: 14px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 1px solid #334155; flex-shrink: 0; }
</style>
</head>
<body class="bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 min-h-screen text-white overflow-x-hidden">
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef } = React;

const firebaseConfig = {
  apiKey: "AIzaSyDZPRiByz69HQa8b7GFMCJeqq56J3Y-bOY",
  authDomain: "step-by-step-279df.firebaseapp.com",
  databaseURL: "https://step-by-step-279df-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "step-by-step-279df",
  storageBucket: "step-by-step-279df.firebasestorage.app",
  messagingSenderId: "302641152597",
  appId: "1:302641152597:web:6479b9ae03104666cd8adc"
};
if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
const db = firebase.database();
const TelegramWebApp = window.Telegram?.WebApp;

// --- –ö–û–ù–°–¢–ê–ù–¢–´ ---
const CASE_REWARDS = {
  cardboard: [
    { id: 's1', name: '0.25 ‚≠êÔ∏è', chance: 80, type: 'stars', value: 0.25, emoji: '‚≠êÔ∏è' },
    { id: 's2', name: '0.75 ‚≠êÔ∏è', chance: 10, type: 'stars', value: 0.75, emoji: '‚≠êÔ∏è' },
    { id: 's3', name: '1.5 ‚≠êÔ∏è', chance: 6, type: 'stars', value: 1.5, emoji: '‚≠êÔ∏è' },
    { id: 's4', name: '5 ‚≠êÔ∏è', chance: 2, type: 'stars', value: 5, emoji: '‚≠êÔ∏è' },
    { id: 'i1', name: '–ú–∏—à–∫–∞ üß∏', chance: 1.5, type: 'item', sellPrice: 5, emoji: 'üß∏' },
    { id: 'c1', name: 'üíé PRO', chance: 0.5, type: 'collectible', emoji: 'üíé' }
  ],
  coal: [
    { id: 'cs1', name: '2.5 ‚≠êÔ∏è', chance: 60, type: 'stars', value: 2.5, emoji: '‚≠êÔ∏è' },
    { id: 'cs2', name: '5 ‚≠êÔ∏è', chance: 18, type: 'stars', value: 5, emoji: '‚≠êÔ∏è' },
    { id: 'cs3', name: '–ö–∏—Ä–∫–∞ ‚õèÔ∏è', chance: 10, type: 'item', sellPrice: 10, emoji: '‚õèÔ∏è' },
    { id: 'cs4', name: '15 ‚≠êÔ∏è', chance: 6, type: 'stars', value: 15, emoji: '‚≠êÔ∏è' },
    { id: 'cs5', name: '–ú–∞—Ç–µ—Ä–∏–∞–ª üß±', chance: 5, type: 'item', sellPrice: 40, emoji: 'üß±' },
    { id: 'cs6', name: 'Happy PRO üí©', chance: 1, type: 'collectible', emoji: 'üí©' }
  ],
  collector: [
    { id: 'cp1', name: 'üß∏ PRO', chance: 55, type: 'collectible', emoji: 'üß∏' },
    { id: 'cp2', name: 'üéÅ PRO', chance: 20, type: 'collectible', emoji: 'üéÅ' },
    { id: 'cp3', name: 'üöÄ PRO', chance: 15, type: 'collectible', emoji: 'üöÄ' },
    { id: 'cp4', name: 'üèÜ PRO', chance: 5, type: 'collectible', emoji: 'üèÜ' },
    { id: 'cp5', name: 'üç∞ Candle', chance: 2, type: 'collectible', emoji: 'üç∞' },
    { id: 'cp6', name: 'üçú Ramen', chance: 0.5, type: 'collectible', emoji: 'üçú' },
    { id: 'cp7', name: 'üé© Top hat', chance: 0, type: 'collectible', emoji: 'üé©' },
    { id: 'cp8', name: 'ü¶Ö Rare bird', chance: 0, type: 'collectible', emoji: 'ü¶Ö' }
  ],
  diamond: [{id:'d1', name:'10 ‚≠êÔ∏è', chance:100, type:'stars', value:10, emoji:'‚≠êÔ∏è'}],
  platinum: [{id:'p1', name:'50 ‚≠êÔ∏è', chance:100, type:'stars', value:50, emoji:'‚≠êÔ∏è'}],
  gold: [{id:'g1', name:'100 ‚≠êÔ∏è', chance:100, type:'stars', value:100, emoji:'‚≠êÔ∏è'}],
  money: [{id:'m1', name:'200 ‚≠êÔ∏è', chance:100, type:'stars', value:200, emoji:'‚≠êÔ∏è'}],
  elite: [{id:'e1', name:'300 ‚≠êÔ∏è', chance:100, type:'stars', value:300, emoji:'‚≠êÔ∏è'}],
  winter: [{id:'w1', name:'150 ‚≠êÔ∏è', chance:100, type:'stars', value:150, emoji:'‚≠êÔ∏è'}],
  major: [{id:'mj1', name:'1000 ‚≠êÔ∏è', chance:100, type:'stars', value:1000, emoji:'‚≠êÔ∏è'}]
};

const INITIAL_CASES = {
  cardboard: { id: 'cardboard', name: '–ö–∞—Ä—Ç–æ–Ω', emoji: 'üì¶', price: 3, cls: 'case-cardboard' },
  coal: { id: 'coal', name: '–£–≥–æ–ª—ë–∫', emoji: 'ü™®', price: 20, cls: '' },
  diamond: { id: 'diamond', name: '–ê–ª–º–∞–∑', emoji: 'üíé', price: 35, cls: '' },
  platinum: { id: 'platinum', name: '–ü–ª–∞—Ç–∏–Ω–∞', emoji: '‚ö™', price: 100, cls: '' },
  gold: { id: 'gold', name: '–ó–æ–ª–æ—Ç–æ–π', emoji: 'üëë', price: 250, cls: '' },
  money: { id: 'money', name: '–î–µ–Ω–µ–∂–Ω—ã–π', emoji: 'üíµ', price: 350, cls: '' },
  elite: { id: 'elite', name: '–≠–ª–∏—Ç–∞', emoji: 'üéñ', price: 500, cls: '', freeSpins: 0 },
  winter: { id: 'winter', name: '–ó–∏–º–Ω–∏–π', emoji: '‚òÉÔ∏è', price: 125, cls: '' },
  major: { id: 'major', name: '–ú–∞–∂–æ—Ä', emoji: 'ü§¥', price: 800, cls: '' },
  collector: { id: 'collector', name: '–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä', emoji: 'üé©', price: 650, cls: 'case-collector' }
};

function App() {
  const [user, setUser] = useState(null);
  const [screen, setScreen] = useState('cases');
  const [balance, setBalance] = useState(0);
  const [inventory, setInventory] = useState([]);
  const [inventorySlots, setInventorySlots] = useState(5);
  const [totalDeposits, setTotalDeposits] = useState(0);
  
  // Roulette
  const [activeCase, setActiveCase] = useState(null);
  const [spinning, setSpinning] = useState(false);
  const [rouletteItems, setRouletteItems] = useState([]);
  const [winItem, setWinItem] = useState(null);
  const trackRef = useRef(null);

  // Ice Arena
  const [iceLobby, setIceLobby] = useState(null);
  const [iceData, setIceData] = useState(null);
  const [myBet, setMyBet] = useState(25);
  const [timer, setTimer] = useState(0);
  const [ball, setBall] = useState({x: 50, y: 50});

  // Admin / Promo
  const [isAdmin, setIsAdmin] = useState(false);
  const [clicks, setClicks] = useState(0);
  const [promo, setPromo] = useState('');

  useEffect(() => {
    let id = localStorage.getItem('sbs_id_v45');
    if(!id) { id = 'u'+Date.now(); localStorage.setItem('sbs_id_v45', id); }
    
    db.ref('users/' + id).on('value', snap => {
      const data = snap.val();
      if(data) {
        setBalance(data.balance || 0);
        setInventory(data.inventory || []);
        setInventorySlots(data.inventorySlots || 5);
        setTotalDeposits(data.totalDeposits || 0);
        setUser({id, ...data});
      } else {
        db.ref('users/' + id).set({
          balance: 15, inventory: [], inventorySlots: 5, totalDeposits: 0,
          cases: { elite: {freeSpins: 0} }, usedPromos: []
        });
      }
    });
  }, []);

  // --- –õ–û–ì–ò–ö–ê –ö–ï–ô–°–û–í (–§–û–†–ú–£–õ–ê –ë–ê–õ–ê–ù–°–ê) ---
  const openCase = (cid) => {
    const info = INITIAL_CASES[cid];
    const freeSpins = user.cases?.[cid]?.freeSpins || 0;
    const price = freeSpins > 0 ? 0 : info.price;

    if(cid === 'collector' && totalDeposits < 350) return alert("–ù—É–∂–µ–Ω –¥–µ–ø–æ–∑–∏—Ç 350‚≠êÔ∏è");
    if(balance < price) return alert("–ú–∞–ª–æ –∑–≤–µ–∑–¥!");

    // 1. –°–ü–ò–°–ê–ù–ò–ï –°–†–ê–ó–£ (–ë–ï–ó –í–û–ó–í–†–ê–¢–ê)
    const balAfterSpend = balance - price;
    setBalance(balAfterSpend);
    const updates = { balance: balAfterSpend };
    if(freeSpins > 0) updates[`cases/${cid}/freeSpins`] = freeSpins - 1;
    db.ref('users/'+user.id).update(updates);

    // 2. –ü–û–î–ì–û–¢–û–í–ö–ê –†–£–õ–ï–¢–ö–ò
    const pool = CASE_REWARDS[cid];
    const tape = [];
    for(let i=0; i<80; i++) tape.push(pool[Math.floor(Math.random()*pool.length)]);
    
    let r = Math.random()*100, cum = 0, winner = pool[0];
    for(const it of pool) { cum += it.chance; if(r <= cum) { winner = it; break; } }
    tape[60] = winner;

    setRouletteItems(tape);
    setActiveCase(cid);
    setSpinning(true);
    setWinItem(null);

    // 3. –ê–ù–ò–ú–ê–¶–ò–Ø
    setTimeout(() => {
      if(trackRef.current) {
        const offset = (60 * 120) - (window.innerWidth / 2) + 60 + (Math.random()*40-20);
        trackRef.current.style.transition = "transform 6s cubic-bezier(0.1, 0, 0.1, 1)";
        trackRef.current.style.transform = `translateX(-${offset}px)`;
      }
    }, 100);

    // 4. –ù–ê–ß–ò–°–õ–ï–ù–ò–ï (–§–û–†–ú–£–õ–ê: balAfterSpend + won)
    setTimeout(() => {
      setSpinning(false);
      setWinItem(winner);
      if(winner.type === 'stars') {
        db.ref('users/'+user.id+'/balance').set(balAfterSpend + winner.value);
      } else {
        const item = {...winner, uid: Date.now()};
        db.ref('users/'+user.id+'/inventory').set([...inventory, item]);
      }
    }, 6500);
  };

  // --- –õ–ï–î–Ø–ù–û–ô –ö–ê–¢–û–ö (–ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê) ---
  const joinIce = (id) => {
    db.ref('iceLobbies/'+id).once('value', s => {
      if(s.val()?.status === 'playing') return alert("–ò–≥—Ä–∞ –∏–¥–µ—Ç!");
      setIceLobby(id);
      db.ref('iceLobbies/'+id).on('value', snap => {
        const v = snap.val(); if(!v) return;
        setIceData(v);
        if(v.ball) setBall(v.ball);
        if(v.timerEnd) setTimer(Math.max(0, Math.ceil((v.timerEnd - Date.now())/1000)));
        if(v.status === 'finished' && v.winner === user.id && !v.claimed) {
          const win = Math.floor(v.pot * 0.4);
          alert("–ü–æ–±–µ–¥–∞! +"+win+"‚≠êÔ∏è");
          db.ref('users/'+user.id+'/balance').set(user.balance + win);
          db.ref('iceLobbies/'+id+'/claimed').set(true);
        }
      });
    });
  };

  const leaveIce = async () => {
    if(!iceLobby) return;
    const me = iceData?.players?.[user.id];
    if(me && (iceData.status === 'waiting' || iceData.status === 'betting')) {
      await db.ref('users/'+user.id+'/balance').set(user.balance + me.bet);
    }
    await db.ref('iceLobbies/'+iceLobby+'/players/'+user.id).remove();
    await db.ref('iceLobbies/'+iceLobby+'/ready/'+user.id).remove();
    const rem = iceData?.players ? Object.keys(iceData.players).length - 1 : 0;
    if(rem <= 0) await db.ref('iceLobbies/'+iceLobby).set({status:'waiting', players:{}, ready:{}});
    db.ref('iceLobbies/'+iceLobby).off();
    setIceLobby(null); setIceData(null);
  };

  const betIce = () => {
    if(balance < myBet) return alert("–ú–∞–ª–æ –∑–≤–µ–∑–¥!");
    db.ref('users/'+user.id+'/balance').set(balance - myBet);
    db.ref('iceLobbies/'+iceLobby+'/players/'+user.id).set({ name: user.name||'User', bet: myBet });
  };

  const readyIce = () => {
    const count = iceData.players ? Object.keys(iceData.players).length : 0;
    if(count < 2) return alert("–û–∂–∏–¥–∞–µ–º —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...");
    db.ref('iceLobbies/'+iceLobby+'/ready/'+user.id).set(true);
    if(count >= 2) {
      db.ref('iceLobbies/'+iceLobby).update({ status: 'betting', timerEnd: Date.now()+10000 });
      setTimeout(() => startGameLogic(iceLobby), 10000);
    }
  };

  const startGameLogic = (lid) => {
    db.ref('iceLobbies/'+lid).update({ status: 'playing' });
    setTimeout(() => {
      db.ref('iceLobbies/'+lid).once('value', s => {
        const d = s.val();
        const winner = Object.keys(d.players)[0];
        let pot = 0; Object.values(d.players).forEach(p=>pot+=p.bet);
        db.ref('iceLobbies/'+lid).update({ status: 'finished', winner, pot });
      });
    }, 5000);
  };

  // --- –ò–ù–í–ï–ù–¢–ê–†–¨ / –ê–î–ú–ò–ù–ö–ê / –ü–†–û–ú–û ---
  const sell = (i) => {
    const it = inventory[i];
    if(it.type==='collectible') return alert("PRO –Ω–µ–ª—å–∑—è –ø—Ä–æ–¥–∞—Ç—å!");
    const pr = it.sellPrice || 5;
    if(confirm("–ü—Ä–æ–¥–∞—Ç—å –∑–∞ "+pr+"‚≠êÔ∏è?")) {
      const ni = [...inventory]; ni.splice(i,1);
      db.ref('users/'+user.id).update({ balance: balance + pr, inventory: ni });
    }
  };

  const buySlot = () => {
    if(balance < 50) return alert("–ù—É–∂–Ω–æ 50‚≠êÔ∏è");
    db.ref('users/'+user.id).update({ balance: balance-50, inventorySlots: inventorySlots+1 });
  };

  const applyPromo = () => {
    const c = promo.toUpperCase();
    if(user.usedPromos?.includes(c)) return alert("–£–∂–µ –±—ã–ª!");
    if(c === 'DELLKO') db.ref('users/'+user.id+'/cases/money/freeSpins').set((user.cases?.money?.freeSpins||0)+3);
    else if(c === 'DIAMOND') db.ref('users/'+user.id+'/cases/diamond/freeSpins').set((user.cases?.diamond?.freeSpins||0)+2);
    else return alert("–ú–∏–Ω—É—Å");
    db.ref('users/'+user.id+'/usedPromos').set([...(user.usedPromos||[]), c]);
    setPromo(''); alert("–£–¥–∞—á–∞!");
  };

  if(!user) return <div className="flex items-center justify-center h-screen">Loading...</div>;

  return (
    <div className="max-w-md mx-auto min-h-screen flex flex-col pb-24">
      {/* HEADER */}
      <header className="glass p-4 rounded-b-3xl flex justify-between items-center sticky top-0 z-50">
        <h1 onClick={()=>{setClicks(c=>c+1); if(clicks>=9) setIsAdmin(true);}} className="font-black text-xl italic tracking-tighter">STEP BY STEP</h1>
        <div className="bg-yellow-500 text-black px-4 py-1 rounded-full font-bold shadow-lg">{balance.toFixed(2)} ‚≠êÔ∏è</div>
      </header>

      {/* ADMIN */}
      {isAdmin && (
        <div className="p-4 bg-black/80 fixed inset-0 z-[200] overflow-y-auto">
          <button onClick={()=>setIsAdmin(false)} className="bg-red-500 p-2 rounded mb-4">EXIT ADMIN</button>
          <p>Admin Mode Active. Use Firebase Console for full control.</p>
        </div>
      )}

      {/* SCREENS */}
      <main className="flex-1 p-4 overflow-y-auto">
        {screen === 'cases' && (
          <div className="grid grid-cols-2 gap-3">
            {Object.values(INITIAL_CASES).map(c => {
              const locked = (c.id === 'collector' && totalDeposits < 350) || (c.id === 'major' && totalDeposits < 100);
              const free = (user.cases?.[c.id]?.freeSpins || 0) > 0;
              return (
                <div key={c.id} onClick={()=>!locked && openCase(c.id)} className={`glass p-4 rounded-2xl flex flex-col items-center justify-center transition active:scale-90 ${c.cls} ${locked?'opacity-40 grayscale':''}`}>
                  <div className="text-5xl mb-2">{c.emoji}</div>
                  <div className="font-bold text-xs">{c.name}</div>
                  <div className="text-[10px] mt-1 bg-black/30 px-2 py-1 rounded">{locked?'üîí –ó–ê–ú–û–ö':(free?'–ë–ï–°–ü–õ–ê–¢–ù–û':c.price+' ‚≠êÔ∏è')}</div>
                </div>
              )
            })}
          </div>
        )}

        {screen === 'games' && (
          !iceLobby ? (
            <div className="glass p-6 rounded-3xl text-center">
              <div className="text-7xl mb-4">‚òÉÔ∏è</div>
              <h2 className="text-2xl font-bold mb-2 text-cyan-300">–õ–µ–¥—è–Ω–æ–π –ö–∞—Ç–æ–∫</h2>
              <p className="text-xs text-gray-400 mb-6">40% –≤—ã–∏–≥—Ä—ã—à. –í–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞–≤–∫–∏ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ.</p>
              <div className="grid grid-cols-4 gap-2">
                {[1,2,3,4,5,6,7,8].map(i => <button key={i} onClick={()=>joinIce(i)} className="bg-cyan-900/50 p-2 rounded-xl font-bold">#{i}</button>)}
              </div>
            </div>
          ) : (
            <div className="glass p-4 rounded-3xl h-full flex flex-col text-center">
              <button onClick={leaveIce} className="text-red-400 text-xs mb-4">–í–´–ô–¢–ò –ò –í–ï–†–ù–£–¢–¨ –°–¢–ê–í–ö–£</button>
              <div className="ice-circle">
                {iceData?.players && Object.keys(iceData.players).map((p,i) => <div key={i} className="player-avatar" style={{left:'50%',top:'50%',transform:`rotate(${i*45}deg) translate(130px)`}}>üë§</div>)}
                {iceData?.status === 'playing' && <div className="ice-ball" style={{left:ball.x+'%', top:ball.y+'%'}}></div>}
              </div>
              <div className="mt-4 font-black">
                {iceData?.status === 'waiting' && <span className="text-yellow-400 animate-pulse">–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤...</span>}
                {iceData?.status === 'betting' && <span className="text-green-400 text-xl">–°–¢–ê–†–¢ –ß–ï–†–ï–ó {timer}—Å</span>}
              </div>
              {!iceData?.players?.[user.id] ? (
                <button onClick={betIce} className="mt-6 bg-blue-600 py-3 rounded-2xl font-bold">–ü–û–°–¢–ê–í–ò–¢–¨ {myBet}‚≠êÔ∏è</button>
              ) : (
                <button onClick={readyIce} disabled={!iceData.players || Object.keys(iceData.players).length < 2} className="mt-6 bg-green-600 py-3 rounded-2xl font-bold disabled:opacity-50">
                  {Object.keys(iceData.players).length < 2 ? "–ñ–¥–µ–º —Å–æ–ø–µ—Ä–Ω–∏–∫–∞..." : "–Ø –ì–û–¢–û–í!"}
                </button>
              )}
            </div>
          )
        )}

        {screen === 'profile' && (
          <div className="space-y-4">
            <div className="glass p-6 rounded-3xl">
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-xl font-bold">–†—é–∫–∑–∞–∫</h2>
                <div className="text-xs">{inventory.length}/{inventorySlots}</div>
              </div>
              <div className="grid grid-cols-4 gap-2 mb-4">
                {inventory.map((it, i) => <div key={i} onClick={()=>sell(i)} className="aspect-square bg-white/5 rounded-xl flex items-center justify-center text-3xl border border-white/5">{it.emoji}</div>)}
              </div>
              <button onClick={buySlot} className="w-full py-2 bg-gray-700 rounded-xl text-xs mb-4">–ö–£–ü–ò–¢–¨ –°–õ–û–¢ (50‚≠êÔ∏è)</button>
              <div className="flex gap-2">
                <input value={promo} onChange={e=>setPromo(e.target.value)} className="bg-black/20 p-2 rounded-xl flex-1 outline-none" placeholder="–ü–†–û–ú–û–ö–û–î" />
                <button onClick={applyPromo} className="bg-indigo-600 px-4 rounded-xl font-bold">OK</button>
              </div>
            </div>
            <button disabled={totalDeposits < 350} className="w-full py-4 bg-purple-600 rounded-2xl font-bold shadow-xl disabled:bg-gray-700">
              {totalDeposits < 350 ? "üîí –í–´–í–û–î (–ù—É–∂–Ω–æ 350‚≠êÔ∏è)" : "üèÜ –í–´–í–ï–°–¢–ò –ü–†–ò–ó–´"}
            </button>
          </div>
        )}

        {screen === 'tasks' && (
          <div className="space-y-3">
            <div className="glass p-4 rounded-2xl flex justify-between items-center">
              <div>
                <div className="font-bold">–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª</div>
                <div className="text-[10px] opacity-50">+1 –ø—Ä–æ–∫—Ä—É—Ç –≠–ª–∏—Ç—ã</div>
              </div>
              <button onClick={()=>{ window.open("https://t.me/stepbystepdelision"); db.ref('users/'+user.id+'/cases/elite/freeSpins').set((user.cases?.elite?.freeSpins||0)+1); }} className="bg-blue-500 px-4 py-1 rounded-lg font-bold">OK</button>
            </div>
          </div>
        )}
      </main>

      {/* ROULETTE MODAL */}
      {activeCase && (
        <div className="fullscreen-modal">
          <div className="w-full max-w-md p-4">
            <h2 className="text-center text-3xl font-black mb-10 text-yellow-400 italic uppercase">{spinning ? "–£–¥–∞—á–∏!" : winItem?.name}</h2>
            <div className="roulette-window">
              <div className="roulette-line"></div>
              <div className="roulette-track" ref={trackRef}>
                {rouletteItems.map((it, i) => (
                  <div key={i} className={`roulette-item ${i===60 ? 'border-yellow-400 bg-yellow-400/20' : ''}`}>
                    <div className="text-4xl mb-1">{it.emoji}</div>
                    <div className="text-[10px] opacity-50">{it.name}</div>
                  </div>
                ))}
              </div>
            </div>
            {!spinning && winItem && <button onClick={()=>{setActiveCase(null); if(trackRef.current) trackRef.current.style.transform='none';}} className="w-full mt-10 py-4 bg-green-500 rounded-2xl font-bold text-xl shadow-2xl">–ó–ê–ë–†–ê–¢–¨</button>}
          </div>
        </div>
      )}

      {/* NAVIGATION */}
      <nav className="fixed bottom-0 left-0 right-0 glass p-3 flex justify-around rounded-t-3xl border-t border-white/10 z-[60]">
        {['tasks','cases','games','profile'].map(s => (
          <button key={s} onClick={()=>setScreen(s)} className={`nav-btn ${screen===s?'active':''}`}>
            <span>{s==='tasks'?'üìã':s==='cases'?'üé∞':s==='games'?'üéÆ':'üë§'}</span>
            <span>{s}</span>
          </button>
        ))}
      </nav>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>
