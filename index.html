<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step By Step Game</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#8b5cf6',
                        accent: '#f59e0b',
                        ice: '#00d2ff',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap');
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulseGlow { 0%, 100% { box-shadow: 0 0 10px rgba(0,210,255,0.3); } 50% { box-shadow: 0 0 30px rgba(0,210,255,0.8); } }
        @keyframes readyPulse { 0%, 100% { box-shadow: 0 0 10px rgba(0,255,100,0.3); } 50% { box-shadow: 0 0 30px rgba(0,255,100,0.8); } }
        .pulse-glow { animation: pulseGlow 2s ease-in-out infinite; }
        .ready-glow { animation: readyPulse 1.5s ease-in-out infinite; }
        .roulette-container { position: relative; width: 100%; height: 160px; overflow: hidden; background: rgba(0,0,0,0.4); border-radius: 16px; border: 2px solid rgba(255,255,255,0.1); margin: 20px 0; }
        .roulette-inner { display: flex; position: absolute; left: 0; top: 20px; transition: transform 6.5s cubic-bezier(0.1, 0, 0.1, 1); will-change: transform; }
        .roulette-item { width: 120px; height: 120px; flex-shrink: 0; margin: 0 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05)); border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); }
        .roulette-item .emoji { font-size: 3.5rem; }
        .roulette-item .name { font-size: 11px; opacity: 0.8; text-align: center; margin-top: 4px; }
        .roulette-pointer { position: absolute; left: 50%; top: 0; bottom: 0; width: 4px; background: #ff4757; z-index: 20; transform: translateX(-50%); box-shadow: 0 0 20px #ff4757; }
        .roulette-pointer::before { content: ''; position: absolute; top: -5px; left: 50%; transform: translateX(-50%); border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 15px solid #ff4757; }
        .roulette-pointer::after { content: ''; position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%); border-left: 10px solid transparent; border-right: 10px solid transparent; border-bottom: 15px solid #ff4757; }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .line-through { text-decoration: line-through; opacity: 0.6; color: #ef4444; text-decoration-color: #ef4444; text-decoration-thickness: 2px; }
        .fullscreen-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 100; overflow-y: auto; }
        .case-cardboard { background: linear-gradient(135deg, #8B4513 0%, #D2691E 50%, #8B4513 100%); border: 3px solid #A0522D; }
        .case-collector { background: linear-gradient(135deg, #DC143C 0%, #FF1493 50%, #8B008B 100%); border: 3px solid #FFD700; }
        @keyframes goldGlow { 0%, 100% { text-shadow: 0 0 5px #facc15, 0 0 10px #facc15; } 50% { text-shadow: 0 0 20px #facc15, 0 0 30px #eab308; } }
        @keyframes purpleGlow { 0%, 100% { text-shadow: 0 0 5px #a855f7, 0 0 10px #a855f7; } 50% { text-shadow: 0 0 20px #a855f7, 0 0 30px #9333ea; } }
        @keyframes greenGlow { 0%, 100% { box-shadow: 0 0 5px #22c55e, 0 0 10px #22c55e; } 50% { box-shadow: 0 0 15px #22c55e, 0 0 25px #16a34a; } }
        @keyframes yellowGlow { 0%, 100% { text-shadow: 0 0 5px #fbbf24, 0 0 10px #fbbf24; } 50% { text-shadow: 0 0 20px #fbbf24, 0 0 30px #f59e0b; } }
        .special-header { animation: purpleGlow 3s infinite; }
        .ordinary-header { animation: goldGlow 3s infinite; }
        .daily-timer { color: #4ade80; font-family: monospace; font-weight: bold; font-size: 14px; background: rgba(0,0,0,0.6); padding: 2px 8px; border-radius: 6px; border: 1px solid #22c55e; animation: greenGlow 2s infinite; display: inline-block; }
        .event-timer { color: #ffffff; font-family: monospace; text-shadow: 0 0 10px #ffffff, 0 0 20px #ffffff; }
        .cases-timer { color: #fbbf24; font-family: monospace; text-shadow: 0 0 5px #fbbf24, 0 0 10px #fbbf24; animation: yellowGlow 2s infinite; }
        .case-countdown-overlay { position: absolute; top: 0; left: 0; right: 0; background: rgba(0,0,0,0.7); padding: 4px; font-size: 10px; color: #fbbf24; text-align: center; font-family: monospace; z-index: 10; text-shadow: 0 0 5px #fbbf24; }
        .olympus-font { font-family: 'Cinzel', serif; font-weight: bold; }
        .events-tab-active { background: linear-gradient(135deg, rgba(251,191,36,0.3), rgba(245,158,11,0.2)); border: 2px solid rgba(251,191,36,0.6); box-shadow: 0 0 20px rgba(251,191,36,0.4); }
        .round-box { width: 30px; height: 30px; border-radius: 6px; border: 2px solid rgba(255,255,255,0.3); display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; margin: 0 3px; transition: all 0.3s; }
        .round-box.completed { background: linear-gradient(135deg, #22c55e, #16a34a); border-color: #22c55e; box-shadow: 0 0 10px #22c55e; }
        .round-box.current { background: linear-gradient(135deg, #fbbf24, #f59e0b); border-color: #fbbf24; box-shadow: 0 0 10px #fbbf24; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .olympus-button { position: absolute; background: linear-gradient(135deg, rgba(255,214,10,0.35), rgba(245,158,11,0.28)); border: 2px solid rgba(255, 237, 74, 0.95); border-radius: 14px; padding: 12px 20px; font-weight: 900; color: #fff7c2; text-shadow: 0 0 8px #fff7c2, 0 0 18px #f59e0b, 0 2px 0 #000; cursor: pointer; transition: all 0.3s; backdrop-filter: blur(6px); box-shadow: 0 8px 25px rgba(245,158,11,0.45); letter-spacing: 0.3px; }
        .olympus-button:hover { background: linear-gradient(135deg, rgba(255,214,10,0.5), rgba(245,158,11,0.4)); box-shadow: 0 0 28px rgba(251, 191, 36, 0.75); transform: scale(1.06); }
        .olympus-title { color: #fff7b0; text-shadow: 0 0 10px #fff7b0, 0 0 22px #fbbf24, 0 0 38px #f59e0b, 0 3px 0 #000; font-weight: 900; }
        .olympus-label { color: #ffffff; text-shadow: 0 0 10px #fff, 0 0 24px #fbbf24, 0 0 38px rgba(251,191,36,0.9), 0 3px 0 #000; font-weight: 900; }
        .hephaestus-text { color: #ffffff; text-shadow: 0 0 10px #fff, 0 0 20px #fb923c, 0 0 34px rgba(249,115,22,0.9), 0 3px 0 #000; font-weight: 900; }
        .progress-step { position: relative; padding: 12px; border-radius: 8px; border: 2px solid rgba(251, 191, 36, 0.3); background: rgba(0, 0, 0, 0.5); margin-bottom: 8px; transition: all 0.3s; }
        .progress-step.completed { border-color: #22c55e; background: rgba(34, 197, 94, 0.2); }
        .progress-step.active { border-color: #fbbf24; background: rgba(251, 191, 36, 0.2); animation: pulse 2s infinite; }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 min-h-screen text-white overflow-x-hidden">
    <div id="root"></div>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        const firebaseConfig = {
            apiKey: "AIzaSyDZPRiByz69HQa8b7GFMCJeqq56J3Y-bOY",
            authDomain: "step-by-step-279df.firebaseapp.com",
            databaseURL: "https://step-by-step-279df-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "step-by-step-279df",
            storageBucket: "step-by-step-279df.firebasestorage.app",
            messagingSenderId: "302641152597",
            appId: "1:302641152597:web:6479b9ae03104666cd8adc"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const TelegramWebApp = window.Telegram?.WebApp;
        const ADMIN_WALLET = 'UQAWqaIPFSg81l9MlgAx0HBE9o3gpJMhk1dnyryKJXhWNHIc';
        const BOT_TOKEN = '8325421899:AAG9t3yS4WWiwasRoHb-nbr3a94S9tQfHys';
        
        const PLAYER_COLORS = ['#FF6B6B','#FF9F43','#FFEAA7','#55EFC4','#74B9FF','#A29BFE','#FD79A8','#E17055','#00CEC9','#6C5CE7','#FDCB6E','#81ECEC','#FF7675','#DFE6E9','#B2BEC3'];
        function getRandomColor() { return PLAYER_COLORS[Math.floor(Math.random() * PLAYER_COLORS.length)]; }
        
        const INITIAL_CASES = {
            daily: { id: 'daily', name: '–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π', emoji: 'üóìÔ∏è', price: 0, color: 'from-cyan-400 to-teal-600', locked: false, isNew: true, freeCount: 1, type: 'special', lastOpened: 0 },
            collector: { id: 'collector', name: '–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä', emoji: 'üé©', price: 650, color: 'from-rose-600 to-pink-800', locked: true, isNew: true, freeCount: 0, type: 'special' },
            cardboard: { id: 'cardboard', name: '–ö–∞—Ä—Ç–æ–Ω', emoji: 'üì¶', price: 3, color: 'from-amber-800 to-amber-900', locked: false, isNew: true, freeCount: 0 },
            coal: { id: 'coal', name: '–£–≥–æ–ª—ë–∫', emoji: 'ü™®', price: 27, color: 'from-gray-600 to-gray-800', locked: false, isNew: false, freeCount: 0 },
            platinum: { id: 'platinum', name: '–ü–ª–∞—Ç–∏–Ω–∞', emoji: 'üíé', price: 100, color: 'from-gray-300 to-gray-500', locked: false },
            gold: { id: 'gold', name: '–ó–æ–ª–æ—Ç–æ–π', emoji: 'üëë', price: 250, color: 'from-yellow-400 to-yellow-600', locked: false },
            money: { id: 'money', name: '–î–µ–Ω–µ–∂–Ω—ã–π', emoji: 'üíµ', price: 350, color: 'from-green-400 to-green-600', locked: false },
            elite: { id: 'elite', name: '–≠–ª–∏—Ç–∞', emoji: 'üéñ', price: 500, color: 'from-red-400 to-red-600', locked: false, isNew: false, freeCount: 0 },
            diamond: { id: 'diamond', name: '–ê–ª–º–∞–∑', emoji: 'üíé', price: 50, color: 'from-blue-400 to-blue-600', locked: false, isNew: false, freeCount: 0 },
            major: { id: 'major', name: '–ú–∞–∂–æ—Ä', emoji: 'ü§¥', price: 800, color: 'from-purple-500 to-indigo-700', locked: true, isNew: false, freeCount: 0 },
            star: { id: 'star', name: '–ó–≤–µ–∑–¥–Ω—ã–π', emoji: '‚≠êÔ∏è', price: 30, originalPrice: 30, discountPrice: 23, color: 'from-yellow-400 to-amber-500', locked: false, isNew: true, freeCount: 0 }
        };
        
        const CASE_REWARDS = {
            daily: [
                { id: 'stars_1', name: '1 ‚≠êÔ∏è', emoji: '‚≠êÔ∏è', type: 'stars', value: 1, realChance: 50, displayChance: '50%' },
                { id: 'stars_3', name: '3 ‚≠êÔ∏è', emoji: '‚≠êÔ∏è', type: 'stars', value: 3, realChance: 35, displayChance: '35%' },
                { id: 'stars_15', name: '15 ‚≠êÔ∏è', emoji: '‚≠êÔ∏è', type: 'stars', value: 15, realChance: 10, displayChance: '10%' },
                { id: 'pickaxe', name: '–ö–∏—Ä–∫–∞ ‚õèÔ∏è', emoji: '‚õèÔ∏è', type: 'item', sellPrice: 22, realChance: 4, displayChance: '4%' },
                { id: 'random_case_box', name: '–°–ª—É—á–∞–π–Ω—ã–π –∫–µ–π—Å', emoji: 'üì¶', type: 'random_case_box', realChance: 1, displayChance: '1%' },
            ],
            cardboard: [
                { id: 'stars_0_25', name: '0.25 ‚≠êÔ∏è', displayChance: '80%', realChance: 80, type: 'stars', value: 0.25, emoji: '‚≠êÔ∏è' },
                { id: 'stars_0_75', name: '0.75 ‚≠êÔ∏è', displayChance: '10%', realChance: 10, type: 'stars', value: 0.75, emoji: '‚≠êÔ∏è' },
                { id: 'stars_1_5', name: '1.5 ‚≠êÔ∏è', displayChance: '6%', realChance: 6, type: 'stars', value: 1.5, emoji: '‚≠êÔ∏è' },
                { id: 'stars_5', name: '5 ‚≠êÔ∏è', displayChance: '2%', realChance: 2, type: 'stars', value: 5, emoji: '‚≠êÔ∏è' },
                { id: 'bear', name: 'üß∏', displayChance: '1.5%', realChance: 1.5, type: 'item', sellPrice: 20, emoji: 'üß∏' },
                { id: 'diamond_pro', name: 'üíé PRO', displayChance: '0.5%', realChance: 0, type: 'collectible', emoji: 'üíé' }
            ],
            coal: [
                { id: 'stars_5', name: '5 ‚≠êÔ∏è', displayChance: '60.5%', realChance: 60.5, type: 'stars', value: 5, emoji: '‚≠êÔ∏è' },
                { id: 'stars_12', name: '12 ‚≠êÔ∏è', displayChance: '18%', realChance: 18, type: 'stars', value: 12, emoji: '‚≠êÔ∏è' },
                { id: 'pickaxe', name: '–ö–∏—Ä–∫–∞ ‚õèÔ∏è', displayChance: '10%', realChance: 10, type: 'item', sellPrice: 22, emoji: '‚õèÔ∏è' },
                { id: 'stars_30', name: '30 ‚≠êÔ∏è', displayChance: '6%', realChance: 6, type: 'stars', value: 30, emoji: '‚≠êÔ∏è' },
                { id: 'material', name: '–ú–∞—Ç–µ—Ä–∏–∞–ª üß±', displayChance: '5%', realChance: 5, type: 'item', sellPrice: 80, emoji: 'üß±' },
                { id: 'brownie_pro', name: 'Happy Brownie PRO üí©', displayChance: '0.5%', realChance: 0, type: 'collectible', emoji: 'üí©' }
            ],
            platinum: [
                { id: 'stars_35', name: '35 ‚≠êÔ∏è', displayChance: '55%', realChance: 55, type: 'stars', value: 35, emoji: '‚≠êÔ∏è' },
                { id: 'stars_50', name: '50 ‚≠êÔ∏è', displayChance: '35%', realChance: 35, type: 'stars', value: 50, emoji: '‚≠êÔ∏è' },
                { id: 'ring', name: 'üíç', displayChance: '5%', realChance: 0, type: 'collectible', emoji: 'üíç' },
                { id: 'bday', name: 'B-day üóì', displayChance: '4%', realChance: 4, type: 'item', sellPrice: 150, emoji: 'üóì' },
                { id: 'bday_pro', name: 'B-Day PRO üìÖ', displayChance: '1%', realChance: 0, type: 'collectible', emoji: 'üìÖ' }
            ],
            gold: [
                { id: 'stars_50', name: '50 ‚≠êÔ∏è', displayChance: '50%', realChance: 50, type: 'stars', value: 50, emoji: '‚≠êÔ∏è' },
                { id: 'stars_125', name: '125 ‚≠êÔ∏è', displayChance: '35%', realChance: 35, type: 'stars', value: 125, emoji: '‚≠êÔ∏è' },
                { id: 'clover', name: 'üçÄ Clover Pin', displayChance: '10%', realChance: 10, type: 'item', sellPrice: 200, emoji: 'üçÄ' },
                { id: 'icecream', name: 'Ice Cream üç¶', displayChance: '3%', realChance: 0, type: 'collectible', emoji: 'üç¶' },
                { id: 'clover_pro', name: 'üçÄ Clover Pin PRO', displayChance: '2%', realChance: 0, type: 'collectible', emoji: 'üçÄ' }
            ],
            money: [
                { id: 'stars_150', name: '150 ‚≠êÔ∏è', displayChance: '45%', realChance: 45, type: 'stars', value: 150, emoji: '‚≠êÔ∏è' },
                { id: 'stars_75', name: '75 ‚≠êÔ∏è', displayChance: '40%', realChance: 40, type: 'stars', value: 75, emoji: '‚≠êÔ∏è' },
                { id: 'trophy', name: 'üèÜ', displayChance: '5%', realChance: 0, type: 'collectible', emoji: 'üèÜ' },
                { id: 'gem', name: 'üíé', displayChance: 5, realChance: 0, type: 'collectible', emoji: 'üíé' },
                { id: 'bday_happy', name: 'Happy B-day üíà', displayChance: '4%', realChance: 4, type: 'collectible', emoji: 'üíà' },
                { id: 'cigar', name: 'Snoop Cigar üö¨', displayChance: '1%', realChance: 0, type: 'collectible', emoji: 'üö¨' }
            ],
            elite: [
                { id: 'stars_200', name: '200 ‚≠êÔ∏è', displayChance: '65%', realChance: 65, type: 'stars', value: 200, emoji: '‚≠êÔ∏è' },
                { id: 'stars_275', name: '275 ‚≠êÔ∏è', displayChance: '25%', realChance: 25, type: 'stars', value: 275, emoji: '‚≠êÔ∏è' },
                { id: 'champagne', name: 'üçæ', displayChance: '8.5%', realChance: 0, type: 'collectible', emoji: 'üçæ' },
                { id: 'socks', name: '–ù–æ—Å–∫–∏ üß¶', displayChance: '1%', realChance: 0, type: 'collectible', emoji: 'üß¶' },
                { id: 'lightsword', name: 'Light Sword ‚öîÔ∏è', displayChance: '0.5%', realChance: 0, type: 'collectible', emoji: '‚öîÔ∏è' }
            ],
            diamond: [
                { id: 'stars_8', name: '8 ‚≠êÔ∏è', displayChance: '70%', realChance: 70, type: 'stars', value: 8, emoji: '‚≠êÔ∏è' },
                { id: 'bear', name: '–ú–∏—à–∫–∞ üß∏', displayChance: '15%', realChance: 15, type: 'item', sellPrice: 20, emoji: 'üß∏' },
                { id: 'stars_25', name: '25 ‚≠êÔ∏è', displayChance: '9%', realChance: 9, type: 'stars', value: 25, emoji: '‚≠êÔ∏è' },
                { id: 'stars_80', name: '80 ‚≠êÔ∏è', displayChance: '4%', realChance: 4, type: 'stars', value: 80, emoji: '‚≠êÔ∏è' },
                { id: 'diamond_pro', name: '–ê–ª–º–∞–∑ PRO üíé', displayChance: '0.6%', realChance: 0, type: 'collectible', emoji: 'üíé' },
                { id: 'snoop_pro', name: 'Snoop Dog PRO üêï', displayChance: '0.4%', realChance: 0, type: 'collectible', emoji: 'üêï' }
            ],
            major: [
                { id: 'stars_500', name: '500 ‚≠êÔ∏è', displayChance: '50%', realChance: 50, type: 'stars', value: 500, emoji: '‚≠êÔ∏è' },
                { id: 'stars_1000', name: '1000 ‚≠êÔ∏è', displayChance: '25%', realChance: 25, type: 'stars', value: 1000, emoji: '‚≠êÔ∏è' },
                { id: 'stars_2500', name: '2500 ‚≠êÔ∏è', displayChance: '10%', realChance: 10, type: 'stars', value: 2500, emoji: '‚≠êÔ∏è' },
                { id: 'stars_5000', name: '5000 ‚≠êÔ∏è', displayChance: '5%', realChance: 5, type: 'stars', value: 5000, emoji: '‚≠êÔ∏è' },
                { id: 'car', name: 'üöó –ê–≤—Ç–æ–º–æ–±–∏–ª—å', displayChance: '5%', realChance: 0, type: 'collectible', emoji: 'üöó' },
                { id: 'diamond_ring', name: 'üíç –ë—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤–æ–µ –∫–æ–ª—å—Ü–æ', displayChance: '3%', realChance: 0, type: 'collectible', emoji: 'üíç' },
                { id: 'gold_bar', name: 'ü•á –ó–æ–ª–æ—Ç–æ–π —Å–ª–∏—Ç–æ–∫', displayChance: '2%', realChance: 0, type: 'collectible', emoji: 'ü•á' }
            ],
            collector: [
                { id: 'bear_pro', name: 'üß∏ PRO', displayChance: '55%', realChance: 0, type: 'collectible', emoji: 'üß∏' },
                { id: 'gift_pro', name: 'üéÅ PRO', displayChance: '20%', realChance: 0, type: 'collectible', emoji: 'üéÅ' },
                { id: 'rocket_pro', name: 'üöÄ PRO', displayChance: '15%', realChance: 0, type: 'collectible', emoji: 'üöÄ' },
                { id: 'cup_pro', name: 'üèÜ PRO', displayChance: '5%', realChance: 0, type: 'collectible', emoji: 'üèÜ' },
                { id: 'cake_candle', name: 'üç∞ B-day Candle', displayChance: '2%', realChance: 0, type: 'collectible', emoji: 'üç∞' },
                { id: 'ramen_pro', name: 'üçú Ramen PRO', displayChance: '1.5%', realChance: 0, type: 'collectible', emoji: 'üçú' },
                { id: 'hat_pro', name: 'üé© Top hat', displayChance: '1%', realChance: 0, type: 'collectible', emoji: 'üé©' },
                { id: 'bird_pro', name: 'ü¶Ö Rare bird', displayChance: '0.5%', realChance: 0, type: 'collectible', emoji: 'ü¶Ö' }
            ],
            star: [
                {id: 'stars_1', name: '1 ‚≠êÔ∏è', displayChance: '10.50%', realChance: 10.50, type: 'stars', value: 1, emoji: '‚≠êÔ∏è'},
                {id: 'stars_2', name: '2 ‚≠êÔ∏è', displayChance: '8.00%', realChance: 8.00, type: 'stars', value: 2, emoji: '‚≠êÔ∏è'},
                {id: 'stars_3', name: '3 ‚≠êÔ∏è', displayChance: '6.50%', realChance: 6.50, type: 'stars', value: 3, emoji: '‚≠êÔ∏è'},
                {id: 'stars_4', name: '4 ‚≠êÔ∏è', displayChance: '5.20%', realChance: 5.20, type: 'stars', value: 4, emoji: '‚≠êÔ∏è'},
                {id: 'stars_5', name: '5 ‚≠êÔ∏è', displayChance: '4.30%', realChance: 4.30, type: 'stars', value: 5, emoji: '‚≠êÔ∏è'},
                {id: 'stars_6', name: '6 ‚≠êÔ∏è', displayChance: '3.70%', realChance: 3.70, type: 'stars', value: 6, emoji: '‚≠êÔ∏è'},
                {id: 'stars_7', name: '7 ‚≠êÔ∏è', displayChance: '3.20%', realChance: 3.20, type: 'stars', value: 7, emoji: '‚≠êÔ∏è'},
                {id: 'stars_8', name: '8 ‚≠êÔ∏è', displayChance: '2.80%', realChance: 2.80, type: 'stars', value: 8, emoji: '‚≠êÔ∏è'},
                {id: 'stars_9', name: '9 ‚≠êÔ∏è', displayChance: '2.50%', realChance: 2.50, type: 'stars', value: 9, emoji: '‚≠êÔ∏è'},
                {id: 'stars_10', name: '10 ‚≠êÔ∏è', displayChance: '2.20%', realChance: 2.20, type: 'stars', value: 10, emoji: '‚≠êÔ∏è'},
                {id: 'stars_11', name: '11 ‚≠êÔ∏è', displayChance: '2.00%', realChance: 2.00, type: 'stars', value: 11, emoji: '‚≠êÔ∏è'},
                {id: 'stars_12', name: '12 ‚≠êÔ∏è', displayChance: '1.85%', realChance: 1.85, type: 'stars', value: 12, emoji: '‚≠êÔ∏è'},
                {id: 'stars_13', name: '13 ‚≠êÔ∏è', displayChance: '1.70%', realChance: 1.70, type: 'stars', value: 13, emoji: '‚≠êÔ∏è'},
                {id: 'stars_14', name: '14 ‚≠êÔ∏è', displayChance: '1.60%', realChance: 1.60, type: 'stars', value: 14, emoji: '‚≠êÔ∏è'},
                {id: 'stars_15', name: '15 ‚≠êÔ∏è', displayChance: '1.50%', realChance: 1.50, type: 'stars', value: 15, emoji: '‚≠êÔ∏è'},
                {id: 'stars_16', name: '16 ‚≠êÔ∏è', displayChance: '1.40%', realChance: 1.40, type: 'stars', value: 16, emoji: '‚≠êÔ∏è'},
                {id: 'stars_17', name: '17 ‚≠êÔ∏è', displayChance: '1.32%', realChance: 1.32, type: 'stars', value: 17, emoji: '‚≠êÔ∏è'},
                {id: 'stars_18', name: '18 ‚≠êÔ∏è', displayChance: '1.24%', realChance: 1.24, type: 'stars', value: 18, emoji: '‚≠êÔ∏è'},
                {id: 'stars_19', name: '19 ‚≠êÔ∏è', displayChance: '1.17%', realChance: 1.17, type: 'stars', value: 19, emoji: '‚≠êÔ∏è'},
                {id: 'stars_20', name: '20 ‚≠êÔ∏è', displayChance: '1.10%', realChance: 1.10, type: 'stars', value: 20, emoji: '‚≠êÔ∏è'},
                {id: 'stars_21', name: '21 ‚≠êÔ∏è', displayChance: '1.04%', realChance: 1.04, type: 'stars', value: 21, emoji: '‚≠êÔ∏è'},
                {id: 'stars_22', name: '22 ‚≠êÔ∏è', displayChance: '0.98%', realChance: 0.98, type: 'stars', value: 22, emoji: '‚≠êÔ∏è'},
                {id: 'stars_23', name: '23 ‚≠êÔ∏è', displayChance: '0.93%', realChance: 0.93, type: 'stars', value: 23, emoji: '‚≠êÔ∏è'},
                {id: 'stars_24', name: '24 ‚≠êÔ∏è', displayChance: '0.88%', realChance: 0.88, type: 'stars', value: 24, emoji: '‚≠êÔ∏è'},
                {id: 'stars_25', name: '25 ‚≠êÔ∏è', displayChance: '0.84%', realChance: 0.84, type: 'stars', value: 25, emoji: '‚≠êÔ∏è'},
                {id: 'stars_26', name: '26 ‚≠êÔ∏è', displayChance: '0.80%', realChance: 0.80, type: 'stars', value: 26, emoji: '‚≠êÔ∏è'},
                {id: 'stars_27', name: '27 ‚≠êÔ∏è', displayChance: '0.77%', realChance: 0.77, type: 'stars', value: 27, emoji: '‚≠êÔ∏è'},
                {id: 'stars_28', name: '28 ‚≠êÔ∏è', displayChance: '0.74%', realChance: 0.74, type: 'stars', value: 28, emoji: '‚≠êÔ∏è'},
                {id: 'stars_29', name: '29 ‚≠êÔ∏è', displayChance: '0.71%', realChance: 0.71, type: 'stars', value: 29, emoji: '‚≠êÔ∏è'},
                {id: 'stars_30', name: '30 ‚≠êÔ∏è', displayChance: '0.68%', realChance: 0.68, type: 'stars', value: 30, emoji: '‚≠êÔ∏è'},
                {id: 'stars_31', name: '31 ‚≠êÔ∏è', displayChance: '0.66%', realChance: 0.66, type: 'stars', value: 31, emoji: '‚≠êÔ∏è'},
                {id: 'stars_32', name: '32 ‚≠êÔ∏è', displayChance: '0.64%', realChance: 0.64, type: 'stars', value: 32, emoji: '‚≠êÔ∏è'},
                {id: 'stars_33', name: '33 ‚≠êÔ∏è', displayChance: '0.62%', realChance: 0.62, type: 'stars', value: 33, emoji: '‚≠êÔ∏è'},
                {id: 'stars_34', name: '34 ‚≠êÔ∏è', displayChance: '0.60%', realChance: 0.60, type: 'stars', value: 34, emoji: '‚≠êÔ∏è'},
                {id: 'stars_35', name: '35 ‚≠êÔ∏è', displayChance: '0.58%', realChance: 0.58, type: 'stars', value: 35, emoji: '‚≠êÔ∏è'},
                {id: 'stars_36', name: '36 ‚≠êÔ∏è', displayChance: '0.56%', realChance: 0.56, type: 'stars', value: 36, emoji: '‚≠êÔ∏è'},
                {id: 'stars_37', name: '37 ‚≠êÔ∏è', displayChance: '0.55%', realChance: 0.55, type: 'stars', value: 37, emoji: '‚≠êÔ∏è'},
                {id: 'stars_38', name: '38 ‚≠êÔ∏è', displayChance: '0.54%', realChance: 0.54, type: 'stars', value: 38, emoji: '‚≠êÔ∏è'},
                {id: 'stars_39', name: '39 ‚≠êÔ∏è', displayChance: '0.53%', realChance: 0.53, type: 'stars', value: 39, emoji: '‚≠êÔ∏è'},
                {id: 'stars_40', name: '40 ‚≠êÔ∏è', displayChance: '0.52%', realChance: 0.52, type: 'stars', value: 40, emoji: '‚≠êÔ∏è'},
                {id: 'stars_41', name: '41 ‚≠êÔ∏è', displayChance: '0.51%', realChance: 0.51, type: 'stars', value: 41, emoji: '‚≠êÔ∏è'},
                {id: 'stars_42', name: '42 ‚≠êÔ∏è', displayChance: '0.50%', realChance: 0.50, type: 'stars', value: 42, emoji: '‚≠êÔ∏è'},
                {id: 'stars_43', name: '43 ‚≠êÔ∏è', displayChance: '0.49%', realChance: 0.49, type: 'stars', value: 43, emoji: '‚≠êÔ∏è'},
                {id: 'stars_44', name: '44 ‚≠êÔ∏è', displayChance: '0.48%', realChance: 0.48, type: 'stars', value: 44, emoji: '‚≠êÔ∏è'},
                {id: 'stars_45', name: '45 ‚≠êÔ∏è', displayChance: '0.47%', realChance: 0.47, type: 'stars', value: 45, emoji: '‚≠êÔ∏è'},
                {id: 'stars_46', name: '46 ‚≠êÔ∏è', displayChance: '0.46%', realChance: 0.46, type: 'stars', value: 46, emoji: '‚≠êÔ∏è'},
                {id: 'stars_47', name: '47 ‚≠êÔ∏è', displayChance: '0.45%', realChance: 0.45, type: 'stars', value: 47, emoji: '‚≠êÔ∏è'},
                {id: 'stars_48', name: '48 ‚≠êÔ∏è', displayChance: '0.44%', realChance: 0.44, type: 'stars', value: 48, emoji: '‚≠êÔ∏è'},
                {id: 'stars_49', name: '49 ‚≠êÔ∏è', displayChance: '0.43%', realChance: 0.43, type: 'stars', value: 49, emoji: '‚≠êÔ∏è'},
                {id: 'stars_50', name: '50 ‚≠êÔ∏è', displayChance: '0.42%', realChance: 0.42, type: 'stars', value: 50, emoji: '‚≠êÔ∏è'},
                {id: 'stars_51', name: '51 ‚≠êÔ∏è', displayChance: '0.45%', realChance: 0.45, type: 'stars', value: 51, emoji: '‚≠êÔ∏è'},
                {id: 'stars_52', name: '52 ‚≠êÔ∏è', displayChance: '0.44%', realChance: 0.44, type: 'stars', value: 52, emoji: '‚≠êÔ∏è'},
                {id: 'stars_53', name: '53 ‚≠êÔ∏è', displayChance: '0.43%', realChance: 0.43, type: 'stars', value: 53, emoji: '‚≠êÔ∏è'},
                {id: 'stars_54', name: '54 ‚≠êÔ∏è', displayChance: '0.42%', realChance: 0.42, type: 'stars', value: 54, emoji: '‚≠êÔ∏è'},
                {id: 'stars_55', name: '55 ‚≠êÔ∏è', displayChance: '0.41%', realChance: 0.41, type: 'stars', value: 55, emoji: '‚≠êÔ∏è'},
                {id: 'stars_56', name: '56 ‚≠êÔ∏è', displayChance: '0.40%', realChance: 0.40, type: 'stars', value: 56, emoji: '‚≠êÔ∏è'},
                {id: 'stars_57', name: '57 ‚≠êÔ∏è', displayChance: '0.39%', realChance: 0.39, type: 'stars', value: 57, emoji: '‚≠êÔ∏è'},
                {id: 'stars_58', name: '58 ‚≠êÔ∏è', displayChance: '0.38%', realChance: 0.38, type: 'stars', value: 58, emoji: '‚≠êÔ∏è'},
                {id: 'stars_59', name: '59 ‚≠êÔ∏è', displayChance: '0.37%', realChance: 0.37, type: 'stars', value: 59, emoji: '‚≠êÔ∏è'},
                {id: 'stars_60', name: '60 ‚≠êÔ∏è', displayChance: '0.36%', realChance: 0.36, type: 'stars', value: 60, emoji: '‚≠êÔ∏è'},
                {id: 'stars_61', name: '61 ‚≠êÔ∏è', displayChance: '0.35%', realChance: 0.35, type: 'stars', value: 61, emoji: '‚≠êÔ∏è'},
                {id: 'stars_62', name: '62 ‚≠êÔ∏è', displayChance: '0.34%', realChance: 0.34, type: 'stars', value: 62, emoji: '‚≠êÔ∏è'},
                {id: 'stars_63', name: '63 ‚≠êÔ∏è', displayChance: '0.33%', realChance: 0.33, type: 'stars', value: 63, emoji: '‚≠êÔ∏è'},
                {id: 'stars_64', name: '64 ‚≠êÔ∏è', displayChance: '0.32%', realChance: 0.32, type: 'stars', value: 64, emoji: '‚≠êÔ∏è'},
                {id: 'stars_65', name: '65 ‚≠êÔ∏è', displayChance: '0.31%', realChance: 0.31, type: 'stars', value: 65, emoji: '‚≠êÔ∏è'},
                {id: 'stars_66', name: '66 ‚≠êÔ∏è', displayChance: '0.30%', realChance: 0.30, type: 'stars', value: 66, emoji: '‚≠êÔ∏è'},
                {id: 'stars_67', name: '67 ‚≠êÔ∏è', displayChance: '0.29%', realChance: 0.29, type: 'stars', value: 67, emoji: '‚≠êÔ∏è'},
                {id: 'stars_68', name: '68 ‚≠êÔ∏è', displayChance: '0.28%', realChance: 0.28, type: 'stars', value: 68, emoji: '‚≠êÔ∏è'},
                {id: 'stars_69', name: '69 ‚≠êÔ∏è', displayChance: '0.27%', realChance: 0.27, type: 'stars', value: 69, emoji: '‚≠êÔ∏è'},
                {id: 'stars_70', name: '70 ‚≠êÔ∏è', displayChance: '0.26%', realChance: 0.26, type: 'stars', value: 70, emoji: '‚≠êÔ∏è'},
                {id: 'stars_71', name: '71 ‚≠êÔ∏è', displayChance: '0.25%', realChance: 0.25, type: 'stars', value: 71, emoji: '‚≠êÔ∏è'},
                {id: 'stars_72', name: '72 ‚≠êÔ∏è', displayChance: '0.24%', realChance: 0.24, type: 'stars', value: 72, emoji: '‚≠êÔ∏è'},
                {id: 'stars_73', name: '73 ‚≠êÔ∏è', displayChance: '0.23%', realChance: 0.23, type: 'stars', value: 73, emoji: '‚≠êÔ∏è'},
                {id: 'stars_74', name: '74 ‚≠êÔ∏è', displayChance: '0.22%', realChance: 0.22, type: 'stars', value: 74, emoji: '‚≠êÔ∏è'},
                {id: 'stars_75', name: '75 ‚≠êÔ∏è', displayChance: '0.21%', realChance: 0.21, type: 'stars', value: 75, emoji: '‚≠êÔ∏è'},
                {id: 'stars_76', name: '76 ‚≠êÔ∏è', displayChance: '0.20%', realChance: 0.20, type: 'stars', value: 76, emoji: '‚≠êÔ∏è'},
                {id: 'stars_77', name: '77 ‚≠êÔ∏è', displayChance: '0.19%', realChance: 0.19, type: 'stars', value: 77, emoji: '‚≠êÔ∏è'},
                {id: 'stars_78', name: '78 ‚≠êÔ∏è', displayChance: '0.18%', realChance: 0.18, type: 'stars', value: 78, emoji: '‚≠êÔ∏è'},
                {id: 'stars_79', name: '79 ‚≠êÔ∏è', displayChance: '0.17%', realChance: 0.17, type: 'stars', value: 79, emoji: '‚≠êÔ∏è'},
                {id: 'stars_80', name: '80 ‚≠êÔ∏è', displayChance: '0.16%', realChance: 0.16, type: 'stars', value: 80, emoji: '‚≠êÔ∏è'},
                {id: 'stars_81', name: '81 ‚≠êÔ∏è', displayChance: '0.15%', realChance: 0.15, type: 'stars', value: 81, emoji: '‚≠êÔ∏è'},
                {id: 'stars_82', name: '82 ‚≠êÔ∏è', displayChance: '0.14%', realChance: 0.14, type: 'stars', value: 82, emoji: '‚≠êÔ∏è'},
                {id: 'stars_83', name: '83 ‚≠êÔ∏è', displayChance: '0.13%', realChance: 0.13, type: 'stars', value: 83, emoji: '‚≠êÔ∏è'},
                {id: 'stars_84', name: '84 ‚≠êÔ∏è', displayChance: '0.12%', realChance: 0.12, type: 'stars', value: 84, emoji: '‚≠êÔ∏è'},
                {id: 'stars_85', name: '85 ‚≠êÔ∏è', displayChance: '0.11%', realChance: 0.11, type: 'stars', value: 85, emoji: '‚≠êÔ∏è'},
                {id: 'stars_86', name: '86 ‚≠êÔ∏è', displayChance: '0.10%', realChance: 0.10, type: 'stars', value: 86, emoji: '‚≠êÔ∏è'},
                {id: 'stars_87', name: '87 ‚≠êÔ∏è', displayChance: '0.09%', realChance: 0.09, type: 'stars', value: 87, emoji: '‚≠êÔ∏è'},
                {id: 'stars_88', name: '88 ‚≠êÔ∏è', displayChance: '0.08%', realChance: 0.08, type: 'stars', value: 88, emoji: '‚≠êÔ∏è'},
                {id: 'stars_89', name: '89 ‚≠êÔ∏è', displayChance: '0.07%', realChance: 0.07, type: 'stars', value: 89, emoji: '‚≠êÔ∏è'},
                {id: 'stars_90', name: '90 ‚≠êÔ∏è', displayChance: '0.06%', realChance: 0.06, type: 'stars', value: 90, emoji: '‚≠êÔ∏è'},
                {id: 'stars_91', name: '91 ‚≠êÔ∏è', displayChance: '0.05%', realChance: 0.05, type: 'stars', value: 91, emoji: '‚≠êÔ∏è'},
                {id: 'stars_92', name: '92 ‚≠êÔ∏è', displayChance: '0.04%', realChance: 0.04, type: 'stars', value: 92, emoji: '‚≠êÔ∏è'},
                {id: 'stars_93', name: '93 ‚≠êÔ∏è', displayChance: '0.03%', realChance: 0.03, type: 'stars', value: 93, emoji: '‚≠êÔ∏è'},
                {id: 'stars_94', name: '94 ‚≠êÔ∏è', displayChance: '0.02%', realChance: 0.02, type: 'stars', value: 94, emoji: '‚≠êÔ∏è'},
                {id: 'stars_95', name: '95 ‚≠êÔ∏è', displayChance: '0.01%', realChance: 0.01, type: 'stars', value: 95, emoji: '‚≠êÔ∏è'},
                {id: 'stars_96', name: '96 ‚≠êÔ∏è', displayChance: '0.009%', realChance: 0.009, type: 'stars', value: 96, emoji: '‚≠êÔ∏è'},
                {id: 'stars_97', name: '97 ‚≠êÔ∏è', displayChance: '0.008%', realChance: 0.008, type: 'stars', value: 97, emoji: '‚≠êÔ∏è'},
                {id: 'stars_98', name: '98 ‚≠êÔ∏è', displayChance: '0.007%', realChance: 0.007, type: 'stars', value: 98, emoji: '‚≠êÔ∏è'},
                {id: 'stars_99', name: '99 ‚≠êÔ∏è', displayChance: '0.006%', realChance: 0.006, type: 'stars', value: 99, emoji: '‚≠êÔ∏è'},
                {id: 'stars_125', name: '125 ‚≠êÔ∏è', displayChance: '0.005%', realChance: 0.005, type: 'stars', value: 125, emoji: '‚≠êÔ∏è'}
            ],
            olympus: [
                { id: 'persephone', name: '–ü–µ—Ä—Å–µ—Ñ–æ–Ω–∞üå∫', displayChance: '40%', realChance: 40, type: 'olympus_item', sellPrice: 20, emoji: 'üå∫' },
                { id: 'ares', name: '–ê—Ä–µ—Åüó°Ô∏è', displayChance: '20%', realChance: 20, type: 'olympus_item', sellPrice: 28, emoji: 'üó°Ô∏è' },
                { id: 'hermes', name: '–ì–µ—Ä–º–µ—Åüìà', displayChance: '15%', realChance: 15, type: 'olympus_slot', emoji: 'üìà' },
                { id: 'dionysus', name: '–î–∏–æ–Ω–∏—Åüç∑', displayChance: '10%', realChance: 10, type: 'olympus_exchange_stars', value: 80, emoji: 'üç∑' },
                { id: 'apollo', name: '–ê–ø–æ–ª–ª–æ–Ω‚òÄÔ∏è', displayChance: '8%', realChance: 8, type: 'olympus_star_cases', count: 5, emoji: '‚òÄÔ∏è' },
                { id: 'poseidon', name: '–ü–æ—Å–µ–π–¥–æ–Ωüî±', displayChance: '5%', realChance: 5, type: 'olympus_choice', emoji: 'üî±' },
                { id: 'hades', name: '–ê–∏–¥üî•', displayChance: '1.9%', realChance: 1.9, type: 'olympus_hades_choice', emoji: 'üî•' },
                { id: 'zeus', name: '–ó–µ–≤—Å‚ö°Ô∏è', displayChance: '0.1%', realChance: 0.1, type: 'olympus_zeus', emoji: '‚ö°Ô∏è' }
            ]
        };
        
        const OLYMPUS_PROGRESS = [
            { opens: 3, reward: { type: 'star_cases', count: 3 }, name: '3 –∫–µ–π—Å–∞ ¬´–ó–≤–µ–∑–¥–Ω—ã–π‚≠êÔ∏è¬ª' },
            { opens: 7, reward: { type: 'case', caseId: 'gold', count: 1 }, name: '1 –∫–µ–π—Å ¬´–ó–æ–ª–æ—Ç–æ–πüëë¬ª' },
            { opens: 15, reward: { type: 'case', caseId: 'elite', count: 1 }, name: '1 –∫–µ–π—Å ¬´–≠–ª–∏—Ç–∞üéñÔ∏è¬ª' },
            { opens: 20, reward: { type: 'stars', value: 150 }, name: '150‚≠êÔ∏è' },
            { opens: 25, reward: { type: 'case', caseId: 'money', count: 3 }, name: '3 –∫–µ–π—Å–∞ ¬´–î–µ–Ω–µ–∂–Ω—ã–πüíµ¬ª' },
            { opens: 30, reward: { type: 'special_item', item: 'hades_gift' }, name: '–ü–æ–¥–∞—Ä–æ–∫ –ê–∏–¥üî•' },
            { opens: 50, reward: { type: 'special_item', item: 'zeus_gift' }, name: '–ü–æ–¥–∞—Ä–æ–∫ –ó–µ–≤—Å‚ö°Ô∏è' },
            { opens: 150, reward: { type: 'mega', starCases: 25, stars: 1000 }, name: '25 –∫–µ–π—Å–æ–≤ ¬´–ó–≤–µ–∑–¥–Ω—ã–π‚≠êÔ∏è¬ª + 1000‚≠êÔ∏è' }
        ];
        
        const GEFEST_EXCHANGES = {
            'gold_ball': { name: '‚öΩÔ∏è –ó–æ–ª–æ—Ç–æ–π –º—è—á', reward: { type: 'case', caseId: 'coal', count: 1 }, rewardText: '1 –∫–µ–π—Å ¬´–£–≥–æ–ª–µ–∫¬ª' },
            'mikhaylov_ball': { name: 'üèê –ú—è—á –ú–∞–∫—Å–∏–º–∞ –ú–∏—Ö–∞–π–ª–æ–≤–∞', reward: { type: 'case', caseId: 'star', count: 1 }, rewardText: '1 –∫–µ–π—Å ¬´–ó–≤–µ–∑–¥–Ω—ã–π‚≠êÔ∏è¬ª' },
            'tyson_gloves': { name: 'ü•ä –ü–µ—Ä—á–∞—Ç–∫–∏ –ú–∞–π–∫–∞ –¢–∞–π—Å–æ–Ω–∞', reward: { type: 'slot' }, rewardText: '+1 —Å–ª–æ—Ç' },
            'steak': { name: 'ü•© –°—Ç–µ–π–∫', reward: { type: 'stars', value: 100 }, rewardText: '100‚≠êÔ∏è' },
            'simba': { name: 'ü¶Å –°–∏–º–±–∞', reward: { type: 'case', caseId: 'gold', count: 2 }, rewardText: '2 –∫–µ–π—Å–∞ ¬´–ó–æ–ª–æ—Ç–æ–πüëë¬ª' },
            'wolf_wallstreet': { name: 'üê∫ –í–æ–ª–∫ —Å –£–æ–ª–ª-—Å—Ç—Ä–∏—Ç', reward: { type: 'collector_unlock' }, rewardText: '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ + 2 –∫–µ–π—Å–∞ ¬´–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Äüé©¬ª' },
            'ice': { name: 'üßä', reward: { type: 'choice', option1: { type: 'case', caseId: 'star', count: 25 }, option2: { type: 'stars', value: 500 } }, rewardText: '25 –∫–µ–π—Å–æ–≤ ¬´–ó–≤–µ–∑–¥–Ω—ã–π‚≠êÔ∏è¬ª –∏–ª–∏ 500‚≠êÔ∏è' },
            'diamond_pro': { name: 'üíé –ê–ª–º–∞–∑ PRO', reward: { type: 'stars', value: 125 }, rewardText: '125‚≠êÔ∏è' },
            'material': { name: 'üß± –ú–∞—Ç–µ—Ä–∏–∞–ª', reward: { type: 'stars', value: 130 }, rewardText: '130‚≠êÔ∏è', highlight: true }
        };
        
        // Backward-compatible aliases for Olympus case id.
        if (CASE_REWARDS.olymp && !CASE_REWARDS.olympus) CASE_REWARDS.olympus = CASE_REWARDS.olymp;
        if (CASE_REWARDS.olympus && !CASE_REWARDS.olymp) CASE_REWARDS.olymp = CASE_REWARDS.olympus;

        const GERAKL_10_REWARDS = [
            { id: 'bear', name: 'üß∏ –ú–∏—à–∫–∞', chance: 35, type: 'item', sellPrice: 20, emoji: 'üß∏' },
            { id: 'bear_pro', name: 'üß∏ PRO', chance: 20, type: 'collectible', emoji: 'üß∏' },
            { id: 'material', name: 'üß± –ú–∞—Ç–µ—Ä–∏–∞–ª', chance: 15, type: 'item', sellPrice: 80, emoji: 'üß±' },
            { id: 'champagne', name: 'üçæ –ë—É—Ç—ã–ª–∫–∞', chance: 10, type: 'collectible', emoji: 'üçæ' },
            { id: 'ring', name: 'üíç –ö–æ–ª—å—Ü–æ', chance: 8, type: 'collectible', emoji: 'üíç' },
            { id: 'stars_25', name: '25 ‚≠êÔ∏è', chance: 5, type: 'stars', value: 25, emoji: '‚≠êÔ∏è' },
            { id: 'stars_200', name: '200 ‚≠êÔ∏è', chance: 3, type: 'stars', value: 200, emoji: '‚≠êÔ∏è' },
            { id: 'stars_350', name: '350 ‚≠êÔ∏è', chance: 2, type: 'stars', value: 350, emoji: '‚≠êÔ∏è' },
            { id: 'dellko', name: 'üîë DELLKO', chance: 2, type: 'promo', code: 'DELLKO', emoji: 'üîë' }
        ];
        
        const GERAKL_MULTIPLIERS = [1.0, 1.1, 1.4, 1.9, 2.3, 2.6, 3.8, 4.5, 5.5, 6.0, 10.0];
        const GERAKL_ICE_CHANCES = [0.15, 0.18, 0.18, 0.20, 0.30, 0.35, 0.45, 0.45, 0.45, 0.50, 0.53];
        
        const TON_RATES = [{ stars: 50, ton: 0.6 }, { stars: 250, ton: 3 }, { stars: 500, ton: 6 }, { stars: 1000, ton: 12 }];
        const STARS_PACKAGES = [ { stars: 50, price: 50 }, { stars: 100, price: 100 }, { stars: 250, price: 250 }, { stars: 500, price: 500 }, { stars: 1000, price: 1000 } ];
        
        function App() {
            const [currentScreen, setCurrentScreen] = useState('cases');
            const [balance, setBalance] = useState(0);
            const [cases, setCases] = useState(INITIAL_CASES);
            const [inventory, setInventory] = useState([]);
            const [inventorySlots, setInventorySlots] = useState(5);
            const [tasks, setTasks] = useState({ 
                subscribe: { completed: false }, 
                deposit: { completed: false }, 
                depositMajor: { completed: false }, 
                inviteThree: { completed: false, count: 0, required: 3, reward: 25 },
                cardboard7: { completed: false, count: 0, required: 7, reward: { type: 'case', caseId: 'diamond', count: 1 } },
                deposit50: { completed: false, minDeposit: 50, reward: 50 }
            });
            const [user, setUser] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [dailyCaseTimeLeft, setDailyCaseTimeLeft] = useState('');
            const [selectedCase, setSelectedCase] = useState(null);
            const [isSpinning, setIsSpinning] = useState(false);
            const [spinResult, setSpinResult] = useState(null);
            const [rouletteOffset, setRouletteOffset] = useState(0);
            const [fakeItems, setFakeItems] = useState([]);
            const [rouletteKey, setRouletteKey] = useState(0);
            const rouletteContainerRef = useRef(null);
            const [showTopUp, setShowTopUp] = useState(false);
            const [promoCode, setPromoCode] = useState('');
            const [promoError, setPromoError] = useState('');
            const [promoSuccess, setPromoSuccess] = useState('');
            const [usedPromos, setUsedPromos] = useState([]);
            const [wonPromos, setWonPromos] = useState([]);
            const [showCollectibleModal, setShowCollectibleModal] = useState(false);
            const [selectedCollectible, setSelectedCollectible] = useState(null);
            const [showRandomCaseModal, setShowRandomCaseModal] = useState(false);
            const [randomCaseItem, setRandomCaseItem] = useState(null);
            const [showWithdrawModal, setShowWithdrawModal] = useState(false);
            const [withdrawAmount, setWithdrawAmount] = useState('');
            const [showAdminLogin, setShowAdminLogin] = useState(false);
            const [adminLogin, setAdminLogin] = useState('');
            const [adminPassword, setAdminPassword] = useState('');
            const [isAdmin, setIsAdmin] = useState(false);
            const [adminScreen, setAdminScreen] = useState('stats');
            const [allUsers, setAllUsers] = useState([]);
            const [selectedUser, setSelectedUser] = useState(null);
            const [adminUserSearch, setAdminUserSearch] = useState('');
            const [adminAttempts, setAdminAttempts] = useState(0);
            const [onlineCount, setOnlineCount] = useState(Math.floor(Math.random() * 300) + 200);
            const [paymentStatus, setPaymentStatus] = useState('');
            const [totalDeposits, setTotalDeposits] = useState(0);
            const [freeEliteSpin, setFreeEliteSpin] = useState(0);
            const [olympusOpened, setOlympusOpened] = useState(0);
            const [olympusTopPlayers, setOlympusTopPlayers] = useState([]);
            const [currentGame, setCurrentGame] = useState(null);
            const [treasureBg, setTreasureBg] = useState(localStorage.getItem('olymp_treasure_bg') || 'case.jpg');

            // Ensure every user always has 2 free Olympus cases (even old accounts)
            useEffect(() => {
                if (!user?.id || isLoading) return;
                const olymp = cases.olympus || cases.olymp;
                if (!olymp) return;
                if ((olymp.freeCount ?? 0) < 2) {
                    setCases(prev => ({ ...prev, olympus: { ...(prev.olympus || olymp), freeCount: 2 } }));
                    db.ref(`users/${user.id}/cases/olympus/freeCount`).set(2);
                }
            }, [user?.id, isLoading]);
            const [geraklGameActive, setGeraklGameActive] = useState(false);
            const [geraklBetAmount, setGeraklBetAmount] = useState(25);
            const [geraklBetInput, setGeraklBetInput] = useState(25);
            const [geraklRound, setGeraklRound] = useState(0);
            const [geraklMultiplier, setGeraklMultiplier] = useState(1.0);
            const [geraklCurrentWin, setGeraklCurrentWin] = useState(0);
            const [geraklTimer, setGeraklTimer] = useState(25);
            const [geraklResult, setGeraklResult] = useState(null);
            const [geraklBoxOpened, setGeraklBoxOpened] = useState(false);
            const [geraklBoxPrize, setGeraklBoxPrize] = useState(null);
            const [eventScreen, setEventScreen] = useState('main');
            const [olympusOpens, setOlympusOpens] = useState(0);
            const [olympusProgress, setOlympusProgress] = useState([]);
            const [showOlympusItemModal, setShowOlympusItemModal] = useState(false);
            const [selectedOlympusItem, setSelectedOlympusItem] = useState(null);
            const [showGefestModal, setShowGefestModal] = useState(false);
            const [gefestCooldown, setGefestCooldown] = useState(0);
            const [showGefestChoice, setShowGefestChoice] = useState(false);
            const [gefestChoiceItem, setGefestChoiceItem] = useState(null);
            
            // Ensure olympusTopPlayers is not accidentally redeclared.
            
            useEffect(() => {
                const initApp = async () => {
                    let userId = null;
                    let userData = { name: '–ì–æ—Å—Ç—å', username: null, avatar: null };
                    if (TelegramWebApp) {
                        TelegramWebApp.ready();
                        TelegramWebApp.expand();
                        const tgUser = TelegramWebApp.initDataUnsafe?.user;
                        if (tgUser) {
                            userId = tgUser.id.toString();
                            userData = { name: tgUser.first_name + (tgUser.last_name ? ' ' + tgUser.last_name : ''), username: tgUser.username ? '@' + tgUser.username : null, avatar: tgUser.photo_url || null };
                        }
                    }
                    if (!userId) {
                        userId = localStorage.getItem('sbs_user_id') || ('guest_' + Date.now());
                        localStorage.setItem('sbs_user_id', userId);
                    } else {
                        localStorage.setItem('sbs_user_id', userId);
                    }
                    try {
                        const snap = await db.ref('users/' + userId).once('value');
                        const data = snap.val();
                        if (data) {
                            const storedCases = data.cases || {};
                            const newMergedCases = {};
                            for (const caseId in INITIAL_CASES) {
                                const initialCase = INITIAL_CASES[caseId];
                                const storedCase = storedCases[caseId];
                                newMergedCases[caseId] = { ...initialCase };
                                if (storedCase) {
                                    newMergedCases[caseId].freeCount = storedCase.freeCount || 0;
                                    if (storedCase.locked !== undefined) newMergedCases[caseId].locked = storedCase.locked;
                                    if (caseId === 'daily' && storedCase.lastOpened) newMergedCases[caseId].lastOpened = storedCase.lastOpened;
                                }
                            }
                            setUser({ id: userId, ...userData, ...data });
                            setBalance(data.balance || 0);
                            setCases(newMergedCases);
                            setInventory(data.inventory || []);
                            setTasks(data.tasks || { 
                                subscribe: { completed: false }, 
                                deposit: { completed: false }, 
                                depositMajor: { completed: false }, 
                                inviteThree: { completed: false, count: 0, required: 3, reward: 25 },
                                cardboard7: { completed: false, count: 0, required: 7, reward: { type: 'case', caseId: 'diamond', count: 1 } },
                                deposit50: { completed: false, minDeposit: 50, reward: 50 }
                            });
                            setInventorySlots(data.inventorySlots || 5);
                            setUsedPromos(data.usedPromos || []);
                            setWonPromos(data.wonPromos || []);
                            setTotalDeposits(data.totalDeposits || 0);
                            setFreeEliteSpin(data.freeEliteSpin || 0);
                            setOlympusOpens(data.olympusOpens || 0);
                            setOlympusProgress(data.olympusProgress || []);
                            setGefestCooldown(data.gefestCooldown || 0);
                            await db.ref('users/' + userId).update({ name: userData.name, username: userData.username || '', cases: newMergedCases });
                        } else {
                            const newCases = { ...INITIAL_CASES, daily: { ...INITIAL_CASES.daily, freeCount: 1, lastOpened: 0 }, diamond: { ...INITIAL_CASES.diamond, freeCount: 5 }, olympus: { id: 'olympus', name: '–û–ª–∏–º–ø', emoji: '‚ö°Ô∏è', price: 77, color: 'from-yellow-400 to-amber-600', locked: false, freeCount: 2, type: 'event' } };
                            const newUser = { balance: 0, cases: newCases, inventory: [], tasks: { subscribe: { completed: false }, deposit: { completed: false }, depositMajor: { completed: false }, inviteThree: { completed: false, count: 0, required: 3, reward: 25 }, cardboard7: { completed: false, count: 0, required: 7, reward: { type: 'case', caseId: 'diamond', count: 1 } }, deposit50: { completed: false, minDeposit: 50, reward: 50 } }, inventorySlots: 5, usedPromos: [], wonPromos: [], createdAt: Date.now(), lastActive: Date.now(), totalDeposits: 0, freeEliteSpin: 0, olympusOpens: 0, olympusProgress: [], gefestCooldown: 0, name: userData.name, username: userData.username || '' };
                            setCases(newCases);
                            setUser({ id: userId, ...userData });
                            await db.ref('users/' + userId).set(newUser);
                        }
                    } catch (e) { console.error(e); }
                    setIsLoading(false);
                };
                initApp();
            }, []);
            
            useEffect(() => {
                if (!user?.id) return;
                const ref = db.ref('online/' + user.id);
                ref.set({ name: user.name, timestamp: Date.now() });
                ref.onDisconnect().remove();
                db.ref('online').on('value', snap => setOnlineCount(Math.floor(Math.random() * 300) + 200 + snap.numChildren()));
                return () => ref.remove();
            }, [user?.id]);

            useEffect(() => {
                if (!user?.id) return;

                const userOlympRef = db.ref(`users/${user.id}/olympusOpened`);
                const usersRef = db.ref('users');

                userOlympRef.on('value', snap => {
                    setOlympusOpened(snap.val() || 0);
                });

                usersRef.on('value', snap => {
                    const players = [];
                    snap.forEach(child => {
                        const u = child.val() || {};
                        const opened = Number(u.olympusOpened || 0);
                        if (opened > 0) {
                            players.push({
                                id: child.key,
                                name: u.name || (u.username ? u.username : '–ò–≥—Ä–æ–∫'),
                                username: u.username || '',
                                avatar: u.avatar || null,
                                olympusOpened: opened
                            });
                        }
                    });
                    players.sort((a, b) => b.olympusOpened - a.olympusOpened);
                    setOlympusTopPlayers(players.slice(0, 5));
                });

                return () => {
                    userOlympRef.off();
                    usersRef.off();
                };
            }, [user?.id]);
            
            useEffect(() => {
                if (!user?.id || isLoading) return;
                const iv = setInterval(() => {
                    const dailyData = cases.daily;
                    db.ref('users/' + user.id).update({ 
                        balance, inventory, tasks, inventorySlots, usedPromos, wonPromos, lastActive: Date.now(), totalDeposits, freeEliteSpin, olympusOpens, olympusProgress, gefestCooldown,
                        'cases/daily/lastOpened': dailyData.lastOpened,
                        'cases/daily/freeCount': dailyData.freeCount
                    });
                }, 5000);
                return () => clearInterval(iv);
            }, [balance, cases, inventory, tasks, inventorySlots, usedPromos, wonPromos, user?.id, isLoading, totalDeposits, freeEliteSpin, olympusOpens, olympusProgress, gefestCooldown]);
            
            useEffect(() => {
                if (isLoading || !cases.daily) return;
                const DAILY_COOLDOWN = 23 * 60 * 60 * 1000;
                const timer = setInterval(() => {
                    const lastOpened = cases.daily.lastOpened || 0;
                    const now = Date.now();
                    const timePassed = now - lastOpened;
                    if (timePassed >= DAILY_COOLDOWN) {
                        if(cases.daily.freeCount === 0) {
                            setCases(prev => ({ ...prev, daily: { ...prev.daily, freeCount: 1 } }));
                        }
                        setDailyCaseTimeLeft('–î–æ—Å—Ç—É–ø–Ω–æ!');
                    } else {
                        const remaining = DAILY_COOLDOWN - timePassed;
                        const h = Math.floor(remaining / (1000 * 60 * 60));
                        const m = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                        const s = Math.floor((remaining % (1000 * 60)) / 1000);
                        setDailyCaseTimeLeft(`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`);
                    }
                }, 1000);
                return () => clearInterval(timer);
            }, [cases.daily, isLoading]);
            
            useEffect(() => {
                if (!geraklGameActive || geraklResult) return;
                const iv = setInterval(() => {
                    setGeraklTimer(prev => {
                        if (prev <= 1) {
                            handleGeraklIce();
                            return 0;
                        }
                        return prev - 1;
                    });
                }, 1000);
                return () => clearInterval(iv);
            }, [geraklGameActive, geraklResult]);

            useEffect(() => {
                if (!user?.id || isLoading) return;
                const olympCase = cases.olympus || cases.olymp;
                if (!olympCase) {
                    const createdOlymp = {
                        id: 'olympus',
                        name: '–û–ª–∏–º–ø‚ö°Ô∏è',
                        emoji: '‚ö°Ô∏è',
                        price: 77,
                        color: 'from-yellow-500 to-orange-600',
                        locked: false,
                        freeCount: 2,
                        type: 'event'
                    };
                    const nextCases = { ...cases, olympus: createdOlymp };
                    setCases(nextCases);
                    db.ref(`users/${user.id}/cases/olympus`).set(createdOlymp);
                    return;
                }
                if ((olympCase.freeCount ?? 0) < 2 && !olympCase.openedOnce) {
                    const nextCases = { ...cases, olympus: { ...(cases.olympus || olympCase), freeCount: 2 } };
                    setCases(nextCases);
                    db.ref(`users/${user.id}/cases/olympus/freeCount`).set(2);
                }
            }, [user?.id, isLoading, cases]);
            
            useEffect(() => {
                if (gefestCooldown > 0) {
                    const timer = setInterval(() => {
                        setGefestCooldown(prev => {
                            const newVal = Math.max(0, prev - 1000);
                            if (user?.id) db.ref(`users/${user.id}/gefestCooldown`).set(newVal);
                            return newVal;
                        });
                    }, 1000);
                    return () => clearInterval(timer);
                }
            }, [gefestCooldown, user?.id]);
            
            useEffect(() => {
                const loadTopPlayers = async () => {
                    try {
                        const snap = await db.ref('users').orderByChild('olympusOpens').limitToLast(5).once('value');
                        const players = [];
                        snap.forEach(child => {
                            const data = child.val();
                            if (data.olympusOpens > 0) {
                                players.push({
                                    id: child.key,
                                    name: data.name || '–ò–≥—Ä–æ–∫',
                                    avatar: data.avatar || null,
                                    olympusOpens: data.olympusOpens || 0
                                });
                            }
                        });
                        setOlympusTopPlayers(players.sort((a, b) => b.olympusOpens - a.olympusOpens).slice(0, 5));
                    } catch (e) {
                        console.error(e);
                    }
                };
                if (eventScreen === 'heroes') loadTopPlayers();
            }, [eventScreen]);
            
            const checkPromo = async () => {
                const code = promoCode.toUpperCase().trim();
                setPromoError(''); setPromoSuccess('');
                if(!code) return;
                if(usedPromos.includes(code)) { setPromoError('–£–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!'); return; }
                if(code === 'DELLKO') {
                     if(!wonPromos.includes('DELLKO')) { setPromoError('–¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–∏–≥—Ä–∞–ª–∏ –≤ 13 –ü–æ–¥–≤–∏–≥–µ –ì–µ—Ä–∞–∫–ª–∞!'); return; }
                     const nc = { ...cases, money: { ...cases.money, freeCount: (cases.money.freeCount || 0) + 3 } };
                     setCases(nc);
                     await addToInventory({ name: 'üßä –õ—ë–¥ (1/3)', emoji: 'üßä', type: 'ice', part: 1 });
                     setPromoSuccess('+3 –¥–µ–Ω–µ–∂–Ω—ã—Ö –∫–µ–π—Å–∞ + üßä!');
                     const np = [...usedPromos, code];
                     setUsedPromos(np);
                     setPromoCode('');
                     await db.ref(`users/${user.id}/usedPromos`).set(np);
                } else if(code === 'DIAMOND') {
                     const nc = { ...cases, diamond: { ...cases.diamond, freeCount: (cases.diamond.freeCount || 0) + 2 } };
                     setCases(nc);
                     setPromoSuccess('+2 –∫–µ–π—Å–∞ –ê–ª–º–∞–∑!');
                     const np = [...usedPromos, code];
                     setUsedPromos(np);
                     setPromoCode('');
                     await db.ref(`users/${user.id}/usedPromos`).set(np);
                } else if(code === 'OLIMP') {
                     const nb = balance + 130;
                     setBalance(nb);
                     setPromoSuccess('‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–æ 130‚≠êÔ∏è!');
                     const np = [...usedPromos, code];
                     setUsedPromos(np);
                     setPromoCode('');
                     await db.ref(`users/${user.id}`).update({ balance: nb, usedPromos: np });
                } else {
                     setPromoError('–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥');
                }
            };
            
            const topUpBalance = async (stars, ton) => {
                 const pid = 'PAY_' + Date.now();
                 const memo = `SBS_${user.id}_${stars}_${pid}`;
                 const link = `ton://transfer/${ADMIN_WALLET}?amount=${Math.round(ton * 1e9)}&text=${encodeURIComponent(memo)}`;
                 window.open(link, '_blank');
                 setPaymentStatus(`–û—Ç–ø—Ä–∞–≤—å—Ç–µ ${ton} TON —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º: ${memo}`);
                 setShowTopUp(false);
            };
            
            const buyStars = async (pkg) => {
                 try {
                     const r = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/createInvoiceLink`, {
                         method: 'POST',
                         headers: { 'Content-Type': 'application/json' },
                         body: JSON.stringify({ title: `${pkg.stars} –∑–≤—ë–∑–¥`, description: `–ü–æ–∫—É–ø–∫–∞ ${pkg.stars} –∑–≤—ë–∑–¥`, payload: `stars_${user.id}_${pkg.stars}_${Date.now()}`, currency: 'XTR', prices: [{ label: `${pkg.stars} –∑–≤—ë–∑–¥`, amount: pkg.price }] })
                     });
                     const data = await r.json();
                     if(data.ok && data.result) {
                         if(TelegramWebApp) {
                             TelegramWebApp.openInvoice(data.result, async (status) => {
                                 if(status === 'paid') {
                                     const nb = balance + pkg.stars, nd = totalDeposits + pkg.stars;
                                     setBalance(nb); setTotalDeposits(nd);
                                     await db.ref(`users/${user.id}`).update({ balance: nb, totalDeposits: nd });
                                     checkDepositTasks(nd, pkg.stars);
                                     alert(`‚úÖ –ó–∞—á–∏—Å–ª–µ–Ω–æ ${pkg.stars} –∑–≤—ë–∑–¥!`);
                                 }
                             });
                         } else {
                             window.open(data.result, '_blank');
                         }
                     }
                 } catch(e) { alert('–û—à–∏–±–∫–∞ –ø–ª–∞—Ç–µ–∂–∞.'); }
            };
            
            const checkDepositTasks = async (nd, depositAmount) => {
                 if(!tasks.deposit?.completed && nd >= 100) {
                     const nt = { ...tasks, deposit: { completed: true } };
                     const nc = { ...cases, gold: { ...cases.gold, freeCount: (cases.gold.freeCount || 0) + 1 } };
                     setTasks(nt); setCases(nc);
                     await db.ref(`users/${user.id}`).update({ tasks: nt, cases: nc });
                 }
                 if(!tasks.depositMajor?.completed && nd >= 350) {
                     const nt = { ...tasks, depositMajor: { completed: true } };
                     const nc = { ...cases, collector: { ...cases.collector, locked: false, freeCount: (cases.collector.freeCount || 0) + 1 } };
                     setTasks(nt); setCases(nc);
                     await db.ref(`users/${user.id}`).update({ tasks: nt, cases: nc });
                 }
                 if(!tasks.deposit50?.completed && depositAmount >= 50) {
                     const nt = { ...tasks, deposit50: { completed: true } };
                     const nb = balance + 50;
                     setTasks(nt); setBalance(nb);
                     await db.ref(`users/${user.id}`).update({ tasks: nt, balance: nb });
                     alert('‚úÖ –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! –ü–æ–ª—É—á–µ–Ω–æ 50‚≠êÔ∏è');
                 }
            };
            
            const completeTask = async (tid) => {
                 if(tid === 'subscribe') {
                     window.open('https://t.me/stepbystepdelision', '_blank');
                     setTimeout(async () => {
                         if(!tasks.subscribe?.completed) {
                             const nt = { ...tasks, subscribe: { completed: true } };
                             const nc = { ...cases, elite: { ...cases.elite, freeCount: (cases.elite.freeCount || 0) + 1 } };
                             setTasks(nt); setCases(nc);
                             await db.ref(`users/${user.id}`).update({ tasks: nt, cases: nc });
                             alert('üéâ –ü–æ–ª—É—á–µ–Ω 1 –∫–µ–π—Å ¬´–≠–ª–∏—Ç–∞¬ª!');
                         }
                     }, 2000);
                 } else if(tid === 'inviteThree') {
                     window.open('https://t.me/share/url?url=' + encodeURIComponent(`https://t.me/stepbystep_game_bot?start=${user.id}`), '_blank');
                 } else if(tid === 'deposit' || tid === 'depositMajor' || tid === 'deposit50') {
                     setShowTopUp(true);
                 }
            };
            
            const confirmWithdraw = () => {
                 if (!tasks.depositMajor?.completed) {
                     alert('–ß—Ç–æ–±—ã –≤—ã–≤–µ—Å—Ç–∏ NFT –ø—Ä–∏–∑—ã, –∑–≤–µ–∑–¥—ã –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ ¬´–ü–æ–ø–æ–ª–Ω–∏ –Ω–∞ 350‚≠êÔ∏è¬ª');
                 } else {
                     alert('–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—ã–≤–æ–¥–∞ –ø—Ä–∏–∑–æ–≤! https://t.me/stepbystepdelision');
                 }
                 setShowWithdrawModal(false);
                 setWithdrawAmount('');
            };
            
            const handleTitleClick = () => {
                 // Show admin login on the 12th click (need 12 taps total)
                 setAdminAttempts(prev => {
                     const next = prev + 1;
                     if (next >= 12) {
                         setShowAdminLogin(true);
                         return 0;
                     }
                     return next;
                 });
            };
            
            const checkAdminLogin = () => {
                 if(adminLogin === '*^BAGUETTE_642819_6281' && adminPassword === '3628874910ZTWMI') {
                     setIsAdmin(true);
                     setShowAdminLogin(false);
                     db.ref('users').once('value').then(snap => {
                         const u = [];
                         snap.forEach(c => u.push({ id: c.key, ...c.val() }));
                         setAllUsers(u);
                     });
                 } else {
                     alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!');
                 }
            };
            
            const adminGiveReward = async (uid, r) => {
                 const snap = await db.ref('users/' + uid).once('value');
                 const ud = snap.val() || {};
                 if(r.type === 'stars') {
                     const nb = (ud.balance || 0) + r.amount;
                     await db.ref('users/' + uid + '/balance').set(nb);
                     if(uid === user.id) setBalance(nb);
                 } else if(r.type === 'case') {
                     const cur = ud.cases?.[r.caseType]?.freeCount || 0;
                     await db.ref(`users/${uid}/cases/${r.caseType}/freeCount`).set(cur + r.count);
                     if(uid === user.id) setCases(p => ({ ...p, [r.caseType]: { ...p[r.caseType], freeCount: cur + r.count } }));
                 } else if(r.type === 'unlock_collector') {
                     await db.ref(`users/${uid}/cases/collector/locked`).set(false);
                     if(uid === user.id) setCases(p => ({ ...p, collector: { ...p.collector, locked: false } }));
                 } else if(r.type === 'reset_daily') {
                     await db.ref(`users/${uid}/cases/daily`).update({ freeCount: 1, lastOpened: 0 });
                     if(uid === user.id) setCases(p => ({ ...p, daily: { ...p.daily, freeCount: 1, lastOpened: 0 } }));
                 } else if(r.type === 'item' && r.item) {
                     const currentInventory = ud.inventory || [];
                     const newItem = { ...r.item, uniqueId: Date.now(), collected: Date.now() };
                     const newInventory = [...currentInventory, newItem];
                     await db.ref(`users/${uid}/inventory`).set(newInventory);
                     if(uid === user.id) setInventory(newInventory);
                 }
                 alert('–ù–∞–≥—Ä–∞–¥–∞ –≤—ã–¥–∞–Ω–∞!');
            };
            
            const getCasePrice = (ct) => {
                const c = cases[ct];
                if (!c) return 0;
                if (c.id === 'daily' && c.freeCount > 0) return 0;
                if (c.freeCount > 0) return 0;
                if (c.discountPrice && c.discountPrice !== c.price) return c.discountPrice;
                return c.price;
            };
            
            const handleSelectCase = (caseData) => {
                setSpinResult(null); setFakeItems([]); setSelectedCase(caseData);
            };
            
            const openCase = async (caseType) => {
                const normalizedCaseType = (caseType === 'olymp' ? 'olympus' : caseType);
                if (normalizedCaseType !== caseType) caseType = normalizedCaseType;
                const cData = cases[caseType];
                if(cData.id === 'daily' && cData.freeCount === 0) { alert('–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∫–µ–π—Å –Ω–µ –≥–æ—Ç–æ–≤!'); return; }
                const price = getCasePrice(caseType);
                const isFree = cData.freeCount > 0;
                if(!isFree && balance < price) { alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥!'); return; }
                let nb = balance;
                if(cData.id === 'daily' && isFree) {
                    const now = Date.now();
                    setCases(p => ({ ...p, daily: { ...p.daily, freeCount: 0, lastOpened: now } }));
                    await db.ref(`users/${user.id}/cases/daily`).update({ freeCount: 0, lastOpened: now });
                } else if(isFree) {
                     const nf = cData.freeCount - 1;
                     setCases(p => ({ ...p, [caseType]: { ...p[caseType], freeCount: nf } }));
                     await db.ref(`users/${user.id}/cases/${caseType}/freeCount`).set(nf);
                } else {
                     nb -= price;
                     setBalance(nb);
                     await db.ref(`users/${user.id}/balance`).set(nb);
                }
                
                if (caseType === 'cardboard' && !tasks.cardboard7?.completed) {
                    const newCount = (tasks.cardboard7?.count || 0) + 1;
                    if (newCount >= 7) {
                        const nt = { ...tasks, cardboard7: { ...tasks.cardboard7, completed: true, count: newCount } };
                        const nc = { ...cases, diamond: { ...cases.diamond, freeCount: (cases.diamond.freeCount || 0) + 1 } };
                        setTasks(nt); setCases(nc);
                        await db.ref(`users/${user.id}`).update({ tasks: nt, cases: nc });
                        alert('üéâ –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! –ü–æ–ª—É—á–µ–Ω 1 –∫–µ–π—Å ¬´–ê–ª–º–∞–∑üíé¬ª!');
                    } else {
                        const nt = { ...tasks, cardboard7: { ...tasks.cardboard7, count: newCount } };
                        setTasks(nt);
                        await db.ref(`users/${user.id}/tasks`).update({ cardboard7: nt.cardboard7 });
                    }
                }
                
                if (caseType === 'olympus') {
                    const newOpens = olympusOpens + 1;
                    setOlympusOpens(newOpens);
                    await db.ref(`users/${user.id}/olympusOpens`).set(newOpens);
                    
                    for (const step of OLYMPUS_PROGRESS) {
                        if (newOpens >= step.opens && !olympusProgress.includes(step.opens)) {
                            const newProgress = [...olympusProgress, step.opens];
                            setOlympusProgress(newProgress);
                            await db.ref(`users/${user.id}/olympusProgress`).set(newProgress);
                            await giveOlympusReward(step.reward);
                            alert(`üéâ –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ ${step.opens} –æ—Ç–∫—Ä—ã—Ç–∏–π: ${step.name}`);
                        }
                    }
                }
                
                setIsSpinning(false); setSpinResult(null); setFakeItems([]); setRouletteOffset(0); setRouletteKey(k => k+1);
                const items = CASE_REWARDS[caseType];
                let won = items[0], r = Math.random()*100, cum = 0;
                for(let i of items) { cum += i.realChance; if(r <= cum) { won = i; break; } }
                const tape = [];
                for(let i=0; i<80; i++) tape.push(i===70 ? won : items[Math.floor(Math.random()*items.length)]);
                setIsSpinning(true);
                setTimeout(() => {
                     setFakeItems(tape);
                     setTimeout(() => {
                         const cw = rouletteContainerRef.current ? rouletteContainerRef.current.offsetWidth : window.innerWidth;
                         const target = (70 * 136 + 68 - cw/2);
                         setRouletteOffset(-target);
                     }, 50);
                }, 50);
                setTimeout(async () => {
                     setSpinResult(won); setIsSpinning(false);
                     if (caseType === 'olympus') {
                         setSelectedOlympusItem(won);
                         setShowOlympusItemModal(true);
                     } else if(won.type === 'stars') {
                         const fb = nb + won.value;
                         setBalance(fb);
                         await db.ref(`users/${user.id}/balance`).set(fb);
                     } else {
                         await addToInventory(won);
                     }
                }, 6600);
            };
            
            const giveOlympusReward = async (reward) => {
                if (reward.type === 'star_cases') {
                    const nc = { ...cases, star: { ...cases.star, freeCount: (cases.star.freeCount || 0) + reward.count } };
                    setCases(nc);
                    await db.ref(`users/${user.id}/cases/star/freeCount`).set((cases.star.freeCount || 0) + reward.count);
                } else if (reward.type === 'case') {
                    const nc = { ...cases, [reward.caseId]: { ...cases[reward.caseId], freeCount: (cases[reward.caseId].freeCount || 0) + reward.count } };
                    setCases(nc);
                    await db.ref(`users/${user.id}/cases/${reward.caseId}/freeCount`).set((cases[reward.caseId].freeCount || 0) + reward.count);
                } else if (reward.type === 'stars') {
                    const nb = balance + reward.value;
                    setBalance(nb);
                    await db.ref(`users/${user.id}/balance`).set(nb);
                } else if (reward.type === 'special_item') {
                    if (reward.item === 'hades_gift') {
                        await addToInventory({ id: 'hades_gift', name: '–ü–æ–¥–∞—Ä–æ–∫ –ê–∏–¥üî•', emoji: 'üî•', type: 'olympus_special', subtype: 'hades' });
                    } else if (reward.item === 'zeus_gift') {
                        await addToInventory({ id: 'zeus_gift', name: '–ü–æ–¥–∞—Ä–æ–∫ –ó–µ–≤—Å‚ö°Ô∏è', emoji: '‚ö°Ô∏è', type: 'olympus_special', subtype: 'zeus' });
                    }
                } else if (reward.type === 'mega') {
                    const nc = { ...cases, star: { ...cases.star, freeCount: (cases.star.freeCount || 0) + reward.starCases } };
                    setCases(nc);
                    const nb = balance + reward.stars;
                    setBalance(nb);
                    await db.ref(`users/${user.id}`).update({
                        'cases/star/freeCount': (cases.star.freeCount || 0) + reward.starCases,
                        balance: nb
                    });
                }
            };
            
            const handleOlympusItem = async (item) => {
                if (item.type === 'olympus_item') {
                    await addToInventory(item);
                } else if (item.type === 'olympus_slot') {
                    const newSlots = inventorySlots + 1;
                    setInventorySlots(newSlots);
                    await db.ref(`users/${user.id}/inventorySlots`).set(newSlots);
                    alert('üéâ –ü–æ–ª—É—á–µ–Ω +1 —Å–ª–æ—Ç –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ!');
                } else if (item.type === 'olympus_exchange_stars') {
                    const nb = balance + item.value;
                    setBalance(nb);
                    await db.ref(`users/${user.id}/balance`).set(nb);
                    alert(`üéâ –ü–æ–ª—É—á–µ–Ω–æ ${item.value}‚≠êÔ∏è!`);
                } else if (item.type === 'olympus_star_cases') {
                    const nc = { ...cases, star: { ...cases.star, freeCount: (cases.star.freeCount || 0) + item.count } };
                    setCases(nc);
                    await db.ref(`users/${user.id}/cases/star/freeCount`).set((cases.star.freeCount || 0) + item.count);
                    alert(`üéâ –ü–æ–ª—É—á–µ–Ω–æ ${item.count} –∫–µ–π—Å–æ–≤ ¬´–ó–≤–µ–∑–¥–Ω—ã–π‚≠êÔ∏è¬ª!`);
                } else if (item.type === 'olympus_choice') {
                    if (confirm('–ü–æ—Å–µ–π–¥–æ–Ωüî±: –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–≥—Ä–∞–¥—É!\n–û–ö = 200‚≠êÔ∏è | –û—Ç–º–µ–Ω–∞ = 5 –∫–µ–π—Å–æ–≤ ¬´–ü–ª–∞—Ç–∏–Ω–∞üíç¬ª')) {
                        const nb = balance + 200;
                        setBalance(nb);
                        await db.ref(`users/${user.id}/balance`).set(nb);
                        alert('üéâ –ü–æ–ª—É—á–µ–Ω–æ 200‚≠êÔ∏è!');
                    } else {
                        const nc = { ...cases, platinum: { ...cases.platinum, freeCount: (cases.platinum.freeCount || 0) + 5 } };
                        setCases(nc);
                        await db.ref(`users/${user.id}/cases/platinum/freeCount`).set((cases.platinum.freeCount || 0) + 5);
                        alert('üéâ –ü–æ–ª—É—á–µ–Ω–æ 5 –∫–µ–π—Å–æ–≤ ¬´–ü–ª–∞—Ç–∏–Ω–∞üíç¬ª!');
                    }
                } else if (item.type === 'olympus_hades_choice') {
                    if (confirm('–ê–∏–¥üî•: –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–≥—Ä–∞–¥—É!\n–û–ö = 250‚≠êÔ∏è | –û—Ç–º–µ–Ω–∞ = –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ ¬´–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Äüé©¬ª')) {
                        const nb = balance + 250;
                        setBalance(nb);
                        await db.ref(`users/${user.id}/balance`).set(nb);
                        alert('üéâ –ü–æ–ª—É—á–µ–Ω–æ 250‚≠êÔ∏è!');
                    } else {
                        const nc = { ...cases, collector: { ...cases.collector, locked: false, freeCount: (cases.collector.freeCount || 0) + 1 } };
                        setCases(nc);
                        await db.ref(`users/${user.id}/cases/collector`).update({ locked: false, freeCount: (cases.collector.freeCount || 0) + 1 });
                        alert('üéâ –ö–µ–π—Å ¬´–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Äüé©¬ª —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω + 1 –ø—Ä–æ–∫—Ä—É—Ç!');
                    }
                } else if (item.type === 'olympus_zeus') {
                    if (confirm('–†–∞–∑–±—É–¥–∏—Ç–µ –ó–µ–≤—Å–∞‚ö°Ô∏è —Å–µ–π—á–∞—Å –∏ –ø–æ–ª—É—á–∏—Ç–µ 2 –ö–µ–π—Å–∞ ¬´–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä¬ª (+—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞) –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –∏ –ø–æ–ª—É—á–∏—Ç–µ –Ω–∞–≥—Ä–∞–¥—É –ª—É—á—à–µ –ø–æ–∑–∂–µ!\n–û–ö = –†–∞–∑–±—É–¥–∏—Ç—å | –û—Ç–º–µ–Ω–∞ = –û—Å—Ç–∞–≤–∏—Ç—å')) {
                        const nc = { ...cases, collector: { ...cases.collector, locked: false, freeCount: (cases.collector.freeCount || 0) + 2 } };
                        setCases(nc);
                        await db.ref(`users/${user.id}/cases/collector`).update({ locked: false, freeCount: (cases.collector.freeCount || 0) + 2 });
                        alert('üéâ –ó–µ–≤—Å‚ö°Ô∏è —Ä–∞–∑–±—É–∂–µ–Ω! –ü–æ–ª—É—á–µ–Ω–æ 2 –∫–µ–π—Å–∞ ¬´–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Äüé©¬ª + —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞!');
                    } else {
                        await addToInventory({ id: 'sleeping_zeus', name: '–°–ø—è—â–∏–π –ó–µ–≤—Å‚ö°Ô∏è', emoji: 'üí§‚ö°Ô∏è', type: 'olympus_special', subtype: 'zeus_sleeping' });
                        alert('üí§ –ó–µ–≤—Å –æ—Å—Ç–∞–ª—Å—è —Å–ø–∞—Ç—å... –ü–æ–ª—É—á–∏—Ç–µ –Ω–∞–≥—Ä–∞–¥—É –ø–æ–∑–∂–µ!');
                    }
                }
                setShowOlympusItemModal(false);
                setSelectedOlympusItem(null);
            };
            
            const handleGefestExchange = async (itemKey) => {
                if (gefestCooldown > 0) {
                    const mins = Math.ceil(gefestCooldown / 60000);
                    alert(`‚è∞ –ü–æ–¥–æ–∂–¥–∏—Ç–µ –µ—â–µ ${mins} –º–∏–Ω—É—Ç!`);
                    return;
                }
                
                const hasItem = inventory.find(i => i.key === itemKey || i.id === itemKey);
                if (!hasItem) {
                    alert('–ü—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                    return;
                }
                
                const exchange = GEFEST_EXCHANGES[itemKey];
                if (!exchange) return;
                
                if (exchange.reward.type === 'choice') {
                    setGefestChoiceItem({ itemKey, hasItem, exchange });
                    setShowGefestChoice(true);
                } else {
                    await processGefestExchange(hasItem, exchange.reward);
                }
            };
            
            const processGefestExchange = async (item, reward) => {
                const ni = inventory.filter(i => i.uniqueId !== item.uniqueId);
                setInventory(ni);
                await db.ref(`users/${user.id}/inventory`).set(ni);
                
                const newCooldown = Date.now() + (3 * 60 * 1000);
                setGefestCooldown(newCooldown);
                await db.ref(`users/${user.id}/gefestCooldown`).set(newCooldown);
                
                if (reward.type === 'stars') {
                    const nb = balance + reward.value;
                    setBalance(nb);
                    await db.ref(`users/${user.id}/balance`).set(nb);
                    alert(`‚úÖ –ü–æ–ª—É—á–µ–Ω–æ ${reward.value}‚≠êÔ∏è!`);
                } else if (reward.type === 'case') {
                    const nc = { ...cases, [reward.caseId]: { ...cases[reward.caseId], freeCount: (cases[reward.caseId].freeCount || 0) + reward.count } };
                    setCases(nc);
                    await db.ref(`users/${user.id}/cases/${reward.caseId}/freeCount`).set((cases[reward.caseId].freeCount || 0) + reward.count);
                    alert(`‚úÖ –ü–æ–ª—É—á–µ–Ω–æ ${reward.count} –∫–µ–π—Å(–æ–≤)!`);
                } else if (reward.type === 'slot') {
                    const newSlots = inventorySlots + 1;
                    setInventorySlots(newSlots);
                    await db.ref(`users/${user.id}/inventorySlots`).set(newSlots);
                    alert('‚úÖ –ü–æ–ª—É—á–µ–Ω +1 —Å–ª–æ—Ç!');
                } else if (reward.type === 'collector_unlock') {
                    const nc = { ...cases, collector: { ...cases.collector, locked: false, freeCount: (cases.collector.freeCount || 0) + 2 } };
                    setCases(nc);
                    await db.ref(`users/${user.id}/cases/collector`).update({ locked: false, freeCount: (cases.collector.freeCount || 0) + 2 });
                    alert('‚úÖ –ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω + 2 –ø—Ä–æ–∫—Ä—É—Ç–∞!');
                }
                
                setShowGefestModal(false);
            };
            
            const handleGefestChoice = async (choice) => {
                const { hasItem, exchange } = gefestChoiceItem;
                const reward = choice === 1 ? exchange.reward.option1 : exchange.reward.option2;
                await processGefestExchange(hasItem, reward);
                setShowGefestChoice(false);
                setGefestChoiceItem(null);
            };
            
            const addToInventory = async (item) => {
                if(inventory.length >= inventorySlots) { alert('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø–æ–ª–æ–Ω!'); return; }
                const ni = [...inventory, { ...item, uniqueId: Date.now(), collected: Date.now() }];
                setInventory(ni);
                await db.ref(`users/${user.id}/inventory`).set(ni);
            };
            
            const sellItem = async (item) => {
                if(item.type === 'random_case_box') { setRandomCaseItem(item); setShowRandomCaseModal(true); return; }
                if(item.type === 'collectible' || item.type === 'olympus_special') { setSelectedCollectible(item); setShowCollectibleModal(true); return; }
                if(item.type === 'olympus_item') {
                    if(confirm(`–ü—Ä–æ–¥–∞—Ç—å ${item.name} –∑–∞ ${item.sellPrice}‚≠êÔ∏è?`)) {
                        const nb = balance + item.sellPrice;
                        const ni = inventory.filter(i => i.uniqueId !== item.uniqueId);
                        setBalance(nb); setInventory(ni);
                        await db.ref(`users/${user.id}`).update({ balance: nb, inventory: ni });
                    }
                    return;
                }
                if(confirm(`–ü—Ä–æ–¥–∞—Ç—å ${item.name} –∑–∞ ${item.sellPrice}‚≠êÔ∏è?`)) {
                     const nb = balance + item.sellPrice;
                     const ni = inventory.filter(i => i.uniqueId !== item.uniqueId);
                     setBalance(nb); setInventory(ni);
                     await db.ref(`users/${user.id}`).update({ balance: nb, inventory: ni });
                }
            };
            
            const exchangeRandomCaseBox = async () => {
                 const keys = ['cardboard','coal','platinum','diamond','money','gold','elite','collector'];
                 const rKey = keys[Math.floor(Math.random()*keys.length)];
                 const ni = inventory.filter(i => i.uniqueId !== randomCaseItem.uniqueId);
                 const nc = { ...cases, [rKey]: { ...cases[rKey], freeCount: (cases[rKey].freeCount||0)+1 } };
                 if(rKey === 'collector') nc.collector.locked = false;
                 setInventory(ni); setCases(nc);
                 await db.ref(`users/${user.id}`).update({ inventory: ni, cases: nc });
                 setShowRandomCaseModal(false); setRandomCaseItem(null);
                 alert(`–í—ã–ø–∞–ª –∫–µ–π—Å: ${cases[rKey].name}!`);
            };
            
            const unlockSlot = async () => {
                 if(balance < 50) return;
                 setBalance(b => b - 50); setInventorySlots(s => s + 1);
                 await db.ref(`users/${user.id}`).update({ balance: balance - 50, inventorySlots: inventorySlots + 1 });
            };
            
            const startGeraklGame = async () => {
                if (balance < geraklBetInput || geraklBetInput < 25) {
                    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥ –∏–ª–∏ —Å—Ç–∞–≤–∫–∞ –º–µ–Ω—å—à–µ 25!');
                    return;
                }
                setBalance(b => b - geraklBetInput);
                await db.ref(`users/${user.id}/balance`).set(balance - geraklBetInput);
                setGeraklBetAmount(geraklBetInput);
                setGeraklRound(0);
                setGeraklMultiplier(1.0);
                setGeraklCurrentWin(geraklBetInput);
                setGeraklTimer(25);
                setGeraklGameActive(true);
                setGeraklResult(null);
                setGeraklBoxOpened(false);
                setGeraklBoxPrize(null);
            };
            
            const handleGeraklFlame = async () => {
                if (geraklRound >= 10) {
                    handleGeraklCashout();
                    return;
                }
                const iceChance = GERAKL_ICE_CHANCES[geraklRound];
                const randomValue = Math.random();
                
                if (randomValue < iceChance) {
                    handleGeraklIce();
                } else {
                    const nextRound = geraklRound + 1;
                    const nextMultiplier = GERAKL_MULTIPLIERS[nextRound];
                    const nextWin = Math.floor(geraklBetAmount * nextMultiplier);
                    setGeraklRound(nextRound);
                    setGeraklMultiplier(nextMultiplier);
                    setGeraklCurrentWin(nextWin);
                    setGeraklTimer(25);
                }
            };
            
            const handleGeraklCashout = async () => {
                const profit = geraklCurrentWin - geraklBetAmount;
                setBalance(b => b + geraklCurrentWin);
                await db.ref(`users/${user.id}/balance`).set(balance + geraklCurrentWin);
                setGeraklResult({
                    type: 'cashout',
                    round: geraklRound,
                    win: geraklCurrentWin,
                    profit: profit
                });
                setGeraklGameActive(false);
                
                if (geraklRound >= 10) {
                    const prize = getGeraklBoxPrize();
                    setGeraklBoxPrize(prize);
                    if (prize.type === 'stars') {
                        const totalWin = geraklCurrentWin + prize.value;
                        setBalance(b => b + prize.value);
                        await db.ref(`users/${user.id}/balance`).set(balance + prize.value);
                    } else if (prize.type === 'item') {
                        await addToInventory(prize);
                    } else if (prize.type === 'collectible') {
                        await addToInventory(prize);
                    } else if (prize.type === 'promo') {
                        await addToInventory(prize);
                    }
                }
            };
            
            const handleGeraklIce = () => {
                setGeraklResult({
                    type: 'ice',
                    round: geraklRound
                });
                setGeraklGameActive(false);
            };
            
            const getGeraklBoxPrize = () => {
                let cum = 0, r = Math.random() * 100;
                for (const prize of GERAKL_10_REWARDS) {
                    cum += prize.chance;
                    if (r <= cum) return prize;
                }
                return GERAKL_10_REWARDS[0];
            };
            
            const openGeraklBox = async () => {
                setGeraklBoxOpened(true);
                if (geraklBoxPrize.type === 'promo') {
                    const np = [...wonPromos, geraklBoxPrize.code];
                    setWonPromos(np);
                    await db.ref(`users/${user.id}/wonPromos`).set(np);
                }
            };
            
            const exitGeraklGame = () => {
                setGeraklGameActive(false);
                setGeraklResult(null);
                setGeraklBoxOpened(false);
                setGeraklBoxPrize(null);
                setCurrentGame(null);
            };
            
            if (currentGame?.type === 'gerakl') {
                return (
                    <div className="min-h-screen bg-gradient-to-b from-red-900 via-orange-900 to-red-800 pb-4" style={{
                        backgroundImage: `url('gerakl.jpg')`,
                        backgroundSize: 'cover',
                        backgroundPosition: 'center',
                        backgroundBlendMode: 'overlay'
                    }}>
                        <div className="max-w-lg mx-auto p-3">
                            <div className="flex justify-between items-center mb-3">
                                <div>
                                    <h1 className="text-xl font-bold text-white">ü™¨ 13 –ü–æ–¥–≤–∏–≥ –ì–µ—Ä–∞–∫–ª–∞ üåä</h1>
                                </div>
                                <button onClick={exitGeraklGame} className="bg-red-600/40 hover:bg-red-600 border border-red-500/50 px-3 py-1.5 rounded-xl font-bold transition text-sm">‚úï –í—ã–π—Ç–∏</button>
                            </div>
                            
                            {geraklResult ? (
                                <div className="glass rounded-xl p-4 mb-3 text-center border border-yellow-500/30">
                                    {geraklResult.type === 'ice' ? (
                                        <>
                                            <div className="text-5xl mb-2">üßä</div>
                                            <div className="font-bold text-red-400 text-xl mb-2">–õ–Å–î!</div>
                                            <div className="text-gray-300 text-sm mb-1">–í—ã –ø—Ä–æ–¥–µ—Ä–∂–∞–ª–∏—Å—å: {geraklResult.round} —Ä–∞—É–Ω–¥–æ–≤</div>
                                            <div className="text-gray-400 text-sm mb-3">–°—Ç–∞–≤–∫–∞: {geraklBetAmount}‚≠êÔ∏è | –í—ã–∏–≥—Ä—ã—à: 0‚≠êÔ∏è</div>
                                            <button onClick={exitGeraklGame} className="w-full bg-gray-600 hover:bg-gray-500 py-2.5 rounded-xl font-bold transition text-sm">–í—ã–π—Ç–∏</button>
                                        </>
                                    ) : (
                                        <>
                                            <div className="text-5xl mb-2">üéâ</div>
                                            <div className="font-bold text-green-400 text-xl mb-2">–í—ã –∑–∞–±—Ä–∞–ª–∏ –≤—ã–∏–≥—Ä—ã—à!</div>
                                            <div className="text-gray-300 text-sm mb-1">–†–∞—É–Ω–¥–æ–≤: {geraklResult.round}</div>
                                            <div className="text-yellow-400 font-bold text-lg mb-1">–í—ã–∏–≥—Ä—ã—à: {geraklResult.win}‚≠êÔ∏è</div>
                                            <div className="text-green-400 text-sm mb-3">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å: +{geraklResult.profit}‚≠êÔ∏è</div>
                                            {geraklBoxPrize && !geraklBoxOpened && (
                                                <>
                                                    <div className="text-7xl mb-3 cursor-pointer hover:scale-110 transition-transform active:scale-95 select-none" onClick={openGeraklBox}>üì¶</div>
                                                    <p className="text-cyan-300 text-xs animate-pulse mb-3">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–æ—Ä–æ–±–∫—É!</p>
                                                </>
                                            )}
                                            {geraklBoxPrize && geraklBoxOpened && (
                                                <div className="bg-gray-800/60 rounded-xl p-3 mb-3">
                                                    <p className="text-gray-400 text-xs mb-1">–ë–æ–Ω—É—Å–Ω—ã–π –ø—Ä–∏–∑:</p>
                                                    <p className="text-3xl">{geraklBoxPrize.emoji}</p>
                                                    <p className="text-white font-bold mt-1">{geraklBoxPrize.name}</p>
                                                </div>
                                            )}
                                            <button onClick={exitGeraklGame} className="w-full bg-green-600 hover:bg-green-500 py-2.5 rounded-xl font-bold transition text-sm">–í—ã–π—Ç–∏</button>
                                        </>
                                    )}
                                </div>
                            ) : geraklGameActive ? (
                                <>
                                    <div className="glass rounded-xl p-4 mb-3 text-center border border-yellow-500/30">
                                        <div className="text-3xl mb-2">‚è±Ô∏è</div>
                                        <div className="text-5xl font-bold text-yellow-400 mb-2">{geraklTimer}</div>
                                        <div className="text-gray-400 text-xs mb-3">—Å–µ–∫—É–Ω–¥ –¥–æ –≤—ã–±–æ—Ä–∞</div>
                                        
                                        <div className="grid grid-cols-2 gap-4 mb-4">
                                            <div className="bg-gray-800/60 rounded-lg p-3">
                                                <div className="text-gray-400 text-xs mb-1">–¢–µ–∫—É—â–∏–π –≤—ã–∏–≥—Ä—ã—à</div>
                                                <div className="text-2xl font-bold text-yellow-400">{geraklCurrentWin}‚≠êÔ∏è</div>
                                            </div>
                                            <div className="bg-gray-800/60 rounded-lg p-3">
                                                <div className="text-gray-400 text-xs mb-1">–ú–Ω–æ–∂–∏—Ç–µ–ª—å</div>
                                                <div className="text-2xl font-bold text-orange-400">{geraklMultiplier}x</div>
                                            </div>
                                        </div>
                                        
                                        <div className="flex gap-2 mb-4">
                                            <button onClick={handleGeraklFlame} className="flex-1 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-500 hover:to-orange-500 py-3 rounded-xl font-bold transition text-sm">üî• –ü–ª–∞–º—è</button>
                                            <button onClick={handleGeraklCashout} className="flex-1 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 py-3 rounded-xl font-bold transition text-sm">üßä –ó–∞–±—Ä–∞—Ç—å</button>
                                        </div>
                                        
                                        <div className="flex justify-center flex-wrap">
                                            {[...Array(10)].map((_, i) => (
                                                <div key={i} className={`round-box ${i < geraklRound ? 'completed' : i === geraklRound ? 'current' : ''}`}>
                                                    {i + 1}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    <div className="glass rounded-xl p-3">
                                        <h3 className="font-bold text-center text-yellow-300 text-xs mb-2">üéÅ –í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ 10 —Ä–∞—É–Ω–¥–æ–≤</h3>
                                        <div className="flex flex-wrap justify-center gap-1.5 text-xl">
                                            {['üß∏', 'üß∏ PRO', 'üß±', 'üçæ', 'üíç', '25‚≠êÔ∏è', '200‚≠êÔ∏è', '350‚≠êÔ∏è', 'üîë'].map((e, i) => <span key={i} className="bg-gray-800/60 p-1.5 rounded-lg border border-white/10">{e}</span>)}
                                        </div>
                                    </div>
                                </>
                            ) : (
                                <div className="glass rounded-xl p-4 mb-3 text-center border border-yellow-500/30">
                                    <div className="text-3xl mb-2 animate-bounce">ü™¨</div>
                                    <div className="font-bold text-yellow-300 text-lg mb-2">–°–æ–≤–µ—Ä—à–∏ 13 –ø–æ–¥–≤–∏–≥!</div>
                                    <div className="text-gray-400 text-xs mb-3">–°–¥–µ–ª–∞–π —Å—Ç–∞–≤–∫—É –∏ –ø—Ä–æ–π–¥–∏ 10 —Ä–∞—É–Ω–¥–æ–≤</div>
                                    <div className="flex gap-2 mb-3">
                                        <input type="number" min="25" value={geraklBetInput} onChange={e => setGeraklBetInput(Math.max(25, Number(e.target.value)))} className="flex-1 bg-gray-800 border border-yellow-600 rounded-lg p-2.5 text-center text-lg text-white" />
                                        <button onClick={() => setGeraklBetInput(p => p + 25)} className="bg-yellow-700 hover:bg-yellow-600 px-3 rounded-lg font-bold transition text-sm">+25</button>
                                        <button onClick={() => setGeraklBetInput(p => p + 100)} className="bg-yellow-700 hover:bg-yellow-600 px-3 rounded-lg font-bold transition text-sm">+100</button>
                                    </div>
                                    <button onClick={startGeraklGame} disabled={balance < geraklBetInput || geraklBetInput < 25} className="w-full bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 py-2.5 rounded-xl font-bold disabled:opacity-50 transition text-sm">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É ({geraklBetInput}‚≠êÔ∏è)</button>
                                    <p className="text-center text-xs text-gray-500 mt-1">–ë–∞–ª–∞–Ω—Å: {balance.toFixed(0)}‚≠êÔ∏è | –ú–∏–Ω: 25‚≠êÔ∏è</p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }
            
            if(isAdmin) {
                const filteredUsers = allUsers.filter(u => !adminUserSearch || (u.name && u.name.toLowerCase().includes(adminUserSearch.toLowerCase())) || (u.username && u.username.toLowerCase().includes(adminUserSearch.toLowerCase())) || (u.id && u.id.toLowerCase().includes(adminUserSearch.toLowerCase())));
                return (
                    <div className="min-h-screen bg-gray-900 p-4">
                        <div className="max-w-4xl mx-auto">
                            <div className="flex justify-between items-center mb-6">
                                <h1 className="text-2xl font-bold text-white">üîê –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
                                <button onClick={() => setIsAdmin(false)} className="text-gray-400 hover:text-white">–í—ã–π—Ç–∏</button>
                            </div>
                            <div className="flex gap-2 mb-6 overflow-x-auto">
                                {['stats', 'users', 'rewards', 'settings'].map(tab => (
                                    <button key={tab} onClick={() => setAdminScreen(tab)} className={`px-4 py-2 rounded-lg ${adminScreen === tab ? 'bg-indigo-600' : 'bg-gray-700'} text-sm`}>
                                        {tab === 'stats' ? 'üìä –°—Ç–∞—Ç.' : tab === 'users' ? 'üë• –Æ–∑–µ—Ä—ã' : tab === 'rewards' ? 'üéÄ –ù–∞–≥—Ä–∞–¥—ã' : '‚öôÔ∏è –ù–∞—Å—Ç—Ä.'}
                                    </button>
                                ))}
                            </div>
                            <div className="glass rounded-xl p-6">
                                {adminScreen === 'stats' && (
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="bg-gray-800 p-4 rounded-lg"><div className="text-gray-400 text-sm">–ò–≥—Ä–æ–∫–æ–≤</div><div className="text-3xl font-bold">{allUsers.length}</div></div>
                                        <div className="bg-gray-800 p-4 rounded-lg"><div className="text-gray-400 text-sm">–û–Ω–ª–∞–π–Ω</div><div className="text-3xl font-bold text-green-400">{onlineCount}</div></div>
                                        <div className="bg-gray-800 p-4 rounded-lg"><div className="text-gray-400 text-sm">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</div><div className="text-2xl font-bold">{allUsers.reduce((s, u) => s + (u.balance || 0), 0).toFixed(0)}‚≠êÔ∏è</div></div>
                                        <div className="bg-gray-800 p-4 rounded-lg"><div className="text-gray-400 text-sm">–ü—Ä–µ–¥–º–µ—Ç–æ–≤</div><div className="text-3xl font-bold">{allUsers.reduce((s, u) => s + (u.inventory?.length || 0), 0)}</div></div>
                                    </div>
                                )}
                                {adminScreen === 'users' && !selectedUser && (
                                    <div>
                                        <div className="mb-4">
                                            <input type="text" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, –Ω–∏–∫—É –∏–ª–∏ ID..." value={adminUserSearch} onChange={e => setAdminUserSearch(e.target.value)} className="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-sm" />
                                        </div>
                                        <div className="space-y-2 max-h-96 overflow-y-auto">
                                            {filteredUsers.map(u => (
                                                <div key={u.id} onClick={() => setSelectedUser(u)} className="bg-gray-800 p-3 rounded-lg cursor-pointer hover:bg-gray-700 flex justify-between">
                                                    <div><div className="font-bold text-sm">{u.name}</div><div className="text-xs text-gray-400">{u.username || u.id.slice(0,12)}</div></div>
                                                    <div className="text-yellow-400 text-sm">{(u.balance || 0).toFixed(0)}‚≠êÔ∏è</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                                {adminScreen === 'users' && selectedUser && (
                                    <div>
                                        <h3 className="font-bold mb-4 text-lg">üë§ {selectedUser.name}</h3>
                                        <div className="grid grid-cols-3 gap-2 mb-4">
                                            <button onClick={() => adminGiveReward(selectedUser.id, {type:'stars', amount:100})} className="bg-green-600 p-2 rounded text-sm">+100‚≠êÔ∏è</button>
                                            <button onClick={() => adminGiveReward(selectedUser.id, {type:'stars', amount:500})} className="bg-green-600 p-2 rounded text-sm">+500‚≠êÔ∏è</button>
                                            <button onClick={() => adminGiveReward(selectedUser.id, {type:'stars', amount:1000})} className="bg-green-600 p-2 rounded text-sm">+1000‚≠êÔ∏è</button>
                                            <button onClick={() => adminGiveReward(selectedUser.id, {type:'case', caseType:'diamond', count:5})} className="bg-blue-600 p-2 rounded text-sm">+5üíé</button>
                                            <button onClick={() => adminGiveReward(selectedUser.id, {type:'case', caseType:'elite', count:2})} className="bg-red-600 p-2 rounded text-sm">+2üéñ</button>
                                            <button onClick={() => adminGiveReward(selectedUser.id, {type:'unlock_collector'})} className="bg-pink-800 p-2 rounded text-sm">üîì –ö–æ–ª–ª–µ–∫—Ü.</button>
                                            <button onClick={() => adminGiveReward(selectedUser.id, {type:'reset_daily'})} className="bg-cyan-600 p-2 rounded text-sm">üóìÔ∏è –°–±—Ä–æ—Å –¥–µ–π–ª–∏</button>
                                            <button onClick={() => adminGiveReward(selectedUser.id, {type:'item', item:{id:'random_case_box', name:'–°–ª—É—á–∞–π–Ω—ã–π –∫–µ–π—Å', emoji:'üì¶', type:'random_case_box'}})} className="bg-amber-600 p-2 rounded text-sm">üì¶ –í—ã–¥–∞—Ç—å —è—â–∏–∫</button>
                                        </div>
                                        <button onClick={() => setSelectedUser(null)} className="w-full bg-gray-600 p-2 rounded text-sm">‚Üê –ù–∞–∑–∞–¥</button>
                                    </div>
                                )}
                                {adminScreen === 'rewards' && (
                                    <div>
                                        <h3 className="text-lg mb-4">–í—ã–¥–∞—Ç—å —Å–µ–±–µ:</h3>
                                        <div className="grid grid-cols-3 gap-2">
                                            <button onClick={() => adminGiveReward(user.id, {type:'stars', amount:10000})} className="bg-indigo-600 p-3 rounded text-sm">+10000‚≠êÔ∏è</button>
                                            <button onClick={() => adminGiveReward(user.id, {type:'case', caseType:'diamond', count:10})} className="bg-blue-600 p-3 rounded text-sm">+10üíé</button>
                                            <button onClick={() => adminGiveReward(user.id, {type:'unlock_collector'})} className="bg-pink-800 p-3 rounded text-sm">üîì –ö–æ–ª–ª–µ–∫—Ü.</button>
                                            <button onClick={() => adminGiveReward(user.id, {type:'reset_daily'})} className="bg-cyan-600 p-3 rounded text-sm">üóìÔ∏è –°–±—Ä–æ—Å –¥–µ–π–ª–∏</button>
                                            <button onClick={() => adminGiveReward(user.id, {type:'item', item:{id:'random_case_box', name:'–°–ª—É—á–∞–π–Ω—ã–π –∫–µ–π—Å', emoji:'üì¶', type:'random_case_box'}})} className="bg-amber-600 p-3 rounded text-sm">üì¶ –í—ã–¥–∞—Ç—å —è—â–∏–∫</button>
                                        </div>
                                    </div>
                                )}
                                {adminScreen === 'settings' && (
                                    <div>
                                        <h3 className="text-lg mb-4">–°–±—Ä–æ—Å–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</h3>
                                        <button onClick={async () => { if(confirm('–£–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ?')) { await db.ref('users/' + user.id).remove(); localStorage.removeItem('sbs_user_id'); window.location.reload(); } }} className="bg-red-600 px-4 py-2 rounded-lg text-sm">üóë –°–±—Ä–æ—Å–∏—Ç—å</button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }
            
            return (
                <div className="min-h-screen pb-24">
                    <header className="p-4 flex justify-between items-center glass sticky top-0 z-50">
                        <h1 onClick={handleTitleClick} className="text-xl font-bold cursor-pointer select-none hover:text-cyan-300 transition">Step By Step Game</h1>
                        <button onClick={() => setShowTopUp(true)} className="bg-gradient-to-r from-yellow-400 to-orange-500 px-4 py-2 rounded-full font-bold text-gray-900 shadow-lg text-sm">{balance.toFixed(2)} ‚≠êÔ∏è</button>
                    </header>
                    
                    {paymentStatus && <div className="mx-4 mt-2 p-3 rounded-lg text-center text-xs bg-blue-500/20 border border-blue-500">{paymentStatus}</div>}
                    
                    {showRandomCaseModal && (
                        <div className="fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4">
                            <div className="glass rounded-2xl p-6 max-w-sm w-full text-center">
                                <div className="text-6xl mb-4 animate-bounce">üì¶</div>
                                <h3 className="text-xl font-bold mb-2">–°–ª—É—á–∞–π–Ω—ã–π –ö–µ–π—Å</h3>
                                <p className="mb-4 text-sm">–û–±–º–µ–Ω—è—Ç—å —ç—Ç–æ—Ç —è—â–∏–∫ –Ω–∞ –æ–¥–∏–Ω —Å–ª—É—á–∞–π–Ω—ã–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–µ–π—Å –∏–∑ —Å–ø–∏—Å–∫–∞?</p>
                                <div className="space-y-3">
                                    <button onClick={exchangeRandomCaseBox} className="w-full bg-green-600 hover:bg-green-500 py-3 rounded-xl font-bold">–û–±–º–µ–Ω—è—Ç—å</button>
                                    <button onClick={() => setShowRandomCaseModal(false)} className="w-full bg-gray-600 hover:bg-gray-500 py-2 rounded-xl text-sm font-bold">–û—Ç–º–µ–Ω–∞</button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {showCollectibleModal && (
                        <div className="fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4">
                            <div className="glass rounded-2xl p-6 max-w-sm w-full text-center">
                                <div className="text-6xl mb-4 animate-bounce">{selectedCollectible?.emoji}</div>
                                <h3 className="text-xl font-bold mb-2">{selectedCollectible?.type === 'olympus_special' ? '–û—Å–æ–±—ã–π –ø—Ä–µ–¥–º–µ—Ç –û–ª–∏–º–ø–∞!' : '–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç!'}</h3>
                                <p className="mb-4 text-sm">–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ <a href="https://t.me/stepbystepdelision" target="_blank" className="text-blue-400 underline">–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏</a></p>
                                <button onClick={() => setShowCollectibleModal(false)} className="w-full bg-indigo-600 hover:bg-indigo-500 py-3 rounded-xl font-bold">–ü–æ–Ω—è—Ç–Ω–æ</button>
                            </div>
                        </div>
                    )}
                    
                    {showOlympusItemModal && selectedOlympusItem && (
                        <div className="fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4">
                            <div className="glass rounded-2xl p-6 max-w-sm w-full text-center olympus-font">
                                <div className="text-6xl mb-4">{selectedOlympusItem.emoji}</div>
                                <h3 className="text-xl font-bold mb-2 text-yellow-300">{selectedOlympusItem.name}</h3>
                                <div className="space-y-3">
                                    <button onClick={() => handleOlympusItem(selectedOlympusItem)} className="w-full bg-gradient-to-r from-yellow-600 to-amber-600 hover:from-yellow-500 hover:to-amber-500 py-3 rounded-xl font-bold transition">–ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É</button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {showGefestModal && (
                        <div className="fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4 overflow-y-auto">
                            <div className="glass rounded-2xl p-6 max-w-md w-full olympus-font" style={{
                                backgroundImage: `url('gefest.jpg')`,
                                backgroundSize: 'cover',
                                backgroundPosition: 'center',
                                backgroundBlendMode: 'overlay'
                            }}>
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-xl font-bold hephaestus-text">–õ–∞–≤–∫–∞ –ì–µ—Ñ–µ—Å—Ç–∞üèµÔ∏è</h3>
                                    <button onClick={() => setShowGefestModal(false)} className="text-2xl hover:text-red-400 transition">√ó</button>
                                </div>
                                <p className="text-center hephaestus-text text-sm mb-4">–û–±–º–µ–Ω—è–π —Å–≤–æ–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –Ω–∞ —á—Ç–æ-–Ω–∏–±—É–¥—å —Ü–µ–Ω–Ω–æ–µüíé</p>
                                {gefestCooldown > 0 && (
                                    <div className="bg-red-500/20 border border-red-500 rounded-lg p-2 mb-4 text-center text-sm">
                                        ‚è∞ –°–ª–µ–¥—É—é—â–∏–π –æ–±–º–µ–Ω —á–µ—Ä–µ–∑: {Math.ceil(gefestCooldown / 60000)} –º–∏–Ω
                                    </div>
                                )}
                                <div className="space-y-2 max-h-96 overflow-y-auto">
                                    {Object.entries(GEFEST_EXCHANGES).map(([key, exchange]) => {
                                        const hasItem = inventory.find(i => i.key === key || i.id === key);
                                        return (
                                            <div key={key} className={`glass rounded-xl p-3 ${hasItem ? 'border-2 border-green-500' : 'opacity-50'}`}>
                                                <div className="flex justify-between items-center mb-2">
                                                    <span className="font-bold text-sm">{exchange.name}</span>
                                                    {hasItem && <span className="text-green-400 text-xs">‚úì –ï—Å—Ç—å</span>}
                                                </div>
                                                <div className="text-xs text-gray-300 mb-2">
                                                    {exchange.highlight && <span className="text-red-400 animate-pulse">‚ö° –í—ã–≥–æ–¥–Ω–æ! </span>}
                                                    ‚Üí {exchange.rewardText}
                                                </div>
                                                <button 
                                                    onClick={() => handleGefestExchange(key)} 
                                                    disabled={!hasItem || gefestCooldown > 0}
                                                    className="w-full bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-500 hover:to-red-500 py-2 rounded-lg font-bold text-xs disabled:opacity-50 disabled:cursor-not-allowed transition"
                                                >
                                                    –û–±–º–µ–Ω—è—Ç—å
                                                </button>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {showGefestChoice && gefestChoiceItem && (
                        <div className="fixed inset-0 bg-black/90 z-[70] flex items-center justify-center p-4">
                            <div className="glass rounded-2xl p-6 max-w-sm w-full text-center olympus-font">
                                <div className="text-6xl mb-4">üßä</div>
                                <h3 className="text-xl font-bold mb-4 text-cyan-300">–í—ã–±–µ—Ä–∏ –Ω–∞–≥—Ä–∞–¥—É!</h3>
                                <div className="space-y-3">
                                    <button onClick={() => handleGefestChoice(1)} className="w-full bg-gradient-to-r from-yellow-600 to-amber-600 hover:from-yellow-500 hover:to-amber-500 py-3 rounded-xl font-bold transition">
                                        25 –∫–µ–π—Å–æ–≤ ¬´–ó–≤–µ–∑–¥–Ω—ã–π‚≠êÔ∏è¬ª
                                    </button>
                                    <button onClick={() => handleGefestChoice(2)} className="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 py-3 rounded-xl font-bold transition">
                                        500‚≠êÔ∏è
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {showAdminLogin && (
                        <div className="fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4">
                            <div className="glass rounded-2xl p-6 max-w-sm w-full">
                                <h2 className="text-xl font-bold text-center mb-4">üîê –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                                <input type="text" placeholder="–õ–æ–≥–∏–Ω" value={adminLogin} onChange={e => setAdminLogin(e.target.value)} className="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 mb-3 text-center text-sm" />
                                <input type="password" placeholder="–ü–∞—Ä–æ–ª—å" value={adminPassword} onChange={e => setAdminPassword(e.target.value)} className="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 mb-4 text-center text-sm" />
                                <button onClick={checkAdminLogin} className="w-full bg-indigo-600 hover:bg-indigo-500 py-3 rounded-xl font-bold mb-2">–í–æ–π—Ç–∏</button>
                                <button onClick={() => setShowAdminLogin(false)} className="w-full bg-gray-700 hover:bg-gray-600 py-2 rounded-xl text-sm">–û—Ç–º–µ–Ω–∞</button>
                            </div>
                        </div>
                    )}
                    
                    {showWithdrawModal && (
                        <div className="fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4">
                            <div className="glass rounded-2xl p-6 max-w-sm w-full">
                                <h2 className="text-xl font-bold text-center mb-4">üìä –í—ã–≤–æ–¥ –ø—Ä–∏–∑–æ–≤</h2>
                                <input type="number" placeholder="–ö–æ–ª-–≤–æ –∑–≤—ë–∑–¥" value={withdrawAmount} onChange={e => setWithdrawAmount(e.target.value)} className="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 mb-4 text-center" />
                                <div className="grid grid-cols-2 gap-3 mb-4">
                                    <button onClick={confirmWithdraw} className="bg-yellow-600 hover:bg-yellow-500 py-3 rounded-xl font-bold">–í –∑–≤—ë–∑–¥–∞—Ö</button>
                                    <button onClick={confirmWithdraw} className="bg-purple-600 hover:bg-purple-500 py-3 rounded-xl font-bold">–í –ø–æ–¥–∞—Ä–∫–∞—Ö</button>
                                </div>
                                <button onClick={() => setShowWithdrawModal(false)} className="w-full bg-gray-700 hover:bg-gray-600 py-2 rounded-xl text-sm">–û—Ç–º–µ–Ω–∞</button>
                            </div>
                        </div>
                    )}
                    
                    <main className="p-4 max-w-md mx-auto">
                        {currentScreen === 'cases' && (
                            <div>
                                <h2 className="text-2xl font-bold mb-4 text-center">üé∞ –ö–µ–π—Å—ã</h2>
                                
                                {cases.diamond?.freeCount > 0 && <div className="bg-green-500/20 border border-green-500 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –ê–ª–º–∞–∑: {cases.diamond.freeCount}</div>}
                                {cases.elite?.freeCount > 0 && <div className="bg-green-500/20 border border-green-500 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –≠–ª–∏—Ç–∞: {cases.elite.freeCount}</div>}
                                {freeEliteSpin > 0 && <div className="bg-green-500/20 border border-green-500 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø—Ä–æ–∫—Ä—É—Ç–æ–≤ –≠–ª–∏—Ç–∞: {freeEliteSpin}</div>}
                                {cases.collector?.freeCount > 0 && <div className="bg-pink-500/20 border border-pink-500 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä: {cases.collector.freeCount}</div>}
                                {cases.cardboard?.freeCount > 0 && <div className="bg-amber-500/20 border border-amber-500 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –ö–∞—Ä—Ç–æ–Ω: {cases.cardboard.freeCount}</div>}
                                {cases.coal?.freeCount > 0 && <div className="bg-gray-500/20 border border-gray-500 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –£–≥–æ–ª—ë–∫: {cases.coal.freeCount}</div>}
                                {cases.platinum?.freeCount > 0 && <div className="bg-gray-300/20 border border-gray-300 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –ü–ª–∞—Ç–∏–Ω–∞: {cases.platinum.freeCount}</div>}
                                {cases.gold?.freeCount > 0 && <div className="bg-yellow-500/20 border border-yellow-500 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –ó–æ–ª–æ—Ç–æ–π: {cases.gold.freeCount}</div>}
                                {cases.money?.freeCount > 0 && <div className="bg-green-500/20 border border-green-500 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –î–µ–Ω–µ–∂–Ω—ã–π: {cases.money.freeCount}</div>}
                                {cases.star?.freeCount > 0 && <div className="bg-amber-400/20 border border-amber-400 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –ó–≤–µ–∑–¥–Ω—ã–π: {cases.star.freeCount}</div>}
                                
                                <div className="mb-6">
                                    <h3 className="text-lg font-bold text-center mb-3 text-purple-300 special-header">üîÆ –û—Å–æ–±—ã–µ üîÆ</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        {Object.values(cases).filter(c => c.type === 'special').map(c => {
                                            const isDaily = c.id === 'daily';
                                            const isDailyWait = isDaily && c.freeCount === 0;
                                            
                                            if (c.id === 'collector' && c.locked) {
                                                return (
                                                     <div key={c.id} className="rounded-xl p-4 relative case-collector opacity-80 overflow-hidden">
                                                        <div className="absolute inset-0 bg-black/50 z-20 flex flex-col items-center justify-center">
                                                            <span className="text-5xl drop-shadow-lg">üîí</span>
                                                        </div>
                                                        <div className="w-16 h-16 mx-auto rounded-lg bg-white/20 flex items-center justify-center text-3xl mb-2 shadow-lg relative z-10">{c.emoji}</div>
                                                        <h3 className="font-bold text-center text-sm relative z-10">{c.name}</h3>
                                                        <p className="text-center text-xs opacity-75 mb-2 h-4 relative z-10">{c.price}‚≠êÔ∏è</p>
                                                        <button disabled className="w-full py-2 rounded-lg font-bold text-sm bg-gray-800/80 cursor-not-allowed text-gray-400 relative z-10">–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</button>
                                                    </div>
                                                );
                                            }

                                            return (
                                                <div key={c.id} className={`glass rounded-xl p-4 relative overflow-hidden hover:scale-105 transition ${c.id === 'collector' ? 'case-collector' : ''}`}>
                                                    <div className={`w-16 h-16 mx-auto rounded-lg ${c.id === 'collector' ? 'bg-white/20' : `bg-gradient-to-br ${c.color}`} flex items-center justify-center text-3xl mb-2 shadow-lg`}>{c.emoji}</div>
                                                    <h3 className="font-bold text-center text-sm">{c.name}</h3>
                                                    <p className="text-center text-xs opacity-75 mb-2 h-4 flex items-center justify-center">
                                                        {isDaily ? (c.freeCount > 0 ? <span className="text-green-400 font-bold">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ!</span> : <span className="daily-timer">{dailyCaseTimeLeft}</span>) :
                                                        (c.discountPrice && c.discountPrice !== c.price ? <span><span className="line-through">{c.originalPrice || c.price}</span> {c.discountPrice}‚≠êÔ∏è</span> : (c.price > 0 ? c.price + '‚≠êÔ∏è' : ''))}
                                                    </p>
                                                    <button onClick={() => handleSelectCase(c)} disabled={c.locked} className="w-full py-2 rounded-lg font-bold text-sm bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 transition disabled:bg-gray-600">
                                                        {c.locked ? 'üîí' : (isDailyWait ? 'üëÅ –°–º–æ—Ç—Ä–µ—Ç—å' : '–û—Ç–∫—Ä—ã—Ç—å')}
                                                    </button>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                                
                                <div className="mb-6">
                                    <h3 className="text-lg font-bold text-center mb-3 text-yellow-300 ordinary-header">üéÅ –û–±—ã—á–Ω—ã–µ üéÅ</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        {Object.values(cases).filter(c => !c.type && !c.locked).map(c => (
                                            <div key={c.id} className={`glass rounded-xl p-4 relative overflow-hidden hover:scale-105 transition ${c.id === 'cardboard' ? 'case-cardboard' : ''}`}>
                                                {c.isNew && !c.type && <span className="absolute -top-2 -right-2 bg-red-500 text-xs px-2 py-1 rounded-full animate-pulse">–ù–æ–≤–æ–µ!</span>}
                                                {(c.discountPrice && c.discountPrice !== c.price) && !c.freeCount && <span className="absolute -top-2 -left-2 bg-green-500 text-xs px-2 py-1 rounded-full animate-pulse">–°–∫–∏–¥–∫–∞!</span>}
                                                <div className={`w-16 h-16 mx-auto rounded-lg ${c.id === 'cardboard' ? 'bg-white/20' : `bg-gradient-to-br ${c.color}`} flex items-center justify-center text-3xl mb-2 shadow-lg`}>{c.emoji}</div>
                                                <h3 className="font-bold text-center text-sm">{c.name}</h3>
                                                <p className="text-center text-xs opacity-75 mb-2 h-4">
                                                    {c.freeCount > 0 ? <span className="text-green-400 font-bold">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ!</span> :
                                                    (c.discountPrice && c.discountPrice !== c.price ? <span><span className="line-through">{c.originalPrice || c.price}‚≠êÔ∏è</span> <span className="font-bold text-white">{c.discountPrice}‚≠êÔ∏è</span></span> : c.price + '‚≠êÔ∏è')}
                                                </p>
                                                <button onClick={() => handleSelectCase(c)} className="w-full py-2 rounded-lg font-bold text-sm bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 transition">–û—Ç–∫—Ä—ã—Ç—å</button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                
                                {Object.values(cases).filter(c => c.locked && !c.type).length > 0 && (
                                    <div className="grid grid-cols-2 gap-4">
                                        {Object.values(cases).filter(c => c.locked && !c.type).map(c => (
                                            <div key={c.id} className="glass rounded-xl p-4 relative opacity-50">
                                                <div className="absolute inset-0 bg-black/70 rounded-xl flex items-center justify-center"><span className="text-2xl">üîí</span></div>
                                                <div className={`w-16 h-16 mx-auto rounded-lg bg-gradient-to-br ${c.color} flex items-center justify-center text-3xl mb-2`}>{c.emoji}</div>
                                                <h3 className="font-bold text-center text-sm">{c.name}</h3>
                                                <p className="text-center text-xs mb-2 h-4">{c.price}‚≠êÔ∏è</p>
                                                <button className="w-full py-2 rounded-lg font-bold text-sm bg-gray-600 cursor-not-allowed">–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</button>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                        
                        {currentScreen === 'games' && (
                            <div>
                                <h2 className="text-2xl font-bold mb-4 text-center">üéÆ –ò–≥—Ä—ã</h2>
                                <div className="space-y-4">
                                    <div className="glass rounded-xl p-5 border border-yellow-500/30" style={{
                                        backgroundImage: `url('gerakl.jpg')`,
                                        backgroundSize: 'cover',
                                        backgroundPosition: 'center',
                                        backgroundBlendMode: 'overlay'
                                    }}>
                                        <h3 className="text-xl font-bold mb-1 text-center text-yellow-300">ü™¨ 13 –ü–æ–¥–≤–∏–≥ –ì–µ—Ä–∞–∫–ª–∞ üåä</h3>
                                        <p className="text-gray-400 mb-1 text-center text-xs">–°–æ–≤–µ—Ä—à–∏ 13 –ø–æ–¥–≤–∏–≥!</p>
                                        <p className="text-yellow-400 text-center text-xs mb-3">–ü—Ä–æ–π–¥–∏ 10 —Ä–∞—É–Ω–¥–æ–≤ –∏ –ø–æ–ª—É—á–∏ —Å—É–Ω–¥—É–∫ üì¶</p>
                                        <button onClick={() => setCurrentGame({ type: 'gerakl' })} className="w-full bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 py-3 rounded-xl font-bold transition text-sm">–í–æ–π—Ç–∏</button>
                                    </div>
                                    <div className="glass rounded-xl p-5 opacity-50 text-center">
                                        <h3 className="text-lg font-bold">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ... üë≤</h3>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {currentScreen === 'events' && (
                            <div>
                                {eventScreen === 'main' && (
                                    <div className="relative rounded-xl overflow-hidden" style={{
                                        backgroundImage: `url('event.jpg')`,
                                        backgroundSize: 'cover',
                                        backgroundPosition: 'center',
                                        minHeight: '500px'
                                    }}>
                                        <div className="absolute inset-0 bg-black/30"></div>
                                        <div className="relative z-10 p-4">
                                            <h2 className="text-3xl font-bold text-center mb-4 olympus-font olympus-title">üèõÔ∏è –ò–í–ï–ù–¢ –û–õ–ò–ú–ü ‚ö°Ô∏è</h2>
                                            
                                            {/* –ì–µ—Ä–æ–∏ –û–ª–∏–º–ø–∞ ‚Äî –≤–≤–µ—Ä—Ö—É */}
                                            <button onClick={() => setEventScreen('heroes')} className="olympus-button olympus-label" style={{top: '12%', left: '50%', transform: 'translateX(-50%)', width: '220px'}}>
                                                –ì–µ—Ä–æ–∏ –û–ª–∏–º–ø–∞üèÜ
                                            </button>

                                            {/* –°–æ–∫—Ä–æ–≤–∏—â–µ ‚Äî —Å–ª–µ–≤–∞ */}
                                            <button onClick={() => setEventScreen('treasure')} className="olympus-button olympus-label" style={{top: '45%', left: '8%', width: '240px'}}>
                                                –°–æ–∫—Ä–æ–≤–∏—â–µ –û–ª–∏–º–ø–∞‚ö°Ô∏è
                                            </button>
                                            
                                            {/* –õ–∞–≤–∫–∞ –ì–µ—Ñ–µ—Å—Ç–∞ ‚Äî —Ç–æ–∂–µ —Å–ª–µ–≤–∞ (–Ω–∏–∂–µ) */}
                                            <button onClick={() => setShowGefestModal(true)} className="olympus-button olympus-label" style={{top: '62%', left: '8%', width: '240px'}}>
                                                –õ–∞–≤–∫–∞ –ì–µ—Ñ–µ—Å—Ç–∞üèµÔ∏è
                                            </button>
                                        </div>
                                    </div>
                                )}
                                
                                {eventScreen === 'treasure' && (
                                    <div className="olympus-font">
                                        <button onClick={() => setEventScreen('main')} className="mb-4 text-yellow-300 hover:text-yellow-400 transition">‚Üê –ù–∞–∑–∞–¥ –∫ –û–ª–∏–º–ø—É</button>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div className="glass rounded-xl p-4" style={{
                                                backgroundImage: `url('${treasureBg}')`,
                                                backgroundSize: 'cover',
                                                backgroundPosition: 'center',
                                                backgroundBlendMode: 'overlay'
                                            }}>
                                                <h3 className="text-xl font-bold text-center mb-3 olympus-title">–ö–µ–π—Å ¬´–û–ª–∏–º–ø‚ö°Ô∏è¬ª</h3>
                                                <div className="glass rounded-xl p-3 mb-4">
                                                    <p className="text-center text-xs olympus-label mb-2">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ–Ω (–∫–∞—Ä—Ç–∏–Ω–∫–∞ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ)</p>
                                                    <input
                                                        type="file"
                                                        accept="image/*"
                                                        className="w-full text-xs"
                                                        onChange={(e) => {
                                                            const f = e.target.files?.[0];
                                                            if (!f) return;
                                                            const reader = new FileReader();
                                                            reader.onload = () => {
                                                                const dataUrl = String(reader.result || '');
                                                                localStorage.setItem('olymp_treasure_bg', dataUrl);
                                                                setTreasureBg(dataUrl);
                                                            };
                                                            reader.readAsDataURL(f);
                                                        }}
                                                    />
                                                    <button
                                                        className="mt-2 w-full bg-gray-800/60 hover:bg-gray-800 py-2 rounded-lg text-xs font-bold"
                                                        onClick={() => {
                                                            localStorage.removeItem('olymp_treasure_bg');
                                                            setTreasureBg('case.jpg');
                                                        }}
                                                    >
                                                        –°–±—Ä–æ—Å–∏—Ç—å –Ω–∞ case.jpg
                                                    </button>
                                                </div>
                                                <div className="w-32 h-32 mx-auto mb-4 rounded-lg bg-gradient-to-br from-yellow-400 to-amber-600 flex items-center justify-center text-6xl shadow-xl">‚ö°Ô∏è</div>
                                                <p className="text-center text-sm mb-2">–¶–µ–Ω–∞: <span className="font-bold text-yellow-400">77‚≠êÔ∏è</span></p>
                                                {cases.olympus?.freeCount > 0 && <p className="text-center text-green-400 text-sm mb-2">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö: {cases.olympus.freeCount}</p>}
                                                <button onClick={() => handleSelectCase(cases.olympus || { id: 'olympus', name: '–û–ª–∏–º–ø', emoji: '‚ö°Ô∏è', price: 77, freeCount: 2 })} className="w-full bg-gradient-to-r from-yellow-600 to-amber-600 hover:from-yellow-500 hover:to-amber-500 py-3 rounded-xl font-bold transition">
                                                    –û—Ç–∫—Ä—ã—Ç—å‚≠êÔ∏è
                                                </button>
                                            </div>
                                            
                                            <div className="glass rounded-xl p-4">
                                                <h3 className="text-lg font-bold text-center mb-3 olympus-title">–õ–µ—Å—Ç–Ω–∏—Ü–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</h3>
                                                <p className="text-center text-xs olympus-label mb-3">–û—Ç–∫—Ä—ã—Ç–æ –∫–µ–π—Å–æ–≤: {olympusOpens}</p>
                                                <div className="w-full h-2 bg-black/50 rounded-full overflow-hidden mb-3 border border-yellow-400/40">
                                                    <div className="h-full bg-gradient-to-r from-yellow-400 to-amber-500" style={{ width: `${Math.min(100, (olympusOpens / 150) * 100)}%` }} />
                                                </div>
                                                <div className="space-y-2 max-h-96 overflow-y-auto">
                                                    {OLYMPUS_PROGRESS.map((step, idx) => {
                                                        const isCompleted = olympusProgress.includes(step.opens);
                                                        const isActive = olympusOpens >= step.opens && !isCompleted;
                                                        return (
                                                            <div key={idx} className={`progress-step ${isCompleted ? 'completed' : ''} ${isActive ? 'active' : ''}`}>
                                                                <div className="flex justify-between items-center">
                                                                    <span className="text-xs font-bold">{step.opens} –æ—Ç–∫—Ä—ã—Ç–∏–π</span>
                                                                    {isCompleted && <span className="text-green-400">‚úì</span>}
                                                                </div>
                                                                <p className="text-xs text-gray-300 mt-1">{step.name}</p>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                
                                {eventScreen === 'heroes' && (
                                    <div className="olympus-font">
                                        <button onClick={() => setEventScreen('main')} className="mb-4 text-yellow-300 hover:text-yellow-400 transition">‚Üê –ù–∞–∑–∞–¥ –∫ –û–ª–∏–º–ø—É</button>
                                        <div className="glass rounded-xl p-4" style={{
                                            backgroundImage: `url('hero.jpg')`,
                                            backgroundSize: 'cover',
                                            backgroundPosition: 'center',
                                            backgroundBlendMode: 'overlay'
                                        }}>
                                            <h2 className="text-2xl font-bold text-center mb-4 olympus-title">üèÜ –ì–µ—Ä–æ–∏ –û–ª–∏–º–ø–∞ üèÜ</h2>
                                            <div className="space-y-3 mb-4">
                                                {olympusTopPlayers.map((player, idx) => (
                                                    <div key={player.id} className="glass rounded-lg p-3 flex items-center gap-3">
                                                        <span className="text-2xl">{idx === 0 ? 'ü•á' : idx === 1 ? 'ü•à' : idx === 2 ? 'ü•â' : `${idx + 1}.`}</span>
                                                        {player.avatar ? (
                                                            <img src={player.avatar} alt="" className="w-10 h-10 rounded-full" />
                                                        ) : (
                                                            <div className="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center text-white font-bold">
                                                                {player.name.charAt(0)}
                                                            </div>
                                                        )}
                                                        <div className="flex-1">
                                                            <div className="font-bold text-sm">{player.name}</div>
                                                            <div className="text-xs text-gray-400">–û—Ç–∫—Ä—ã—Ç–æ: {player.olympusOpens}</div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                            <p className="text-center olympus-label text-sm">–¢–æ–ø 3 –ø–æ–ª—É—á–∞—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã –≤ –∫–æ–Ω—Ü–µ –∏–≤–µ–Ω—Ç–∞!</p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                        
                        {currentScreen === 'tasks' && (
                            <div>
                                <h2 className="text-2xl font-bold mb-4 text-center">üìã –ó–∞–¥–∞–Ω–∏—è</h2>
                                <div className="space-y-3">
                                    <div className={`glass rounded-xl p-4 ${tasks.subscribe?.completed ? 'bg-green-500/20' : ''}`}>
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <h3 className="font-bold text-sm">–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª</h3>
                                                <p className="text-xs opacity-75">–ù–∞–≥—Ä–∞–¥–∞: 1 –∫–µ–π—Å ¬´–≠–ª–∏—Ç–∞¬ª üéñ</p>
                                            </div>
                                            {tasks.subscribe?.completed && <span className="text-green-400 text-xl">‚úÖ</span>}
                                        </div>
                                        <button onClick={() => completeTask('subscribe')} disabled={tasks.subscribe?.completed} className={`w-full py-2 rounded-lg text-sm ${tasks.subscribe?.completed ? 'bg-green-600' : 'bg-blue-600 hover:bg-blue-500'} transition`}>{tasks.subscribe?.completed ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' : '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è'}</button>
                                    </div>
                                    <div className={`glass rounded-xl p-4 ${tasks.inviteThree?.completed ? 'bg-green-500/20' : ''}`}>
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <h3 className="font-bold text-sm">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å 3 –¥—Ä—É–∑–µ–π</h3>
                                                <p className="text-xs opacity-75">–ù–∞–≥—Ä–∞–¥–∞: 25 ‚≠êÔ∏è</p>
                                                {!tasks.inviteThree?.completed && <p className="text-xs text-cyan-400 mt-0.5">–ü—Ä–æ–≥—Ä–µ—Å—Å: {tasks.inviteThree?.count || 0}/3</p>}
                                            </div>
                                            {tasks.inviteThree?.completed && <span className="text-green-400 text-xl">‚úÖ</span>}
                                        </div>
                                        <button onClick={() => completeTask('inviteThree')} disabled={tasks.inviteThree?.completed} className={`w-full py-2 rounded-lg text-sm ${tasks.inviteThree?.completed ? 'bg-green-600' : 'bg-blue-600 hover:bg-blue-500'} transition`}>{tasks.inviteThree?.completed ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' : '–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å'}</button>
                                    </div>
                                    <div className={`glass rounded-xl p-4 ${tasks.cardboard7?.completed ? 'bg-green-500/20' : ''}`}>
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <h3 className="font-bold text-sm">–ü—Ä–æ–∫—Ä—É—Ç–∏ –∫–µ–π—Å ¬´–ö–∞—Ä—Ç–æ–Ωüì¶¬ª 7 —Ä–∞–∑</h3>
                                                <p className="text-xs opacity-75">–ù–∞–≥—Ä–∞–¥–∞: 1 –∫–µ–π—Å ¬´–ê–ª–º–∞–∑üíé¬ª</p>
                                                {!tasks.cardboard7?.completed && <p className="text-xs text-cyan-400 mt-0.5">–ü—Ä–æ–≥—Ä–µ—Å—Å: {tasks.cardboard7?.count || 0}/7</p>}
                                            </div>
                                            {tasks.cardboard7?.completed && <span className="text-green-400 text-xl">‚úÖ</span>}
                                        </div>
                                        {tasks.cardboard7?.completed && <div className="w-full py-2 rounded-lg text-sm bg-green-600 text-center font-bold">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>}
                                    </div>
                                    <div className={`glass rounded-xl p-4 ${tasks.deposit50?.completed ? 'bg-green-500/20' : ''}`}>
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <h3 className="font-bold text-sm">–ü–æ–ø–æ–ª–Ω–∏ –±–∞–ª–∞–Ω—Å –Ω–∞ 50‚≠êÔ∏è</h3>
                                                <p className="text-xs opacity-75">–ù–∞–≥—Ä–∞–¥–∞: 50‚≠êÔ∏è</p>
                                            </div>
                                            {tasks.deposit50?.completed && <span className="text-green-400 text-xl">‚úÖ</span>}
                                        </div>
                                        <button onClick={() => completeTask('deposit50')} disabled={tasks.deposit50?.completed} className={`w-full py-2 rounded-lg text-sm ${tasks.deposit50?.completed ? 'bg-green-600' : 'bg-blue-600 hover:bg-blue-500'} transition`}>{tasks.deposit50?.completed ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' : '–ü–æ–ø–æ–ª–Ω–∏—Ç—å'}</button>
                                    </div>
                                    <div className={`glass rounded-xl p-4 ${tasks.deposit?.completed ? 'bg-green-500/20' : ''}`}>
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <h3 className="font-bold text-sm">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ 100 ‚≠êÔ∏è</h3>
                                                <p className="text-xs opacity-75">–ù–∞–≥—Ä–∞–¥–∞: 1 –∑–æ–ª–æ—Ç–æ–π –∫–µ–π—Å üëë</p>
                                            </div>
                                            {tasks.deposit?.completed && <span className="text-green-400 text-xl">‚úÖ</span>}
                                        </div>
                                        <button onClick={() => completeTask('deposit')} disabled={tasks.deposit?.completed} className={`w-full py-2 rounded-lg text-sm ${tasks.deposit?.completed ? 'bg-green-600' : 'bg-blue-600 hover:bg-blue-500'} transition`}>{tasks.deposit?.completed ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' : '–ü–æ–ø–æ–ª–Ω–∏—Ç—å'}</button>
                                    </div>
                                    <div className={`glass rounded-xl p-4 ${tasks.depositMajor?.completed ? 'bg-green-500/20' : ''}`}>
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <h3 className="font-bold text-sm">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ 350 ‚≠êÔ∏è</h3>
                                                <p className="text-xs opacity-75">–ù–∞–≥—Ä–∞–¥–∞: –ö–µ–π—Å ¬´–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä¬ª + 1 –ø—Ä–æ–∫—Ä—É—Ç</p>
                                            </div>
                                            {tasks.depositMajor?.completed && <span className="text-green-400 text-xl">‚úÖ</span>}
                                        </div>
                                        <button onClick={() => completeTask('depositMajor')} disabled={tasks.depositMajor?.completed} className={`w-full py-2 rounded-lg text-sm ${tasks.depositMajor?.completed ? 'bg-green-600' : 'bg-blue-600 hover:bg-blue-500'} transition`}>{tasks.depositMajor?.completed ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' : '–ü–æ–ø–æ–ª–Ω–∏—Ç—å'}</button>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {currentScreen === 'profile' && (
                            <div>
                                <div className="glass rounded-xl p-3 mb-4 flex justify-between items-center">
                                    <span className="text-gray-400 text-sm">üü¢ –û–Ω–ª–∞–π–Ω:</span>
                                    <span className="font-bold text-green-400 text-sm">{onlineCount} –∏–≥—Ä–æ–∫–æ–≤</span>
                                </div>
                                <h2 className="text-2xl font-bold mb-4 text-center">üë§ –ú–æ–π –ü—Ä–æ—Ñ–∏–ª—å</h2>
                                <div className="glass rounded-xl p-5 text-center mb-4">
                                    <div className="w-20 h-20 mx-auto rounded-full bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center text-3xl mb-3 overflow-hidden border-2 border-white/20">
                                        {user?.avatar ? <img src={user.avatar} alt="" className="w-full h-full object-cover" /> : user?.name?.charAt(0).toUpperCase()}
                                    </div>
                                    <h3 className="text-lg font-bold">{user?.name}</h3>
                                    {user?.username && <p className="text-gray-400 text-sm">{user.username}</p>}
                                </div>
                                <div className="flex gap-2 mb-4">
                                    <button onClick={() => setShowTopUp(true)} className="flex-1 bg-gradient-to-r from-yellow-400 to-orange-500 text-gray-900 font-bold py-3 rounded-xl shadow-lg transition text-sm">üíé –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                                </div>
                                <div className="mb-4">
                                    <button onClick={() => setShowWithdrawModal(true)} className="w-full bg-gradient-to-r from-purple-500 to-indigo-600 text-white font-bold py-3 rounded-xl shadow-lg transition text-sm">üèÜ –í—ã–≤–µ—Å—Ç–∏ –ø—Ä–∏–∑—ã üèÜ</button>
                                </div>
                                <div className="glass rounded-xl p-4 mb-4">
                                    <h3 className="font-bold mb-2 text-sm">üéÅ –ü—Ä–æ–º–æ–∫–æ–¥</h3>
                                    <div className="flex gap-2">
                                        <input type="text" placeholder="–ü–†–û–ú–û–ö–û–î" value={promoCode} onChange={e => setPromoCode(e.target.value)} className="flex-1 bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-center uppercase text-sm" />
                                        <button onClick={checkPromo} className="bg-indigo-600 hover:bg-indigo-500 px-4 py-2 rounded-lg font-bold transition text-sm">OK</button>
                                    </div>
                                    {promoError && <p className="text-red-400 text-xs mt-2 text-center">{promoError}</p>}
                                    {promoSuccess && <p className="text-green-400 text-xs mt-2 text-center">{promoSuccess}</p>}
                                </div>
                                <div className="glass rounded-xl p-4">
                                    <div className="flex justify-between items-center mb-3">
                                        <h3 className="font-bold text-sm">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
                                        <span className="text-xs text-gray-400">{inventory.length}/{inventorySlots}</span>
                                    </div>
                                    <div className="grid grid-cols-5 gap-2 mb-3">
                                        {[...Array(inventorySlots)].map((_, i) => (
                                            <div key={i} className="aspect-square bg-gray-700/50 rounded-lg flex items-center justify-center text-2xl hover:bg-gray-600/50 transition cursor-pointer">
                                                {inventory[i] ? <span onClick={() => sellItem(inventory[i])} className="hover:scale-110 transition">{inventory[i].emoji}</span> : <span className="text-gray-600 text-xs">‚óã</span>}
                                            </div>
                                        ))}
                                    </div>
                                    <button onClick={unlockSlot} disabled={balance < 50} className="w-full bg-gray-700 hover:bg-gray-600 disabled:opacity-50 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition">üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç (50‚≠êÔ∏è)</button>
                                </div>
                            </div>
                        )}
                    </main>
                    
                    {selectedCase && (
                        <div className="fullscreen-modal flex items-center justify-center p-4">
                            <div className="w-full max-w-lg" ref={rouletteContainerRef}>
                                <div className="flex justify-between items-center mb-5">
                                    <h3 className="text-2xl font-bold">{selectedCase.emoji} {selectedCase.name}</h3>
                                    <button onClick={() => { setSelectedCase(null); setSpinResult(null); setFakeItems([]); }} className="text-3xl hover:text-red-400 transition">√ó</button>
                                </div>
                                <div className="roulette-container mb-5">
                                    <div className="roulette-pointer" />
                                    <div key={rouletteKey} className="roulette-inner" style={{ transform: `translateX(${rouletteOffset}px)` }}>
                                        {fakeItems.length > 0 ? fakeItems.map((item, i) => (
                                            <div key={i} className="roulette-item">
                                                <div className="emoji">{item.emoji}</div>
                                                <div className="name">{item.name}</div>
                                            </div>
                                        )) : [...Array(80)].map((_, i) => <div key={i} className="roulette-item"><div className="emoji">‚ùì</div></div>)}
                                    </div>
                                </div>
                                <div className="glass rounded-xl p-4 mb-5 max-h-40 overflow-y-auto">
                                    <p className="font-bold mb-2 text-center text-sm">–í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã:</p>
                                    <div className="space-y-1">
                                        {CASE_REWARDS[selectedCase.id]?.map((r, i) => (
                                            <div key={i} className="flex justify-between py-1 border-b border-white/10 last:border-0 text-xs">
                                                <span>{r.emoji} {r.name}</span>
                                                <span className="text-yellow-400 font-bold">{r.displayChance}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                {spinResult ? (
                                    <div className="text-center">
                                        <p className="text-xl font-bold mb-2">üéâ –í—ã–ø–∞–ª–æ: {spinResult.name}!</p>
                                        {spinResult.type === 'collectible' && <p className="text-yellow-400 text-xs mb-4">‚≠êÔ∏è –ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç!</p>}
                                        <button onClick={() => { setSpinResult(null); openCase(selectedCase.id); }} className="w-full bg-green-600 hover:bg-green-500 py-3 rounded-xl font-bold mb-2 transition">–ó–∞–±—Ä–∞—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç—å –µ—â—ë</button>
                                        <button onClick={() => { setSelectedCase(null); setSpinResult(null); setFakeItems([]); }} className="w-full bg-gray-600 hover:bg-gray-500 py-2.5 rounded-xl font-bold transition text-sm">–ö –∫–µ–π—Å–∞–º</button>
                                    </div>
                                ) : !spinResult ? (
                                    <button onClick={() => openCase(selectedCase.id)} disabled={isSpinning || (selectedCase.id === 'daily' && selectedCase.freeCount === 0)} className="w-full bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 py-4 rounded-xl font-bold text-lg disabled:opacity-50 shadow-lg transition">
                                        {isSpinning ? 'üåÄ –ö—Ä—É—Ç–∏–º...' : (selectedCase.id === 'daily' && selectedCase.freeCount === 0 ? dailyCaseTimeLeft : `–û—Ç–∫—Ä—ã—Ç—å –∑–∞ ${getCasePrice(selectedCase.id) === 0 ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : getCasePrice(selectedCase.id) + '‚≠êÔ∏è'}`)}
                                    </button>
                                ) : null}
                            </div>
                        </div>
                    )}
                    
                    {showTopUp && (
                        <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
                            <div className="glass rounded-2xl p-5 max-w-sm w-full">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-bold">üí≥ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
                                    <button onClick={() => setShowTopUp(false)} className="text-2xl hover:text-red-400 transition">√ó</button>
                                </div>
                                <p className="text-xs text-gray-400 text-center mb-3">‚≠êÔ∏è Telegram Stars</p>
                                <div className="space-y-2 mb-4">
                                    {STARS_PACKAGES.map(pkg => (
                                        <button key={pkg.stars} onClick={() => buyStars(pkg)} className="w-full glass p-3 rounded-xl flex justify-between items-center hover:bg-white/10 transition border border-white/10">
                                            <span className="font-bold text-yellow-400 text-sm">+{pkg.stars} ‚≠êÔ∏è</span>
                                            <span className="text-gray-300 text-xs">–ö—É–ø–∏—Ç—å</span>
                                        </button>
                                    ))}
                                </div>
                                <div className="border-t border-gray-600 pt-4">
                                    <p className="text-xs text-gray-400 text-center mb-3">üíé TON</p>
                                    {TON_RATES.map(rate => (
                                        <button key={rate.stars} onClick={() => topUpBalance(rate.stars, rate.ton)} className="w-full glass p-3 rounded-xl flex justify-between items-center hover:bg-white/10 transition border border-white/10 mb-2">
                                            <span className="font-bold text-sm">+{rate.stars}‚≠êÔ∏è</span>
                                            <span className="text-yellow-400 font-bold text-sm">{rate.ton} TON</span>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                    
                    <nav className="fixed bottom-0 left-0 right-0 glass border-t border-white/10 p-2 z-40">
                        <div className="max-w-md mx-auto flex justify-around">
                            {[ { id: 'tasks', emoji: 'üìã', label: '–ó–∞–¥–∞–Ω–∏—è' }, { id: 'cases', emoji: 'üéÅ', label: '–ö–µ–π—Å—ã' }, { id: 'events', emoji: 'üèõÔ∏è', label: '–ò–≤–µ–Ω—Ç—ã' }, { id: 'games', emoji: 'üéÆ', label: '–ò–≥—Ä—ã' }, { id: 'profile', emoji: 'üë§', label: '–ü—Ä–æ—Ñ–∏–ª—å' } ].map(s => (
                                <button key={s.id} onClick={() => { setCurrentScreen(s.id); if (s.id === 'events') setEventScreen('main'); }} className={`flex flex-col items-center p-2 rounded-lg transition ${currentScreen === s.id ? 'events-tab-active text-yellow-400 scale-110' : 'text-gray-400 hover:text-white'}`}>
                                    <span className="text-2xl">{s.emoji}</span>
                                    <span className="text-xs font-bold">{s.label}</span>
                                </button>
                            ))}
                        </div>
                    </nav>
                </div>
            );
        }
        
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
