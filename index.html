<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step By Step Game</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { colors: { primary: '#6366f1', secondary: '#8b5cf6', accent: '#f59e0b', ice: '#00d2ff' } } }
        }
    </script>
    <style>
        @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
        @keyframes pulseGlow { 0%,100%{box-shadow:0 0 10px rgba(0,210,255,.3)} 50%{box-shadow:0 0 30px rgba(0,210,255,.8)} }
        @keyframes goldGlow { 0%,100%{text-shadow:0 0 5px #facc15,0 0 10px #facc15} 50%{text-shadow:0 0 20px #facc15,0 0 30px #eab308} }
        @keyframes purpleGlow { 0%,100%{text-shadow:0 0 5px #a855f7,0 0 10px #a855f7} 50%{text-shadow:0 0 20px #a855f7,0 0 30px #9333ea} }
        @keyframes greenGlow { 0%,100%{box-shadow:0 0 5px #22c55e,0 0 10px #22c55e} 50%{box-shadow:0 0 15px #22c55e,0 0 25px #16a34a} }
        @keyframes yellowGlow { 0%,100%{text-shadow:0 0 5px #fbbf24,0 0 10px #fbbf24} 50%{text-shadow:0 0 20px #fbbf24,0 0 30px #f59e0b} }
        @keyframes olympGlow { 0%,100%{text-shadow:0 0 10px #fff7b0,0 0 22px #fbbf24,0 0 40px #f59e0b,0 3px 0 #000} 50%{text-shadow:0 0 20px #fff,0 0 40px #fbbf24,0 0 60px #f59e0b,0 3px 0 #000} }
        @keyframes btnGlow { 0%,100%{box-shadow:0 0 10px rgba(251,191,36,.5),0 8px 25px rgba(245,158,11,.4)} 50%{box-shadow:0 0 25px rgba(251,191,36,.9),0 8px 35px rgba(245,158,11,.7)} }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.7} }
        @keyframes neonRed { 0%,100%{text-shadow:0 0 5px #f87171,0 0 10px #ef4444} 50%{text-shadow:0 0 15px #f87171,0 0 25px #ef4444} }

        .pulse-glow { animation: pulseGlow 2s ease-in-out infinite; }
        .special-header { animation: purpleGlow 3s infinite; }
        .ordinary-header { animation: goldGlow 3s infinite; }
        .olympus-font { font-family: 'Cinzel', serif; font-weight: 700; }
        .olympus-font-black { font-family: 'Cinzel', serif; font-weight: 900; }

        .glass { background:rgba(255,255,255,.1); backdrop-filter:blur(10px); border:1px solid rgba(255,255,255,.2); }
        .fullscreen-modal { position:fixed; inset:0; background:rgba(0,0,0,.95); z-index:100; overflow-y:auto; }
        .case-cardboard { background:linear-gradient(135deg,#8B4513 0%,#D2691E 50%,#8B4513 100%); border:3px solid #A0522D; }
        .case-collector { background:linear-gradient(135deg,#DC143C 0%,#FF1493 50%,#8B008B 100%); border:3px solid #FFD700; }

        .daily-timer { color:#4ade80; font-family:monospace; font-weight:bold; font-size:14px; background:rgba(0,0,0,.6); padding:2px 8px; border-radius:6px; border:1px solid #22c55e; animation:greenGlow 2s infinite; display:inline-block; }
        .events-tab-active { background:linear-gradient(135deg,rgba(251,191,36,.3),rgba(245,158,11,.2)); border:2px solid rgba(251,191,36,.6); box-shadow:0 0 20px rgba(251,191,36,.4); }

        .roulette-container { position:relative; width:100%; height:160px; overflow:hidden; background:rgba(0,0,0,.4); border-radius:16px; border:2px solid rgba(255,255,255,.1); margin:20px 0; }
        .roulette-inner { display:flex; position:absolute; left:0; top:20px; transition:transform 6.5s cubic-bezier(.1,0,.1,1); will-change:transform; }
        .roulette-item { width:120px; height:120px; flex-shrink:0; margin:0 8px; display:flex; flex-direction:column; align-items:center; justify-content:center; background:linear-gradient(135deg,rgba(255,255,255,.1),rgba(255,255,255,.05)); border-radius:12px; border:1px solid rgba(255,255,255,.1); }
        .roulette-item .emoji { font-size:3.5rem; }
        .roulette-item .name { font-size:11px; opacity:.8; text-align:center; margin-top:4px; }
        .roulette-pointer { position:absolute; left:50%; top:0; bottom:0; width:4px; background:#ff4757; z-index:20; transform:translateX(-50%); box-shadow:0 0 20px #ff4757; }
        .roulette-pointer::before { content:''; position:absolute; top:-5px; left:50%; transform:translateX(-50%); border-left:10px solid transparent; border-right:10px solid transparent; border-top:15px solid #ff4757; }
        .roulette-pointer::after { content:''; position:absolute; bottom:-5px; left:50%; transform:translateX(-50%); border-left:10px solid transparent; border-right:10px solid transparent; border-bottom:15px solid #ff4757; }

        /* Olympus Styles */
        .olympus-title {
            font-family:'Cinzel',serif; font-weight:900;
            color:#fff7b0;
            text-shadow:0 0 12px #fff7b0,0 0 25px #fbbf24,0 0 45px #f59e0b,0 3px 0 #000;
            animation: olympGlow 3s ease-in-out infinite;
        }
        .olympus-label {
            font-family:'Cinzel',serif; font-weight:700;
            color:#ffffff;
            text-shadow:0 0 12px #fff,0 0 28px #fbbf24,0 0 45px rgba(251,191,36,.9),0 3px 0 #000;
        }
        .hephaestus-text {
            font-family:'Cinzel',serif; font-weight:700;
            color:#ffffff;
            text-shadow:0 0 12px #fff,0 0 25px #fb923c,0 0 40px rgba(249,115,22,.9),0 3px 0 #000;
        }
        .olympus-btn {
            font-family:'Cinzel',serif; font-weight:900;
            background:linear-gradient(135deg,rgba(255,214,10,.4),rgba(245,158,11,.3));
            border:2.5px solid rgba(255,237,74,1);
            border-radius:14px;
            padding:14px 22px;
            color:#fff7c2;
            text-shadow:0 0 10px #fff7c2,0 0 22px #f59e0b,0 2px 0 #000;
            cursor:pointer;
            transition:all .3s;
            backdrop-filter:blur(8px);
            box-shadow:0 8px 28px rgba(245,158,11,.5);
            animation: btnGlow 2.5s ease-in-out infinite;
            letter-spacing:.5px;
            font-size:15px;
            white-space:nowrap;
        }
        .olympus-btn:hover { background:linear-gradient(135deg,rgba(255,214,10,.6),rgba(245,158,11,.5)); transform:scale(1.06); }
        .olympus-btn:active { transform:scale(.97); }

        .progress-step { position:relative; padding:12px; border-radius:10px; border:2px solid rgba(251,191,36,.35); background:rgba(0,0,0,.5); margin-bottom:8px; transition:all .3s; }
        .progress-step.completed { border-color:#22c55e; background:rgba(34,197,94,.2); box-shadow:0 0 10px rgba(34,197,94,.4); }
        .progress-step.active { border-color:#fbbf24; background:rgba(251,191,36,.2); animation:pulse 2s infinite; }

        .round-box { width:30px; height:30px; border-radius:6px; border:2px solid rgba(255,255,255,.3); display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:bold; margin:0 3px; transition:all .3s; }
        .round-box.completed { background:linear-gradient(135deg,#22c55e,#16a34a); border-color:#22c55e; box-shadow:0 0 10px #22c55e; }
        .round-box.current { background:linear-gradient(135deg,#fbbf24,#f59e0b); border-color:#fbbf24; box-shadow:0 0 10px #fbbf24; animation:pulse 1s infinite; }

        .neon-red { animation: neonRed 2s infinite; }
        .line-thru { text-decoration:line-through; opacity:.6; color:#ef4444; text-decoration-color:#ef4444; text-decoration-thickness:2px; }

        .event-bg {
            background-image: url('event.jpg');
            background-size: cover;
            background-position: center;
            min-height: 520px;
            position: relative;
            border-radius: 16px;
            overflow: hidden;
        }
        .event-overlay {
            position: absolute; inset: 0;
            background: linear-gradient(180deg, rgba(0,0,0,.45) 0%, rgba(0,0,0,.2) 60%, rgba(0,0,0,.55) 100%);
        }
        .gefest-bg {
            background-image: url('gefest.jpg');
            background-size: cover;
            background-position: center;
        }
        .hero-bg {
            background-image: url('hero.jpg');
            background-size: cover;
            background-position: center;
        }
        .treasure-bg-wrap {
            background-size: cover;
            background-position: center;
            background-blend-mode: overlay;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 min-h-screen text-white overflow-x-hidden">
<div id="root"></div>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel">
const { useState, useEffect, useRef, useCallback } = React;

const firebaseConfig = {
    apiKey: "AIzaSyDZPRiByz69HQa8b7GFMCJeqq56J3Y-bOY",
    authDomain: "step-by-step-279df.firebaseapp.com",
    databaseURL: "https://step-by-step-279df-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "step-by-step-279df",
    storageBucket: "step-by-step-279df.firebasestorage.app",
    messagingSenderId: "302641152597",
    appId: "1:302641152597:web:6479b9ae03104666cd8adc"
};
if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const TelegramWebApp = window.Telegram?.WebApp;
const ADMIN_WALLET = 'UQAWqaIPFSg81l9MlgAx0HBE9o3gpJMhk1dnyryKJXhWNHIc';
const BOT_TOKEN = '8325421899:AAG9t3yS4WWiwasRoHb-nbr3a94S9tQfHys';

/* ‚îÄ‚îÄ‚îÄ INITIAL CASES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const INITIAL_CASES = {
    daily:     { id:'daily',     name:'–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π',  emoji:'üóìÔ∏è', price:0,   color:'from-cyan-400 to-teal-600',    locked:false, isNew:true,  freeCount:1,  type:'special', lastOpened:0 },
    collector: { id:'collector', name:'–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä',emoji:'üé©', price:650, color:'from-rose-600 to-pink-800',    locked:true,  isNew:true,  freeCount:0,  type:'special' },
    cardboard: { id:'cardboard', name:'–ö–∞—Ä—Ç–æ–Ω',       emoji:'üì¶', price:3,   color:'from-amber-800 to-amber-900',  locked:false, isNew:true,  freeCount:0 },
    coal:      { id:'coal',      name:'–£–≥–æ–ª—ë–∫',       emoji:'ü™®', price:27,  color:'from-gray-600 to-gray-800',    locked:false, isNew:false, freeCount:0 },
    platinum:  { id:'platinum',  name:'–ü–ª–∞—Ç–∏–Ω–∞',      emoji:'üíé', price:100, color:'from-gray-300 to-gray-500',    locked:false, freeCount:0 },
    gold:      { id:'gold',      name:'–ó–æ–ª–æ—Ç–æ–π',      emoji:'üëë', price:250, color:'from-yellow-400 to-yellow-600',locked:false, freeCount:0 },
    money:     { id:'money',     name:'–î–µ–Ω–µ–∂–Ω—ã–π',     emoji:'üíµ', price:350, color:'from-green-400 to-green-600',  locked:false, freeCount:0 },
    elite:     { id:'elite',     name:'–≠–ª–∏—Ç–∞',        emoji:'üéñ', price:500, color:'from-red-400 to-red-600',      locked:false, isNew:false, freeCount:0 },
    diamond:   { id:'diamond',   name:'–ê–ª–º–∞–∑',        emoji:'üíé', price:50,  color:'from-blue-400 to-blue-600',    locked:false, isNew:false, freeCount:0 },
    major:     { id:'major',     name:'–ú–∞–∂–æ—Ä',        emoji:'ü§¥', price:800, color:'from-purple-500 to-indigo-700',locked:true,  isNew:false, freeCount:0 },
    star:      { id:'star',      name:'–ó–≤–µ–∑–¥–Ω—ã–π',     emoji:'‚≠êÔ∏è', price:30,  originalPrice:30, discountPrice:23, color:'from-yellow-400 to-amber-500', locked:false, isNew:true, freeCount:0 }
};

/* ‚îÄ‚îÄ‚îÄ CASE REWARDS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const CASE_REWARDS = {
    daily: [
        { id:'stars_1',         name:'1 ‚≠êÔ∏è',          emoji:'‚≠êÔ∏è', type:'stars',          value:1,    realChance:50,  displayChance:'50%'   },
        { id:'stars_3',         name:'3 ‚≠êÔ∏è',          emoji:'‚≠êÔ∏è', type:'stars',          value:3,    realChance:35,  displayChance:'35%'   },
        { id:'stars_15',        name:'15 ‚≠êÔ∏è',         emoji:'‚≠êÔ∏è', type:'stars',          value:15,   realChance:10,  displayChance:'10%'   },
        { id:'pickaxe',         name:'–ö–∏—Ä–∫–∞ ‚õèÔ∏è',      emoji:'‚õèÔ∏è', type:'item',  sellPrice:22,       realChance:4,   displayChance:'4%'    },
        { id:'random_case_box', name:'–°–ª—É—á–∞–π–Ω—ã–π –∫–µ–π—Å', emoji:'üì¶', type:'random_case_box',            realChance:1,   displayChance:'1%'    },
    ],
    cardboard: [
        { id:'stars_025',  name:'0.25 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:0.25, realChance:80,  displayChance:'80%'  },
        { id:'stars_075',  name:'0.75 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:0.75, realChance:10,  displayChance:'10%'  },
        { id:'stars_15',   name:'1.5 ‚≠êÔ∏è',  emoji:'‚≠êÔ∏è', type:'stars', value:1.5,  realChance:6,   displayChance:'6%'   },
        { id:'stars_5',    name:'5 ‚≠êÔ∏è',    emoji:'‚≠êÔ∏è', type:'stars', value:5,    realChance:2,   displayChance:'2%'   },
        { id:'bear',       name:'üß∏',       emoji:'üß∏', type:'item',  sellPrice:20, realChance:1.5, displayChance:'1.5%' },
        { id:'diamond_pro',name:'üíé PRO',   emoji:'üíé', type:'collectible',         realChance:0.5, displayChance:'0.5%' },
    ],
    coal: [
        { id:'stars_5',    name:'5 ‚≠êÔ∏è',              emoji:'‚≠êÔ∏è', type:'stars', value:5,   realChance:60.5, displayChance:'60.5%' },
        { id:'stars_12',   name:'12 ‚≠êÔ∏è',             emoji:'‚≠êÔ∏è', type:'stars', value:12,  realChance:18,   displayChance:'18%'   },
        { id:'pickaxe',    name:'–ö–∏—Ä–∫–∞ ‚õèÔ∏è',           emoji:'‚õèÔ∏è', type:'item',  sellPrice:22, realChance:10, displayChance:'10%'  },
        { id:'stars_30',   name:'30 ‚≠êÔ∏è',             emoji:'‚≠êÔ∏è', type:'stars', value:30,  realChance:6,    displayChance:'6%'    },
        { id:'material',   name:'–ú–∞—Ç–µ—Ä–∏–∞–ª üß±',        emoji:'üß±', type:'item',  sellPrice:80, realChance:5,  displayChance:'5%'   },
        { id:'brownie_pro',name:'Happy Brownie PRO üí©',emoji:'üí©', type:'collectible',       realChance:0.5, displayChance:'0.5%' },
    ],
    platinum: [
        { id:'stars_35',  name:'35 ‚≠êÔ∏è',      emoji:'‚≠êÔ∏è', type:'stars', value:35, realChance:55, displayChance:'55%' },
        { id:'stars_50',  name:'50 ‚≠êÔ∏è',      emoji:'‚≠êÔ∏è', type:'stars', value:50, realChance:35, displayChance:'35%' },
        { id:'ring',      name:'üíç',          emoji:'üíç', type:'collectible',      realChance:5,  displayChance:'5%'  },
        { id:'bday',      name:'B-day üóì',    emoji:'üóì', type:'item', sellPrice:150, realChance:4, displayChance:'4%'},
        { id:'bday_pro',  name:'B-Day PRO üìÖ',emoji:'üìÖ', type:'collectible',      realChance:1,  displayChance:'1%'  },
    ],
    gold: [
        { id:'stars_50',    name:'50 ‚≠êÔ∏è',         emoji:'‚≠êÔ∏è', type:'stars', value:50,  realChance:50,  displayChance:'50%'  },
        { id:'stars_125',   name:'125 ‚≠êÔ∏è',        emoji:'‚≠êÔ∏è', type:'stars', value:125, realChance:35,  displayChance:'35%'  },
        { id:'clover',      name:'üçÄ Clover Pin',  emoji:'üçÄ', type:'item',  sellPrice:200, realChance:10, displayChance:'10%'},
        { id:'icecream',    name:'Ice Cream üç¶',   emoji:'üç¶', type:'collectible',         realChance:3,  displayChance:'3%'   },
        { id:'clover_pro',  name:'üçÄ Clover Pin PRO',emoji:'üçÄ',type:'collectible',        realChance:2,  displayChance:'2%'   },
    ],
    money: [
        { id:'stars_150',   name:'150 ‚≠êÔ∏è',        emoji:'‚≠êÔ∏è', type:'stars', value:150, realChance:45, displayChance:'45%' },
        { id:'stars_75',    name:'75 ‚≠êÔ∏è',         emoji:'‚≠êÔ∏è', type:'stars', value:75,  realChance:40, displayChance:'40%' },
        { id:'trophy',      name:'üèÜ',             emoji:'üèÜ', type:'collectible',       realChance:5,  displayChance:'5%'  },
        { id:'gem',         name:'üíé',             emoji:'üíé', type:'collectible',       realChance:5,  displayChance:'5%'  },
        { id:'bday_happy',  name:'Happy B-day üíà', emoji:'üíà', type:'collectible',       realChance:4,  displayChance:'4%'  },
        { id:'cigar',       name:'Snoop Cigar üö¨', emoji:'üö¨', type:'collectible',       realChance:1,  displayChance:'1%'  },
    ],
    elite: [
        { id:'stars_200',   name:'200 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:200, realChance:65,  displayChance:'65%'   },
        { id:'stars_275',   name:'275 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:275, realChance:25,  displayChance:'25%'   },
        { id:'champagne',   name:'üçæ',      emoji:'üçæ', type:'collectible',       realChance:8.5, displayChance:'8.5%'  },
        { id:'socks',       name:'–ù–æ—Å–∫–∏ üß¶',emoji:'üß¶', type:'collectible',       realChance:1,   displayChance:'1%'    },
        { id:'lightsword',  name:'Light Sword ‚öîÔ∏è',emoji:'‚öîÔ∏è',type:'collectible', realChance:0.5, displayChance:'0.5%'  },
    ],
    diamond: [
        { id:'stars_8',       name:'8 ‚≠êÔ∏è',       emoji:'‚≠êÔ∏è', type:'stars', value:8,  realChance:70, displayChance:'70%'   },
        { id:'bear',          name:'–ú–∏—à–∫–∞ üß∏',   emoji:'üß∏', type:'item',  sellPrice:20, realChance:15, displayChance:'15%'},
        { id:'stars_25',      name:'25 ‚≠êÔ∏è',      emoji:'‚≠êÔ∏è', type:'stars', value:25, realChance:9,  displayChance:'9%'    },
        { id:'stars_80',      name:'80 ‚≠êÔ∏è',      emoji:'‚≠êÔ∏è', type:'stars', value:80, realChance:4,  displayChance:'4%'    },
        { id:'diamond_pro',   name:'–ê–ª–º–∞–∑ PRO üíé',emoji:'üíé', type:'collectible',     realChance:1.2,displayChance:'0.6%'  },
        { id:'snoop_pro',     name:'Snoop Dog PRO üêï',emoji:'üêï',type:'collectible',  realChance:0.8,displayChance:'0.4%'  },
    ],
    major: [
        { id:'stars_500',   name:'500 ‚≠êÔ∏è',  emoji:'‚≠êÔ∏è', type:'stars', value:500,  realChance:50, displayChance:'50%' },
        { id:'stars_1000',  name:'1000 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:1000, realChance:25, displayChance:'25%' },
        { id:'stars_2500',  name:'2500 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:2500, realChance:10, displayChance:'10%' },
        { id:'stars_5000',  name:'5000 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:5000, realChance:5,  displayChance:'5%'  },
        { id:'car',         name:'üöó –ê–≤—Ç–æ–º–æ–±–∏–ª—å',          emoji:'üöó', type:'collectible', realChance:5, displayChance:'5%' },
        { id:'diamond_ring',name:'üíç –ë—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤–æ–µ –∫–æ–ª—å—Ü–æ',emoji:'üíç', type:'collectible', realChance:3, displayChance:'3%' },
        { id:'gold_bar',    name:'ü•á –ó–æ–ª–æ—Ç–æ–π —Å–ª–∏—Ç–æ–∫',      emoji:'ü•á', type:'collectible', realChance:2, displayChance:'2%' },
    ],
    collector: [
        { id:'bear_pro',   name:'üß∏ PRO',       emoji:'üß∏', type:'collectible', realChance:55,  displayChance:'55%'  },
        { id:'gift_pro',   name:'üéÅ PRO',       emoji:'üéÅ', type:'collectible', realChance:20,  displayChance:'20%'  },
        { id:'rocket_pro', name:'üöÄ PRO',       emoji:'üöÄ', type:'collectible', realChance:15,  displayChance:'15%'  },
        { id:'cup_pro',    name:'üèÜ PRO',       emoji:'üèÜ', type:'collectible', realChance:5,   displayChance:'5%'   },
        { id:'cake_candle',name:'üç∞ B-day Candle',emoji:'üç∞',type:'collectible', realChance:2,  displayChance:'2%'   },
        { id:'ramen_pro',  name:'üçú Ramen PRO', emoji:'üçú', type:'collectible', realChance:1.5, displayChance:'1.5%' },
        { id:'hat_pro',    name:'üé© Top hat',   emoji:'üé©', type:'collectible', realChance:1,   displayChance:'1%'   },
        { id:'bird_pro',   name:'ü¶Ö Rare bird', emoji:'ü¶Ö', type:'collectible', realChance:0.5, displayChance:'0.5%' },
    ],
    star: [
        {id:'stars_1',  name:'1 ‚≠êÔ∏è',  emoji:'‚≠êÔ∏è', type:'stars', value:1,  realChance:10.50, displayChance:'10.50%'},
        {id:'stars_2',  name:'2 ‚≠êÔ∏è',  emoji:'‚≠êÔ∏è', type:'stars', value:2,  realChance:8.00,  displayChance:'8.00%' },
        {id:'stars_3',  name:'3 ‚≠êÔ∏è',  emoji:'‚≠êÔ∏è', type:'stars', value:3,  realChance:6.50,  displayChance:'6.50%' },
        {id:'stars_4',  name:'4 ‚≠êÔ∏è',  emoji:'‚≠êÔ∏è', type:'stars', value:4,  realChance:5.20,  displayChance:'5.20%' },
        {id:'stars_5',  name:'5 ‚≠êÔ∏è',  emoji:'‚≠êÔ∏è', type:'stars', value:5,  realChance:4.30,  displayChance:'4.30%' },
        {id:'stars_6',  name:'6 ‚≠êÔ∏è',  emoji:'‚≠êÔ∏è', type:'stars', value:6,  realChance:3.70,  displayChance:'3.70%' },
        {id:'stars_7',  name:'7 ‚≠êÔ∏è',  emoji:'‚≠êÔ∏è', type:'stars', value:7,  realChance:3.20,  displayChance:'3.20%' },
        {id:'stars_8',  name:'8 ‚≠êÔ∏è',  emoji:'‚≠êÔ∏è', type:'stars', value:8,  realChance:2.80,  displayChance:'2.80%' },
        {id:'stars_9',  name:'9 ‚≠êÔ∏è',  emoji:'‚≠êÔ∏è', type:'stars', value:9,  realChance:2.50,  displayChance:'2.50%' },
        {id:'stars_10', name:'10 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:10, realChance:2.20,  displayChance:'2.20%' },
        {id:'stars_15', name:'15 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:15, realChance:1.50,  displayChance:'1.50%' },
        {id:'stars_20', name:'20 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:20, realChance:1.10,  displayChance:'1.10%' },
        {id:'stars_25', name:'25 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:25, realChance:0.84,  displayChance:'0.84%' },
        {id:'stars_30', name:'30 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:30, realChance:0.68,  displayChance:'0.68%' },
        {id:'stars_35', name:'35 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:35, realChance:0.58,  displayChance:'0.58%' },
        {id:'stars_40', name:'40 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:40, realChance:0.52,  displayChance:'0.52%' },
        {id:'stars_50', name:'50 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:50, realChance:0.42,  displayChance:'0.42%' },
        {id:'stars_60', name:'60 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:60, realChance:0.36,  displayChance:'0.36%' },
        {id:'stars_75', name:'75 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:75, realChance:0.21,  displayChance:'0.21%' },
        {id:'stars_95', name:'95 ‚≠êÔ∏è', emoji:'‚≠êÔ∏è', type:'stars', value:95, realChance:0.01,  displayChance:'0.01%' },
        {id:'stars_125',name:'125 ‚≠êÔ∏è',emoji:'‚≠êÔ∏è', type:'stars', value:125,realChance:0.005, displayChance:'0.005%'},
    ],
    olympus: [
        { id:'persephone', name:'–ü–µ—Ä—Å–µ—Ñ–æ–Ω–∞üå∫',  emoji:'üå∫', type:'olympus_item',           sellPrice:20, realChance:40,  displayChance:'40%'   },
        { id:'ares',       name:'–ê—Ä–µ—Åüó°Ô∏è',       emoji:'üó°Ô∏è', type:'olympus_item',           sellPrice:28, realChance:20,  displayChance:'20%'   },
        { id:'hermes',     name:'–ì–µ—Ä–º–µ—Åüìà',      emoji:'üìà', type:'olympus_slot',                         realChance:15,  displayChance:'15%'   },
        { id:'dionysus',   name:'–î–∏–æ–Ω–∏—Åüç∑',      emoji:'üç∑', type:'olympus_exchange_stars', value:80,     realChance:10,  displayChance:'10%'   },
        { id:'apollo',     name:'–ê–ø–æ–ª–ª–æ–Ω‚òÄÔ∏è',    emoji:'‚òÄÔ∏è', type:'olympus_star_cases',     count:5,      realChance:8,   displayChance:'8%'    },
        { id:'poseidon',   name:'–ü–æ—Å–µ–π–¥–æ–Ωüî±',    emoji:'üî±', type:'olympus_choice',                       realChance:5,   displayChance:'5%'    },
        { id:'hades',      name:'–ê–∏–¥üî•',         emoji:'üî•', type:'olympus_hades_choice',                 realChance:1.9, displayChance:'1.9%'  },
        { id:'zeus',       name:'–ó–µ–≤—Å‚ö°Ô∏è',       emoji:'‚ö°Ô∏è', type:'olympus_zeus',                         realChance:0.1, displayChance:'0.1%'  },
    ],
};

/* ‚îÄ‚îÄ‚îÄ OLYMPUS PROGRESS LADDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const OLYMPUS_PROGRESS = [
    { opens:3,   reward:{ type:'star_cases', count:3 },                          name:'3 –∫–µ–π—Å–∞ ¬´–ó–≤–µ–∑–¥–Ω—ã–π‚≠êÔ∏è¬ª'                  },
    { opens:7,   reward:{ type:'case', caseId:'gold',   count:1 },               name:'1 –∫–µ–π—Å ¬´–ó–æ–ª–æ—Ç–æ–πüëë¬ª'                    },
    { opens:15,  reward:{ type:'case', caseId:'elite',  count:1 },               name:'1 –∫–µ–π—Å ¬´–≠–ª–∏—Ç–∞üéñÔ∏è¬ª'                     },
    { opens:20,  reward:{ type:'stars', value:150 },                              name:'150‚≠êÔ∏è'                                  },
    { opens:25,  reward:{ type:'case', caseId:'money',  count:3 },               name:'3 –∫–µ–π—Å–∞ ¬´–î–µ–Ω–µ–∂–Ω—ã–πüíµ¬ª'                  },
    { opens:30,  reward:{ type:'special_item', item:'hades_gift' },               name:'–ü–æ–¥–∞—Ä–æ–∫ –ê–∏–¥üî•'                          },
    { opens:50,  reward:{ type:'special_item', item:'zeus_gift' },                name:'–ü–æ–¥–∞—Ä–æ–∫ –ó–µ–≤—Å‚ö°Ô∏è'                        },
    { opens:150, reward:{ type:'mega', starCases:25, stars:1000 },                name:'25 –∫–µ–π—Å–æ–≤ ¬´–ó–≤–µ–∑–¥–Ω—ã–π‚≠êÔ∏è¬ª + 1000‚≠êÔ∏è'     },
];

/* ‚îÄ‚îÄ‚îÄ GEFEST EXCHANGES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const GEFEST_EXCHANGES = {
    gold_ball:       { name:'‚öΩÔ∏è –ó–æ–ª–æ—Ç–æ–π –º—è—á',            reward:{ type:'case', caseId:'coal',  count:1 },    rewardText:'1 –∫–µ–π—Å ¬´–£–≥–æ–ª–µ–∫¬ª'                              },
    mikhaylov_ball:  { name:'üèê –ú—è—á –ú–∞–∫—Å–∏–º–∞ –ú–∏—Ö–∞–π–ª–æ–≤–∞',   reward:{ type:'case', caseId:'star',  count:1 },    rewardText:'1 –∫–µ–π—Å ¬´–ó–≤–µ–∑–¥–Ω—ã–π‚≠êÔ∏è¬ª'                         },
    tyson_gloves:    { name:'ü•ä –ü–µ—Ä—á–∞—Ç–∫–∏ –ú–∞–π–∫–∞ –¢–∞–π—Å–æ–Ω–∞',  reward:{ type:'slot' },                              rewardText:'+1 —Å–ª–æ—Ç'                                      },
    steak:           { name:'ü•© –°—Ç–µ–π–∫',                   reward:{ type:'stars', value:100 },                  rewardText:'100‚≠êÔ∏è'                                        },
    simba:           { name:'ü¶Å –°–∏–º–±–∞',                   reward:{ type:'case', caseId:'gold',  count:2 },    rewardText:'2 –∫–µ–π—Å–∞ ¬´–ó–æ–ª–æ—Ç–æ–πüëë¬ª'                          },
    wolf_wallstreet: { name:'üê∫ –í–æ–ª–∫ —Å –£–æ–ª–ª-—Å—Ç—Ä–∏—Ç',      reward:{ type:'collector_unlock' },                  rewardText:'–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ + 2 –∫–µ–π—Å–∞ ¬´–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Äüé©¬ª'    },
    ice:             { name:'üßä',                          reward:{ type:'choice', option1:{ type:'case', caseId:'star', count:25 }, option2:{ type:'stars', value:500 } }, rewardText:'25 –∫–µ–π—Å–æ–≤ ¬´–ó–≤–µ–∑–¥–Ω—ã–π‚≠êÔ∏è¬ª –∏–ª–∏ 500‚≠êÔ∏è' },
    diamond_pro:     { name:'üíé –ê–ª–º–∞–∑ PRO',               reward:{ type:'stars', value:125 },                  rewardText:'125‚≠êÔ∏è'                                        },
    material:        { name:'üß± –ú–∞—Ç–µ—Ä–∏–∞–ª',                reward:{ type:'stars', value:130 },                  rewardText:'130‚≠êÔ∏è', highlight:true                        },
};

/* ‚îÄ‚îÄ‚îÄ GERAKL CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const GERAKL_10_REWARDS = [
    { id:'bear',      name:'üß∏ –ú–∏—à–∫–∞',   chance:35, type:'item',        sellPrice:20, emoji:'üß∏' },
    { id:'bear_pro',  name:'üß∏ PRO',     chance:20, type:'collectible',               emoji:'üß∏' },
    { id:'material',  name:'üß± –ú–∞—Ç–µ—Ä–∏–∞–ª',chance:15, type:'item',        sellPrice:80, emoji:'üß±' },
    { id:'champagne', name:'üçæ –ë—É—Ç—ã–ª–∫–∞', chance:10, type:'collectible',               emoji:'üçæ' },
    { id:'ring',      name:'üíç –ö–æ–ª—å—Ü–æ',  chance:8,  type:'collectible',               emoji:'üíç' },
    { id:'stars_25',  name:'25 ‚≠êÔ∏è',     chance:5,  type:'stars',       value:25,     emoji:'‚≠êÔ∏è' },
    { id:'stars_200', name:'200 ‚≠êÔ∏è',    chance:3,  type:'stars',       value:200,    emoji:'‚≠êÔ∏è' },
    { id:'stars_350', name:'350 ‚≠êÔ∏è',    chance:2,  type:'stars',       value:350,    emoji:'‚≠êÔ∏è' },
    { id:'dellko',    name:'üîë DELLKO',  chance:2,  type:'promo',       code:'DELLKO',emoji:'üîë' },
];
const GERAKL_MULTIPLIERS  = [1.0, 1.1, 1.4, 1.9, 2.3, 2.6, 3.8, 4.5, 5.5, 6.0, 10.0];
const GERAKL_ICE_CHANCES  = [0.15,0.18,0.18,0.20,0.30,0.35,0.45,0.45,0.45,0.50,0.53];

const TON_RATES      = [{stars:50,ton:.6},{stars:250,ton:3},{stars:500,ton:6},{stars:1000,ton:12}];
const STARS_PACKAGES = [{stars:50,price:50},{stars:100,price:100},{stars:250,price:250},{stars:500,price:500},{stars:1000,price:1000}];

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   APP
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function App() {
    /* ‚îÄ‚îÄ base state ‚îÄ‚îÄ */
    const [currentScreen, setCurrentScreen] = useState('cases');
    const [balance,        setBalance]        = useState(0);
    const [cases,          setCases]          = useState(INITIAL_CASES);
    const [inventory,      setInventory]      = useState([]);
    const [inventorySlots, setInventorySlots] = useState(5);
    const [tasks, setTasks] = useState({
        subscribe:    { completed:false },
        deposit:      { completed:false },
        depositMajor: { completed:false },
        inviteThree:  { completed:false, count:0, required:3, reward:25 },
        cardboard7:   { completed:false, count:0, required:7 },
        deposit50:    { completed:false },
    });
    const [user,         setUser]         = useState(null);
    const [isLoading,    setIsLoading]    = useState(true);
    const [dailyCaseTimeLeft, setDailyCaseTimeLeft] = useState('');
    const [onlineCount,  setOnlineCount]  = useState(Math.floor(Math.random()*300)+200);
    const [paymentStatus,setPaymentStatus]= useState('');
    const [totalDeposits,setTotalDeposits]= useState(0);
    const [freeEliteSpin,setFreeEliteSpin]= useState(0);
    const [usedPromos,   setUsedPromos]   = useState([]);
    const [wonPromos,    setWonPromos]    = useState([]);
    const [promoCode,    setPromoCode]    = useState('');
    const [promoError,   setPromoError]   = useState('');
    const [promoSuccess, setPromoSuccess] = useState('');

    /* ‚îÄ‚îÄ roulette / case open ‚îÄ‚îÄ */
    const [selectedCase,   setSelectedCase]   = useState(null);
    const [isSpinning,     setIsSpinning]      = useState(false);
    const [spinResult,     setSpinResult]      = useState(null);
    const [rouletteOffset, setRouletteOffset]  = useState(0);
    const [fakeItems,      setFakeItems]        = useState([]);
    const [rouletteKey,    setRouletteKey]      = useState(0);
    const rouletteContainerRef = useRef(null);

    /* ‚îÄ‚îÄ modals ‚îÄ‚îÄ */
    const [showTopUp,             setShowTopUp]             = useState(false);
    const [showWithdrawModal,     setShowWithdrawModal]     = useState(false);
    const [withdrawAmount,        setWithdrawAmount]        = useState('');
    const [showAdminLogin,        setShowAdminLogin]        = useState(false);
    const [adminLogin,            setAdminLogin]            = useState('');
    const [adminPassword,         setAdminPassword]         = useState('');
    const [isAdmin,               setIsAdmin]               = useState(false);
    const [adminScreen,           setAdminScreen]           = useState('stats');
    const [allUsers,              setAllUsers]              = useState([]);
    const [selectedUser,          setSelectedUser]          = useState(null);
    const [adminUserSearch,       setAdminUserSearch]       = useState('');
    const [adminAttempts,         setAdminAttempts]         = useState(0);
    const [showCollectibleModal,  setShowCollectibleModal]  = useState(false);
    const [selectedCollectible,   setSelectedCollectible]   = useState(null);
    const [showRandomCaseModal,   setShowRandomCaseModal]   = useState(false);
    const [randomCaseItem,        setRandomCaseItem]        = useState(null);

    /* ‚îÄ‚îÄ olympus item result modal ‚îÄ‚îÄ */
    const [showOlympusItemModal,  setShowOlympusItemModal]  = useState(false);
    const [selectedOlympusItem,   setSelectedOlympusItem]   = useState(null);

    /* ‚îÄ‚îÄ poseidon / hades / zeus choice modals ‚îÄ‚îÄ */
    const [showPoseidonModal, setShowPoseidonModal] = useState(false);
    const [showHadesModal,    setShowHadesModal]    = useState(false);
    const [showZeusModal,     setShowZeusModal]     = useState(false);

    /* ‚îÄ‚îÄ gefest ‚îÄ‚îÄ */
    const [showGefestModal,   setShowGefestModal]   = useState(false);
    const [gefestCooldownEnd, setGefestCooldownEnd] = useState(0);
    const [gefestCooldownStr, setGefestCooldownStr] = useState('');
    const [showGefestChoice,  setShowGefestChoice]  = useState(false);
    const [gefestChoiceCtx,   setGefestChoiceCtx]   = useState(null);

    /* ‚îÄ‚îÄ events ‚îÄ‚îÄ */
    const [eventScreen,      setEventScreen]      = useState('main');
    const [olympusOpens,     setOlympusOpens]     = useState(0);
    const [olympusProgress,  setOlympusProgress]  = useState([]);
    const [olympusTopPlayers,setOlympusTopPlayers]= useState([]);
    const [treasureBg,       setTreasureBg]       = useState(localStorage.getItem('olymp_bg') || 'case.jpg');

    /* ‚îÄ‚îÄ gerakl ‚îÄ‚îÄ */
    const [currentGame,       setCurrentGame]       = useState(null);
    const [geraklGameActive,  setGeraklGameActive]  = useState(false);
    const [geraklBetAmount,   setGeraklBetAmount]   = useState(25);
    const [geraklBetInput,    setGeraklBetInput]    = useState(25);
    const [geraklRound,       setGeraklRound]       = useState(0);
    const [geraklMultiplier,  setGeraklMultiplier]  = useState(1.0);
    const [geraklCurrentWin,  setGeraklCurrentWin]  = useState(0);
    const [geraklTimer,       setGeraklTimer]       = useState(25);
    const [geraklResult,      setGeraklResult]      = useState(null);
    const [geraklBoxOpened,   setGeraklBoxOpened]   = useState(false);
    const [geraklBoxPrize,    setGeraklBoxPrize]    = useState(null);

    /* ‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê */
    useEffect(() => {
        const init = async () => {
            let userId = null;
            let userData = { name:'–ì–æ—Å—Ç—å', username:null, avatar:null };
            if (TelegramWebApp) {
                TelegramWebApp.ready(); TelegramWebApp.expand();
                const tg = TelegramWebApp.initDataUnsafe?.user;
                if (tg) {
                    userId = tg.id.toString();
                    userData = { name: tg.first_name + (tg.last_name ? ' '+tg.last_name : ''), username: tg.username ? '@'+tg.username : null, avatar: tg.photo_url || null };
                }
            }
            if (!userId) { userId = localStorage.getItem('sbs_user_id') || ('guest_'+Date.now()); }
            localStorage.setItem('sbs_user_id', userId);

            try {
                const snap = await db.ref('users/'+userId).once('value');
                const data = snap.val();
                if (data) {
                    const stored = data.cases || {};
                    const merged = {};
                    for (const cid in INITIAL_CASES) {
                        merged[cid] = { ...INITIAL_CASES[cid] };
                        const s = stored[cid];
                        if (s) {
                            merged[cid].freeCount = s.freeCount || 0;
                            if (s.locked !== undefined) merged[cid].locked = s.locked;
                            if (cid === 'daily' && s.lastOpened) merged[cid].lastOpened = s.lastOpened;
                        }
                    }
                    // ensure olympus case
                    if (!merged.olympus) {
                        merged.olympus = { id:'olympus', name:'–û–ª–∏–º–ø‚ö°Ô∏è', emoji:'‚ö°Ô∏è', price:77, color:'from-yellow-400 to-amber-600', locked:false, freeCount:2, type:'event' };
                    } else {
                        merged.olympus = stored.olympus || { id:'olympus', name:'–û–ª–∏–º–ø‚ö°Ô∏è', emoji:'‚ö°Ô∏è', price:77, color:'from-yellow-400 to-amber-600', locked:false, freeCount:2, type:'event' };
                        if ((merged.olympus.everGiven !== true) && (merged.olympus.freeCount || 0) < 2) {
                            merged.olympus.freeCount = 2;
                        }
                    }

                    setUser({ id:userId, ...userData, ...data });
                    setBalance(data.balance || 0);
                    setCases(merged);
                    setInventory(data.inventory || []);
                    const savedTasks = data.tasks || {};
                    setTasks({
                        subscribe:    savedTasks.subscribe    || { completed:false },
                        deposit:      savedTasks.deposit      || { completed:false },
                        depositMajor: savedTasks.depositMajor || { completed:false },
                        inviteThree:  savedTasks.inviteThree  || { completed:false, count:0, required:3, reward:25 },
                        cardboard7:   savedTasks.cardboard7   || { completed:false, count:0, required:7 },
                        deposit50:    savedTasks.deposit50    || { completed:false },
                    });
                    setInventorySlots(data.inventorySlots || 5);
                    setUsedPromos(data.usedPromos || []);
                    setWonPromos(data.wonPromos || []);
                    setTotalDeposits(data.totalDeposits || 0);
                    setFreeEliteSpin(data.freeEliteSpin || 0);
                    setOlympusOpens(data.olympusOpens || 0);
                    setOlympusProgress(data.olympusProgress || []);
                    setGefestCooldownEnd(data.gefestCooldownEnd || 0);
                    await db.ref('users/'+userId).update({ name:userData.name, username:userData.username||'', cases: merged });
                } else {
                    const olympCase = { id:'olympus', name:'–û–ª–∏–º–ø‚ö°Ô∏è', emoji:'‚ö°Ô∏è', price:77, color:'from-yellow-400 to-amber-600', locked:false, freeCount:2, everGiven:true, type:'event' };
                    const newCases = { ...INITIAL_CASES, daily:{ ...INITIAL_CASES.daily, freeCount:1, lastOpened:0 }, diamond:{ ...INITIAL_CASES.diamond, freeCount:5 }, olympus: olympCase };
                    const newUser = { balance:0, cases:newCases, inventory:[], tasks:{ subscribe:{completed:false}, deposit:{completed:false}, depositMajor:{completed:false}, inviteThree:{completed:false,count:0,required:3,reward:25}, cardboard7:{completed:false,count:0,required:7}, deposit50:{completed:false} }, inventorySlots:5, usedPromos:[], wonPromos:[], createdAt:Date.now(), lastActive:Date.now(), totalDeposits:0, freeEliteSpin:0, olympusOpens:0, olympusProgress:[], gefestCooldownEnd:0, name:userData.name, username:userData.username||'' };
                    setCases(newCases);
                    setUser({ id:userId, ...userData });
                    await db.ref('users/'+userId).set(newUser);
                }
            } catch(e) { console.error(e); }
            setIsLoading(false);
        };
        init();
    }, []);

    /* ‚îÄ‚îÄ online ‚îÄ‚îÄ */
    useEffect(() => {
        if (!user?.id) return;
        const ref = db.ref('online/'+user.id);
        ref.set({ name:user.name, timestamp:Date.now() });
        ref.onDisconnect().remove();
        db.ref('online').on('value', snap => setOnlineCount(Math.floor(Math.random()*300)+200+snap.numChildren()));
        return () => ref.remove();
    }, [user?.id]);

    /* ‚îÄ‚îÄ autosave ‚îÄ‚îÄ */
    useEffect(() => {
        if (!user?.id || isLoading) return;
        const iv = setInterval(() => {
            db.ref('users/'+user.id).update({ balance, inventory, tasks, inventorySlots, usedPromos, wonPromos, lastActive:Date.now(), totalDeposits, freeEliteSpin, olympusOpens, olympusProgress, gefestCooldownEnd, 'cases/daily/lastOpened': cases.daily?.lastOpened, 'cases/daily/freeCount': cases.daily?.freeCount, 'cases/olympus/freeCount': cases.olympus?.freeCount||0, 'cases/olympus/everGiven': true });
        }, 5000);
        return () => clearInterval(iv);
    }, [balance, cases, inventory, tasks, inventorySlots, usedPromos, wonPromos, user?.id, isLoading, totalDeposits, freeEliteSpin, olympusOpens, olympusProgress, gefestCooldownEnd]);

    /* ‚îÄ‚îÄ daily timer ‚îÄ‚îÄ */
    useEffect(() => {
        if (isLoading || !cases.daily) return;
        const COOLDOWN = 23*60*60*1000;
        const timer = setInterval(() => {
            const last = cases.daily.lastOpened || 0;
            const diff = COOLDOWN - (Date.now()-last);
            if (diff <= 0) {
                if (cases.daily.freeCount === 0) setCases(p => ({ ...p, daily:{ ...p.daily, freeCount:1 } }));
                setDailyCaseTimeLeft('–î–æ—Å—Ç—É–ø–Ω–æ!');
            } else {
                const h = Math.floor(diff/(1000*60*60)), m = Math.floor((diff%(1000*60*60))/(1000*60)), s = Math.floor((diff%(1000*60))/1000);
                setDailyCaseTimeLeft(`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`);
            }
        }, 1000);
        return () => clearInterval(timer);
    }, [cases.daily, isLoading]);

    /* ‚îÄ‚îÄ gefest cooldown timer ‚îÄ‚îÄ */
    useEffect(() => {
        const t = setInterval(() => {
            const remaining = gefestCooldownEnd - Date.now();
            if (remaining > 0) {
                const m = Math.floor(remaining/60000), s = Math.floor((remaining%60000)/1000);
                setGefestCooldownStr(`${m}:${String(s).padStart(2,'0')}`);
            } else {
                setGefestCooldownStr('');
            }
        }, 1000);
        return () => clearInterval(t);
    }, [gefestCooldownEnd]);

    /* ‚îÄ‚îÄ gerakl timer ‚îÄ‚îÄ */
    useEffect(() => {
        if (!geraklGameActive || geraklResult) return;
        const iv = setInterval(() => {
            setGeraklTimer(prev => { if (prev <= 1) { handleGeraklIce(); return 0; } return prev-1; });
        }, 1000);
        return () => clearInterval(iv);
    }, [geraklGameActive, geraklResult]);

    /* ‚îÄ‚îÄ olympus top players ‚îÄ‚îÄ */
    useEffect(() => {
        if (eventScreen !== 'heroes') return;
        const ref = db.ref('users');
        ref.on('value', snap => {
            const arr = [];
            snap.forEach(c => {
                const d = c.val() || {};
                if ((d.olympusOpens||0) > 0) arr.push({ id:c.key, name:d.name||'–ò–≥—Ä–æ–∫', avatar:d.avatar||null, olympusOpens:d.olympusOpens||0 });
            });
            arr.sort((a,b) => b.olympusOpens - a.olympusOpens);
            setOlympusTopPlayers(arr.slice(0,5));
        });
        return () => ref.off();
    }, [eventScreen]);

    /* ‚ïê‚ïê‚ïê‚ïê HELPERS ‚ïê‚ïê‚ïê‚ïê */
    const addToInventory = async (item) => {
        if (inventory.length >= inventorySlots) { alert('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø–æ–ª–æ–Ω!'); return false; }
        const ni = [...inventory, { ...item, uniqueId:Date.now(), collected:Date.now() }];
        setInventory(ni);
        await db.ref(`users/${user.id}/inventory`).set(ni);
        return true;
    };

    const getCasePrice = (ct) => {
        const c = cases[ct]; if (!c) return 0;
        if (c.id === 'daily' && c.freeCount > 0) return 0;
        if (c.freeCount > 0) return 0;
        if (c.discountPrice && c.discountPrice !== c.price) return c.discountPrice;
        return c.price;
    };

    /* ‚ïê‚ïê‚ïê‚ïê PROMO ‚ïê‚ïê‚ïê‚ïê */
    const checkPromo = async () => {
        const code = promoCode.toUpperCase().trim();
        setPromoError(''); setPromoSuccess('');
        if (!code) return;
        if (usedPromos.includes(code)) { setPromoError('–£–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!'); return; }
        if (code === 'DELLKO') {
            if (!wonPromos.includes('DELLKO')) { setPromoError('–¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–∏–≥—Ä–∞–ª–∏ –≤ 13 –ü–æ–¥–≤–∏–≥–µ –ì–µ—Ä–∞–∫–ª–∞!'); return; }
            const nc = { ...cases, money:{ ...cases.money, freeCount:(cases.money.freeCount||0)+3 } };
            setCases(nc); await addToInventory({ name:'üßä –õ—ë–¥ (1/3)', emoji:'üßä', type:'ice', part:1 });
            setPromoSuccess('+3 –¥–µ–Ω–µ–∂–Ω—ã—Ö –∫–µ–π—Å–∞ + üßä!');
            const np = [...usedPromos, code]; setUsedPromos(np); setPromoCode('');
            await db.ref(`users/${user.id}/usedPromos`).set(np);
        } else if (code === 'DIAMOND') {
            const nc = { ...cases, diamond:{ ...cases.diamond, freeCount:(cases.diamond.freeCount||0)+2 } };
            setCases(nc); setPromoSuccess('+2 –∫–µ–π—Å–∞ –ê–ª–º–∞–∑!');
            const np = [...usedPromos, code]; setUsedPromos(np); setPromoCode('');
            await db.ref(`users/${user.id}/usedPromos`).set(np);
        } else if (code === 'OLIMP') {
            const nb = balance+130; setBalance(nb); setPromoSuccess('‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–æ 130‚≠êÔ∏è!');
            const np = [...usedPromos, code]; setUsedPromos(np); setPromoCode('');
            await db.ref(`users/${user.id}`).update({ balance:nb, usedPromos:np });
        } else {
            setPromoError('–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥');
        }
    };

    /* ‚ïê‚ïê‚ïê‚ïê PAYMENT ‚ïê‚ïê‚ïê‚ïê */
    const topUpBalance = async (stars, ton) => {
        const memo = `SBS_${user.id}_${stars}_PAY_${Date.now()}`;
        const link = `ton://transfer/${ADMIN_WALLET}?amount=${Math.round(ton*1e9)}&text=${encodeURIComponent(memo)}`;
        window.open(link,'_blank');
        setPaymentStatus(`–û—Ç–ø—Ä–∞–≤—å—Ç–µ ${ton} TON —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º: ${memo}`);
        setShowTopUp(false);
    };
    const buyStars = async (pkg) => {
        try {
            const r = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/createInvoiceLink`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({ title:`${pkg.stars} –∑–≤—ë–∑–¥`, description:`–ü–æ–∫—É–ø–∫–∞ ${pkg.stars} –∑–≤—ë–∑–¥`, payload:`stars_${user.id}_${pkg.stars}_${Date.now()}`, currency:'XTR', prices:[{ label:`${pkg.stars} –∑–≤—ë–∑–¥`, amount:pkg.price }] }) });
            const data = await r.json();
            if (data.ok && data.result) {
                if (TelegramWebApp) {
                    TelegramWebApp.openInvoice(data.result, async (status) => {
                        if (status === 'paid') {
                            const nb = balance+pkg.stars, nd = totalDeposits+pkg.stars;
                            setBalance(nb); setTotalDeposits(nd);
                            await db.ref(`users/${user.id}`).update({ balance:nb, totalDeposits:nd });
                            checkDepositTasks(nd, pkg.stars);
                            alert(`‚úÖ –ó–∞—á–∏—Å–ª–µ–Ω–æ ${pkg.stars} –∑–≤—ë–∑–¥!`);
                        }
                    });
                } else { window.open(data.result,'_blank'); }
            }
        } catch(e) { alert('–û—à–∏–±–∫–∞ –ø–ª–∞—Ç–µ–∂–∞.'); }
    };
    const checkDepositTasks = async (nd, depositAmount) => {
        if (!tasks.deposit?.completed && nd >= 100) {
            const nt = { ...tasks, deposit:{ completed:true } };
            const nc = { ...cases, gold:{ ...cases.gold, freeCount:(cases.gold.freeCount||0)+1 } };
            setTasks(nt); setCases(nc);
            await db.ref(`users/${user.id}`).update({ tasks:nt, cases:nc });
        }
        if (!tasks.depositMajor?.completed && nd >= 350) {
            const nt = { ...tasks, depositMajor:{ completed:true } };
            const nc = { ...cases, collector:{ ...cases.collector, locked:false, freeCount:(cases.collector.freeCount||0)+1 } };
            setTasks(nt); setCases(nc);
            await db.ref(`users/${user.id}`).update({ tasks:nt, cases:nc });
        }
        if (!tasks.deposit50?.completed && depositAmount >= 50) {
            const nt = { ...tasks, deposit50:{ completed:true } };
            const nb = balance+50;
            setTasks(nt); setBalance(nb);
            await db.ref(`users/${user.id}`).update({ tasks:nt, balance:nb });
            alert('‚úÖ –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! –ü–æ–ª—É—á–µ–Ω–æ 50‚≠êÔ∏è');
        }
    };

    /* ‚ïê‚ïê‚ïê‚ïê TASKS ‚ïê‚ïê‚ïê‚ïê */
    const completeTask = (tid) => {
        if (tid === 'subscribe') {
            window.open('https://t.me/stepbystepdelision','_blank');
            setTimeout(async () => {
                if (!tasks.subscribe?.completed) {
                    const nt = { ...tasks, subscribe:{ completed:true } };
                    const nc = { ...cases, elite:{ ...cases.elite, freeCount:(cases.elite.freeCount||0)+1 } };
                    setTasks(nt); setCases(nc);
                    await db.ref(`users/${user.id}`).update({ tasks:nt, cases:nc });
                    alert('üéâ –ü–æ–ª—É—á–µ–Ω 1 –∫–µ–π—Å ¬´–≠–ª–∏—Ç–∞¬ª!');
                }
            }, 2000);
        } else if (tid === 'inviteThree') {
            window.open('https://t.me/share/url?url='+encodeURIComponent(`https://t.me/stepbystep_game_bot?start=${user.id}`),'_blank');
        } else {
            setShowTopUp(true);
        }
    };

    /* ‚ïê‚ïê‚ïê‚ïê ADMIN ‚ïê‚ïê‚ïê‚ïê */
    const handleTitleClick = () => {
        setAdminAttempts(prev => {
            const next = prev+1;
            if (next >= 12) { setShowAdminLogin(true); return 0; }
            return next;
        });
    };
    const checkAdminLogin = () => {
        if (adminLogin === '*^BAGUETTE_642819_6281' && adminPassword === '3628874910ZTWMI') {
            setIsAdmin(true); setShowAdminLogin(false);
            db.ref('users').once('value').then(snap => { const u=[]; snap.forEach(c=>u.push({id:c.key,...c.val()})); setAllUsers(u); });
        } else { alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!'); }
    };
    const adminGiveReward = async (uid, r) => {
        const snap = await db.ref('users/'+uid).once('value');
        const ud = snap.val() || {};
        if (r.type==='stars') {
            const nb=(ud.balance||0)+r.amount; await db.ref('users/'+uid+'/balance').set(nb);
            if (uid===user.id) setBalance(nb);
        } else if (r.type==='case') {
            const cur=ud.cases?.[r.caseType]?.freeCount||0; await db.ref(`users/${uid}/cases/${r.caseType}/freeCount`).set(cur+r.count);
            if (uid===user.id) setCases(p=>({...p,[r.caseType]:{...p[r.caseType],freeCount:cur+r.count}}));
        } else if (r.type==='unlock_collector') {
            await db.ref(`users/${uid}/cases/collector/locked`).set(false);
            if (uid===user.id) setCases(p=>({...p,collector:{...p.collector,locked:false}}));
        } else if (r.type==='reset_daily') {
            await db.ref(`users/${uid}/cases/daily`).update({freeCount:1,lastOpened:0});
            if (uid===user.id) setCases(p=>({...p,daily:{...p.daily,freeCount:1,lastOpened:0}}));
        } else if (r.type==='item' && r.item) {
            const cur=ud.inventory||[]; const ni=[...cur,{...r.item,uniqueId:Date.now(),collected:Date.now()}];
            await db.ref(`users/${uid}/inventory`).set(ni);
            if (uid===user.id) setInventory(ni);
        }
        alert('–ù–∞–≥—Ä–∞–¥–∞ –≤—ã–¥–∞–Ω–∞!');
    };

    /* ‚ïê‚ïê‚ïê‚ïê CASE OPEN ‚ïê‚ïê‚ïê‚ïê */
    const handleSelectCase = (caseData) => { setSpinResult(null); setFakeItems([]); setSelectedCase(caseData); };

    const openCase = async (caseType) => {
        const cData = cases[caseType];
        if (!cData) return;
        if (cData.id==='daily' && cData.freeCount===0) { alert('–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∫–µ–π—Å –Ω–µ –≥–æ—Ç–æ–≤!'); return; }
        const price = getCasePrice(caseType);
        const isFree = cData.freeCount > 0;
        if (!isFree && balance < price) { alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥!'); return; }
        let nb = balance;

        if (cData.id==='daily' && isFree) {
            const now = Date.now();
            setCases(p=>({...p,daily:{...p.daily,freeCount:0,lastOpened:now}}));
            await db.ref(`users/${user.id}/cases/daily`).update({freeCount:0,lastOpened:now});
        } else if (isFree) {
            const nf = cData.freeCount-1;
            setCases(p=>({...p,[caseType]:{...p[caseType],freeCount:nf}}));
            await db.ref(`users/${user.id}/cases/${caseType}/freeCount`).set(nf);
        } else {
            nb -= price; setBalance(nb);
            await db.ref(`users/${user.id}/balance`).set(nb);
        }

        // cardboard7 task
        if (caseType === 'cardboard' && !tasks.cardboard7?.completed) {
            const newCount = (tasks.cardboard7?.count||0)+1;
            if (newCount >= 7) {
                const nt = { ...tasks, cardboard7:{ completed:true, count:newCount } };
                const nc = { ...cases, diamond:{ ...cases.diamond, freeCount:(cases.diamond.freeCount||0)+1 } };
                setTasks(nt); setCases(nc);
                await db.ref(`users/${user.id}`).update({ tasks:nt, cases:nc });
                alert('üéâ –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! –ü–æ–ª—É—á–µ–Ω 1 –∫–µ–π—Å ¬´–ê–ª–º–∞–∑üíé¬ª!');
            } else {
                const nt = { ...tasks, cardboard7:{ ...tasks.cardboard7, count:newCount } };
                setTasks(nt); await db.ref(`users/${user.id}/tasks/cardboard7`).set(nt.cardboard7);
            }
        }

        // olympus opens counter + progress
        if (caseType === 'olympus') {
            const newOpens = olympusOpens+1;
            setOlympusOpens(newOpens);
            await db.ref(`users/${user.id}/olympusOpens`).set(newOpens);
            for (const step of OLYMPUS_PROGRESS) {
                if (newOpens >= step.opens && !olympusProgress.includes(step.opens)) {
                    const np = [...olympusProgress, step.opens];
                    setOlympusProgress(np);
                    await db.ref(`users/${user.id}/olympusProgress`).set(np);
                    await giveOlympusReward(step.reward, nb);
                    alert(`üéâ –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ ${step.opens} –æ—Ç–∫—Ä—ã—Ç–∏–π: ${step.name}`);
                }
            }
        }

        // spin
        setIsSpinning(false); setSpinResult(null); setFakeItems([]); setRouletteOffset(0); setRouletteKey(k=>k+1);
        const items = CASE_REWARDS[caseType]; if (!items) return;
        let won = items[0], r = Math.random()*100, cum = 0;
        for (const i of items) { cum += i.realChance; if (r <= cum) { won = i; break; } }
        const tape = [];
        for (let i=0; i<80; i++) tape.push(i===70 ? won : items[Math.floor(Math.random()*items.length)]);
        setIsSpinning(true);
        setTimeout(() => {
            setFakeItems(tape);
            setTimeout(() => {
                const cw = rouletteContainerRef.current ? rouletteContainerRef.current.offsetWidth : window.innerWidth;
                setRouletteOffset(-(70*136+68-cw/2));
            }, 50);
        }, 50);
        setTimeout(async () => {
            setSpinResult(won); setIsSpinning(false);
            if (caseType === 'olympus') {
                // show choice modal for special types
                if (won.type === 'olympus_choice') { setShowPoseidonModal(true); }
                else if (won.type === 'olympus_hades_choice') { setShowHadesModal(true); }
                else if (won.type === 'olympus_zeus') { setShowZeusModal(true); }
                else {
                    setSelectedOlympusItem(won); setShowOlympusItemModal(true);
                }
            } else if (won.type === 'stars') {
                const fb = nb+won.value; setBalance(fb);
                await db.ref(`users/${user.id}/balance`).set(fb);
            } else { await addToInventory(won); }
        }, 6600);
    };

    /* ‚îÄ‚îÄ olympus reward ‚îÄ‚îÄ */
    const giveOlympusReward = async (reward, curBal) => {
        const bal = curBal !== undefined ? curBal : balance;
        if (reward.type==='star_cases') {
            const nc={...cases,star:{...cases.star,freeCount:(cases.star.freeCount||0)+reward.count}}; setCases(nc);
            await db.ref(`users/${user.id}/cases/star/freeCount`).set((cases.star.freeCount||0)+reward.count);
        } else if (reward.type==='case') {
            const nc={...cases,[reward.caseId]:{...cases[reward.caseId],freeCount:(cases[reward.caseId].freeCount||0)+reward.count}}; setCases(nc);
            await db.ref(`users/${user.id}/cases/${reward.caseId}/freeCount`).set((cases[reward.caseId].freeCount||0)+reward.count);
        } else if (reward.type==='stars') {
            const nb=bal+reward.value; setBalance(nb);
            await db.ref(`users/${user.id}/balance`).set(nb);
        } else if (reward.type==='special_item') {
            if (reward.item==='hades_gift') await addToInventory({id:'hades_gift',name:'–ü–æ–¥–∞—Ä–æ–∫ –ê–∏–¥üî•',emoji:'üî•',type:'olympus_special'});
            else if (reward.item==='zeus_gift') await addToInventory({id:'zeus_gift',name:'–ü–æ–¥–∞—Ä–æ–∫ –ó–µ–≤—Å‚ö°Ô∏è',emoji:'‚ö°Ô∏è',type:'olympus_special'});
        } else if (reward.type==='mega') {
            const nc={...cases,star:{...cases.star,freeCount:(cases.star.freeCount||0)+reward.starCases}}; setCases(nc);
            const nb=bal+reward.stars; setBalance(nb);
            await db.ref(`users/${user.id}`).update({'cases/star/freeCount':(cases.star.freeCount||0)+reward.starCases,balance:nb});
        }
    };

    /* ‚îÄ‚îÄ olympus item modal action ‚îÄ‚îÄ */
    const handleOlympusItemAction = async (item) => {
        setShowOlympusItemModal(false); setSelectedOlympusItem(null);
        if (item.type==='olympus_item') { await addToInventory(item); }
        else if (item.type==='olympus_slot') {
            const ns=inventorySlots+1; setInventorySlots(ns);
            await db.ref(`users/${user.id}/inventorySlots`).set(ns);
            alert('üéâ +1 —Å–ª–æ—Ç –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ!');
        } else if (item.type==='olympus_exchange_stars') {
            const nb=balance+item.value; setBalance(nb);
            await db.ref(`users/${user.id}/balance`).set(nb);
            alert(`üéâ –ü–æ–ª—É—á–µ–Ω–æ ${item.value}‚≠êÔ∏è!`);
        } else if (item.type==='olympus_star_cases') {
            const nc={...cases,star:{...cases.star,freeCount:(cases.star.freeCount||0)+item.count}}; setCases(nc);
            await db.ref(`users/${user.id}/cases/star/freeCount`).set((cases.star.freeCount||0)+item.count);
            alert(`üéâ –ü–æ–ª—É—á–µ–Ω–æ ${item.count} –∫–µ–π—Å–æ–≤ ¬´–ó–≤–µ–∑–¥–Ω—ã–π‚≠êÔ∏è¬ª!`);
        }
    };

    /* ‚îÄ‚îÄ poseidon choice ‚îÄ‚îÄ */
    const handlePoseidon = async (choice) => {
        setShowPoseidonModal(false);
        if (choice===1) {
            const nb=balance+200; setBalance(nb); await db.ref(`users/${user.id}/balance`).set(nb); alert('üéâ –ü–æ–ª—É—á–µ–Ω–æ 200‚≠êÔ∏è!');
        } else {
            const nc={...cases,platinum:{...cases.platinum,freeCount:(cases.platinum.freeCount||0)+5}}; setCases(nc);
            await db.ref(`users/${user.id}/cases/platinum/freeCount`).set((cases.platinum.freeCount||0)+5);
            alert('üéâ –ü–æ–ª—É—á–µ–Ω–æ 5 –∫–µ–π—Å–æ–≤ ¬´–ü–ª–∞—Ç–∏–Ω–∞¬ª!');
        }
    };

    /* ‚îÄ‚îÄ hades choice ‚îÄ‚îÄ */
    const handleHades = async (choice) => {
        setShowHadesModal(false);
        if (choice===1) {
            const nb=balance+250; setBalance(nb); await db.ref(`users/${user.id}/balance`).set(nb); alert('üéâ –ü–æ–ª—É—á–µ–Ω–æ 250‚≠êÔ∏è!');
        } else {
            const nc={...cases,collector:{...cases.collector,locked:false,freeCount:(cases.collector.freeCount||0)+1}}; setCases(nc);
            await db.ref(`users/${user.id}/cases/collector`).update({locked:false,freeCount:(cases.collector.freeCount||0)+1});
            alert('üéâ –ö–µ–π—Å ¬´–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Äüé©¬ª —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω + 1 –ø—Ä–æ–∫—Ä—É—Ç!');
        }
    };

    /* ‚îÄ‚îÄ zeus choice ‚îÄ‚îÄ */
    const handleZeus = async (choice) => {
        setShowZeusModal(false);
        if (choice==='wake') {
            const nc={...cases,collector:{...cases.collector,locked:false,freeCount:(cases.collector.freeCount||0)+2}}; setCases(nc);
            await db.ref(`users/${user.id}/cases/collector`).update({locked:false,freeCount:(cases.collector.freeCount||0)+2});
            alert('üéâ –ó–µ–≤—Å‚ö°Ô∏è —Ä–∞–∑–±—É–∂–µ–Ω! –ü–æ–ª—É—á–µ–Ω–æ 2 –∫–µ–π—Å–∞ ¬´–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Äüé©¬ª + —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞!');
        } else {
            await addToInventory({id:'sleeping_zeus',name:'–°–ø—è—â–∏–π –ó–µ–≤—Å‚ö°Ô∏è',emoji:'üí§',type:'olympus_special'});
            alert('üí§ –ó–µ–≤—Å –æ—Å—Ç–∞–ª—Å—è —Å–ø–∞—Ç—å...');
        }
    };

    /* ‚ïê‚ïê‚ïê‚ïê INVENTORY / SELL ‚ïê‚ïê‚ïê‚ïê */
    const sellItem = async (item) => {
        if (item.type==='random_case_box') { setRandomCaseItem(item); setShowRandomCaseModal(true); return; }
        if (item.type==='collectible'||item.type==='olympus_special') { setSelectedCollectible(item); setShowCollectibleModal(true); return; }
        if (item.type==='olympus_item') {
            if (confirm(`–ü—Ä–æ–¥–∞—Ç—å ${item.name} –∑–∞ ${item.sellPrice}‚≠êÔ∏è?`)) {
                const nb=balance+item.sellPrice, ni=inventory.filter(i=>i.uniqueId!==item.uniqueId);
                setBalance(nb); setInventory(ni);
                await db.ref(`users/${user.id}`).update({balance:nb,inventory:ni});
            }
            return;
        }
        if (item.sellPrice !== undefined) {
            if (confirm(`–ü—Ä–æ–¥–∞—Ç—å ${item.name} –∑–∞ ${item.sellPrice}‚≠êÔ∏è?`)) {
                const nb=balance+item.sellPrice, ni=inventory.filter(i=>i.uniqueId!==item.uniqueId);
                setBalance(nb); setInventory(ni);
                await db.ref(`users/${user.id}`).update({balance:nb,inventory:ni});
            }
        } else { alert('–≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç –Ω–µ–ª—å–∑—è –ø—Ä–æ–¥–∞—Ç—å. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏.'); }
    };

    const exchangeRandomCaseBox = async () => {
        const keys=['cardboard','coal','platinum','diamond','money','gold','elite','collector'];
        const rKey=keys[Math.floor(Math.random()*keys.length)];
        const ni=inventory.filter(i=>i.uniqueId!==randomCaseItem.uniqueId);
        const nc={...cases,[rKey]:{...cases[rKey],freeCount:(cases[rKey].freeCount||0)+1}};
        if (rKey==='collector') nc.collector.locked=false;
        setInventory(ni); setCases(nc);
        await db.ref(`users/${user.id}`).update({inventory:ni,cases:nc});
        setShowRandomCaseModal(false); setRandomCaseItem(null);
        alert(`–í—ã–ø–∞–ª –∫–µ–π—Å: ${cases[rKey].name}!`);
    };

    const unlockSlot = async () => {
        if (balance<50) return;
        const nb=balance-50, ns=inventorySlots+1;
        setBalance(nb); setInventorySlots(ns);
        await db.ref(`users/${user.id}`).update({balance:nb,inventorySlots:ns});
    };

    /* ‚ïê‚ïê‚ïê‚ïê GEFEST ‚ïê‚ïê‚ïê‚ïê */
    const handleGefestExchange = async (itemKey) => {
        if (gefestCooldownEnd > Date.now()) { alert(`‚è∞ –ü–æ–¥–æ–∂–¥–∏—Ç–µ: ${gefestCooldownStr}`); return; }
        const hasItem = inventory.find(i=>(i.key===itemKey||i.id===itemKey||i.id===itemKey+''));
        if (!hasItem) { alert('–ü—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω!'); return; }
        const exchange = GEFEST_EXCHANGES[itemKey]; if (!exchange) return;
        if (exchange.reward.type==='choice') { setGefestChoiceCtx({hasItem,exchange}); setShowGefestChoice(true); }
        else { await processGefestExchange(hasItem, exchange.reward); }
    };
    const processGefestExchange = async (item, reward) => {
        const ni=inventory.filter(i=>i.uniqueId!==item.uniqueId); setInventory(ni);
        await db.ref(`users/${user.id}/inventory`).set(ni);
        const cd=Date.now()+3*60*1000; setGefestCooldownEnd(cd);
        await db.ref(`users/${user.id}/gefestCooldownEnd`).set(cd);
        if (reward.type==='stars') {
            const nb=balance+reward.value; setBalance(nb); await db.ref(`users/${user.id}/balance`).set(nb); alert(`‚úÖ –ü–æ–ª—É—á–µ–Ω–æ ${reward.value}‚≠êÔ∏è!`);
        } else if (reward.type==='case') {
            const nc={...cases,[reward.caseId]:{...cases[reward.caseId],freeCount:(cases[reward.caseId].freeCount||0)+reward.count}}; setCases(nc);
            await db.ref(`users/${user.id}/cases/${reward.caseId}/freeCount`).set((cases[reward.caseId].freeCount||0)+reward.count);
            alert(`‚úÖ –ü–æ–ª—É—á–µ–Ω–æ ${reward.count} –∫–µ–π—Å(–æ–≤)!`);
        } else if (reward.type==='slot') {
            const ns=inventorySlots+1; setInventorySlots(ns); await db.ref(`users/${user.id}/inventorySlots`).set(ns); alert('‚úÖ +1 —Å–ª–æ—Ç!');
        } else if (reward.type==='collector_unlock') {
            const nc={...cases,collector:{...cases.collector,locked:false,freeCount:(cases.collector.freeCount||0)+2}}; setCases(nc);
            await db.ref(`users/${user.id}/cases/collector`).update({locked:false,freeCount:(cases.collector.freeCount||0)+2});
            alert('‚úÖ –ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω + 2 –ø—Ä–æ–∫—Ä—É—Ç–∞!');
        }
        setShowGefestModal(false);
    };
    const handleGefestChoice = async (opt) => {
        const { hasItem, exchange } = gefestChoiceCtx;
        const reward = opt===1 ? exchange.reward.option1 : exchange.reward.option2;
        await processGefestExchange(hasItem, reward);
        setShowGefestChoice(false); setGefestChoiceCtx(null);
    };

    /* ‚ïê‚ïê‚ïê‚ïê GERAKL ‚ïê‚ïê‚ïê‚ïê */
    const startGeraklGame = async () => {
        if (balance<geraklBetInput||geraklBetInput<25) { alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥ –∏–ª–∏ —Å—Ç–∞–≤–∫–∞ –º–µ–Ω—å—à–µ 25!'); return; }
        const nb=balance-geraklBetInput; setBalance(nb);
        await db.ref(`users/${user.id}/balance`).set(nb);
        setGeraklBetAmount(geraklBetInput); setGeraklRound(0); setGeraklMultiplier(1.0);
        setGeraklCurrentWin(geraklBetInput); setGeraklTimer(25); setGeraklGameActive(true);
        setGeraklResult(null); setGeraklBoxOpened(false); setGeraklBoxPrize(null);
    };
    const handleGeraklFlame = () => {
        if (geraklRound>=10) { handleGeraklCashout(); return; }
        if (Math.random() < GERAKL_ICE_CHANCES[geraklRound]) { handleGeraklIce(); }
        else {
            const nr=geraklRound+1;
            setGeraklRound(nr); setGeraklMultiplier(GERAKL_MULTIPLIERS[nr]);
            setGeraklCurrentWin(Math.floor(geraklBetAmount*GERAKL_MULTIPLIERS[nr])); setGeraklTimer(25);
        }
    };
    const handleGeraklCashout = async () => {
        const win=geraklCurrentWin, profit=win-geraklBetAmount;
        const nb=balance+win; setBalance(nb);
        await db.ref(`users/${user.id}/balance`).set(nb);
        setGeraklResult({type:'cashout',round:geraklRound,win,profit}); setGeraklGameActive(false);
        if (geraklRound>=10) {
            const prize=getGeraklBoxPrize(); setGeraklBoxPrize(prize);
            if (prize.type==='stars') { const nb2=nb+prize.value; setBalance(nb2); await db.ref(`users/${user.id}/balance`).set(nb2); }
            else await addToInventory(prize);
        }
    };
    const handleGeraklIce = () => { setGeraklResult({type:'ice',round:geraklRound}); setGeraklGameActive(false); };
    const getGeraklBoxPrize = () => {
        let cum=0, r=Math.random()*100;
        for (const p of GERAKL_10_REWARDS) { cum+=p.chance; if (r<=cum) return p; }
        return GERAKL_10_REWARDS[0];
    };
    const openGeraklBox = async () => {
        setGeraklBoxOpened(true);
        if (geraklBoxPrize?.type==='promo') {
            const np=[...wonPromos,geraklBoxPrize.code]; setWonPromos(np);
            await db.ref(`users/${user.id}/wonPromos`).set(np);
        }
    };
    const exitGeraklGame = () => { setGeraklGameActive(false); setGeraklResult(null); setGeraklBoxOpened(false); setGeraklBoxPrize(null); setCurrentGame(null); };

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       RENDER ‚Äì GERAKL GAME
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    if (currentGame?.type==='gerakl') return (
        <div className="min-h-screen pb-4" style={{backgroundImage:`url('gerakl.jpg')`,backgroundSize:'cover',backgroundPosition:'center',backgroundBlendMode:'overlay',background:'linear-gradient(to bottom,#7f1d1d,#431407)'}}>
            <div className="max-w-lg mx-auto p-3">
                <div className="flex justify-between items-center mb-3">
                    <h1 className="text-xl font-bold">ü™¨ 13 –ü–æ–¥–≤–∏–≥ –ì–µ—Ä–∞–∫–ª–∞ üåä</h1>
                    <button onClick={exitGeraklGame} className="bg-red-600/40 hover:bg-red-600 border border-red-500/50 px-3 py-1.5 rounded-xl font-bold transition text-sm">‚úï –í—ã–π—Ç–∏</button>
                </div>
                {geraklResult ? (
                    <div className="glass rounded-xl p-4 mb-3 text-center border border-yellow-500/30">
                        {geraklResult.type==='ice' ? (<>
                            <div className="text-5xl mb-2">üßä</div>
                            <div className="font-bold text-red-400 text-xl mb-2">–õ–Å–î!</div>
                            <div className="text-gray-300 text-sm mb-1">–†–∞—É–Ω–¥–æ–≤: {geraklResult.round}</div>
                            <div className="text-gray-400 text-sm mb-3">–°—Ç–∞–≤–∫–∞: {geraklBetAmount}‚≠êÔ∏è | –í—ã–∏–≥—Ä—ã—à: 0</div>
                            <button onClick={exitGeraklGame} className="w-full bg-gray-600 hover:bg-gray-500 py-2.5 rounded-xl font-bold text-sm">–í—ã–π—Ç–∏</button>
                        </>) : (<>
                            <div className="text-5xl mb-2">üéâ</div>
                            <div className="font-bold text-green-400 text-xl mb-2">–í—ã –∑–∞–±—Ä–∞–ª–∏ –≤—ã–∏–≥—Ä—ã—à!</div>
                            <div className="text-yellow-400 font-bold text-lg mb-1">{geraklResult.win}‚≠êÔ∏è</div>
                            <div className="text-green-400 text-sm mb-3">+{geraklResult.profit}‚≠êÔ∏è –ø—Ä–∏–±—ã–ª–∏</div>
                            {geraklBoxPrize && !geraklBoxOpened && (<>
                                <div className="text-7xl mb-3 cursor-pointer hover:scale-110 transition-transform select-none" onClick={openGeraklBox}>üì¶</div>
                                <p className="text-cyan-300 text-xs animate-pulse mb-3">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–æ—Ä–æ–±–∫—É!</p>
                            </>)}
                            {geraklBoxPrize && geraklBoxOpened && (
                                <div className="bg-gray-800/60 rounded-xl p-3 mb-3">
                                    <p className="text-3xl">{geraklBoxPrize.emoji}</p>
                                    <p className="text-white font-bold mt-1">{geraklBoxPrize.name}</p>
                                </div>
                            )}
                            <button onClick={exitGeraklGame} className="w-full bg-green-600 hover:bg-green-500 py-2.5 rounded-xl font-bold text-sm">–í—ã–π—Ç–∏</button>
                        </>)}
                    </div>
                ) : geraklGameActive ? (<>
                    <div className="glass rounded-xl p-4 mb-3 text-center border border-yellow-500/30">
                        <div className="text-5xl font-bold text-yellow-400 mb-1">{geraklTimer}</div>
                        <div className="text-gray-400 text-xs mb-3">—Å–µ–∫. –¥–æ –≤—ã–±–æ—Ä–∞</div>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div className="bg-gray-800/60 rounded-lg p-3"><div className="text-gray-400 text-xs mb-1">–í—ã–∏–≥—Ä—ã—à</div><div className="text-2xl font-bold text-yellow-400">{geraklCurrentWin}‚≠êÔ∏è</div></div>
                            <div className="bg-gray-800/60 rounded-lg p-3"><div className="text-gray-400 text-xs mb-1">–ú–Ω–æ–∂–∏—Ç–µ–ª—å</div><div className="text-2xl font-bold text-orange-400">{geraklMultiplier}x</div></div>
                        </div>
                        <div className="flex gap-2 mb-4">
                            <button onClick={handleGeraklFlame} className="flex-1 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-500 hover:to-orange-500 py-3 rounded-xl font-bold text-sm">üî• –ü–ª–∞–º—è</button>
                            <button onClick={handleGeraklCashout} className="flex-1 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 py-3 rounded-xl font-bold text-sm">üßä –ó–∞–±—Ä–∞—Ç—å</button>
                        </div>
                        <div className="flex justify-center flex-wrap">
                            {[...Array(10)].map((_,i)=><div key={i} className={`round-box ${i<geraklRound?'completed':i===geraklRound?'current':''}`}>{i+1}</div>)}
                        </div>
                    </div>
                    <div className="glass rounded-xl p-3">
                        <h3 className="font-bold text-center text-yellow-300 text-xs mb-2">üéÅ –ù–∞–≥—Ä–∞–¥—ã –∑–∞ 10 —Ä–∞—É–Ω–¥–æ–≤</h3>
                        <div className="flex flex-wrap justify-center gap-1.5 text-xl">
                            {['üß∏','üß∏','üß±','üçæ','üíç','25‚≠êÔ∏è','200‚≠êÔ∏è','350‚≠êÔ∏è','üîë'].map((e,i)=><span key={i} className="bg-gray-800/60 p-1.5 rounded-lg border border-white/10">{e}</span>)}
                        </div>
                    </div>
                </>) : (
                    <div className="glass rounded-xl p-4 mb-3 text-center border border-yellow-500/30">
                        <div className="text-3xl mb-2 animate-bounce">ü™¨</div>
                        <div className="font-bold text-yellow-300 text-lg mb-2">–°–æ–≤–µ—Ä—à–∏ 13 –ø–æ–¥–≤–∏–≥!</div>
                        <div className="text-gray-400 text-xs mb-3">–°–¥–µ–ª–∞–π —Å—Ç–∞–≤–∫—É –∏ –ø—Ä–æ–π–¥–∏ 10 —Ä–∞—É–Ω–¥–æ–≤</div>
                        <div className="flex gap-2 mb-3">
                            <input type="number" min="25" value={geraklBetInput} onChange={e=>setGeraklBetInput(Math.max(25,Number(e.target.value)))} className="flex-1 bg-gray-800 border border-yellow-600 rounded-lg p-2.5 text-center text-lg text-white" />
                            <button onClick={()=>setGeraklBetInput(p=>p+25)} className="bg-yellow-700 hover:bg-yellow-600 px-3 rounded-lg font-bold text-sm">+25</button>
                            <button onClick={()=>setGeraklBetInput(p=>p+100)} className="bg-yellow-700 hover:bg-yellow-600 px-3 rounded-lg font-bold text-sm">+100</button>
                        </div>
                        <button onClick={startGeraklGame} disabled={balance<geraklBetInput||geraklBetInput<25} className="w-full bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 py-2.5 rounded-xl font-bold disabled:opacity-50 text-sm">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É ({geraklBetInput}‚≠êÔ∏è)</button>
                        <p className="text-center text-xs text-gray-500 mt-1">–ë–∞–ª–∞–Ω—Å: {balance.toFixed(0)}‚≠êÔ∏è | –ú–∏–Ω: 25‚≠êÔ∏è</p>
                    </div>
                )}
            </div>
        </div>
    );

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       RENDER ‚Äì ADMIN
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    if (isAdmin) {
        const filtered = allUsers.filter(u => !adminUserSearch || (u.name||'').toLowerCase().includes(adminUserSearch.toLowerCase()) || (u.username||'').toLowerCase().includes(adminUserSearch.toLowerCase()) || (u.id||'').toLowerCase().includes(adminUserSearch.toLowerCase()));
        return (
            <div className="min-h-screen bg-gray-900 p-4">
                <div className="max-w-4xl mx-auto">
                    <div className="flex justify-between items-center mb-6">
                        <h1 className="text-2xl font-bold">üîê –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
                        <button onClick={()=>setIsAdmin(false)} className="text-gray-400 hover:text-white">–í—ã–π—Ç–∏</button>
                    </div>
                    <div className="flex gap-2 mb-6 overflow-x-auto">
                        {['stats','users','rewards','settings'].map(t=>(
                            <button key={t} onClick={()=>setAdminScreen(t)} className={`px-4 py-2 rounded-lg ${adminScreen===t?'bg-indigo-600':'bg-gray-700'} text-sm`}>
                                {t==='stats'?'üìä –°—Ç–∞—Ç.':t==='users'?'üë• –Æ–∑–µ—Ä—ã':t==='rewards'?'üéÄ –ù–∞–≥—Ä–∞–¥—ã':'‚öôÔ∏è –ù–∞—Å—Ç—Ä.'}
                            </button>
                        ))}
                    </div>
                    <div className="glass rounded-xl p-6">
                        {adminScreen==='stats' && (
                            <div className="grid grid-cols-2 gap-4">
                                <div className="bg-gray-800 p-4 rounded-lg"><div className="text-gray-400 text-sm">–ò–≥—Ä–æ–∫–æ–≤</div><div className="text-3xl font-bold">{allUsers.length}</div></div>
                                <div className="bg-gray-800 p-4 rounded-lg"><div className="text-gray-400 text-sm">–û–Ω–ª–∞–π–Ω</div><div className="text-3xl font-bold text-green-400">{onlineCount}</div></div>
                                <div className="bg-gray-800 p-4 rounded-lg"><div className="text-gray-400 text-sm">–ë–∞–ª–∞–Ω—Å –≤—Å–µ–≥–æ</div><div className="text-2xl font-bold">{allUsers.reduce((s,u)=>s+(u.balance||0),0).toFixed(0)}‚≠êÔ∏è</div></div>
                                <div className="bg-gray-800 p-4 rounded-lg"><div className="text-gray-400 text-sm">–ü—Ä–µ–¥–º–µ—Ç–æ–≤</div><div className="text-3xl font-bold">{allUsers.reduce((s,u)=>s+(u.inventory?.length||0),0)}</div></div>
                            </div>
                        )}
                        {adminScreen==='users' && !selectedUser && (<div>
                            <input type="text" placeholder="üîç –ü–æ–∏—Å–∫..." value={adminUserSearch} onChange={e=>setAdminUserSearch(e.target.value)} className="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-sm mb-4" />
                            <div className="space-y-2 max-h-96 overflow-y-auto">
                                {filtered.map(u=>(
                                    <div key={u.id} onClick={()=>setSelectedUser(u)} className="bg-gray-800 p-3 rounded-lg cursor-pointer hover:bg-gray-700 flex justify-between">
                                        <div><div className="font-bold text-sm">{u.name}</div><div className="text-xs text-gray-400">{u.username||u.id?.slice(0,12)}</div></div>
                                        <div className="text-yellow-400 text-sm">{(u.balance||0).toFixed(0)}‚≠êÔ∏è</div>
                                    </div>
                                ))}
                            </div>
                        </div>)}
                        {adminScreen==='users' && selectedUser && (<div>
                            <h3 className="font-bold mb-4 text-lg">üë§ {selectedUser.name}</h3>
                            <div className="grid grid-cols-3 gap-2 mb-4">
                                <button onClick={()=>adminGiveReward(selectedUser.id,{type:'stars',amount:100})} className="bg-green-600 p-2 rounded text-sm">+100‚≠êÔ∏è</button>
                                <button onClick={()=>adminGiveReward(selectedUser.id,{type:'stars',amount:500})} className="bg-green-600 p-2 rounded text-sm">+500‚≠êÔ∏è</button>
                                <button onClick={()=>adminGiveReward(selectedUser.id,{type:'stars',amount:1000})} className="bg-green-600 p-2 rounded text-sm">+1000‚≠êÔ∏è</button>
                                <button onClick={()=>adminGiveReward(selectedUser.id,{type:'case',caseType:'diamond',count:5})} className="bg-blue-600 p-2 rounded text-sm">+5üíé</button>
                                <button onClick={()=>adminGiveReward(selectedUser.id,{type:'case',caseType:'elite',count:2})} className="bg-red-600 p-2 rounded text-sm">+2üéñ</button>
                                <button onClick={()=>adminGiveReward(selectedUser.id,{type:'unlock_collector'})} className="bg-pink-800 p-2 rounded text-sm">üîì –ö–æ–ª–ª–µ–∫—Ü.</button>
                                <button onClick={()=>adminGiveReward(selectedUser.id,{type:'reset_daily'})} className="bg-cyan-600 p-2 rounded text-sm">üóìÔ∏è –°–±—Ä–æ—Å –¥–µ–π–ª–∏</button>
                                <button onClick={()=>adminGiveReward(selectedUser.id,{type:'item',item:{id:'random_case_box',name:'–°–ª—É—á–∞–π–Ω—ã–π –∫–µ–π—Å',emoji:'üì¶',type:'random_case_box'}})} className="bg-amber-600 p-2 rounded text-sm">üì¶ –í—ã–¥–∞—Ç—å —è—â–∏–∫</button>
                                <button onClick={()=>adminGiveReward(selectedUser.id,{type:'stars',amount:10000})} className="bg-purple-600 p-2 rounded text-sm">+10000‚≠êÔ∏è</button>
                            </div>
                            <button onClick={()=>setSelectedUser(null)} className="w-full bg-gray-600 p-2 rounded text-sm">‚Üê –ù–∞–∑–∞–¥</button>
                        </div>)}
                        {adminScreen==='rewards' && (<div>
                            <h3 className="text-lg mb-4">–í—ã–¥–∞—Ç—å —Å–µ–±–µ:</h3>
                            <div className="grid grid-cols-3 gap-2">
                                <button onClick={()=>adminGiveReward(user.id,{type:'stars',amount:10000})} className="bg-indigo-600 p-3 rounded text-sm">+10000‚≠êÔ∏è</button>
                                <button onClick={()=>adminGiveReward(user.id,{type:'case',caseType:'diamond',count:10})} className="bg-blue-600 p-3 rounded text-sm">+10üíé</button>
                                <button onClick={()=>adminGiveReward(user.id,{type:'unlock_collector'})} className="bg-pink-800 p-3 rounded text-sm">üîì –ö–æ–ª–ª–µ–∫—Ü.</button>
                                <button onClick={()=>adminGiveReward(user.id,{type:'reset_daily'})} className="bg-cyan-600 p-3 rounded text-sm">üóìÔ∏è –î–µ–π–ª–∏</button>
                                <button onClick={()=>adminGiveReward(user.id,{type:'item',item:{id:'random_case_box',name:'–°–ª—É—á–∞–π–Ω—ã–π –∫–µ–π—Å',emoji:'üì¶',type:'random_case_box'}})} className="bg-amber-600 p-3 rounded text-sm">üì¶ –Ø—â–∏–∫</button>
                            </div>
                        </div>)}
                        {adminScreen==='settings' && (<div>
                            <h3 className="text-lg mb-4">–°–±—Ä–æ—Å–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</h3>
                            <button onClick={async()=>{ if(confirm('–£–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ?')){ await db.ref('users/'+user.id).remove(); localStorage.removeItem('sbs_user_id'); window.location.reload(); } }} className="bg-red-600 px-4 py-2 rounded-lg text-sm">üóë –°–±—Ä–æ—Å–∏—Ç—å</button>
                        </div>)}
                    </div>
                </div>
            </div>
        );
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       RENDER ‚Äì MAIN
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    return (
        <div className="min-h-screen pb-24">
            {/* HEADER */}
            <header className="p-4 flex justify-between items-center glass sticky top-0 z-50">
                <h1 onClick={handleTitleClick} className="text-xl font-bold cursor-pointer select-none hover:text-cyan-300 transition">Step By Step Game</h1>
                <button onClick={()=>setShowTopUp(true)} className="bg-gradient-to-r from-yellow-400 to-orange-500 px-4 py-2 rounded-full font-bold text-gray-900 shadow-lg text-sm">{balance.toFixed(2)} ‚≠êÔ∏è</button>
            </header>

            {paymentStatus && <div className="mx-4 mt-2 p-3 rounded-lg text-center text-xs bg-blue-500/20 border border-blue-500">{paymentStatus}</div>}

            {/* ‚îÄ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ‚îÄ */}
            {showRandomCaseModal && (
                <div className="fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4">
                    <div className="glass rounded-2xl p-6 max-w-sm w-full text-center">
                        <div className="text-6xl mb-4 animate-bounce">üì¶</div>
                        <h3 className="text-xl font-bold mb-2">–°–ª—É—á–∞–π–Ω—ã–π –ö–µ–π—Å</h3>
                        <p className="mb-4 text-sm">–û–±–º–µ–Ω—è—Ç—å —è—â–∏–∫ –Ω–∞ –æ–¥–∏–Ω —Å–ª—É—á–∞–π–Ω—ã–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–µ–π—Å?</p>
                        <button onClick={exchangeRandomCaseBox} className="w-full bg-green-600 hover:bg-green-500 py-3 rounded-xl font-bold mb-2">–û–±–º–µ–Ω—è—Ç—å</button>
                        <button onClick={()=>setShowRandomCaseModal(false)} className="w-full bg-gray-600 hover:bg-gray-500 py-2 rounded-xl text-sm font-bold">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            )}
            {showCollectibleModal && (
                <div className="fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4">
                    <div className="glass rounded-2xl p-6 max-w-sm w-full text-center">
                        <div className="text-6xl mb-4 animate-bounce">{selectedCollectible?.emoji}</div>
                        <h3 className="text-xl font-bold mb-2">–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç!</h3>
                        <p className="mb-4 text-sm">–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ <a href="https://t.me/stepbystepdelision" target="_blank" className="text-blue-400 underline">–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏</a> –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥—ã.</p>
                        <button onClick={()=>setShowCollectibleModal(false)} className="w-full bg-indigo-600 hover:bg-indigo-500 py-3 rounded-xl font-bold">–ü–æ–Ω—è—Ç–Ω–æ</button>
                    </div>
                </div>
            )}
            {/* Olympus item result */}
            {showOlympusItemModal && selectedOlympusItem && (
                <div className="fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4">
                    <div className="glass rounded-2xl p-6 max-w-sm w-full text-center olympus-font">
                        <div className="text-6xl mb-3">{selectedOlympusItem.emoji}</div>
                        <h3 className="text-xl font-bold mb-1 olympus-label">{selectedOlympusItem.name}</h3>
                        {selectedOlympusItem.type==='olympus_item' && <p className="text-sm text-gray-300 mb-4">–ü—Ä–æ–¥–∞—Ç—å –∑–∞ {selectedOlympusItem.sellPrice}‚≠êÔ∏è –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å</p>}
                        {selectedOlympusItem.type==='olympus_slot' && <p className="text-sm text-gray-300 mb-4">+1 —Å–ª–æ—Ç –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ!</p>}
                        {selectedOlympusItem.type==='olympus_exchange_stars' && <p className="text-sm text-gray-300 mb-4">+{selectedOlympusItem.value}‚≠êÔ∏è</p>}
                        {selectedOlympusItem.type==='olympus_star_cases' && <p className="text-sm text-gray-300 mb-4">+{selectedOlympusItem.count} –∫–µ–π—Å–æ–≤ ¬´–ó–≤–µ–∑–¥–Ω—ã–π‚≠êÔ∏è¬ª</p>}
                        <button onClick={()=>handleOlympusItemAction(selectedOlympusItem)} className="w-full bg-gradient-to-r from-yellow-600 to-amber-600 hover:from-yellow-500 hover:to-amber-500 py-3 rounded-xl font-bold transition">–ü–æ–ª—É—á–∏—Ç—å!</button>
                        {selectedOlympusItem.type==='olympus_item' && (
                            <button onClick={()=>{setShowOlympusItemModal(false);setSelectedOlympusItem(null);}} className="w-full bg-gray-600 hover:bg-gray-500 py-2 rounded-xl text-sm font-bold mt-2">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ</button>
                        )}
                    </div>
                </div>
            )}
            {/* Poseidon */}
            {showPoseidonModal && (
                <div className="fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4">
                    <div className="glass rounded-2xl p-6 max-w-sm w-full text-center olympus-font border-2 border-blue-400/50">
                        <div className="text-6xl mb-3">üî±</div>
                        <h3 className="text-xl font-bold mb-2 olympus-label">–ü–æ—Å–µ–π–¥–æ–Ωüî±</h3>
                        <p className="text-sm text-gray-300 mb-5">–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é –Ω–∞–≥—Ä–∞–¥—É!</p>
                        <button onClick={()=>handlePoseidon(1)} className="w-full bg-gradient-to-r from-yellow-600 to-amber-600 hover:from-yellow-500 hover:to-amber-500 py-3 rounded-xl font-bold mb-3 transition">üí∞ 200‚≠êÔ∏è</button>
                        <button onClick={()=>handlePoseidon(2)} className="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 py-3 rounded-xl font-bold transition">üíé 5 –∫–µ–π—Å–æ–≤ ¬´–ü–ª–∞—Ç–∏–Ω–∞¬ª</button>
                    </div>
                </div>
            )}
            {/* Hades */}
            {showHadesModal && (
                <div className="fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4">
                    <div className="glass rounded-2xl p-6 max-w-sm w-full text-center olympus-font border-2 border-red-500/50">
                        <div className="text-6xl mb-3">üî•</div>
                        <h3 className="text-xl font-bold mb-2 olympus-label">–ê–∏–¥üî•</h3>
                        <p className="text-sm text-gray-300 mb-5">–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é –Ω–∞–≥—Ä–∞–¥—É!</p>
                        <button onClick={()=>handleHades(1)} className="w-full bg-gradient-to-r from-yellow-600 to-amber-600 hover:from-yellow-500 hover:to-amber-500 py-3 rounded-xl font-bold mb-3 transition">üí∞ 250‚≠êÔ∏è</button>
                        <button onClick={()=>handleHades(2)} className="w-full bg-gradient-to-r from-pink-700 to-rose-700 hover:from-pink-600 hover:to-rose-600 py-3 rounded-xl font-bold transition">üé© –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ ¬´–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä¬ª + 1 –ø—Ä–æ–∫—Ä—É—Ç</button>
                    </div>
                </div>
            )}
            {/* Zeus */}
            {showZeusModal && (
                <div className="fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4">
                    <div className="glass rounded-2xl p-6 max-w-sm w-full text-center olympus-font border-2 border-yellow-400/70">
                        <div className="text-6xl mb-3">‚ö°Ô∏è</div>
                        <h3 className="text-xl font-bold mb-2 olympus-label">–ó–µ–≤—Å‚ö°Ô∏è</h3>
                        <p className="text-sm text-gray-200 mb-5">–†–∞–∑–±—É–¥–∏—Ç–µ –ó–µ–≤—Å–∞‚ö°Ô∏è —Å–µ–π—á–∞—Å –∏ –ø–æ–ª—É—á–∏—Ç–µ 2 –ö–µ–π—Å–∞ ¬´–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä¬ª (+—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞) –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –∏ –ø–æ–ª—É—á–∏—Ç–µ –Ω–∞–≥—Ä–∞–¥—É –ª—É—á—à–µ –ø–æ–∑–∂–µ!</p>
                        <button onClick={()=>handleZeus('wake')} className="w-full bg-gradient-to-r from-yellow-500 to-amber-600 hover:from-yellow-400 hover:to-amber-500 py-3 rounded-xl font-bold mb-3 transition">‚ö°Ô∏è –†–∞–∑–±—É–¥–∏—Ç—å</button>
                        <button onClick={()=>handleZeus('sleep')} className="w-full bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-500 hover:to-gray-600 py-3 rounded-xl font-bold transition">üí§ –û—Å—Ç–∞–≤–∏—Ç—å</button>
                    </div>
                </div>
            )}
            {/* Gefest */}
            {showGefestModal && (
                <div className="fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4 overflow-y-auto">
                    <div className="rounded-2xl p-5 max-w-md w-full olympus-font gefest-bg" style={{backgroundBlendMode:'overlay',background:'rgba(30,20,10,0.85)'}}>
                        <div className="flex justify-between items-center mb-3">
                            <h3 className="text-xl font-bold hephaestus-text">–õ–∞–≤–∫–∞ –ì–µ—Ñ–µ—Å—Ç–∞üèµÔ∏è</h3>
                            <button onClick={()=>setShowGefestModal(false)} className="text-2xl hover:text-red-400">√ó</button>
                        </div>
                        <p className="text-center hephaestus-text text-sm mb-3">–û–±–º–µ–Ω—è–π —Å–≤–æ–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –Ω–∞ —á—Ç–æ-–Ω–∏–±—É–¥—å —Ü–µ–Ω–Ω–æ–µüíé</p>
                        {gefestCooldownStr && <div className="bg-red-500/20 border border-red-500 rounded-lg p-2 mb-3 text-center text-sm font-bold">‚è∞ –°–ª–µ–¥—É—é—â–∏–π –æ–±–º–µ–Ω —á–µ—Ä–µ–∑: {gefestCooldownStr}</div>}
                        <div className="space-y-2 max-h-[60vh] overflow-y-auto">
                            {Object.entries(GEFEST_EXCHANGES).map(([key,ex])=>{
                                const has = inventory.find(i=>i.key===key||i.id===key);
                                return (
                                    <div key={key} className={`glass rounded-xl p-3 border ${has?'border-green-500':'border-white/10 opacity-60'}`}>
                                        <div className="flex justify-between items-center mb-1">
                                            <span className="font-bold text-sm">{ex.name}</span>
                                            {has && <span className="text-green-400 text-xs font-bold">‚úì –ï—Å—Ç—å</span>}
                                        </div>
                                        <div className="text-xs text-gray-200 mb-2">
                                            {ex.highlight && <span className="text-red-400 font-bold neon-red mr-1">‚ö° –í—ã–≥–æ–¥–Ω–æ!</span>}
                                            ‚Üí {ex.rewardText}
                                        </div>
                                        <button onClick={()=>handleGefestExchange(key)} disabled={!has||gefestCooldownStr!==''} className="w-full bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-500 hover:to-red-500 py-2 rounded-lg font-bold text-xs disabled:opacity-40 disabled:cursor-not-allowed transition">–û–±–º–µ–Ω—è—Ç—å</button>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            )}
            {/* Gefest choice */}
            {showGefestChoice && gefestChoiceCtx && (
                <div className="fixed inset-0 bg-black/90 z-[70] flex items-center justify-center p-4">
                    <div className="glass rounded-2xl p-6 max-w-sm w-full text-center olympus-font">
                        <div className="text-5xl mb-3">üßä</div>
                        <h3 className="text-xl font-bold mb-4 text-cyan-300">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–≥—Ä–∞–¥—É!</h3>
                        <button onClick={()=>handleGefestChoice(1)} className="w-full bg-gradient-to-r from-yellow-600 to-amber-600 hover:from-yellow-500 hover:to-amber-500 py-3 rounded-xl font-bold mb-3 transition">25 –∫–µ–π—Å–æ–≤ ¬´–ó–≤–µ–∑–¥–Ω—ã–π‚≠êÔ∏è¬ª</button>
                        <button onClick={()=>handleGefestChoice(2)} className="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 py-3 rounded-xl font-bold transition">500‚≠êÔ∏è</button>
                    </div>
                </div>
            )}
            {/* Admin login */}
            {showAdminLogin && (
                <div className="fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4">
                    <div className="glass rounded-2xl p-6 max-w-sm w-full">
                        <h2 className="text-xl font-bold text-center mb-4">üîê –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                        <input type="text" placeholder="–õ–æ–≥–∏–Ω" value={adminLogin} onChange={e=>setAdminLogin(e.target.value)} className="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 mb-3 text-center text-sm" />
                        <input type="password" placeholder="–ü–∞—Ä–æ–ª—å" value={adminPassword} onChange={e=>setAdminPassword(e.target.value)} className="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 mb-4 text-center text-sm" />
                        <button onClick={checkAdminLogin} className="w-full bg-indigo-600 hover:bg-indigo-500 py-3 rounded-xl font-bold mb-2">–í–æ–π—Ç–∏</button>
                        <button onClick={()=>setShowAdminLogin(false)} className="w-full bg-gray-700 hover:bg-gray-600 py-2 rounded-xl text-sm">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            )}
            {/* Withdraw */}
            {showWithdrawModal && (
                <div className="fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4">
                    <div className="glass rounded-2xl p-6 max-w-sm w-full text-center">
                        <h2 className="text-xl font-bold mb-4">üìä –í—ã–≤–æ–¥ –ø—Ä–∏–∑–æ–≤</h2>
                        {tasks.depositMajor?.completed
                            ? <p className="text-green-400 text-sm mb-4">–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—ã–≤–æ–¥–∞ –ø—Ä–∏–∑–æ–≤! <a href="https://t.me/stepbystepdelision" className="underline">@stepbystepdelision</a></p>
                            : <p className="text-yellow-400 text-sm mb-4">–ß—Ç–æ–±—ã –≤—ã–≤–µ—Å—Ç–∏ NFT –ø—Ä–∏–∑—ã, –∑–≤–µ–∑–¥—ã –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ ¬´–ü–æ–ø–æ–ª–Ω–∏ –Ω–∞ 350‚≠êÔ∏è¬ª</p>
                        }
                        <button onClick={()=>setShowWithdrawModal(false)} className="w-full bg-gray-700 hover:bg-gray-600 py-2 rounded-xl text-sm">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            )}
            {/* TopUp */}
            {showTopUp && (
                <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
                    <div className="glass rounded-2xl p-5 max-w-sm w-full">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-lg font-bold">üí≥ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
                            <button onClick={()=>setShowTopUp(false)} className="text-2xl hover:text-red-400">√ó</button>
                        </div>
                        <p className="text-xs text-gray-400 text-center mb-3">‚≠êÔ∏è Telegram Stars</p>
                        <div className="space-y-2 mb-4">
                            {STARS_PACKAGES.map(pkg=>(
                                <button key={pkg.stars} onClick={()=>buyStars(pkg)} className="w-full glass p-3 rounded-xl flex justify-between items-center hover:bg-white/10 transition border border-white/10">
                                    <span className="font-bold text-yellow-400 text-sm">+{pkg.stars} ‚≠êÔ∏è</span>
                                    <span className="text-gray-300 text-xs">–ö—É–ø–∏—Ç—å</span>
                                </button>
                            ))}
                        </div>
                        <div className="border-t border-gray-600 pt-4">
                            <p className="text-xs text-gray-400 text-center mb-3">üíé TON</p>
                            {TON_RATES.map(rate=>(
                                <button key={rate.stars} onClick={()=>topUpBalance(rate.stars,rate.ton)} className="w-full glass p-3 rounded-xl flex justify-between items-center hover:bg-white/10 transition border border-white/10 mb-2">
                                    <span className="font-bold text-sm">+{rate.stars}‚≠êÔ∏è</span>
                                    <span className="text-yellow-400 font-bold text-sm">{rate.ton} TON</span>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            )}

            {/* ‚îÄ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ‚îÄ */}
            <main className="p-4 max-w-md mx-auto">

                {/* ‚ïê‚ïê CASES SCREEN ‚ïê‚ïê */}
                {currentScreen==='cases' && (
                    <div>
                        <h2 className="text-2xl font-bold mb-4 text-center">üé∞ –ö–µ–π—Å—ã</h2>
                        {/* free case banners */}
                        {cases.diamond?.freeCount>0 && <div className="bg-green-500/20 border border-green-500 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –ê–ª–º–∞–∑: {cases.diamond.freeCount}</div>}
                        {cases.elite?.freeCount>0 && <div className="bg-green-500/20 border border-green-500 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –≠–ª–∏—Ç–∞: {cases.elite.freeCount}</div>}
                        {cases.collector?.freeCount>0 && <div className="bg-pink-500/20 border border-pink-500 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä: {cases.collector.freeCount}</div>}
                        {cases.cardboard?.freeCount>0 && <div className="bg-amber-500/20 border border-amber-500 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –ö–∞—Ä—Ç–æ–Ω: {cases.cardboard.freeCount}</div>}
                        {cases.coal?.freeCount>0 && <div className="bg-gray-500/20 border border-gray-500 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –£–≥–æ–ª—ë–∫: {cases.coal.freeCount}</div>}
                        {cases.platinum?.freeCount>0 && <div className="bg-gray-300/20 border border-gray-300 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –ü–ª–∞—Ç–∏–Ω–∞: {cases.platinum.freeCount}</div>}
                        {cases.gold?.freeCount>0 && <div className="bg-yellow-500/20 border border-yellow-500 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –ó–æ–ª–æ—Ç–æ–π: {cases.gold.freeCount}</div>}
                        {cases.money?.freeCount>0 && <div className="bg-green-500/20 border border-green-500 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –î–µ–Ω–µ–∂–Ω—ã–π: {cases.money.freeCount}</div>}
                        {cases.star?.freeCount>0 && <div className="bg-amber-400/20 border border-amber-400 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –ó–≤–µ–∑–¥–Ω—ã–π: {cases.star.freeCount}</div>}

                        {/* Special cases (no olympus here!) */}
                        <div className="mb-6">
                            <h3 className="text-lg font-bold text-center mb-3 text-purple-300 special-header">üîÆ –û—Å–æ–±—ã–µ üîÆ</h3>
                            <div className="grid grid-cols-2 gap-4">
                                {Object.values(cases).filter(c=>c.type==='special').map(c=>{
                                    const isDaily=c.id==='daily', isDailyWait=isDaily&&c.freeCount===0;
                                    if (c.id==='collector'&&c.locked) return (
                                        <div key={c.id} className="rounded-xl p-4 relative case-collector opacity-80 overflow-hidden">
                                            <div className="absolute inset-0 bg-black/50 z-20 flex items-center justify-center"><span className="text-5xl">üîí</span></div>
                                            <div className="w-16 h-16 mx-auto rounded-lg bg-white/20 flex items-center justify-center text-3xl mb-2 relative z-10">{c.emoji}</div>
                                            <h3 className="font-bold text-center text-sm relative z-10">{c.name}</h3>
                                            <p className="text-center text-xs opacity-75 mb-2 relative z-10">{c.price}‚≠êÔ∏è</p>
                                            <button disabled className="w-full py-2 rounded-lg font-bold text-sm bg-gray-800/80 cursor-not-allowed text-gray-400 relative z-10">–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</button>
                                        </div>
                                    );
                                    return (
                                        <div key={c.id} className={`glass rounded-xl p-4 relative overflow-hidden hover:scale-105 transition ${c.id==='collector'?'case-collector':''}`}>
                                            <div className={`w-16 h-16 mx-auto rounded-lg ${c.id==='collector'?'bg-white/20':`bg-gradient-to-br ${c.color}`} flex items-center justify-center text-3xl mb-2 shadow-lg`}>{c.emoji}</div>
                                            <h3 className="font-bold text-center text-sm">{c.name}</h3>
                                            <p className="text-center text-xs opacity-75 mb-2 h-4 flex items-center justify-center">
                                                {isDaily?(c.freeCount>0?<span className="text-green-400 font-bold">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ!</span>:<span className="daily-timer">{dailyCaseTimeLeft}</span>):(c.price>0?c.price+'‚≠êÔ∏è':'')}
                                            </p>
                                            <button onClick={()=>handleSelectCase(c)} disabled={c.locked} className="w-full py-2 rounded-lg font-bold text-sm bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 transition">
                                                {c.locked?'üîí':(isDailyWait?'üëÅ –°–º–æ—Ç—Ä–µ—Ç—å':'–û—Ç–∫—Ä—ã—Ç—å')}
                                            </button>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        {/* Ordinary cases */}
                        <div className="mb-6">
                            <h3 className="text-lg font-bold text-center mb-3 text-yellow-300 ordinary-header">üéÅ –û–±—ã—á–Ω—ã–µ üéÅ</h3>
                            <div className="grid grid-cols-2 gap-4">
                                {Object.values(cases).filter(c=>!c.type&&!c.locked).map(c=>(
                                    <div key={c.id} className={`glass rounded-xl p-4 relative overflow-hidden hover:scale-105 transition ${c.id==='cardboard'?'case-cardboard':''}`}>
                                        {c.isNew&&<span className="absolute -top-2 -right-2 bg-red-500 text-xs px-2 py-1 rounded-full animate-pulse">–ù–æ–≤–æ–µ!</span>}
                                        {(c.discountPrice&&c.discountPrice!==c.price)&&!c.freeCount&&<span className="absolute -top-2 -left-2 bg-green-500 text-xs px-2 py-1 rounded-full animate-pulse">–°–∫–∏–¥–∫–∞!</span>}
                                        <div className={`w-16 h-16 mx-auto rounded-lg ${c.id==='cardboard'?'bg-white/20':`bg-gradient-to-br ${c.color}`} flex items-center justify-center text-3xl mb-2 shadow-lg`}>{c.emoji}</div>
                                        <h3 className="font-bold text-center text-sm">{c.name}</h3>
                                        <p className="text-center text-xs opacity-75 mb-2 h-4">
                                            {c.freeCount>0?<span className="text-green-400 font-bold">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ!</span>:(c.discountPrice&&c.discountPrice!==c.price?<span><span className="line-thru">{c.originalPrice||c.price}‚≠êÔ∏è</span> <span className="font-bold text-white">{c.discountPrice}‚≠êÔ∏è</span></span>:c.price+'‚≠êÔ∏è')}
                                        </p>
                                        <button onClick={()=>handleSelectCase(c)} className="w-full py-2 rounded-lg font-bold text-sm bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 transition">–û—Ç–∫—Ä—ã—Ç—å</button>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Locked ordinary cases */}
                        {Object.values(cases).filter(c=>c.locked&&!c.type).length>0 && (
                            <div className="grid grid-cols-2 gap-4">
                                {Object.values(cases).filter(c=>c.locked&&!c.type).map(c=>(
                                    <div key={c.id} className="glass rounded-xl p-4 relative opacity-50">
                                        <div className="absolute inset-0 bg-black/70 rounded-xl flex items-center justify-center"><span className="text-2xl">üîí</span></div>
                                        <div className={`w-16 h-16 mx-auto rounded-lg bg-gradient-to-br ${c.color} flex items-center justify-center text-3xl mb-2`}>{c.emoji}</div>
                                        <h3 className="font-bold text-center text-sm">{c.name}</h3>
                                        <p className="text-center text-xs mb-2">{c.price}‚≠êÔ∏è</p>
                                        <button className="w-full py-2 rounded-lg font-bold text-sm bg-gray-600 cursor-not-allowed">–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</button>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                )}

                {/* ‚ïê‚ïê GAMES SCREEN ‚ïê‚ïê */}
                {currentScreen==='games' && (
                    <div>
                        <h2 className="text-2xl font-bold mb-4 text-center">üéÆ –ò–≥—Ä—ã</h2>
                        <div className="space-y-4">
                            <div className="glass rounded-xl p-5 border border-yellow-500/30" style={{backgroundImage:`url('gerakl.jpg')`,backgroundSize:'cover',backgroundPosition:'center',backgroundBlendMode:'overlay'}}>
                                <h3 className="text-xl font-bold mb-1 text-center text-yellow-300">ü™¨ 13 –ü–æ–¥–≤–∏–≥ –ì–µ—Ä–∞–∫–ª–∞ üåä</h3>
                                <p className="text-gray-300 mb-1 text-center text-xs">–°–æ–≤–µ—Ä—à–∏ 13 –ø–æ–¥–≤–∏–≥!</p>
                                <p className="text-yellow-400 text-center text-xs mb-3">–ü—Ä–æ–π–¥–∏ 10 —Ä–∞—É–Ω–¥–æ–≤ –∏ –ø–æ–ª—É—á–∏ —Å—É–Ω–¥—É–∫ üì¶</p>
                                <button onClick={()=>setCurrentGame({type:'gerakl'})} className="w-full bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 py-3 rounded-xl font-bold transition text-sm">–í–æ–π—Ç–∏</button>
                            </div>
                            <div className="glass rounded-xl p-5 opacity-50 text-center"><h3 className="text-lg font-bold">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ... üë≤</h3></div>
                        </div>
                    </div>
                )}

                {/* ‚ïê‚ïê EVENTS SCREEN ‚ïê‚ïê */}
                {currentScreen==='events' && (<div>
                    {/* MAIN EVENT */}
                    {eventScreen==='main' && (
                        <div className="event-bg">
                            <div className="event-overlay" />
                            <div className="relative z-10 p-4 flex flex-col items-center" style={{minHeight:'520px'}}>
                                <h2 className="text-3xl font-bold text-center mb-6 olympus-title olympus-font-black" style={{letterSpacing:'1px'}}>üèõÔ∏è –ò–í–ï–ù–¢ –û–õ–ò–ú–ü ‚ö°Ô∏è</h2>

                                {/* –ì–µ—Ä–æ–∏ –û–ª–∏–º–ø–∞ ‚Äî –í–í–ï–†–•–£, –ø–æ —Ü–µ–Ω—Ç—Ä—É */}
                                <button onClick={()=>setEventScreen('heroes')} className="olympus-btn mb-5 w-full max-w-xs text-center">
                                    üèÜ –ì–µ—Ä–æ–∏ –û–ª–∏–º–ø–∞
                                </button>

                                {/* –°–æ–∫—Ä–æ–≤–∏—â–µ –∏ –õ–∞–≤–∫–∞ ‚Äî –°–õ–ï–í–ê */}
                                <div className="w-full flex flex-col items-start gap-4 pl-0">
                                    <button onClick={()=>setEventScreen('treasure')} className="olympus-btn w-64">
                                        ‚ö°Ô∏è –°–æ–∫—Ä–æ–≤–∏—â–µ –û–ª–∏–º–ø–∞
                                    </button>
                                    <button onClick={()=>setShowGefestModal(true)} className="olympus-btn w-64">
                                        üèµÔ∏è –õ–∞–≤–∫–∞ –ì–µ—Ñ–µ—Å—Ç–∞
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* TREASURE */}
                    {eventScreen==='treasure' && (
                        <div className="olympus-font">
                            <button onClick={()=>setEventScreen('main')} className="mb-3 text-yellow-300 hover:text-yellow-400 font-bold transition text-sm">‚Üê –ù–∞–∑–∞–¥</button>
                            <div className="rounded-2xl overflow-hidden mb-4 treasure-bg-wrap" style={{backgroundImage:`url('${treasureBg}')`,backgroundBlendMode:'overlay',background:'rgba(20,10,30,0.82)'}}>
                                <div className="p-4">
                                    <h3 className="text-2xl font-bold text-center mb-3 olympus-title olympus-font-black">‚ö°Ô∏è –°–æ–∫—Ä–æ–≤–∏—â–µ –û–ª–∏–º–ø–∞</h3>

                                    {/* Bg upload */}
                                    <div className="glass rounded-xl p-3 mb-4">
                                        <p className="text-center text-xs olympus-label mb-2">üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ–Ω (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ)</p>
                                        <input type="file" accept="image/*" className="w-full text-xs mb-2"
                                            onChange={e=>{ const f=e.target.files?.[0]; if(!f) return; const rd=new FileReader(); rd.onload=()=>{ const d=String(rd.result||''); localStorage.setItem('olymp_bg',d); setTreasureBg(d); }; rd.readAsDataURL(f); }} />
                                        <button className="w-full bg-gray-800/60 hover:bg-gray-800 py-1.5 rounded-lg text-xs font-bold" onClick={()=>{ localStorage.removeItem('olymp_bg'); setTreasureBg('case.jpg'); }}>–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞ case.jpg</button>
                                    </div>

                                    {/* Olympus Case */}
                                    <div className="glass rounded-2xl p-4 mb-4 text-center border-2 border-yellow-500/50" style={{boxShadow:'0 0 30px rgba(251,191,36,0.3)'}}>
                                        <div className="w-28 h-28 mx-auto mb-3 rounded-xl bg-gradient-to-br from-yellow-400 to-amber-600 flex items-center justify-center text-6xl shadow-xl border-2 border-yellow-300/50" style={{boxShadow:'0 0 25px rgba(251,191,36,0.6)'}}>‚ö°Ô∏è</div>
                                        <h4 className="text-xl font-bold mb-1 olympus-label olympus-font-black">–ö–µ–π—Å ¬´–û–ª–∏–º–ø‚ö°Ô∏è¬ª</h4>
                                        <p className="text-sm text-gray-300 mb-1">–¶–µ–Ω–∞: <span className="font-bold text-yellow-400 text-base">77‚≠êÔ∏è</span></p>
                                        {(cases.olympus?.freeCount||0)>0 && <p className="text-green-400 font-bold text-sm mb-2">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö: {cases.olympus.freeCount}</p>}
                                        <button onClick={()=>{ const oc=cases.olympus||{id:'olympus',name:'–û–ª–∏–º–ø‚ö°Ô∏è',emoji:'‚ö°Ô∏è',price:77,freeCount:0,type:'event'}; handleSelectCase(oc); }} className="w-full bg-gradient-to-r from-yellow-500 to-amber-600 hover:from-yellow-400 hover:to-amber-500 py-3 rounded-xl font-bold transition olympus-label" style={{boxShadow:'0 0 20px rgba(251,191,36,0.5)'}}>
                                            –û—Ç–∫—Ä—ã—Ç—å ‚≠êÔ∏è
                                        </button>
                                        {/* Rewards list */}
                                        <div className="mt-3 text-left max-h-36 overflow-y-auto">
                                            {CASE_REWARDS.olympus.map((r,i)=>(
                                                <div key={i} className="flex justify-between py-1 border-b border-white/10 last:border-0 text-xs">
                                                    <span>{r.emoji} {r.name}</span>
                                                    <span className="text-yellow-400 font-bold">{r.displayChance}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Progress ladder */}
                                    <div className="glass rounded-2xl p-4 border border-yellow-500/30">
                                        <h4 className="text-lg font-bold text-center mb-2 olympus-label olympus-font-black">üèÜ –õ–µ—Å—Ç–Ω–∏—Ü–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</h4>
                                        <p className="text-center text-xs olympus-label mb-2">–û—Ç–∫—Ä—ã—Ç–æ –∫–µ–π—Å–æ–≤: <span className="text-yellow-300 font-bold">{olympusOpens}</span></p>
                                        <div className="w-full h-3 bg-black/60 rounded-full overflow-hidden mb-3 border border-yellow-400/40">
                                            <div className="h-full bg-gradient-to-r from-yellow-400 to-amber-500 rounded-full transition-all" style={{width:`${Math.min(100,(olympusOpens/150)*100)}%`}} />
                                        </div>
                                        <div className="space-y-2 max-h-72 overflow-y-auto">
                                            {OLYMPUS_PROGRESS.map((step,idx)=>{
                                                const done=olympusProgress.includes(step.opens);
                                                const active=olympusOpens>=step.opens&&!done;
                                                return (
                                                    <div key={idx} className={`progress-step ${done?'completed':''} ${active?'active':''}`}>
                                                        <div className="flex justify-between items-center">
                                                            <span className="text-xs font-bold olympus-label">{step.opens} –æ—Ç–∫—Ä—ã—Ç–∏–π</span>
                                                            {done && <span className="text-green-400 font-bold">‚úì –ü–æ–ª—É—á–µ–Ω–æ</span>}
                                                            {active && <span className="text-yellow-400 text-xs animate-pulse">‚Üí –ó–∞–±—Ä–∞—Ç—å!</span>}
                                                        </div>
                                                        <p className="text-xs text-gray-200 mt-1">{step.name}</p>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* HEROES */}
                    {eventScreen==='heroes' && (
                        <div className="olympus-font">
                            <button onClick={()=>setEventScreen('main')} className="mb-3 text-yellow-300 hover:text-yellow-400 font-bold transition text-sm">‚Üê –ù–∞–∑–∞–¥</button>
                            <div className="rounded-2xl p-5 hero-bg" style={{backgroundBlendMode:'overlay',background:'rgba(10,5,30,0.80)',minHeight:'400px'}}>
                                <h2 className="text-2xl font-bold text-center mb-5 olympus-title olympus-font-black">üèÜ –ì–µ—Ä–æ–∏ –û–ª–∏–º–ø–∞ üèÜ</h2>
                                {olympusTopPlayers.length===0 && <p className="text-center text-gray-400 text-sm">–ü–æ–∫–∞ –Ω–µ—Ç –≥–µ—Ä–æ–µ–≤. –û—Ç–∫—Ä–æ–π –∫–µ–π—Å ¬´–û–ª–∏–º–ø‚ö°Ô∏è¬ª –ø–µ—Ä–≤—ã–º!</p>}
                                <div className="space-y-3 mb-5">
                                    {olympusTopPlayers.map((p,idx)=>(
                                        <div key={p.id} className="glass rounded-xl p-3 flex items-center gap-3 border border-yellow-500/20">
                                            <span className="text-3xl">{idx===0?'ü•á':idx===1?'ü•à':idx===2?'ü•â':`${idx+1}.`}</span>
                                            {p.avatar ? <img src={p.avatar} alt="" className="w-12 h-12 rounded-full border-2 border-yellow-400/50" /> : <div className="w-12 h-12 rounded-full bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center text-white font-bold text-xl">{(p.name||'?').charAt(0)}</div>}
                                            <div className="flex-1">
                                                <div className="font-bold text-sm olympus-label">{p.name}</div>
                                                <div className="text-xs text-gray-300">–û—Ç–∫—Ä—ã—Ç–æ: <span className="text-yellow-400 font-bold">{p.olympusOpens}</span></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <p className="text-center olympus-label text-sm" style={{textShadow:'0 0 10px #fbbf24'}}>üèÖ –¢–æ–ø 3 –ø–æ–ª—É—á–∞—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã –≤ –∫–æ–Ω—Ü–µ –∏–≤–µ–Ω—Ç–∞!</p>
                            </div>
                        </div>
                    )}
                </div>)}

                {/* ‚ïê‚ïê TASKS SCREEN ‚ïê‚ïê */}
                {currentScreen==='tasks' && (
                    <div>
                        <h2 className="text-2xl font-bold mb-4 text-center">üìã –ó–∞–¥–∞–Ω–∏—è</h2>
                        <div className="space-y-3">
                            {/* Subscribe */}
                            <div className={`glass rounded-xl p-4 ${tasks.subscribe?.completed?'bg-green-500/20':''}`}>
                                <div className="flex justify-between items-start mb-2">
                                    <div><h3 className="font-bold text-sm">–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª</h3><p className="text-xs opacity-75">–ù–∞–≥—Ä–∞–¥–∞: 1 –∫–µ–π—Å ¬´–≠–ª–∏—Ç–∞¬ª üéñ</p></div>
                                    {tasks.subscribe?.completed && <span className="text-green-400 text-xl">‚úÖ</span>}
                                </div>
                                <button onClick={()=>completeTask('subscribe')} disabled={tasks.subscribe?.completed} className={`w-full py-2 rounded-lg text-sm ${tasks.subscribe?.completed?'bg-green-600':'bg-blue-600 hover:bg-blue-500'} transition`}>{tasks.subscribe?.completed?'–í—ã–ø–æ–ª–Ω–µ–Ω–æ':'–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è'}</button>
                            </div>
                            {/* Invite */}
                            <div className={`glass rounded-xl p-4 ${tasks.inviteThree?.completed?'bg-green-500/20':''}`}>
                                <div className="flex justify-between items-start mb-2">
                                    <div><h3 className="font-bold text-sm">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å 3 –¥—Ä—É–∑–µ–π</h3><p className="text-xs opacity-75">–ù–∞–≥—Ä–∞–¥–∞: 25 ‚≠êÔ∏è</p>{!tasks.inviteThree?.completed&&<p className="text-xs text-cyan-400 mt-0.5">–ü—Ä–æ–≥—Ä–µ—Å—Å: {tasks.inviteThree?.count||0}/3</p>}</div>
                                    {tasks.inviteThree?.completed&&<span className="text-green-400 text-xl">‚úÖ</span>}
                                </div>
                                <button onClick={()=>completeTask('inviteThree')} disabled={tasks.inviteThree?.completed} className={`w-full py-2 rounded-lg text-sm ${tasks.inviteThree?.completed?'bg-green-600':'bg-blue-600 hover:bg-blue-500'} transition`}>{tasks.inviteThree?.completed?'–í—ã–ø–æ–ª–Ω–µ–Ω–æ':'–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å'}</button>
                            </div>
                            {/* Cardboard x7 */}
                            <div className={`glass rounded-xl p-4 ${tasks.cardboard7?.completed?'bg-green-500/20':''}`}>
                                <div className="flex justify-between items-start mb-2">
                                    <div><h3 className="font-bold text-sm">–ü—Ä–æ–∫—Ä—É—Ç–∏ –∫–µ–π—Å ¬´–ö–∞—Ä—Ç–æ–Ωüì¶¬ª 7 —Ä–∞–∑</h3><p className="text-xs opacity-75">–ù–∞–≥—Ä–∞–¥–∞: 1 –∫–µ–π—Å ¬´–ê–ª–º–∞–∑üíé¬ª</p>{!tasks.cardboard7?.completed&&<p className="text-xs text-cyan-400 mt-0.5">–ü—Ä–æ–≥—Ä–µ—Å—Å: {tasks.cardboard7?.count||0}/7</p>}</div>
                                    {tasks.cardboard7?.completed&&<span className="text-green-400 text-xl">‚úÖ</span>}
                                </div>
                                <div className={`w-full py-2 rounded-lg text-sm text-center font-bold ${tasks.cardboard7?.completed?'bg-green-600':'bg-gray-600 opacity-70'}`}>{tasks.cardboard7?.completed?'–í—ã–ø–æ–ª–Ω–µ–Ω–æ':'–û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –∫–µ–π—Å ¬´–ö–∞—Ä—Ç–æ–Ω¬ª'}</div>
                            </div>
                            {/* Deposit 50 */}
                            <div className={`glass rounded-xl p-4 ${tasks.deposit50?.completed?'bg-green-500/20':''}`}>
                                <div className="flex justify-between items-start mb-2">
                                    <div><h3 className="font-bold text-sm">–ü–æ–ø–æ–ª–Ω–∏ –±–∞–ª–∞–Ω—Å –Ω–∞ 50‚≠êÔ∏è</h3><p className="text-xs opacity-75">–ù–∞–≥—Ä–∞–¥–∞: 50‚≠êÔ∏è</p></div>
                                    {tasks.deposit50?.completed&&<span className="text-green-400 text-xl">‚úÖ</span>}
                                </div>
                                <button onClick={()=>completeTask('deposit50')} disabled={tasks.deposit50?.completed} className={`w-full py-2 rounded-lg text-sm ${tasks.deposit50?.completed?'bg-green-600':'bg-blue-600 hover:bg-blue-500'} transition`}>{tasks.deposit50?.completed?'–í—ã–ø–æ–ª–Ω–µ–Ω–æ':'–ü–æ–ø–æ–ª–Ω–∏—Ç—å'}</button>
                            </div>
                            {/* Deposit 100 */}
                            <div className={`glass rounded-xl p-4 ${tasks.deposit?.completed?'bg-green-500/20':''}`}>
                                <div className="flex justify-between items-start mb-2">
                                    <div><h3 className="font-bold text-sm">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ 100 ‚≠êÔ∏è</h3><p className="text-xs opacity-75">–ù–∞–≥—Ä–∞–¥–∞: 1 –∑–æ–ª–æ—Ç–æ–π –∫–µ–π—Å üëë</p></div>
                                    {tasks.deposit?.completed&&<span className="text-green-400 text-xl">‚úÖ</span>}
                                </div>
                                <button onClick={()=>completeTask('deposit')} disabled={tasks.deposit?.completed} className={`w-full py-2 rounded-lg text-sm ${tasks.deposit?.completed?'bg-green-600':'bg-blue-600 hover:bg-blue-500'} transition`}>{tasks.deposit?.completed?'–í—ã–ø–æ–ª–Ω–µ–Ω–æ':'–ü–æ–ø–æ–ª–Ω–∏—Ç—å'}</button>
                            </div>
                            {/* Deposit 350 */}
                            <div className={`glass rounded-xl p-4 ${tasks.depositMajor?.completed?'bg-green-500/20':''}`}>
                                <div className="flex justify-between items-start mb-2">
                                    <div><h3 className="font-bold text-sm">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ 350 ‚≠êÔ∏è</h3><p className="text-xs opacity-75">–ù–∞–≥—Ä–∞–¥–∞: –ö–µ–π—Å ¬´–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä¬ª + 1 –ø—Ä–æ–∫—Ä—É—Ç</p></div>
                                    {tasks.depositMajor?.completed&&<span className="text-green-400 text-xl">‚úÖ</span>}
                                </div>
                                <button onClick={()=>completeTask('depositMajor')} disabled={tasks.depositMajor?.completed} className={`w-full py-2 rounded-lg text-sm ${tasks.depositMajor?.completed?'bg-green-600':'bg-blue-600 hover:bg-blue-500'} transition`}>{tasks.depositMajor?.completed?'–í—ã–ø–æ–ª–Ω–µ–Ω–æ':'–ü–æ–ø–æ–ª–Ω–∏—Ç—å'}</button>
                            </div>
                        </div>
                    </div>
                )}

                {/* ‚ïê‚ïê PROFILE SCREEN ‚ïê‚ïê */}
                {currentScreen==='profile' && (
                    <div>
                        <div className="glass rounded-xl p-3 mb-4 flex justify-between items-center">
                            <span className="text-gray-400 text-sm">üü¢ –û–Ω–ª–∞–π–Ω:</span>
                            <span className="font-bold text-green-400 text-sm">{onlineCount} –∏–≥—Ä–æ–∫–æ–≤</span>
                        </div>
                        <h2 className="text-2xl font-bold mb-4 text-center">üë§ –ú–æ–π –ü—Ä–æ—Ñ–∏–ª—å</h2>
                        <div className="glass rounded-xl p-5 text-center mb-4">
                            <div className="w-20 h-20 mx-auto rounded-full bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center text-3xl mb-3 overflow-hidden border-2 border-white/20">
                                {user?.avatar?<img src={user.avatar} alt="" className="w-full h-full object-cover" />:user?.name?.charAt(0).toUpperCase()}
                            </div>
                            <h3 className="text-lg font-bold">{user?.name}</h3>
                            {user?.username&&<p className="text-gray-400 text-sm">{user.username}</p>}
                        </div>
                        <div className="flex gap-2 mb-4">
                            <button onClick={()=>setShowTopUp(true)} className="flex-1 bg-gradient-to-r from-yellow-400 to-orange-500 text-gray-900 font-bold py-3 rounded-xl shadow-lg transition text-sm">üíé –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                        </div>
                        <div className="mb-4">
                            <button onClick={()=>setShowWithdrawModal(true)} className="w-full bg-gradient-to-r from-purple-500 to-indigo-600 text-white font-bold py-3 rounded-xl shadow-lg transition text-sm">üèÜ –í—ã–≤–µ—Å—Ç–∏ –ø—Ä–∏–∑—ã üèÜ</button>
                        </div>
                        <div className="glass rounded-xl p-4 mb-4">
                            <h3 className="font-bold mb-2 text-sm">üéÅ –ü—Ä–æ–º–æ–∫–æ–¥</h3>
                            <div className="flex gap-2">
                                <input type="text" placeholder="–ü–†–û–ú–û–ö–û–î" value={promoCode} onChange={e=>setPromoCode(e.target.value)} className="flex-1 bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-center uppercase text-sm" />
                                <button onClick={checkPromo} className="bg-indigo-600 hover:bg-indigo-500 px-4 py-2 rounded-lg font-bold transition text-sm">OK</button>
                            </div>
                            {promoError&&<p className="text-red-400 text-xs mt-2 text-center">{promoError}</p>}
                            {promoSuccess&&<p className="text-green-400 text-xs mt-2 text-center">{promoSuccess}</p>}
                        </div>
                        <div className="glass rounded-xl p-4">
                            <div className="flex justify-between items-center mb-3">
                                <h3 className="font-bold text-sm">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
                                <span className="text-xs text-gray-400">{inventory.length}/{inventorySlots}</span>
                            </div>
                            <div className="grid grid-cols-5 gap-2 mb-3">
                                {[...Array(inventorySlots)].map((_,i)=>(
                                    <div key={i} className="aspect-square bg-gray-700/50 rounded-lg flex items-center justify-center text-2xl hover:bg-gray-600/50 transition cursor-pointer">
                                        {inventory[i]?<span onClick={()=>sellItem(inventory[i])} className="hover:scale-110 transition">{inventory[i].emoji}</span>:<span className="text-gray-600 text-xs">‚óã</span>}
                                    </div>
                                ))}
                            </div>
                            <button onClick={unlockSlot} disabled={balance<50} className="w-full bg-gray-700 hover:bg-gray-600 disabled:opacity-50 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition">üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç (50‚≠êÔ∏è)</button>
                        </div>
                    </div>
                )}
            </main>

            {/* ‚îÄ‚îÄ‚îÄ ROULETTE MODAL ‚îÄ‚îÄ‚îÄ */}
            {selectedCase && (
                <div className="fullscreen-modal flex items-center justify-center p-4">
                    <div className="w-full max-w-lg" ref={rouletteContainerRef}>
                        <div className="flex justify-between items-center mb-5">
                            <h3 className="text-2xl font-bold">{selectedCase.emoji} {selectedCase.name}</h3>
                            <button onClick={()=>{ setSelectedCase(null); setSpinResult(null); setFakeItems([]); }} className="text-3xl hover:text-red-400 transition">√ó</button>
                        </div>
                        <div className="roulette-container mb-5">
                            <div className="roulette-pointer" />
                            <div key={rouletteKey} className="roulette-inner" style={{transform:`translateX(${rouletteOffset}px)`}}>
                                {fakeItems.length>0?fakeItems.map((item,i)=>(
                                    <div key={i} className="roulette-item"><div className="emoji">{item.emoji}</div><div className="name">{item.name}</div></div>
                                )):[...Array(80)].map((_,i)=><div key={i} className="roulette-item"><div className="emoji">‚ùì</div></div>)}
                            </div>
                        </div>
                        <div className="glass rounded-xl p-4 mb-5 max-h-40 overflow-y-auto">
                            <p className="font-bold mb-2 text-center text-sm">–í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã:</p>
                            <div className="space-y-1">
                                {(CASE_REWARDS[selectedCase.id]||[]).map((r,i)=>(
                                    <div key={i} className="flex justify-between py-1 border-b border-white/10 last:border-0 text-xs">
                                        <span>{r.emoji} {r.name}</span>
                                        <span className="text-yellow-400 font-bold">{r.displayChance}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                        {spinResult?(
                            <div className="text-center">
                                <p className="text-xl font-bold mb-2">üéâ –í—ã–ø–∞–ª–æ: {spinResult.name}!</p>
                                {spinResult.type==='collectible'&&<p className="text-yellow-400 text-xs mb-4">‚≠êÔ∏è –ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç!</p>}
                                <button onClick={()=>{ setSpinResult(null); openCase(selectedCase.id); }} className="w-full bg-green-600 hover:bg-green-500 py-3 rounded-xl font-bold mb-2 transition">–ó–∞–±—Ä–∞—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç—å –µ—â—ë</button>
                                <button onClick={()=>{ setSelectedCase(null); setSpinResult(null); setFakeItems([]); }} className="w-full bg-gray-600 hover:bg-gray-500 py-2.5 rounded-xl font-bold transition text-sm">–ö –∫–µ–π—Å–∞–º</button>
                            </div>
                        ):(
                            <button onClick={()=>openCase(selectedCase.id)} disabled={isSpinning||(selectedCase.id==='daily'&&selectedCase.freeCount===0)} className="w-full bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 py-4 rounded-xl font-bold text-lg disabled:opacity-50 shadow-lg transition">
                                {isSpinning?'üåÄ –ö—Ä—É—Ç–∏–º...':(selectedCase.id==='daily'&&selectedCase.freeCount===0?dailyCaseTimeLeft:`–û—Ç–∫—Ä—ã—Ç—å –∑–∞ ${getCasePrice(selectedCase.id)===0?'–ë–µ—Å–ø–ª–∞—Ç–Ω–æ':getCasePrice(selectedCase.id)+'‚≠êÔ∏è'}`)}
                            </button>
                        )}
                    </div>
                </div>
            )}

            {/* ‚îÄ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ‚îÄ */}
            <nav className="fixed bottom-0 left-0 right-0 glass border-t border-white/10 p-2 z-40">
                <div className="max-w-md mx-auto flex justify-around">
                    {[{id:'tasks',emoji:'üìã',label:'–ó–∞–¥–∞–Ω–∏—è'},{id:'cases',emoji:'üéÅ',label:'–ö–µ–π—Å—ã'},{id:'events',emoji:'üèõÔ∏è',label:'–ò–≤–µ–Ω—Ç—ã'},{id:'games',emoji:'üéÆ',label:'–ò–≥—Ä—ã'},{id:'profile',emoji:'üë§',label:'–ü—Ä–æ—Ñ–∏–ª—å'}].map(s=>(
                        <button key={s.id} onClick={()=>{ setCurrentScreen(s.id); if(s.id==='events') setEventScreen('main'); }} className={`flex flex-col items-center p-2 rounded-lg transition ${currentScreen===s.id?'events-tab-active text-yellow-400 scale-110':'text-gray-400 hover:text-white'}`}>
                            <span className="text-2xl">{s.emoji}</span>
                            <span className="text-xs font-bold">{s.label}</span>
                        </button>
                    ))}
                </div>
            </nav>
        </div>
    );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
