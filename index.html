<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Step By Step Game</title>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
tailwind.config = {
darkMode: 'class',
theme: {
extend: {
colors: { primary: '#6366f1', secondary: '#8b5cf6', accent: '#f59e0b', ice: '#00d2ff' }
}
}
}
</script>
<style>
@keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
.roulette-container { position: relative; width: 100%; height: 160px; overflow: hidden; background: rgba(0,0,0,0.4); border-radius: 16px; border: 2px solid rgba(255,255,255,0.1); margin: 20px 0; }
.roulette-inner { display: flex; position: absolute; left: 0; top: 20px; transition: transform 6.5s cubic-bezier(0.15, 0, 0.15, 1); will-change: transform; }
.roulette-item { width: 120px; height: 120px; flex-shrink: 0; margin: 0 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05)); border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); }
.roulette-item .emoji { font-size: 3.5rem; }
.roulette-item .name { font-size: 11px; opacity: 0.8; text-align: center; margin-top: 4px; }
.roulette-pointer { position: absolute; left: 50%; top: 0; bottom: 0; width: 4px; background: #ff4757; z-index: 20; transform: translateX(-50%); box-shadow: 0 0 20px #ff4757; }
.roulette-pointer::before { content: ''; position: absolute; top: -5px; left: 50%; transform: translateX(-50%); border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 15px solid #ff4757; }
.roulette-pointer::after { content: ''; position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%); border-left: 10px solid transparent; border-right: 10px solid transparent; border-bottom: 15px solid #ff4757; }
.glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
.line-through { text-decoration: line-through; opacity: 0.5; }
.fullscreen-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 100; overflow-y: auto; }
.ice-circle { width: 320px; height: 320px; border-radius: 50%; border: 4px solid rgba(0,210,255,0.5); position: relative; overflow: hidden; background: radial-gradient(circle, rgba(0,210,255, 0%), rgba(0,128,255,0.2) 160px, rgba(0,128,255,0.4) 100%); box-shadow: 0 0 30px rgba(0,210,255,0.3); }
.ice-ball { position: absolute; width: 40px; height: 40px; background: radial-gradient(circle at 30% 30%, #fff, #00d2ff); border-radius: 50%; box-shadow: 0 0 20px rgba(0,210,255,0.8); z-index: 10; transform: translate(-50%, -50%); border: 2px solid rgba(255,255,255,0.5); transition: left 0.025s linear, top 0.025s linear; }
.player-avatar { position: absolute; width: 40px; height: 40px; border-radius: 50%; border: 2px solid white; overflow: hidden; transform: translate(-50%, -50%); z-index: 5; transition: left 0.3s ease, top 0.3s ease; }
.case-cardboard { background: linear-gradient(135deg, #8B4513 0%, #D2691E 50%, #8B4513 100%); border: 3px solid #A0522D; }
.case-collector { background: linear-gradient(135deg, #DC143C 0%, #FF1493 50%, #8B008B 100%); border: 3px solid #FFD700; }
</style>
</head>
<body class="bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 min-h-screen text-white overflow-x-hidden">
<div id="root"></div>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel">
const { useState, useEffect, useRef } = React;
const firebaseConfig = {
apiKey: "AIzaSyDZPRiByz69HQa8b7GFMCJeqq56J3Y-bOY",
authDomain: "step-by-step-279df.firebaseapp.com",
databaseURL: "https://step-by-step-279df-default-rtdb.europe-west1.firebasedatabase.app",
projectId: "step-by-step-279df",
storageBucket: "step-by-step-279df.firebasestorage.app",
messagingSenderId: "302641152597",
appId: "1:302641152597:web:6479b9ae03104666cd8adc"
};
if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const TelegramWebApp = window.Telegram?.WebApp;
const ADMIN_WALLET = 'UQAWqaIPFSg81l9MlgAx0HBE9o3gpJMhk1dnyryKJXhWNHIc';
const TONCENTER_API = 'https://toncenter.com/api/v2';
const BOT_TOKEN = '8325421899:AAHRdmMYdjJMXmAVIynDsQtpUNsSeKkaOis';

const CASE_REWARDS = {
cardboard: [
{ id: 'stars_0_25', name: '0.25 ‚≠êÔ∏è', displayChance: '80%', realChance: 80, type: 'stars', value: 0.25, emoji: '‚≠êÔ∏è' },
{ id: 'stars_0_75', name: '0.75 ‚≠êÔ∏è', displayChance: '10%', realChance: 10, type: 'stars', value: 0.75, emoji: '‚≠êÔ∏è' },
{ id: 'stars_1_5', name: '1.5 ‚≠êÔ∏è', displayChance: '6%', realChance: 6, type: 'stars', value: 1.5, emoji: '‚≠êÔ∏è' },
{ id: 'stars_5', name: '5 ‚≠êÔ∏è', displayChance: '2%', realChance: 2, type: 'stars', value: 5, emoji: '‚≠êÔ∏è' },
{ id: 'bear', name: 'üß∏', displayChance: '1.5%', realChance: 1.5, type: 'item', sellPrice: 20, emoji: 'üß∏' },
{ id: 'diamond_pro', name: 'üíé PRO', displayChance: '0.5%', realChance: 0.5, type: 'collectible', emoji: 'üíé' }
],
coal: [
{ id: 'stars_2_5', name: '2.5 ‚≠êÔ∏è', displayChance: '60%', realChance: 60, type: 'stars', value: 2.5, emoji: '‚≠êÔ∏è' },
{ id: 'stars_5', name: '5 ‚≠êÔ∏è', displayChance: '18%', realChance: 18, type: 'stars', value: 5, emoji: '‚≠êÔ∏è' },
{ id: 'pickaxe', name: '–ö–∏—Ä–∫–∞ ‚õèÔ∏è', displayChance: '10%', realChance: 10, type: 'item', sellPrice: 10, emoji: '‚õèÔ∏è' },
{ id: 'stars_15', name: '15 ‚≠êÔ∏è', displayChance: '6%', realChance: 6, type: 'stars', value: 15, emoji: '‚≠êÔ∏è' },
{ id: 'material', name: '–ú–∞—Ç–µ—Ä–∏–∞–ª üß±', displayChance: '5%', realChance: 5, type: 'item', sellPrice: 40, emoji: 'üß±' },
{ id: 'brownie_pro', name: 'Happy Brownie PRO üí©', displayChance: '1%', realChance: 1, type: 'collectible', emoji: 'üí©' }
],
platinum: [
{ id: 'stars_35', name: '35 ‚≠êÔ∏è', displayChance: '55%', realChance: 55, type: 'stars', value: 35, emoji: '‚≠êÔ∏è' },
{ id: 'stars_50', name: '50 ‚≠êÔ∏è', displayChance: '35%', realChance: 35, type: 'stars', value: 50, emoji: '‚≠êÔ∏è' },
{ id: 'ring', name: 'üíç', displayChance: '5%', realChance: 5, type: 'collectible', emoji: 'üíç' },
{ id: 'bday', name: 'B-day üóì', displayChance: '4%', realChance: 4, type: 'item', sellPrice: 150, emoji: 'üóì' },
{ id: 'bday_pro', name: 'B-Day PRO üìÖ', displayChance: '1%', realChance: 1, type: 'collectible', emoji: 'üìÖ' }
],
gold: [
{ id: 'stars_50', name: '50 ‚≠êÔ∏è', displayChance: '50%', realChance: 50, type: 'stars', value: 50, emoji: '‚≠êÔ∏è' },
{ id: 'stars_125', name: '125 ‚≠êÔ∏è', displayChance: '35%', realChance: 35, type: 'stars', value: 125, emoji: '‚≠êÔ∏è' },
{ id: 'clover', name: 'üçÄ Clover Pin', displayChance: '10%', realChance: 10, type: 'item', sellPrice: 200, emoji: 'üçÄ' },
{ id: 'icecream', name: 'Ice Cream üç¶', displayChance: '3%', realChance: 3, type: 'collectible', emoji: 'üç¶' },
{ id: 'clover_pro', name: 'üçÄ Clover Pin PRO', displayChance: '2%', realChance: 2, type: 'collectible', emoji: 'üçÄ' }
],
money: [
{ id: 'stars_150', name: '150 ‚≠êÔ∏è', displayChance: '45%', realChance: 45, type: 'stars', value: 150, emoji: '‚≠êÔ∏è' },
{ id: 'stars_75', name: '75 ‚≠êÔ∏è', displayChance: '40%', realChance: 40, type: 'stars', value: 75, emoji: '‚≠êÔ∏è' },
{ id: 'trophy', name: 'üèÜ', displayChance: '5%', realChance: 5, type: 'collectible', emoji: 'üèÜ' },
{ id: 'gem', name: 'üíé', displayChance: '5%', realChance: 5, type: 'collectible', emoji: 'üíé' },
{ id: 'bday_happy', name: 'Happy B-day üíà', displayChance: '4%', realChance: 4, type: 'collectible', emoji: 'üíà' },
{ id: 'cigar', name: 'Snoop Cigar üö¨', displayChance: '1%', realChance: 1, type: 'collectible', emoji: 'üö¨' }
],
elite: [
{ id: 'stars_200', name: '200 ‚≠êÔ∏è', displayChance: '75%', realChance: 75, type: 'stars', value: 200, emoji: '‚≠êÔ∏è' },
{ id: 'stars_275', name: '275 ‚≠êÔ∏è', displayChance: '5%', realChance: 5, type: 'stars', value: 275, emoji: '‚≠êÔ∏è' },
{ id: 'champagne', name: 'üçæ', displayChance: '17%', realChance: 17, type: 'collectible', emoji: 'üçæ' },
{ id: 'socks', name: '–ù–æ—Å–∫–∏ üß¶', displayChance: '2%', realChance: 2, type: 'collectible', emoji: 'üß¶' },
{ id: 'lightsword', name: 'Light Sword ‚öîÔ∏è', displayChance: '1%', realChance: 1, type: 'collectible', emoji: '‚öîÔ∏è' }
],
diamond: [
{ id: 'stars_8', name: '8 ‚≠êÔ∏è', displayChance: '70%', realChance: 70, type: 'stars', value: 8, emoji: '‚≠êÔ∏è' },
{ id: 'bear', name: '–ú–∏—à–∫–∞ üß∏', displayChance: '15%', realChance: 15, type: 'item', sellPrice: 20, emoji: 'üß∏' },
{ id: 'stars_25', name: '25 ‚≠êÔ∏è', displayChance: '9%', realChance: 9, type: 'stars', value: 25, emoji: '‚≠êÔ∏è' },
{ id: 'stars_80', name: '80 ‚≠êÔ∏è', displayChance: '4%', realChance: 4, type: 'stars', value: 80, emoji: '‚≠êÔ∏è' },
{ id: 'diamond_pro', name: '–ê–ª–º–∞–∑ PRO üíé', displayChance: '0.6%', realChance: 0.6, type: 'collectible', emoji: 'üíé' },
{ id: 'snoop_pro', name: 'Snoop Dog PRO üêï', displayChance: '0.4%', realChance: 0.4, type: 'collectible', emoji: 'üêï' }
],
winter: [
{ id: 'stars_20', name: '20 ‚≠êÔ∏è', displayChance: '60%', realChance: 60, type: 'stars', value: 20, emoji: '‚≠êÔ∏è' },
{ id: 'stars_35', name: '35 ‚≠êÔ∏è', displayChance: '35%', realChance: 35, type: 'stars', value: 35, emoji: '‚≠êÔ∏è' },
{ id: 'stars_80', name: '80 ‚≠êÔ∏è', displayChance: '3.5%', realChance: 3.5, type: 'stars', value: 80, emoji: '‚≠êÔ∏è' },
{ id: 'snake', name: 'üéÑ Lunar Snake 2025 üêç', displayChance: '1%', realChance: 1, type: 'collectible', emoji: 'üêç' },
{ id: 'scarf', name: 'üß£ –ó–∏–º–Ω–µ–µ —Å–æ–∫—Ä–æ–≤–∏—â–µ', displayChance: '0.5%', realChance: 0.5, type: 'collectible', emoji: 'üß£' }
],
major: [
{ id: 'stars_500', name: '500 ‚≠êÔ∏è', displayChance: '50%', realChance: 50, type: 'stars', value: 500, emoji: '‚≠êÔ∏è' },
{ id: 'stars_1000', name: '1000 ‚≠êÔ∏è', displayChance: '25%', realChance: 25, type: 'stars', value: 1000, emoji: '‚≠êÔ∏è' },
{ id: 'stars_2500', name: '2500 ‚≠êÔ∏è', displayChance: '10%', realChance: 10, type: 'stars', value: 2500, emoji: '‚≠êÔ∏è' },
{ id: 'stars_5000', name: '5000 ‚≠êÔ∏è', displayChance: '5%', realChance: 5, type: 'stars', value: 5000, emoji: '‚≠êÔ∏è' },
{ id: 'car', name: 'üöó –ê–≤—Ç–æ–º–æ–±–∏–ª—å', displayChance: '5%', realChance: 5, type: 'collectible', emoji: 'üöó' },
{ id: 'diamond_ring', name: 'üíç –ë—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤–æ–µ –∫–æ–ª—å—Ü–æ', displayChance: '3%', realChance: 3, type: 'collectible', emoji: 'üíç' },
{ id: 'gold_bar', name: 'ü•á –ó–æ–ª–æ—Ç–æ–π —Å–ª–∏—Ç–æ–∫', displayChance: '2%', realChance: 2, type: 'collectible', emoji: 'ü•á' }
],
collector: [
{ id: 'bear_pro', name: 'üß∏ PRO', displayChance: '55%', realChance: 55, type: 'collectible', emoji: 'üß∏' },
{ id: 'gift_pro', name: 'üéÅ PRO', displayChance: '20%', realChance: 20, type: 'collectible', emoji: 'üéÅ' },
{ id: 'rocket_pro', name: 'üöÄ PRO', displayChance: '15%', realChance: 15, type: 'collectible', emoji: 'üöÄ' },
{ id: 'cup_pro', name: 'üèÜ PRO', displayChance: '5%', realChance: 5, type: 'collectible', emoji: 'üèÜ' },
{ id: 'cake_candle', name: 'üç∞B-day Candle', displayChance: '2%', realChance: 2, type: 'collectible', emoji: 'üç∞' },
{ id: 'ramen_pro', name: 'üçúRamen PRO', displayChance: '1.5%', realChance: 0.5, type: 'collectible', emoji: 'üçú' },
{ id: 'hat_pro', name: 'üé© Top hat', displayChance: '1%', realChance: 0, type: 'collectible', emoji: 'üé©' },
{ id: 'bird_pro', name: 'ü¶ÖRare bird', displayChance: '0.5%', realChance: 0, type: 'collectible', emoji: 'ü¶Ö' }
]
};

const INITIAL_CASES = {
cardboard: { id: 'cardboard', name: '–ö–∞—Ä—Ç–æ–Ω', emoji: 'üì¶', price: 3, color: 'from-amber-800 to-amber-900', locked: false, isNew: true, freeCount: 0 },
coal: { id: 'coal', name: '–£–≥–æ–ª—ë–∫', emoji: 'ü™®', price: 22, originalPrice: 22, discountPrice: 20, color: 'from-gray-600 to-gray-800', locked: false, isNew: false, freeCount: 0 },
platinum: { id: 'platinum', name: '–ü–ª–∞—Ç–∏–Ω–∞', emoji: 'üíé', price: 100, color: 'from-gray-300 to-gray-500', locked: false },
gold: { id: 'gold', name: '–ó–æ–ª–æ—Ç–æ–π', emoji: 'üëë', price: 250, color: 'from-yellow-400 to-yellow-600', locked: false },
money: { id: 'money', name: '–î–µ–Ω–µ–∂–Ω—ã–π', emoji: 'üíµ', price: 350, color: 'from-green-400 to-green-600', locked: false },
elite: { id: 'elite', name: '–≠–ª–∏—Ç–∞', emoji: 'üéñ', price: 500, color: 'from-red-400 to-red-600', locked: false, isNew: false, freeCount: 0 },
diamond: { id: 'diamond', name: '–ê–ª–º–∞–∑', emoji: 'üíé', price: 50, originalPrice: 50, discountPrice: 35, color: 'from-blue-400 to-blue-600', locked: false, isNew: false, freeCount: 0 },
winter: { id: 'winter', name: '–ó–∏–º–Ω–∏–π', emoji: '‚òÉÔ∏è', price: 125, originalPrice: 150, discountPrice: 125, color: 'from-cyan-400 to-blue-500', locked: false, isNew: true, freeCount: 0 },
major: { id: 'major', name: '–ú–∞–∂–æ—Ä', emoji: 'ü§¥', price: 800, color: 'from-purple-500 to-indigo-700', locked: true, isNew: false, freeCount: 0 },
collector: { id: 'collector', name: '–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä', emoji: 'üé©', price: 650, color: 'from-rose-600 to-pink-800', locked: true, isNew: true, freeCount: 0 }
};

const ICE_ARENA_PRIZES = [
{ id: 'bear', name: 'üß∏ –ú–∏—à–∫–∞', chance: 40, type: 'item', sellPrice: 20, emoji: 'üß∏' },
{ id: 'gloves', name: 'üß§ –í–∞—Ä–µ–∂–∫–∏', chance: 30, type: 'item', sellPrice: 50, emoji: 'üß§' },
{ id: 'fire', name: 'üî• –û–≥–æ–Ω—å', chance: 10, type: 'special', emoji: 'üî•', message: '–í—ã —Ä–∞—Å—Ç–æ–ø–∏–ª–∏ –ª–µ–¥! –ü–æ–ª—É—á–∞–µ—Ç–µ 40% –æ—Ç —Å—Ç–∞–≤–æ–∫' },
{ id: 'snow', name: '‚ùÑÔ∏è –°–Ω–µ–∂–∏–Ω–∫–∞', chance: 5, type: 'item', sellPrice: 125, emoji: '‚ùÑÔ∏è' },
{ id: 'snoop', name: 'üêï Snoop Dog', chance: 5, type: 'item', sellPrice: 130, emoji: 'üêï' },
{ id: 'winter_case', name: '‚òÉÔ∏è –ö–µ–π—Å –ó–∏–º–Ω–∏–π', chance: 4, type: 'case_free', caseType: 'winter', emoji: '‚òÉÔ∏è' },
{ id: 'elite_case', name: 'üéñ –ö–µ–π—Å –≠–ª–∏—Ç–Ω—ã–π', chance: 3, type: 'case_free', caseType: 'elite', emoji: 'üéñ' },
{ id: 'stars_350', name: '350 ‚≠êÔ∏è', chance: 2, type: 'stars', value: 350, emoji: '350‚≠êÔ∏è' },
{ id: 'scarf', name: 'üß£ –ó–∏–º–Ω–µ–µ —Å–æ–∫—Ä–æ–≤–∏—â–µ', chance: 0.5, type: 'collectible', emoji: 'üß£' },
{ id: 'dellko', name: 'üîë Promocode DELLKO', chance: 0.5, type: 'promo', code: 'DELLKO', emoji: 'üîë' }
];

const TON_RATES = [ { stars: 50, ton: 0.6 }, { stars: 250, ton: 3 }, { stars: 500, ton: 6 }, { stars: 1000, ton: 12 } ];
const STARS_PACKAGES = [ { stars: 50, price: 50, name: '50 –∑–≤–µ–∑–¥' }, { stars: 100, price: 100, name: '100 –∑–≤–µ–∑–¥' }, { stars: 250, price: 250, name: '250 –∑–≤–µ–∑–¥' }, { stars: 500, price: 500, name: '500 –∑–≤–µ–∑–¥' }, { stars: 1000, price: 1000, name: '1000 –∑–≤–µ–∑–¥' } ];
    function App() {
const [currentScreen, setCurrentScreen] = useState('cases');
const [balance, setBalance] = useState(0);
const [cases, setCases] = useState(INITIAL_CASES);
const [inventory, setInventory] = useState([]);
const [inventorySlots, setInventorySlots] = useState(5);
const [tasks, setTasks] = useState({ subscribe: { completed: false }, depositMajor: { completed: false } });
const [user, setUser] = useState(null);

const [selectedCase, setSelectedCase] = useState(null);
const [isSpinning, setIsSpinning] = useState(false);
const [spinResult, setSpinResult] = useState(null);
const [rouletteOffset, setRouletteOffset] = useState(0);
const [fakeItems, setFakeItems] = useState([]);
const [rouletteKey, setRouletteKey] = useState(0);
const rouletteContainerRef = useRef(null);
const [determinedWinner, setDeterminedWinner] = useState(null);

const [showTopUp, setShowTopUp] = useState(false);
const [promoCode, setPromoCode] = useState('');
const [usedPromos, setUsedPromos] = useState([]);

const [adminAttempts, setAdminAttempts] = useState(0);
const [showAdminLogin, setShowAdminLogin] = useState(false);
const [isAdmin, setIsAdmin] = useState(false);
const [adminLogin, setAdminLogin] = useState('');
const [adminPassword, setAdminPassword] = useState('');
const [allUsers, setAllUsers] = useState([]);
const [selectedUser, setSelectedUser] = useState(null);

const [showCollectibleModal, setShowCollectibleModal] = useState(false);
const [selectedCollectible, setSelectedCollectible] = useState(null);
const [isLoading, setIsLoading] = useState(true);

const [currentGame, setCurrentGame] = useState(null);
const [iceLobby, setIceLobby] = useState(null);
const [myBet, setMyBet] = useState(25);
const [hasBet, setHasBet] = useState(false);
const [gameStatus, setGameStatus] = useState('waiting');
const [ballPos, setBallPos] = useState({ x: 50, y: 50 });
const [showPrizeChest, setShowPrizeChest] = useState(false);
const [chestPrizes, setChestPrizes] = useState([]);
const [openedChestCount, setOpenedChestCount] = useState(0);
const [showNewGamePrompt, setShowNewGamePrompt] = useState(false);
const [timerRemaining, setTimerRemaining] = useState(0);
const [totalDeposits, setTotalDeposits] = useState(0);
const [freeEliteSpin, setFreeEliteSpin] = useState(0);
const [icePlayerCount, setIcePlayerCount] = useState(0);

useEffect(() => {
const initApp = async () => {
let userId = localStorage.getItem('sbs_user_id');
let userData = { name: '–ì–æ—Å—Ç—å', username: null, avatar: null };
const tgUser = TelegramWebApp?.initDataUnsafe?.user;

if (tgUser) {
  userId = tgUser.id.toString();
  localStorage.setItem('sbs_user_id', userId);
  userData = { name: tgUser.first_name + (tgUser.last_name ? ' ' + tgUser.last_name : ''), username: tgUser.username ? '@' + tgUser.username : null, avatar: tgUser.photo_url || null };
} else if (!userId) {
  userId = 'guest_' + Date.now();
  localStorage.setItem('sbs_user_id', userId);
}

const userRef = db.ref('users/' + userId);
userRef.on('value', snap => {
  const data = snap.val();
  if (data) {
    setUser({ id: userId, ...data });
    setBalance(data.balance || 0);
    setCases(data.cases || INITIAL_CASES);
    setInventory(data.inventory || []);
    setTasks(data.tasks || { subscribe: { completed: false } });
    setInventorySlots(data.inventorySlots || 5);
    setUsedPromos(data.usedPromos || []);
    setTotalDeposits(data.totalDeposits || 0);
    setFreeEliteSpin(data.freeEliteSpin || 0);
    userRef.update({ name: userData.name, username: userData.username });
  } else {
    const newUser = { ...userData, balance: 15, cases: INITIAL_CASES, inventory: [], inventorySlots: 5, usedPromos: [], totalDeposits: 0, freeEliteSpin: 0 };
    setUser({ id: userId, ...newUser });
    userRef.set(newUser);
  }
  setIsLoading(false);
});
};
initApp();
}, []);

// –õ–ï–î–Ø–ù–û–ô –ö–ê–¢–û–ö: –°–õ–£–®–ê–¢–ï–õ–¨ –õ–û–ë–ë–ò
useEffect(() => {
if (currentGame?.type === 'ice' && currentGame.lobbyId) {
const lobbyRef = db.ref('iceLobbies/' + currentGame.lobbyId);
lobbyRef.on('value', snap => {
const data = snap.val();
if (data) {
setIceLobby(data);
setGameStatus(data.status || 'waiting');
const pCount = data.players ? Object.keys(data.players).length : 0;
setIcePlayerCount(pCount);
if (data.players?.[user?.id]) {
setHasBet(data.players[user.id].bet > 0);
} else {
setHasBet(false);
}
if (data.ballPosition) setBallPos(data.ballPosition);
if (data.timerEnd && data.status === 'betting') {
const remaining = Math.max(0, Math.ceil((data.timerEnd - Date.now()) / 1000));
setTimerRemaining(remaining);
}
if (data.status === 'finished' && data.winner?.id === user.id && !data.prizeClaimed?.[user.id]) {
const winAmount = Math.floor(data.totalPot * 0.4);
alert(`–ü–û–ë–ï–î–ê! –í—ã–∏–≥—Ä—ã—à: ${winAmount} ‚≠êÔ∏è`);
db.ref('users/'+user.id+'/balance').transaction(b => (b || 0) + winAmount);
lobbyRef.child('prizeClaimed/'+user.id).set(true);
}
}
});
return () => lobbyRef.off();
}
}, [currentGame, user?.id]);

const handleTitleClick = () => {
const newAttempts = adminAttempts + 1;
setAdminAttempts(newAttempts);
if (newAttempts >= 11) {
setShowAdminLogin(true);
setAdminAttempts(0);
}
};

const checkAdminLogin = () => {
if (adminLogin === '_*\\^BAGUETTE_642819_6281' && adminPassword === '3628874910ZTWMI_') {
setIsAdmin(true);
setShowAdminLogin(false);
db.ref('users').once('value').then(snap => {
const users = [];
snap.forEach(child => users.push({ id: child.key, ...child.val() }));
setAllUsers(users);
});
} else { alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω!'); }
};

const adminGiveReward = async (targetUserId, reward) => {
const snapshot = await db.ref('users/' + targetUserId).once('value');
const userData = snapshot.val() || {};
if (reward.type === 'stars') {
await db.ref('users/' + targetUserId + '/balance').transaction(b => (b || 0) + reward.amount);
} else if (reward.type === 'case') {
await db.ref('users/' + targetUserId + `/cases/${reward.caseType}/freeCount`).transaction(c => (c || 0) + reward.count);
} else if (reward.type === 'item') {
const newItem = { ...reward.item, uniqueId: Date.now() };
await db.ref('users/' + targetUserId + '/inventory').set([...(userData.inventory || []), newItem]);
} else if (reward.type === 'unlock_collector') {
await db.ref('users/' + targetUserId + '/totalDeposits').set(350);
}
alert('–ù–∞–≥—Ä–∞–¥–∞ –≤—ã–¥–∞–Ω–∞!');
};

// –õ–ï–î–Ø–ù–û–ô –ö–ê–¢–û–ö: –í–•–û–î
const joinIceLobby = async (lobbyId) => {
const lobbyRef = db.ref('iceLobbies/' + lobbyId);
const snap = await lobbyRef.once('value');
const data = snap.val() || { status: 'waiting', players: {} };

if (data.status === 'playing') {
alert('–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –í—ã –º–æ–∂–µ—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–∞–±–ª—é–¥–∞—Ç—å.');
setCurrentGame({ type: 'ice', lobbyId, spectator: true });
return;
}
// –ò–ì–†–û–ö –í–ò–î–ï–ù –°–†–ê–ó–£ (—Å—Ç–∞–≤–∫–∞ 0)
await lobbyRef.child('players/' + user.id).set({
id: user.id, name: user.name, avatar: user.avatar, bet: 0, color: `hsl(${Math.random() * 360}, 70%, 50%)`
});
setCurrentGame({ type: 'ice', lobbyId, spectator: false });
};

// –õ–ï–î–Ø–ù–û–ô –ö–ê–¢–û–ö: –°–¢–ê–í–ö–ê
const placeBet = async () => {
if (balance < myBet) { alert("–ú–∞–ª–æ –∑–≤–µ–∑–¥!"); return; }
if (myBet < 25) { alert("–ú–∏–Ω–∏–º—É–º 25‚≠êÔ∏è!"); return; }

const lobbyRef = db.ref('iceLobbies/' + currentGame.lobbyId);
await db.ref('users/'+user.id+'/balance').transaction(b => b - myBet);
await lobbyRef.child('players/' + user.id).update({ bet: myBet });

setHasBet(true);

const snap = await lobbyRef.once('value');
const d = snap.val();
const players = Object.values(d.players || {});
// –°–¢–ê–†–¢ –¢–ê–ô–ú–ï–†–ê (–¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Å–µ –≤ –ª–æ–±–±–∏ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ —Å—Ç–∞–≤–∫—É)
const allBetted = players.length >= 2 && players.every(p => p.bet > 0);

if (allBetted && d.status === 'waiting') {
const tEnd = Date.now() + 10000;
await lobbyRef.update({ status: 'betting', timerEnd: tEnd, totalPot: players.reduce((s,p)=>s+p.bet, 0) });
setTimeout(() => startIceGame(lobbyRef), 10000);
}
};

const startIceGame = async (lobbyRef) => {
await lobbyRef.update({ status: 'playing' });
let x=50, y=50, vx=(Math.random()-0.5)*15, vy=(Math.random()-0.5)*15;
const int = setInterval(() => {
x+=vx*0.5; y+=vy*0.5;
if(x<=5||x>=95) vx*=-1; if(y<=5||y>=95) vy*=-1;
lobbyRef.child('ballPosition').set({x,y});
vx*=0.99; vy*=0.99;
if(Math.abs(vx)<0.2 && Math.abs(vy)<0.2) {
clearInterval(int); finishIceGame(lobbyRef, x, y);
}
}, 30);
};

const finishIceGame = async (ref, fx, fy) => {
const snap = await ref.once('value');
const d = snap.val();
const players = Object.values(d.players).filter(p => p.bet > 0); // –¢–æ–ª—å–∫–æ —Ç–µ –∫—Ç–æ —Å—Ç–∞–≤–∏–ª
if(players.length === 0) return;
const winIdx = Math.floor(Math.random() * players.length);
await ref.update({ status: 'finished', winner: players[winIdx], finalBall: {x:fx, y:fy} });
};

const leaveLobby = async () => {
const lobbyRef = db.ref('iceLobbies/' + currentGame.lobbyId);
const myData = iceLobby?.players?.[user.id];
// –í–û–ó–í–†–ê–¢ –°–¢–ê–í–ö–ò –ï–°–õ–ò –í–´–®–ï–õ
if (myData?.bet > 0 && iceLobby.status !== 'playing') {
await db.ref('users/'+user.id+'/balance').transaction(b => (b||0) + myData.bet);
}
await lobbyRef.child('players/' + user.id).remove();
const remain = iceLobby?.players ? Object.keys(iceLobby.players).length - 1 : 0;
if (remain <= 0) {
await lobbyRef.set({status:'waiting', players:{}});
}
lobbyRef.off();
setCurrentGame(null); setIceLobby(null);
};

// –†–£–õ–ï–¢–ö–ê –ò –ö–ï–ô–°–´
const getCasePrice = (caseType) => {
const c = cases[caseType];
if (c.freeCount > 0) return 0;
if (c.discountPrice && c.discountPrice !== c.price) return c.discountPrice;
return c.price;
};

const openCase = async (caseType) => {
if (caseType === 'collector' && cases.collector?.locked) { alert('–ö–µ–π—Å ¬´–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä¬ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω. –ù—É–∂–Ω–æ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ 350‚≠êÔ∏è'); return; }
const price = getCasePrice(caseType);
const isFreeCase = cases[caseType]?.freeCount > 0;
const isElite = caseType === 'elite';
const hasFreeEliteSpin = isElite && (freeEliteSpin || 0) > 0;
if (!hasFreeEliteSpin && !isFreeCase && price > 0 && balance < price) { alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥!'); return; }

// –§–û–†–ú–£–õ–ê: –°–ø–∏—Å–∞–Ω–∏–µ –¥–æ —Ä—É–ª–µ—Ç–∫–∏. –í–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ù–ï–¢.
const balanceBefore = balance;
let newBalanceAfterPurchase = balanceBefore;

if (isFreeCase) { const newFreeCount = cases[caseType].freeCount - 1; setCases(prev => ({ ...prev, [caseType]: { ...prev[caseType], freeCount: newFreeCount } })); await db.ref(`users/${user.id}/cases/${caseType}/freeCount`).set(newFreeCount); }
else if (hasFreeEliteSpin) { const newSpin = (freeEliteSpin || 0) - 1; setFreeEliteSpin(newSpin); await db.ref(`users/${user.id}/freeEliteSpin`).set(newSpin); }
else if (price > 0) {
newBalanceAfterPurchase = balanceBefore - price;
setBalance(newBalanceAfterPurchase);
await db.ref('users/' + user.id + '/balance').set(newBalanceAfterPurchase);
}

setIsSpinning(true);
setSelectedCase({ ...cases[caseType], id: caseType });
setSpinResult(null);
setRouletteOffset(0);
setFakeItems([]);
setRouletteKey(k => k + 1);

const items = CASE_REWARDS[caseType];
const rand = Math.random() * 100;
let cum = 0, won = items[0];
for (const item of items) { cum += item.realChance; if (rand <= cum) { won = item; break; } }
setDeterminedWinner(won); // –¢–æ—á–Ω—ã–π –ø–æ–±–µ–¥–∏—Ç–µ–ª—å

const tape = [];
for(let i=0; i<80; i++) {
if(i === 70) tape.push(won); // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –Ω–∞ 70 –ø–æ–∑–∏—Ü–∏–∏
else tape.push(items[Math.floor(Math.random() * items.length)]);
}

setTimeout(() => {
setFakeItems(tape);
setTimeout(() => {
const containerWidth = rouletteContainerRef.current?.offsetWidth || window.innerWidth;
const itemWidth = 120 + 16; // width + margin
const targetPos = (70 * itemWidth) + (itemWidth / 2) - (containerWidth / 2);
setRouletteOffset(-targetPos);
}, 100);
}, 100);

setTimeout(async () => {
setSpinResult(determinedWinner || won);
setIsSpinning(false);
if ((determinedWinner || won).type === 'stars') {
const finalBalance = newBalanceAfterPurchase + (determinedWinner || won).value;
setBalance(finalBalance);
await db.ref(`users/${user.id}/balance`).set(finalBalance);
} else {
await addToInventory(determinedWinner || won);
}
setDeterminedWinner(null);
}, 6600);
};

const addToInventory = async (item) => { if (inventory.length < inventorySlots) { const newItem = { ...item, uniqueId: Date.now(), collected: Date.now() }; const newInventory = [...inventory, newItem]; setInventory(newInventory); await db.ref(`users/${user.id}/inventory`).set(newInventory); } else { alert('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø–æ–ª–æ–Ω!'); } };

const sellItem = async (item) => { 
if (item.type === 'collectible') { setSelectedCollectible(item); setShowCollectibleModal(true); return; } 
if (confirm(`–ü—Ä–æ–¥–∞—Ç—å ${item.name} –∑–∞ ${item.sellPrice}‚≠êÔ∏è?`)) { 
const newInventory = inventory.filter(i => i.uniqueId !== item.uniqueId); 
db.ref('users/'+user.id).update({ balance: balance + item.sellPrice, inventory: newInventory }); 
} 
};

const buySlot = async () => { if (balance < 50) return alert("–ù—É–∂–Ω–æ 50 ‚≠êÔ∏è"); await db.ref('users/'+user.id).update({ balance: balance - 50, inventorySlots: (inventorySlots || 5) + 1 }); };

const checkPromo = async () => {
const code = promoCode.toUpperCase();
if (usedPromos.includes(code)) { alert("–£–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!"); return; }
if (code === 'DELLKO') { if (!wonPromos.includes('DELLKO')) { alert('–¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–∏–≥—Ä–∞–ª–∏ –≤ –õ–µ–¥—è–Ω–æ–º –ö–∞—Ç–∫–µ!'); return; } const newCases = { ...cases, money: { ...cases.money, freeCount: cases.money.freeCount + 3 } }; setCases(newCases); await addToInventory({ name: 'üßä –õ—ë–¥ (1/3)', emoji: 'üßä', type: 'ice', part: 1, uniqueId: Date.now() }); setPromoCode(''); const newPromos = [...usedPromos, code]; setUsedPromos(newPromos); await db.ref(`users/${user.id}/usedPromos`).set(newPromos); alert('–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! +3 –¥–µ–Ω–µ–∂–Ω—ã—Ö –∫–µ–π—Å–∞ + üßä');}
else if (code === 'DIAMOND') { const newCases = { ...cases, diamond: { ...cases.diamond, freeCount: cases.diamond.freeCount + 2 } }; setCases(newCases); setPromoCode(''); const newPromos = [...usedPromos, code]; setUsedPromos(newPromos); await db.ref(`users/${user.id}/usedPromos`).set(newPromos); alert('+2 –∫–µ–π—Å–∞ –ê–ª–º–∞–∑!');}
else { alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥'); }
};

const completeTask = async (taskId) => {
if (taskId === 'subscribe') {
window.open('https://t.me/stepbystepdelision', '_blank');
setTimeout(async () => {
if (!tasks.subscribe?.completed) {
await db.ref(`users/${user.id}`).update({ 'tasks/subscribe': {completed: true}, freeEliteSpin: (freeEliteSpin || 0) + 1 });
alert('üéâ –ü–æ–ª—É—á–µ–Ω 1 –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Ä—É—Ç –≠–ª–∏—Ç–∞!');
}
}, 2000);
}
};

const renderIceArenaField = () => {
if (!iceLobby?.players) return null;
const players = Object.entries(iceLobby.players);
const totalBet = players.reduce((sum, [, p]) => sum + p.bet, 0);
let currentAngle = 0;
return players.map(([id, player], idx) => {
const percentage = totalBet > 0 ? (player.bet / totalBet) * 100 : (100 / players.length);
const sectorAngle = totalBet > 0 ? (player.bet / totalBet) * 360 : (360 / players.length);
const midAngle = currentAngle + sectorAngle / 2;
const avatarRadius = 35 * (percentage / 100);
const avatarX = 50 + avatarRadius * Math.cos((midAngle - 90) * Math.PI / 180);
const avatarY = 50 + avatarRadius * Math.sin((midAngle - 90) * Math.PI / 180);
currentAngle += sectorAngle;
return (
<React.Fragment key={id}>
<div className="absolute inset-0" style={{ background: `conic-gradient(from ${currentAngle - sectorAngle}deg, ${player.color}${Math.round(percentage) > 50 ? 'cc' : '99'} 0deg, ${player.color}${Math.round(percentage) > 50 ? 'cc' : '99'} ${sectorAngle}deg, transparent ${sectorAngle}deg)`, clipPath: 'circle(50% at 50% 50%)', boxShadow: `inset 0 0 30px ${player.color}40` }} />
<div className="absolute text-2xl font-bold pointer-events-none" style={{ left: `${50 + 25 * Math.cos((midAngle - 90) * Math.PI / 180)}%`, top: `${50 + 25 * Math.sin((midAngle - 90) * Math.PI / 180)}%`, transform: 'translate(-50%, -50%)', color: 'white', textShadow: '0 0 10px black, 0 0 20px black' }} >{Math.round(percentage)}%</div>
<div className="player-avatar" style={{ left: `${avatarX}%`, top: `${avatarY}%`, borderColor: player.color, boxShadow: `0 0 15px ${player.color}` }} >{player.avatar ? (<img src={player.avatar} className="w-full h-full object-cover" />) : (<div className="w-full h-full bg-gray-600 flex items-center justify-center text-sm font-bold"> {player.name[0] || 'U'} </div>)}</div>
</React.Fragment>
);
});
};

if (isAdmin) {
return (
<div className="min-h-screen bg-gray-900 p-4">
<div className="flex justify-between items-center mb-6"><h1 className="text-2xl font-bold text-white">üîê –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1><button onClick={() => setIsAdmin(false)} className="text-gray-400 hover:text-white">–í—ã–π—Ç–∏</button></div>
<div className="glass rounded-xl p-6">
<h3 className="text-lg mb-4 font-bold">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞:</h3>
<div className="space-y-2 max-h-96 overflow-y-auto">
{allUsers.map(u => (
<div key={u.id} className="bg-gray-800 p-3 rounded-lg flex justify-between items-center">
<div><div className="font-bold">{u.name}</div><div className="text-sm text-gray-400">{u.username || u.id.slice(0, 10)}</div></div>
<div className="flex gap-2 items-center">
<div className="text-yellow-400 font-bold mr-2">{(u.balance || 0).toFixed(0)}‚≠êÔ∏è</div>
<button onClick={() => adminGiveReward(u.id, { type: 'stars', amount: 500 })} className="bg-green-600 px-3 py-1 rounded text-xs">+500‚≠êÔ∏è</button>
<button onClick={() => adminGiveReward(u.id, { type: 'unlock_collector' })} className="bg-purple-600 px-3 py-1 rounded text-xs">üîì –ö–æ–ª–ª.</button>
</div>
</div>
))}
</div>
</div>
</div>
);
}

if (currentGame?.type === 'ice') {
return (
<div className="min-h-screen bg-gradient-to-b from-blue-900 to-indigo-900 p-4">
<div className="max-w-2xl mx-auto">
<div className="flex justify-between items-center mb-4"><h1 className="text-2xl font-bold">‚òÉÔ∏è –õ–µ–¥—è–Ω–æ–π –ö–∞—Ç–æ–∫</h1><button onClick={leaveLobby} className="text-white bg-red-500/20 px-3 py-1 rounded-lg border border-red-500/50 hover:bg-red-500/40 transition">–í–´–ô–¢–ò</button></div>
<div className="text-center mb-4"><div className="text-sm text-cyan-300">–õ–æ–±–±–∏ #{currentGame.lobbyId}</div><div className="text-lg font-bold text-white"> {gameStatus === 'waiting' ? '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤...' : gameStatus === 'betting' ? '‚è∞ –ò–¥—ë—Ç —Å—Ç–∞–≤–∫–∞!' : gameStatus === 'playing' ? 'üî¥ –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!' : 'üèÜ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞'} </div>{gameStatus === 'betting' && timerRemaining > 0 && (<div className="text-3xl font-bold text-yellow-400 animate-pulse mt-2"> ‚è∞ {timerRemaining} —Å–µ–∫ </div>)}</div>
<div className="flex justify-center mb-6"><div className="ice-circle relative">{renderIceArenaField()}{(gameStatus === 'waiting' || gameStatus === 'betting') && (<div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-20 h-20 bg-black rounded-full flex items-center justify-center text-4xl mystery-box border-4 border-cyan-400 shadow-lg shadow-cyan-500/50"> ‚ùì </div>)}{gameStatus === 'playing' && (<div className="ice-ball" style={{ left: ballPos.x + '%', top: ballPos.y + '%' }} />)}{gameStatus === 'finished' && iceLobby?.finalBall && (<div className="ice-ball" style={{ left: iceLobby.finalBall.x + '%', top: iceLobby.finalBall.y + '%', background: '#ffd700', boxShadow: '0 0 30px #ffd700' }} />)}</div></div>
{!hasBet ? (
<div className={`glass rounded-xl p-4 mb-4 border border-cyan-500/30 ${icePlayerCount < 2 ? 'bg-slate-800 opacity-60 grayscale' : ''}`}>
{icePlayerCount < 2 ? (
<div className="text-center text-yellow-400 py-4 font-bold text-lg">–û–∂–∏–¥–∞–µ–º –µ—â–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è... (—Å–µ–π—á–∞—Å {icePlayerCount})</div>
) : (
<>
<div className="flex gap-2 mb-4"><input type="number" min="25" value={myBet} onChange={(e) => setMyBet(Number(e.target.value))} className="flex-1 bg-gray-800 border border-cyan-600 rounded-lg p-3 text-center text-xl text-white outline-none" /><button onClick={() => setMyBet(p => p + 25)} className="bg-cyan-700 px-4 rounded-lg font-bold">+25</button><button onClick={() => setMyBet(p => p + 100)} className="bg-cyan-700 px-4 rounded-lg font-bold">+100</button></div>
<button onClick={placeBet} disabled={balance < myBet} className="w-full bg-gradient-to-r from-cyan-600 to-blue-600 py-4 rounded-xl font-bold text-xl disabled:opacity-50 shadow-lg"> –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É ({myBet}‚≠êÔ∏è) </button>
<p className="text-center text-sm text-cyan-300 mt-2">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: 25‚≠êÔ∏è</p>
</>
)}
</div>
) : (
<div className="text-center mb-4"><div className="text-green-400 font-bold text-xl mb-2">‚úì –°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞: {myBet}‚≠êÔ∏è</div></div>
)}
<div className="glass rounded-xl p-4 mb-4"><h3 className="font-bold mb-2 text-cyan-300">–ò–≥—Ä–æ–∫–∏ ({icePlayerCount}/15):</h3><div className="space-y-2 max-h-40 overflow-y-auto">{iceLobby?.players && Object.entries(iceLobby.players).map(([id, p]) => (<div key={id} className="flex justify-between items-center bg-gray-800/50 p-2 rounded border border-white/10"><div className="flex items-center gap-2"><div className="w-3 h-3 rounded-full" style={{background: p.color}}></div><span className={id === user.id ? 'font-bold text-cyan-300' : ''}>{p.name} {id === user.id && '(–í—ã)'}</span></div><div className="text-right"><span className="font-bold text-yellow-400">{p.bet}‚≠êÔ∏è</span></div></div>))}</div><div className="border-t border-gray-600 mt-2 pt-2 flex justify-between font-bold text-lg"><span className="text-gray-300">–û–±—â–∏–π –±–∞–Ω–∫:</span><span className="text-yellow-400"> {iceLobby?.players ? Object.values(iceLobby.players).reduce((s, p) => s + p.bet, 0) : 0}‚≠êÔ∏è </span></div></div>
<div className="glass rounded-xl p-4"><h3 className="font-bold mb-3 text-center text-cyan-300">–í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã:</h3><div className="flex flex-wrap justify-center gap-3 text-2xl">{['üß∏','üß§','‚ùÑÔ∏è','üêï','‚òÉÔ∏è','üéñ','‚≠êÔ∏è','üß£'].map((emoji, i) => (<span key={i} className="bg-gray-800 p-2 rounded-lg border border-white/10 hover:scale-110 transition">{emoji}</span>))}</div><div className="text-xs text-center text-gray-500 mt-2">+ —Å–∫—Ä—ã—Ç—ã–µ –ø—Ä–∏–∑—ã!</div></div>
</div>
</div>
);
}

return (
<div className="min-h-screen pb-24">
<header className="p-4 flex justify-between items-center glass sticky top-0 z-50"><h1 onClick={handleTitleClick} className="text-xl font-bold cursor-pointer select-none hover:text-cyan-300 transition">Step By Step Game</h1><div className="bg-gradient-to-r from-yellow-400 to-orange-500 px-4 py-2 rounded-full font-bold text-gray-900 shadow-lg"> {balance.toFixed(2)} ‚≠êÔ∏è </div></header>

{/* –ü–†–û-–ü–†–ï–î–ú–ï–¢–´ –ú–û–î–ê–õ–ö–ê –í–ï–†–ù–£–õ–ê–°–¨! */}
{showCollectibleModal && (
<div className="fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4">
<div className="glass rounded-2xl p-6 max-w-sm w-full text-center border-2 border-purple-500 shadow-2xl">
<div className="text-6xl mb-4 animate-bounce">{selectedCollectible?.emoji}</div>
<h3 className="text-xl font-bold mb-2 text-purple-400">–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç!</h3>
<p className="mb-4 text-gray-300">–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥—ã –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ <a href="https://t.me/stepbystepdelision" target="_blank" className="text-blue-400 underline font-bold hover:text-blue-300">–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏</a>.</p>
<button onClick={() => setShowCollectibleModal(false)} className="w-full bg-indigo-600 hover:bg-indigo-500 py-3 rounded-xl font-bold transition">–ü–æ–Ω—è—Ç–Ω–æ</button>
</div>
</div>
)}

<main className="p-4 max-w-md mx-auto">
{currentScreen === 'cases' && (
<div>
<h2 className="text-2xl font-bold mb-4 text-center">üé∞ –ö–µ–π—Å—ã</h2>
{freeEliteSpin > 0 && (<div className="bg-green-500/20 border border-green-500 rounded-lg p-3 mb-4 text-center animate-pulse"> üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø—Ä–æ–∫—Ä—É—Ç–æ–≤ –≠–ª–∏—Ç–∞: {freeEliteSpin} </div>)}
<div className="grid grid-cols-2 gap-4">
{Object.values(cases).filter(c => !c.locked).map(c => (
<div key={c.id} className={`glass rounded-xl p-4 relative hover:scale-105 transition ${c.id === 'cardboard' ? 'case-cardboard' : c.id === 'collector' ? 'case-collector' : ''}`}>
<div className={`w-16 h-16 mx-auto rounded-lg flex items-center justify-center text-3xl mb-2 shadow-lg ${c.id === 'cardboard' || c.id === 'collector' ? 'bg-white/20' : `bg-gradient-to-br ${c.color}`}`}>{c.emoji}</div>
<h3 className="font-bold text-center">{c.name}</h3>
<p className="text-center text-sm opacity-75"> {c.freeCount > 0 ? <span className="text-green-400 font-bold">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ!</span> : c.id === 'elite' && freeEliteSpin > 0 ? <span className="text-blue-400 font-bold">–ü—Ä–æ–∫—Ä—É—Ç!</span> : `${c.price} ‚≠êÔ∏è`} </p>
<button onClick={() => setSelectedCase(c)} className="w-full mt-2 py-2 rounded-lg font-bold bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 transition">–û—Ç–∫—Ä—ã—Ç—å</button>
</div>
))}
{Object.values(cases).filter(c => c.locked).map(c => (
<div key={c.id} className="glass rounded-xl p-4 relative opacity-50">
<div className="absolute inset-0 bg-black/70 rounded-xl flex items-center justify-center"><span className="text-2xl">üîí</span></div>
<div className={`w-16 h-16 mx-auto rounded-lg flex items-center justify-center text-3xl mb-2 shadow-lg bg-gradient-to-br ${c.color}`}>{c.emoji}</div>
<h3 className="font-bold text-center">{c.name}</h3>
<p className="text-center text-sm opacity-75">{c.price} ‚≠êÔ∏è</p>
<button className="w-full mt-2 py-2 rounded-lg font-bold bg-gray-600 cursor-not-allowed">–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</button>
</div>
))}
</div>
</div>
)}

{currentScreen === 'games' && (
<div>
<h2 className="text-2xl font-bold mb-4 text-center">üéÆ –ò–≥—Ä—ã</h2>
<div className="space-y-4">
<div className="glass rounded-xl p-6 cursor-pointer hover:bg-white/5 transition border border-cyan-500/30" onClick={() => joinIceLobby(1)}>
<h3 className="text-2xl font-bold mb-2 text-center text-cyan-300">‚òÉÔ∏è –õ–µ–¥—è–Ω–æ–π –ö–∞—Ç–æ–∫</h3>
<p className="text-gray-400 mb-4 text-center">–°–æ—Ä–µ–≤–Ω—É–π—Ç–µ—Å—å —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏! –ú–∏–Ω. —Å—Ç–∞–≤–∫–∞ 25‚≠êÔ∏è</p>
<div className="grid grid-cols-5 gap-2">
{[1,2,3,4,5,6,7,8,9,10].map(i => (
<button key={i} onClick={(e) => { e.stopPropagation(); joinIceLobby(i); }} className="bg-cyan-700 hover:bg-cyan-600 py-2 rounded-lg text-sm font-bold transition">#{i}</button>
))}
</div>
</div>
</div>
</div>
)}

{currentScreen === 'tasks' && (
<div>
<h2 className="text-2xl font-bold mb-4 text-center">üìã –ú–æ–∏ –ó–∞–¥–∞–Ω–∏—è</h2>
<div className="space-y-4">
<div className={`glass rounded-xl p-4 ${tasks.subscribe?.completed ? 'bg-green-500/20 border-green-500' : ''}`}>
<div className="flex justify-between items-start mb-2"><div><h3 className="font-bold">–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª</h3><p className="text-sm opacity-75">–ù–∞–≥—Ä–∞–¥–∞: 1 –ø—Ä–æ–∫—Ä—É—Ç –≠–ª–∏—Ç—ã üéñ</p></div>{tasks.subscribe?.completed && <span className="text-green-400 text-2xl">‚úÖ</span>}</div>
<button onClick={() => completeTask('subscribe')} disabled={tasks.subscribe?.completed} className={`w-full py-2 rounded-lg ${tasks.subscribe?.completed ? 'bg-green-600' : 'bg-blue-600 hover:bg-blue-500'} transition`}> {tasks.subscribe?.completed ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' : '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è'} </button>
</div>
</div>
</div>
)}

{currentScreen === 'profile' && (
<div>
<h2 className="text-2xl font-bold mb-4 text-center">üë§ –ú–æ–π –ü—Ä–æ—Ñ–∏–ª—å</h2>
<div className="glass rounded-xl p-6 text-center mb-4">
<div className="w-24 h-24 mx-auto rounded-full bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center text-4xl mb-3 overflow-hidden border-2 border-white/20">
{user?.avatar ? <img src={user.avatar} className="w-full h-full object-cover" /> : user?.name?.charAt(0).toUpperCase()}
</div>
<h3 className="text-xl font-bold">{user?.name}</h3>
{user?.username && <p className="text-gray-400">{user.username}</p>}
</div>
<div className="glass rounded-xl p-4 mb-4"><h3 className="font-bold mb-2">üéÅ –ü—Ä–æ–º–æ–∫–æ–¥</h3><div className="flex gap-2"><input type="text" placeholder="–í–í–ï–î–ò–¢–ï –ü–†–û–ú–û–ö–û–î" value={promoCode} onChange={(e) => setPromoCode(e.target.value)} className="flex-1 bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-center uppercase outline-none" /><button onClick={checkPromo} className="bg-indigo-600 hover:bg-indigo-500 px-4 py-2 rounded-lg font-bold transition">OK</button></div></div>
<div className="glass rounded-xl p-4"><div className="flex justify-between items-center mb-3"><h3 className="font-bold">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3><span className="text-sm text-gray-400">{inventory.length}/{inventorySlots}</span></div><div className="grid grid-cols-5 gap-2 mb-4">{[...Array(inventorySlots)].map((_, i) => (<div key={i} className="aspect-square bg-gray-700/50 rounded-lg flex items-center justify-center text-2xl relative hover:bg-gray-600/50 transition cursor-pointer">{inventory[i] ? (<span onClick={() => sellItem(inventory[i])} className="hover:scale-110 transition">{inventory[i].emoji}</span>) : <span className="text-gray-600 text-xs">–ü—É—Å—Ç–æ</span>}</div>))}</div><button onClick={buySlot} disabled={balance < 50} className="w-full bg-gray-700 hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed py-2 rounded-lg text-sm font-bold flex items-center justify-center gap-2 transition"> <span>üîì</span> –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç (50‚≠êÔ∏è) </button></div>
</div>
)}
</main>

{selectedCase && (
<div className="fullscreen-modal flex items-center justify-center p-4" key={rouletteKey}>
<div className="w-full max-w-lg" ref={rouletteContainerRef}>
<div className="flex justify-between items-center mb-6">
<h3 className="text-3xl font-bold">{selectedCase.emoji} {selectedCase.name}</h3>
<button onClick={() => {setSelectedCase(null); setSpinResult(null); setFakeItems([]);}} className="text-4xl hover:text-red-400 transition">&times;</button>
</div>

<div className="roulette-container-new mb-8">
<div className="roulette-marker-new"></div>
<div className="roulette-track-new" style={{ transform: `translateX(${rouletteOffset}px)` }}>
{fakeItems.length > 0 ? (
fakeItems.map((item, i) => (
<div key={i} className={`roulette-item-new ${i===70 ? 'bg-yellow-500/20 border-yellow-500 shadow-lg' : ''}`}>
<div className="text-5xl">{item.emoji}</div>
<div className="text-xs mt-2 font-bold text-center px-1">{item.name}</div>
</div>
))
) : (
[...Array(80)].map((_, i) => (
<div key={i} className="roulette-item-new"><div className="text-4xl">‚ùì</div></div>
))
)}
</div>
</div>

<div className="glass rounded-xl p-4 mb-6 max-h-48 overflow-y-auto">
<p className="font-bold mb-2 text-center text-lg">–í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã:</p>
<div className="space-y-1 text-sm">
{CASE_REWARDS[selectedCase.id].map((reward, idx) => (
<div key={idx} className="flex justify-between py-1 border-b border-white/10 last:border-0"><span className="flex items-center gap-2">{reward.emoji} {reward.name}</span><span className="text-yellow-400 font-bold">{reward.displayChance}</span></div>
))}
</div>
</div>

{spinResult ? (
<div className="text-center">
<p className="text-3xl font-black mb-2 text-yellow-400 drop-shadow-md">–í–´–ü–ê–õ–û: {spinResult.name}!</p>
{spinResult.type === 'collectible' && <p className="text-sm text-purple-400 mb-4 font-bold uppercase tracking-widest">‚≠êÔ∏è –ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç!</p>}
<button onClick={() => setSpinResult(null)} className="w-full bg-green-600 hover:bg-green-500 py-4 rounded-xl font-bold text-xl mb-3 shadow-xl transition active:scale-95">–ó–∞–±—Ä–∞—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç—å –µ—â—ë</button>
<button onClick={() => {setSelectedCase(null); setSpinResult(null); setFakeItems([]);}} className="w-full bg-gray-600 hover:bg-gray-500 py-3 rounded-xl font-bold transition">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–µ–π—Å–∞–º</button>
</div>
) : (
<button onClick={() => openCase(selectedCase.id)} disabled={isSpinning} className="w-full bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 py-4 rounded-xl font-bold text-xl disabled:opacity-50 shadow-xl transition active:scale-95">
{isSpinning ? '–ö—Ä—É—Ç–∏–º...' : `–û—Ç–∫—Ä—ã—Ç—å –∑–∞ ${getCasePrice(selectedCase.id) === 0 ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : getCasePrice(selectedCase.id) + ' ‚≠êÔ∏è'}`}
</button>
)}
</div>
</div>
)}

<nav className="fixed bottom-0 left-0 right-0 glass border-t border-white/10 p-2">
<div className="max-w-md mx-auto flex justify-around">
{['tasks', 'cases', 'games', 'profile'].map(screen => (
<button key={screen} onClick={() => setCurrentScreen(screen)} className={`flex flex-col items-center p-2 rounded-lg transition ${currentScreen === screen ? 'text-blue-400 scale-110' : 'text-gray-400 hover:text-white'}`}>
<span className="text-2xl">{screen === 'cases' ? 'üéÅ' : screen === 'games' ? 'üéÆ' : screen === 'tasks' ? 'üìã' : 'üë§'}</span>
<span className="text-[10px] font-bold mt-1 uppercase tracking-widest">{screen === 'cases' ? '–ö–µ–π—Å—ã' : screen === 'games' ? '–ò–≥—Ä—ã' : screen === 'tasks' ? '–ó–∞–¥–∞–Ω–∏—è' : '–ü—Ä–æ—Ñ–∏–ª—å'}</span>
</button>
))}
</div>
</nav>
</div>
);
}
ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
