<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Step By Step Game</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#8b5cf6',
                        accent: '#f59e0b',
                        ice: '#00d2ff',
                    },
                    fontFamily: {
                        cinzel: ['Cinzel', 'serif'],
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulseGlow { 0%, 100% { box-shadow: 0 0 10px rgba(0,210,255,0.3); } 50% { box-shadow: 0 0 30px rgba(0,210,255,0.8); } }
        @keyframes readyPulse { 0%, 100% { box-shadow: 0 0 10px rgba(0,255,100,0.3); } 50% { box-shadow: 0 0 30px rgba(0,255,100,0.8); } }
        @keyframes goldGlow { 0%, 100% { text-shadow: 0 0 5px #facc15, 0 0 10px #facc15; } 50% { text-shadow: 0 0 20px #facc15, 0 0 30px #eab308; } }
        @keyframes purpleGlow { 0%, 100% { text-shadow: 0 0 5px #a855f7, 0 0 10px #a855f7; } 50% { text-shadow: 0 0 20px #a855f7, 0 0 30px #9333ea; } }
        @keyframes greenGlow { 0%, 100% { box-shadow: 0 0 5px #22c55e, 0 0 10px #22c55e; } 50% { box-shadow: 0 0 15px #22c55e, 0 0 25px #16a34a; } }
        @keyframes yellowGlow { 0%, 100% { text-shadow: 0 0 5px #fbbf24, 0 0 10px #fbbf24; } 50% { text-shadow: 0 0 20px #fbbf24, 0 0 30px #f59e0b; } }
        .pulse-glow { animation: pulseGlow 2s ease-in-out infinite; }
        .ready-glow { animation: readyPulse 1.5s ease-in-out infinite; }
        .gold-glow { animation: goldGlow 2s ease-in-out infinite; }
        .purple-glow { animation: purpleGlow 2s ease-in-out infinite; }
        .green-glow { animation: greenGlow 2s ease-in-out infinite; }
        .yellow-glow { animation: yellowGlow 2s ease-in-out infinite; }
        .roulette-container { position: relative; width: 100%; height: 160px; overflow: hidden; background: rgba(0,0,0,0.4); border-radius: 16px; border: 2px solid rgba(255,255,255,0.1); margin: 20px 0; }
        .roulette-inner { display: flex; position: absolute; left: 0; top: 20px; transition: transform 6.5s cubic-bezier(0.1, 0, 0.1, 1); will-change: transform; }
        .roulette-item { width: 120px; height: 120px; flex-shrink: 0; margin: 0 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05)); border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); }
        .roulette-item .emoji { font-size: 3.5rem; }
        .roulette-item .name { font-size: 11px; opacity: 0.8; text-align: center; margin-top: 4px; }
        .roulette-pointer { position: absolute; left: 50%; top: 0; bottom: 0; width: 4px; background: #ff4757; z-index: 20; transform: translateX(-50%); box-shadow: 0 0 20px #ff4757; }
        .roulette-pointer::before { content: ''; position: absolute; top: -5px; left: 50%; transform: translateX(-50%); border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 15px solid #ff4757; }
        .roulette-pointer::after { content: ''; position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%); border-left: 10px solid transparent; border-right: 10px solid transparent; border-bottom: 15px solid #ff4757; }
        
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .line-through { text-decoration: line-through; opacity: 0.6; color: #ef4444; text-decoration-color: #ef4444; text-decoration-thickness: 2px; }
        .fullscreen-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 100; overflow-y: auto; }
        
        .case-cardboard { background: linear-gradient(135deg, #8B4513 0%, #D2691E 50%, #8B4513 100%); border: 3px solid #A0522D; }
        .case-collector { background: linear-gradient(135deg, #DC143C 0%, #FF1493 50%, #8B008B 100%); border: 3px solid #FFD700; }
        
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .round-box { width: 30px; height: 30px; border-radius: 6px; border: 2px solid rgba(255,255,255,0.3); display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; margin: 0 3px; transition: all 0.3s; }
        .round-box.completed { background: linear-gradient(135deg, #22c55e, #16a34a); border-color: #22c55e; box-shadow: 0 0 10px #22c55e; }
        .round-box.current { background: linear-gradient(135deg, #fbbf24, #f59e0b); border-color: #fbbf24; box-shadow: 0 0 10px #fbbf24; animation: pulse 1s infinite; }
        /* –û–ª–∏–º–ø —Å—Ç–∏–ª–∏ */
        .olymp-header {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            font-weight: 900;
            color: #fbbf24;
            text-shadow: 0 0 10px #fbbf24, 0 0 20px #f59e0b, 0 0 30px rgba(251, 191, 36, 0.5);
            letter-spacing: 2px;
        }
        .olymp-button {
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: #fbbf24;
            text-shadow: 0 0 5px #fbbf24;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(245, 158, 11, 0.2));
            border: 2px solid rgba(251, 191, 36, 0.6);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.4);
            transition: all 0.3s;
            padding: 12px 16px;
            border-radius: 12px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .olymp-button:hover {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.5), rgba(245, 158, 11, 0.4));
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.6);
            transform: scale(1.05);
        }
        .hero-card {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.1));
            border: 2px solid rgba(251, 191, 36, 0.4);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.3);
        }
        .hero-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 8px;
            border: 2px solid #fbbf24;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }
        .progress-bar {
            width: 100%;
            height: 24px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            border: 2px solid rgba(251, 191, 36, 0.3);
            overflow: hidden;
            margin: 8px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #fbbf24, #f59e0b);
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.6);
        }
        @media (max-width: 768px) {
            .olymp-header {
                font-size: 1.5rem;
            }
            
            .olymp-button {
                font-size: 0.95rem;
                padding: 10px 14px;
                min-height: 45px;
            }
            .roulette-container {
                height: 140px;
            }
            .hero-card {
                padding: 10px;
            }
            .hero-avatar {
                width: 50px;
                height: 50px;
                font-size: 24px;
            }
        }
        @media (max-width: 480px) {
            .olymp-header {
                font-size: 1.2rem;
            }
            
            .olymp-button {
                font-size: 0.85rem;
                padding: 8px 12px;
                min-height: 40px;
            }
            .roulette-container {
                height: 120px;
            }
            .roulette-item {
                width: 100px;
                height: 100px;
            }
            .roulette-item .emoji {
                font-size: 2.5rem;
            }
            .hero-card {
                padding: 8px;
            }
            .hero-avatar {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 min-h-screen text-white overflow-x-hidden">
    <div id="root"></div>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        const firebaseConfig = {
            apiKey: "AIzaSyDZPRiByz69HQa8b7GFMCJeqq56J3Y-bOY",
            authDomain: "step-by-step-279df.firebaseapp.com",
            databaseURL: "https://step-by-step-279df-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "step-by-step-279df",
            storageBucket: "step-by-step-279df.firebasestorage.app",
            messagingSenderId: "302641152597",
            appId: "1:302641152597:web:6479b9ae03104666cd8adc"
        };
        
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const TelegramWebApp = window.Telegram?.WebApp;
        const ADMIN_WALLET = 'UQAWqaIPFSg81l9MlgAx0HBE9o3gpJMhk1dnyryKJXhWNHIc';
        const BOT_TOKEN = '8325421899:AAG9t3yS4WWiwasRoHb-nbr3a94S9tQfHys';
        
        const PLAYER_COLORS = ['#FF6B6B','#FF9F43','#FFEAA7','#55EFC4','#74B9FF','#A29BFE','#FD79A8','#E17055','#00CEC9','#6C5CE7','#FDCB6E','#81ECEC','#FF7675','#DFE6E9','#B2BEC3'];
        function getRandomColor() { return PLAYER_COLORS[Math.floor(Math.random() * PLAYER_COLORS.length)]; }
        
        const INITIAL_CASES = {
            daily: { id: 'daily', name: '–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π', emoji: 'üóìÔ∏è', price: 0, color: 'from-cyan-400 to-teal-600', locked: false, isNew: true, freeCount: 1, type: 'special', lastOpened: 0 },
            star: { id: 'star', name: '–ó–≤–µ–∑–¥–Ω—ã–π', emoji: '‚≠êÔ∏è', price: 30, originalPrice: 30, discountPrice: 23, color: 'from-yellow-400 to-amber-500', locked: false, isNew: true, freeCount: 0 },
            cardboard: { id: 'cardboard', name: '–ö–∞—Ä—Ç–æ–Ω', emoji: 'üì¶', price: 3, color: 'from-amber-800 to-amber-900', locked: false, isNew: true, freeCount: 0 },
            coal: { id: 'coal', name: '–£–≥–æ–ª—ë–∫', emoji: 'ü™®', price: 27, color: 'from-gray-600 to-gray-800', locked: false, isNew: false, freeCount: 0 },
            platinum: { id: 'platinum', name: '–ü–ª–∞—Ç–∏–Ω–∞', emoji: 'üíé', price: 100, color: 'from-gray-300 to-gray-500', locked: false },
            gold: { id: 'gold', name: '–ó–æ–ª–æ—Ç–æ–π', emoji: 'üëë', price: 250, color: 'from-yellow-400 to-yellow-600', locked: false },
            money: { id: 'money', name: '–î–µ–Ω–µ–∂–Ω—ã–π', emoji: 'üíµ', price: 350, color: 'from-green-400 to-green-600', locked: false },
            elite: { id: 'elite', name: '–≠–ª–∏—Ç–∞', emoji: 'üéñ', price: 500, color: 'from-red-400 to-red-600', locked: false, isNew: false, freeCount: 0 },
            diamond: { id: 'diamond', name: '–ê–ª–º–∞–∑', emoji: 'üíé', price: 50, color: 'from-blue-400 to-blue-600', locked: false, isNew: false, freeCount: 0 },
            major: { id: 'major', name: '–ú–∞–∂–æ—Ä', emoji: 'ü§¥', price: 800, color: 'from-purple-500 to-indigo-700', locked: true, isNew: false, freeCount: 0 },
            collector: { id: 'collector', name: '–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä', emoji: 'üé©', price: 650, color: 'from-rose-600 to-pink-800', locked: true, isNew: true, freeCount: 0, type: 'special' },
            olympus: { id: 'olympus', name: '–û–ª–∏–º–ø', emoji: '‚ö°Ô∏è', price: 77, color: 'from-yellow-400 to-orange-600', locked: false, isNew: true, freeCount: 2, type: 'special' }
        };
        
        const CASE_REWARDS = {
            olympus: [
                { id: 'persephone', name: '–ü–µ—Ä—Å–µ—Ñ–æ–Ω–∞üå∫', emoji: 'üå∫', type: 'item', sellPrice: 20, realChance: 40, displayChance: '40%' },
                { id: 'ares', name: '–ê—Ä–µ—Åüó°Ô∏è', emoji: 'üó°Ô∏è', type: 'item', sellPrice: 28, realChance: 20, displayChance: '20%' },
                { id: 'hermes', name: '–ì–µ—Ä–º–µ—Åüìà', emoji: 'üìà', type: 'slot_unlock', realChance: 15, displayChance: '15%' },
                { id: 'dionys', name: '–î–∏–æ–Ω–∏—Åüç∑', emoji: 'üç∑', type: 'stars', value: 80, realChance: 10, displayChance: '10%' },
                { id: 'apollon', name: '–ê–ø–æ–ª–ª–æ–Ω‚òÄÔ∏è', emoji: '‚òÄÔ∏è', type: 'case', caseType: 'star', count: 5, realChance: 8, displayChance: '8%' },
                { id: 'poseidon', name: '–ü–æ—Å–µ–π–¥–æ–Ωüî±', emoji: 'üî±', type: 'choice_poseidon', realChance: 5, displayChance: '5%' },
                { id: 'hades', name: '–ê–∏–¥üî•', emoji: 'üî•', type: 'choice_hades', realChance: 1.9, displayChance: '1.9%' },
                { id: 'zeus', name: '–ó–µ–≤—Å‚ö°Ô∏è', emoji: '‚ö°Ô∏è', type: 'choice_zeus', realChance: 0.1, displayChance: '0.1%' }
            ],
            daily: [
                { id: 'stars_1', name: '1 ‚≠êÔ∏è', emoji: '‚≠êÔ∏è', type: 'stars', value: 1, realChance: 50, displayChance: '50%' },
                { id: 'stars_3', name: '3 ‚≠êÔ∏è', emoji: '‚≠êÔ∏è', type: 'stars', value: 3, realChance: 35, displayChance: '35%' },
                { id: 'stars_15', name: '15 ‚≠êÔ∏è', emoji: '‚≠êÔ∏è', type: 'stars', value: 15, realChance: 10, displayChance: '10%' },
                { id: 'pickaxe', name: '–ö–∏—Ä–∫–∞ ‚õèÔ∏è', emoji: '‚õèÔ∏è', type: 'item', sellPrice: 22, realChance: 4, displayChance: '4%' },
                { id: 'random_case_box', name: '–°–ª—É—á–∞–π–Ω—ã–π –∫–µ–π—Å', emoji: 'üì¶', type: 'random_case_box', realChance: 1, displayChance: '1%' },
            ],
            cardboard: [
                { id: 'stars_0_25', name: '0.25 ‚≠êÔ∏è', displayChance: '80%', realChance: 80, type: 'stars', value: 0.25, emoji: '‚≠êÔ∏è' },
                { id: 'stars_0_75', name: '0.75 ‚≠êÔ∏è', displayChance: '10%', realChance: 10, type: 'stars', value: 0.75, emoji: '‚≠êÔ∏è' },
                { id: 'stars_1_5', name: '1.5 ‚≠êÔ∏è', displayChance: '6%', realChance: 6, type: 'stars', value: 1.5, emoji: '‚≠êÔ∏è' },
                { id: 'stars_5', name: '5 ‚≠êÔ∏è', displayChance: '2%', realChance: 2, type: 'stars', value: 5, emoji: '‚≠êÔ∏è' },
                { id: 'bear', name: 'üß∏', displayChance: '1.5%', realChance: 1.5, type: 'item', sellPrice: 20, emoji: 'üß∏' },
                { id: 'diamond_pro', name: 'üíé PRO', displayChance: '0.5%', realChance: 0, type: 'collectible', emoji: 'üíé' }
            ],
            coal: [
                { id: 'stars_5', name: '5 ‚≠êÔ∏è', displayChance: '60.5%', realChance: 60.5, type: 'stars', value: 5, emoji: '‚≠êÔ∏è' },
                { id: 'stars_12', name: '12 ‚≠êÔ∏è', displayChance: '18%', realChance: 18, type: 'stars', value: 12, emoji: '‚≠êÔ∏è' },
                { id: 'pickaxe', name: '–ö–∏—Ä–∫–∞ ‚õèÔ∏è', displayChance: '10%', realChance: 10, type: 'item', sellPrice: 22, emoji: '‚õèÔ∏è' },
                { id: 'stars_30', name: '30 ‚≠êÔ∏è', displayChance: '6%', realChance: 6, type: 'stars', value: 30, emoji: '‚≠êÔ∏è' },
                { id: 'material', name: '–ú–∞—Ç–µ—Ä–∏–∞–ª üß±', displayChance: '5%', realChance: 5, type: 'item', sellPrice: 80, emoji: 'üß±' },
                { id: 'brownie_pro', name: 'Happy Brownie PRO üí©', displayChance: '0.5%', realChance: 0, type: 'collectible', emoji: 'üí©' }
            ],
            platinum: [
                { id: 'stars_35', name: '35 ‚≠êÔ∏è', displayChance: '55%', realChance: 55, type: 'stars', value: 35, emoji: '‚≠êÔ∏è' },
                { id: 'stars_50', name: '50 ‚≠êÔ∏è', displayChance: '35%', realChance: 35, type: 'stars', value: 50, emoji: '‚≠êÔ∏è' },
                { id: 'ring', name: 'üíç', displayChance: '5%', realChance: 0, type: 'collectible', emoji: 'üíç' },
                { id: 'bday', name: 'B-day üóì', displayChance: '4%', realChance: 4, type: 'item', sellPrice: 150, emoji: 'üóì' },
                { id: 'bday_pro', name: 'B-Day PRO üìÖ', displayChance: '1%', realChance: 0, type: 'collectible', emoji: 'üìÖ' }
            ],
            gold: [
                { id: 'stars_50', name: '50 ‚≠êÔ∏è', displayChance: '50%', realChance: 50, type: 'stars', value: 50, emoji: '‚≠êÔ∏è' },
                { id: 'stars_125', name: '125 ‚≠êÔ∏è', displayChance: '35%', realChance: 35, type: 'stars', value: 125, emoji: '‚≠êÔ∏è' },
                { id: 'clover', name: 'üçÄ Clover Pin', displayChance: '10%', realChance: 10, type: 'item', sellPrice: 200, emoji: 'üçÄ' },
                { id: 'icecream', name: 'Ice Cream üç¶', displayChance: '3%', realChance: 0, type: 'collectible', emoji: 'üç¶' },
                { id: 'clover_pro', name: 'üçÄ Clover Pin PRO', displayChance: '2%', realChance: 0, type: 'collectible', emoji: 'üçÄ' }
            ],
            money: [
                { id: 'stars_150', name: '150 ‚≠êÔ∏è', displayChance: '45%', realChance: 45, type: 'stars', value: 150, emoji: '‚≠êÔ∏è' },
                { id: 'stars_75', name: '75 ‚≠êÔ∏è', displayChance: '40%', realChance: 40, type: 'stars', value: 75, emoji: '‚≠êÔ∏è' },
                { id: 'trophy', name: 'üèÜ', displayChance: '5%', realChance: 0, type: 'collectible', emoji: 'üèÜ' },
                { id: 'gem', name: 'üíé', displayChance: '5%', realChance: 0, type: 'collectible', emoji: 'üíé' },
                { id: 'bday_happy', name: 'Happy B-day üíà', displayChance: '4%', realChance: 4, type: 'collectible', emoji: 'üíà' },
                { id: 'cigar', name: 'Snoop Cigar üö¨', displayChance: '1%', realChance: 0, type: 'collectible', emoji: 'üö¨' }
            ],
            elite: [
                { id: 'stars_200', name: '200 ‚≠êÔ∏è', displayChance: '65%', realChance: 65, type: 'stars', value: 200, emoji: '‚≠êÔ∏è' },
                { id: 'stars_275', name: '275 ‚≠êÔ∏è', displayChance: '25%', realChance: 25, type: 'stars', value: 275, emoji: '‚≠êÔ∏è' },
                { id: 'champagne', name: 'üçæ', displayChance: '8.5%', realChance: 0, type: 'collectible', emoji: 'üçæ' },
                { id: 'socks', name: '–ù–æ—Å–∫–∏ üß¶', displayChance: '1%', realChance: 0, type: 'collectible', emoji: 'üß¶' },
                { id: 'lightsword', name: 'Light Sword ‚öîÔ∏è', displayChance: '0.5%', realChance: 0, type: 'collectible', emoji: '‚öîÔ∏è' }
            ],
            diamond: [
                { id: 'stars_8', name: '8 ‚≠êÔ∏è', displayChance: '70%', realChance: 70, type: 'stars', value: 8, emoji: '‚≠êÔ∏è' },
                { id: 'bear', name: '–ú–∏—à–∫–∞ üß∏', displayChance: '15%', realChance: 15, type: 'item', sellPrice: 20, emoji: 'üß∏' },
                { id: 'stars_25', name: '25 ‚≠êÔ∏è', displayChance: '9%', realChance: 9, type: 'stars', value: 25, emoji: '‚≠êÔ∏è' },
                { id: 'stars_80', name: '80 ‚≠êÔ∏è', displayChance: '4%', realChance: 4, type: 'stars', value: 80, emoji: '‚≠êÔ∏è' },
                { id: 'diamond_pro', name: '–ê–ª–º–∞–∑ PRO üíé', displayChance: '0.6%', realChance: 0, type: 'collectible', emoji: 'üíé' },
                { id: 'snoop_pro', name: 'Snoop Dog PRO üêï', displayChance: '0.4%', realChance: 0, type: 'collectible', emoji: 'üêï' }
            ],
            star: [
                {id: 'stars_1', name: '1 ‚≠êÔ∏è', displayChance: '10.50%', realChance: 10.50, type: 'stars', value: 1, emoji: '‚≠êÔ∏è'},
                {id: 'stars_2', name: '2 ‚≠êÔ∏è', displayChance: '8.00%', realChance: 8.00, type: 'stars', value: 2, emoji: '‚≠êÔ∏è'},
                {id: 'stars_3', name: '3 ‚≠êÔ∏è', displayChance: '6.50%', realChance: 6.50, type: 'stars', value: 3, emoji: '‚≠êÔ∏è'},
                {id: 'stars_5', name: '5 ‚≠êÔ∏è', displayChance: '4.30%', realChance: 4.30, type: 'stars', value: 5, emoji: '‚≠êÔ∏è'},
                {id: 'stars_10', name: '10 ‚≠êÔ∏è', displayChance: '2.20%', realChance: 2.20, type: 'stars', value: 10, emoji: '‚≠êÔ∏è'},
                {id: 'stars_25', name: '25 ‚≠êÔ∏è', displayChance: '0.58%', realChance: 0.58, type: 'stars', value: 25, emoji: '‚≠êÔ∏è'},
            ],
        };
        const GERAKL_MULTIPLIERS = [1.0, 1.1, 1.4, 1.9, 2.3, 2.6, 3.8, 4.5, 5.5, 6.0, 10.0];
        const GERAKL_ICE_CHANCES = [0.15, 0.18, 0.18, 0.20, 0.30, 0.35, 0.45, 0.45, 0.45, 0.50, 0.53];
        function App() {
            const [currentScreen, setCurrentScreen] = useState('cases');
            const [balance, setBalance] = useState(0);
            const [cases, setCases] = useState(INITIAL_CASES);
            const [inventory, setInventory] = useState([]);
            const [inventorySlots, setInventorySlots] = useState(5);
            const [tasks, setTasks] = useState({ 
                cardboard7: { completed: false, count: 0 },
                deposit50: { completed: false },
                subscribe: { completed: false },
                deposit: { completed: false },
                depositMajor: { completed: false },
                inviteThree: { completed: false, count: 0, required: 3, reward: 25 }
            });
            const [user, setUser] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [dailyCaseTimeLeft, setDailyCaseTimeLeft] = useState('');
            const [selectedCase, setSelectedCase] = useState(null);
            const [isSpinning, setIsSpinning] = useState(false);
            const [spinResult, setSpinResult] = useState(null);
            const [rouletteOffset, setRouletteOffset] = useState(0);
            const [fakeItems, setFakeItems] = useState([]);
            const [rouletteKey, setRouletteKey] = useState(0);
            const rouletteContainerRef = useRef(null);
            const [showTopUp, setShowTopUp] = useState(false);
            const [promoCode, setPromoCode] = useState('');
            const [promoError, setPromoError] = useState('');
            const [promoSuccess, setPromoSuccess] = useState('');
            const [usedPromos, setUsedPromos] = useState([]);
            const [wonPromos, setWonPromos] = useState([]);
            const [showCollectibleModal, setShowCollectibleModal] = useState(false);
            const [selectedCollectible, setSelectedCollectible] = useState(null);
            const [showWithdrawModal, setShowWithdrawModal] = useState(false);
            const [withdrawAmount, setWithdrawAmount] = useState('');
            const [showAdminLogin, setShowAdminLogin] = useState(false);
            const [adminLogin, setAdminLogin] = useState('');
            const [adminPassword, setAdminPassword] = useState('');
            const [isAdmin, setIsAdmin] = useState(false);
            const [adminScreen, setAdminScreen] = useState('stats');
            const [allUsers, setAllUsers] = useState([]);
            const [selectedUser, setSelectedUser] = useState(null);
            const [adminUserSearch, setAdminUserSearch] = useState('');
            const [adminAttempts, setAdminAttempts] = useState(0);
            const [onlineCount, setOnlineCount] = useState(Math.floor(Math.random() * 300) + 200);
            const [paymentStatus, setPaymentStatus] = useState('');
            const [totalDeposits, setTotalDeposits] = useState(0);
            const [olympusScreen, setOlympusScreen] = useState('main');
            const [olympusOpens, setOlympusOpens] = useState(0);
            const [topOlympusPlayers, setTopOlympusPlayers] = useState([]);
            const [olympusProgress, setOlympusProgress] = useState([]);
            const [showOlympusChoiceModal, setShowOlympusChoiceModal] = useState(false);
            const [olympusChoiceType, setOlympusChoiceType] = useState(null);
            const OLYMPUS_PROGRESS = [
                { opens: 3, reward: { type: 'case', caseType: 'star', count: 3 }, name: '3 –∫–µ–π—Å–∞ –ó–≤–µ–∑–¥–Ω—ã–π' },
                { opens: 7, reward: { type: 'case', caseType: 'gold', count: 1 }, name: '1 –∫–µ–π—Å –ó–æ–ª–æ—Ç–æ–π' },
                { opens: 15, reward: { type: 'case', caseType: 'elite', count: 1 }, name: '1 –∫–µ–π—Å –≠–ª–∏—Ç–∞' },
                { opens: 20, reward: { type: 'stars', value: 150 }, name: '150‚≠êÔ∏è' },
                { opens: 25, reward: { type: 'case', caseType: 'money', count: 3 }, name: '3 –∫–µ–π—Å–∞ –î–µ–Ω–µ–∂–Ω—ã–π' },
                { opens: 30, reward: { type: 'item', name: '–ü–æ–¥–∞—Ä–æ–∫ –ê–∏–¥' }, name: '–ü–æ–¥–∞—Ä–æ–∫ –ê–∏–¥' },
                { opens: 50, reward: { type: 'item', name: '–ü–æ–¥–∞—Ä–æ–∫ –ó–µ–≤—Å' }, name: '–ü–æ–¥–∞—Ä–æ–∫ –ó–µ–≤—Å' },
                { opens: 150, reward: { type: 'case', caseType: 'star', count: 25 }, name: '25 –ó–≤–µ–∑–¥–Ω—ã—Ö + 1000‚≠êÔ∏è' }
            ];
            useEffect(() => {
                const initApp = async () => {
                    let userId = null;
                    let userData = { name: '–ì–æ—Å—Ç—å', username: null, avatar: null };
                    if (TelegramWebApp) {
                        TelegramWebApp.ready();
                        TelegramWebApp.expand();
                        const tgUser = TelegramWebApp.initDataUnsafe?.user;
                        if (tgUser) {
                            userId = tgUser.id.toString();
                            userData = { name: tgUser.first_name + (tgUser.last_name ? ' ' + tgUser.last_name : ''), username: tgUser.username ? '@' + tgUser.username : null, avatar: tgUser.photo_url || null };
                        }
                    }
                    if (!userId) {
                        userId = localStorage.getItem('sbs_user_id') || ('guest_' + Date.now());
                        localStorage.setItem('sbs_user_id', userId);
                    } else {
                        localStorage.setItem('sbs_user_id', userId);
                    }
                    try {
                        const snap = await db.ref('users/' + userId).once('value');
                        const data = snap.val();
                        if (data) {
                            const storedCases = data.cases || {};
                            const newMergedCases = {};
                            for (const caseId in INITIAL_CASES) {
                                const initialCase = INITIAL_CASES[caseId];
                                const storedCase = storedCases[caseId];
                                newMergedCases[caseId] = { ...initialCase };
                                if (storedCase) {
                                    newMergedCases[caseId].freeCount = storedCase.freeCount || 0;
                                    if (storedCase.locked !== undefined) newMergedCases[caseId].locked = storedCase.locked;
                                    if (caseId === 'daily' && storedCase.lastOpened) newMergedCases[caseId].lastOpened = storedCase.lastOpened;
                                }
                            }
                            setUser({ id: userId, ...userData, ...data });
                            setBalance(data.balance || 0);
                            setCases(newMergedCases);
                            setInventory(data.inventory || []);
                            setTasks(data.tasks || tasks);
                            setInventorySlots(data.inventorySlots || 5);
                            setUsedPromos(data.usedPromos || []);
                            setWonPromos(data.wonPromos || []);
                            setTotalDeposits(data.totalDeposits || 0);
                            setOlympusOpens(data.olympusOpens || 0);
                        } else {
                            const newCases = { ...INITIAL_CASES, daily: { ...INITIAL_CASES.daily, freeCount: 1, lastOpened: 0 }, diamond: { ...INITIAL_CASES.diamond, freeCount: 5 }, olympus: { ...INITIAL_CASES.olympus, freeCount: 2 } };
                            const newUser = { balance: 0, cases: newCases, inventory: [], tasks, inventorySlots: 5, usedPromos: [], wonPromos: [], createdAt: Date.now(), lastActive: Date.now(), totalDeposits: 0, olympusOpens: 0, name: userData.name, username: userData.username || '' };
                            setCases(newCases);
                            setUser({ id: userId, ...userData });
                            await db.ref('users/' + userId).set(newUser);
                        }
                    } catch (e) { console.error(e); }
                    setIsLoading(false);
                };
                initApp();
            }, []);
            useEffect(() => {
                if (!user?.id || isLoading) return;
                const iv = setInterval(() => {
                    db.ref('users/' + user.id).update({ 
                        balance, inventory, tasks, inventorySlots, usedPromos, wonPromos, lastActive: Date.now(), totalDeposits, olympusOpens,
                        cases
                    });
                }, 5000);
                return () => clearInterval(iv);
            }, [balance, cases, inventory, tasks, inventorySlots, usedPromos, wonPromos, user?.id, isLoading, totalDeposits, olympusOpens]);
            useEffect(() => {
                if (isLoading || !cases.daily) return;
                const DAILY_COOLDOWN = 23 * 60 * 60 * 1000;
                const timer = setInterval(() => {
                    const lastOpened = cases.daily.lastOpened || 0;
                    const now = Date.now();
                    const timePassed = now - lastOpened;
                    if (timePassed >= DAILY_COOLDOWN) {
                        if(cases.daily.freeCount === 0) {
                            setCases(prev => ({ ...prev, daily: { ...prev.daily, freeCount: 1 } }));
                        }
                        setDailyCaseTimeLeft('–î–æ—Å—Ç—É–ø–Ω–æ!');
                    } else {
                        const remaining = DAILY_COOLDOWN - timePassed;
                        const h = Math.floor(remaining / (1000 * 60 * 60));
                        const m = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                        const s = Math.floor((remaining % (1000 * 60)) / 1000);
                        setDailyCaseTimeLeft(`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`);
                    }
                }, 1000);
                return () => clearInterval(timer);
            }, [cases.daily, isLoading]);
            useEffect(() => {
                const loadOlympusData = async () => {
                    try {
                        const snap = await db.ref('users').orderByChild('olympusOpens').limitToLast(5).once('value');
                        const players = [];
                        snap.forEach(child => {
                            const data = child.val();
                            if (data.olympusOpens > 0) {
                                players.unshift({ id: child.key, ...data });
                            }
                        });
                        setTopOlympusPlayers(players);
                    } catch (e) { console.error(e); }
                };
                loadOlympusData();
                const timer = setInterval(loadOlympusData, 10000);
                return () => clearInterval(timer);
            }, []);
            const checkPromo = async () => {
                const code = promoCode.toUpperCase().trim();
                setPromoError(''); setPromoSuccess('');
                if(!code) return;
                if(usedPromos.includes(code)) { setPromoError('–£–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!'); return; }
                if(code === 'OLIMP') {
                     const nb = balance + 130;
                     setBalance(nb);
                     setPromoSuccess('‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–æ 130‚≠êÔ∏è!');
                     const np = [...usedPromos, code];
                     setUsedPromos(np);
                     setPromoCode('');
                     await db.ref(`users/${user.id}`).update({ balance: nb, usedPromos: np });
                } else if(code === 'DELLKO') {
                     if(!wonPromos.includes('DELLKO')) { setPromoError('–¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–∏–≥—Ä–∞–ª–∏ –≤ –û–ª–∏–º–ø–µ!'); return; }
                     const nc = { ...cases, money: { ...cases.money, freeCount: (cases.money.freeCount || 0) + 3 } };
                     setCases(nc);
                     await addToInventory({ name: 'üßä –õ—ë–¥ (1/3)', emoji: 'üßä', type: 'ice', part: 1 });
                     setPromoSuccess('+3 –¥–µ–Ω–µ–∂–Ω—ã—Ö –∫–µ–π—Å–∞ + üßä!');
                     const np = [...usedPromos, code];
                     setUsedPromos(np);
                     setPromoCode('');
                     await db.ref(`users/${user.id}/usedPromos`).set(np);
                } else if(code === 'DIAMOND') {
                     const nc = { ...cases, diamond: { ...cases.diamond, freeCount: (cases.diamond.freeCount || 0) + 2 } };
                     setCases(nc);
                     setPromoSuccess('+2 –∫–µ–π—Å–∞ –ê–ª–º–∞–∑!');
                     const np = [...usedPromos, code];
                     setUsedPromos(np);
                     setPromoCode('');
                     await db.ref(`users/${user.id}/usedPromos`).set(np);
                } else {
                     setPromoError('–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥');
                }
            };
            const handleSelectCase = (caseData) => {
                setSpinResult(null); setFakeItems([]); setSelectedCase(caseData);
            };
            const openCase = async (caseType) => {
                const cData = cases[caseType];
                if(cData.id === 'daily' && cData.freeCount === 0) { alert('–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∫–µ–π—Å –Ω–µ –≥–æ—Ç–æ–≤!'); return; }
                const price = getCasePrice(caseType);
                const isFree = cData.freeCount > 0;
                if(!isFree && balance < price) { alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥!'); return; }
                let nb = balance;
                if(cData.id === 'daily' && isFree) {
                    const now = Date.now();
                    setCases(p => ({ ...p, daily: { ...p.daily, freeCount: 0, lastOpened: now } }));
                    await db.ref(`users/${user.id}/cases/daily`).update({ freeCount: 0, lastOpened: now });
                } else if(isFree) {
                     const nf = cData.freeCount - 1;
                     setCases(p => ({ ...p, [caseType]: { ...p[caseType], freeCount: nf } }));
                     await db.ref(`users/${user.id}/cases/${caseType}/freeCount`).set(nf);
                } else {
                     nb -= price;
                     setBalance(nb);
                     await db.ref(`users/${user.id}/balance`).set(nb);
                }
                if (caseType === 'olympus') {
                    const newOpens = olympusOpens + 1;
                    setOlympusOpens(newOpens);
                    await db.ref(`users/${user.id}/olympusOpens`).set(newOpens);
                    
                    const newCardboard = tasks.cardboard7.count + 1;
                    if (newCardboard >= 7 && !tasks.cardboard7.completed) {
                        const nc = { ...cases, diamond: { ...cases.diamond, freeCount: (cases.diamond.freeCount || 0) + 1 } };
                        const nt = { ...tasks, cardboard7: { completed: true, count: newCardboard } };
                        setCases(nc);
                        setTasks(nt);
                        await db.ref(`users/${user.id}`).update({ cases: nc, tasks: nt });
                    } else {
                        const nt = { ...tasks, cardboard7: { ...tasks.cardboard7, count: newCardboard } };
                        setTasks(nt);
                        await db.ref(`users/${user.id}/tasks/cardboard7`).set(nt.cardboard7);
                    }
                }
                setIsSpinning(false); setSpinResult(null); setFakeItems([]); setRouletteOffset(0); setRouletteKey(k => k+1);
                const items = CASE_REWARDS[caseType];
                let won = items[0], r = Math.random()*100, cum = 0;
                for(let i of items) { cum += i.realChance; if(r <= cum) { won = i; break; } }
                
                const tape = [];
                for(let i=0; i<80; i++) tape.push(i===70 ? won : items[Math.floor(Math.random()*items.length)]);
                setIsSpinning(true);
                setTimeout(() => {
                     setFakeItems(tape);
                     setTimeout(() => {
                         const cw = rouletteContainerRef.current ? rouletteContainerRef.current.offsetWidth : window.innerWidth;
                         const target = (70 * 136 + 68 - cw/2);
                         setRouletteOffset(-target);
                     }, 50);
                }, 50);
                setTimeout(async () => {
                     setSpinResult(won); setIsSpinning(false);
                     if(won.type === 'stars') {
                         const fb = nb + won.value;
                         setBalance(fb);
                         await db.ref(`users/${user.id}/balance`).set(fb);
                     } else if(won.type === 'case') {
                         const nc = { ...cases, [won.caseType]: { ...cases[won.caseType], freeCount: (cases[won.caseType].freeCount || 0) + won.count } };
                         setCases(nc);
                         await db.ref(`users/${user.id}/cases/${won.caseType}/freeCount`).set((cases[won.caseType].freeCount || 0) + won.count);
                     } else if(won.type === 'slot_unlock') {
                         const newSlots = inventorySlots + 1;
                         setInventorySlots(newSlots);
                         await db.ref(`users/${user.id}/inventorySlots`).set(newSlots);
                     } else if(won.type === 'choice_poseidon') {
                         setOlympusChoiceType('poseidon');
                         setShowOlympusChoiceModal(true);
                     } else if(won.type === 'choice_hades') {
                         setOlympusChoiceType('hades');
                         setShowOlympusChoiceModal(true);
                     } else if(won.type === 'choice_zeus') {
                         setOlympusChoiceType('zeus');
                         setShowOlympusChoiceModal(true);
                     } else {
                         await addToInventory(won);
                     }
                }, 6600);
            };
            const getCasePrice = (ct) => {
                const c = cases[ct];
                if (!c) return 0;
                if (c.id === 'daily' && c.freeCount > 0) return 0;
                if (c.freeCount > 0) return 0;
                if (c.discountPrice && c.discountPrice !== c.price) return c.discountPrice;
                return c.price;
            };
            const addToInventory = async (item) => {
                if(inventory.length >= inventorySlots) { alert('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø–æ–ª–æ–Ω!'); return; }
                const ni = [...inventory, { ...item, uniqueId: Date.now(), collected: Date.now() }];
                setInventory(ni);
                await db.ref(`users/${user.id}/inventory`).set(ni);
            };
            const handleOlympusChoice = async (choice) => {
                setShowOlympusChoiceModal(false);
                
                if (olympusChoiceType === 'poseidon') {
                    if (choice === 'stars') {
                        const nb = balance + 200;
                        setBalance(nb);
                        await db.ref(`users/${user.id}/balance`).set(nb);
                    } else {
                        const nc = { ...cases, platinum: { ...cases.platinum, freeCount: (cases.platinum.freeCount || 0) + 5 } };
                        setCases(nc);
                        await db.ref(`users/${user.id}/cases/platinum/freeCount`).set((cases.platinum.freeCount || 0) + 5);
                    }
                } else if (olympusChoiceType === 'hades') {
                    if (choice === 'stars') {
                        const nb = balance + 250;
                        setBalance(nb);
                        await db.ref(`users/${user.id}/balance`).set(nb);
                    } else {
                        const nc = { ...cases, collector: { ...cases.collector, locked: false, freeCount: (cases.collector.freeCount || 0) + 1 } };
                        setCases(nc);
                        await db.ref(`users/${user.id}/cases/collector`).update({ locked: false, freeCount: (cases.collector.freeCount || 0) + 1 });
                    }
                } else if (olympusChoiceType === 'zeus') {
                    const nc = { ...cases, collector: { ...cases.collector, locked: false, freeCount: (cases.collector.freeCount || 0) + 2 } };
                    setCases(nc);
                    await db.ref(`users/${user.id}/cases/collector`).update({ locked: false, freeCount: (cases.collector.freeCount || 0) + 2 });
                }
                
                setOlympusChoiceType(null);
            };
            const handleTitleClick = () => { if(++adminAttempts >= 12) { setShowAdminLogin(true); setAdminAttempts(0); } };
            const checkAdminLogin = () => {
                 if(adminLogin === '*^BAGUETTE_642819_6281' && adminPassword === '3628874910ZTWMI') {
                     setIsAdmin(true);
                     setShowAdminLogin(false);
                     db.ref('users').once('value').then(snap => {
                         const u = [];
                         snap.forEach(c => u.push({ id: c.key, ...c.val() }));
                         setAllUsers(u);
                     });
                 } else {
                     alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!');
                 }
            };
            if(isAdmin) {
                return (
                    <div className="min-h-screen bg-gray-900 p-4">
                        <div className="max-w-4xl mx-auto">
                            <div className="flex justify-between items-center mb-6">
                                <h1 className="text-2xl font-bold text-white">üîê –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
                                <button onClick={() => setIsAdmin(false)} className="text-gray-400 hover:text-white">–í—ã–π—Ç–∏</button>
                            </div>
                            <div className="glass rounded-xl p-6">
                                <h3 className="text-lg mb-4">–í—ã–¥–∞—Ç—å —Å–µ–±–µ:</h3>
                                <div className="grid grid-cols-3 gap-2">
                                    <button onClick={async () => { const nb = balance + 10000; setBalance(nb); await db.ref(`users/${user.id}/balance`).set(nb); }} className="bg-indigo-600 p-3 rounded text-sm">+10000‚≠êÔ∏è</button>
                                    <button onClick={async () => { const nc = { ...cases, diamond: { ...cases.diamond, freeCount: (cases.diamond.freeCount || 0) + 10 } }; setCases(nc); await db.ref(`users/${user.id}/cases/diamond/freeCount`).set((cases.diamond.freeCount || 0) + 10); }} className="bg-blue-600 p-3 rounded text-sm">+10üíé</button>
                                    <button onClick={async () => { const nc = { ...cases, collector: { ...cases.collector, locked: false, freeCount: (cases.collector.freeCount || 0) + 5 } }; setCases(nc); await db.ref(`users/${user.id}/cases/collector`).update({ locked: false }); }} className="bg-pink-800 p-3 rounded text-sm">üîì –ö–æ–ª–ª–µ–∫—Ü.</button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }
            return (
                <div className="min-h-screen pb-24">
                    <header className="p-4 flex justify-between items-center glass sticky top-0 z-50">
                        <h1 onClick={handleTitleClick} className="text-xl font-bold cursor-pointer select-none hover:text-cyan-300 transition">Step By Step Game</h1>
                        <button onClick={() => setShowTopUp(true)} className="bg-gradient-to-r from-yellow-400 to-orange-500 px-4 py-2 rounded-full font-bold text-gray-900 shadow-lg text-sm">{balance.toFixed(2)} ‚≠êÔ∏è</button>
                    </header>
                    
                    <main className="p-4 max-w-md mx-auto">
                        {currentScreen === 'cases' && (
                            <div>
                                <h2 className="text-2xl font-bold mb-4 text-center">üé∞ –ö–µ–π—Å—ã</h2>
                                
                                {cases.diamond?.freeCount > 0 && <div className="bg-green-500/20 border border-green-500 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –ê–ª–º–∞–∑: {cases.diamond.freeCount}</div>}
                                {cases.elite?.freeCount > 0 && <div className="bg-green-500/20 border border-green-500 rounded-lg p-3 mb-3 text-center text-sm animate-pulse">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –≠–ª–∏—Ç–∞: {cases.elite.freeCount}</div>}
                                <div className="mb-6">
                                    <h3 className="text-lg font-bold text-center mb-3 text-purple-300">üîÆ –û—Å–æ–±—ã–µ üîÆ</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        {Object.values(cases).filter(c => c.type === 'special').map(c => (
                                            <div key={c.id} className="glass rounded-xl p-4 relative overflow-hidden hover:scale-105 transition">
                                                <div className={`w-16 h-16 mx-auto rounded-lg bg-gradient-to-br ${c.color} flex items-center justify-center text-3xl mb-2 shadow-lg`}>{c.emoji}</div>
                                                <h3 className="font-bold text-center text-sm">{c.name}</h3>
                                                <p className="text-center text-xs opacity-75 mb-2 h-4 flex items-center justify-center">
                                                    {c.id === 'daily' ? (c.freeCount > 0 ? <span className="text-green-400 font-bold">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ!</span> : <span className="daily-timer text-xs">{dailyCaseTimeLeft}</span>) : (c.freeCount > 0 ? <span className="text-green-400 font-bold">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ ({c.freeCount})</span> : c.price + '‚≠êÔ∏è')}
                                                </p>
                                                <button onClick={() => c.id === 'olympus' ? (setOlympusScreen('treasure'), setCurrentScreen('events')) : handleSelectCase(c)} className="w-full py-2 rounded-lg font-bold text-sm bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 transition">–û—Ç–∫—Ä—ã—Ç—å</button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="mb-6">
                                    <h3 className="text-lg font-bold text-center mb-3 text-yellow-300">üéÅ –û–±—ã—á–Ω—ã–µ üéÅ</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        {Object.values(cases).filter(c => !c.type && !c.locked).map(c => (
                                            <div key={c.id} className="glass rounded-xl p-4 relative overflow-hidden hover:scale-105 transition">
                                                <div className={`w-16 h-16 mx-auto rounded-lg bg-gradient-to-br ${c.color} flex items-center justify-center text-3xl mb-2 shadow-lg`}>{c.emoji}</div>
                                                <h3 className="font-bold text-center text-sm">{c.name}</h3>
                                                <p className="text-center text-xs opacity-75 mb-2 h-4">
                                                    {c.freeCount > 0 ? <span className="text-green-400 font-bold">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ!</span> : (c.discountPrice && c.discountPrice !== c.price ? <span><span className="line-through">{c.originalPrice || c.price}‚≠êÔ∏è</span> <span className="font-bold text-white">{c.discountPrice}‚≠êÔ∏è</span></span> : c.price + '‚≠êÔ∏è')}
                                                </p>
                                                <button onClick={() => handleSelectCase(c)} className="w-full py-2 rounded-lg font-bold text-sm bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 transition">–û—Ç–∫—Ä—ã—Ç—å</button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                        {currentScreen === 'events' && (
                            <div>
                                {olympusScreen === 'main' && (
                                    <div className="space-y-4">
                                        <div className="olymp-header text-center mb-6">üèõÔ∏è –ò–í–ï–ù–¢ –û–õ–ò–ú–ü ‚ö°Ô∏è</div>
                                        
                                        <button onClick={() => setOlympusScreen('heroes')} className="w-full olymp-button text-center">
                                            üèÜ –ì–µ—Ä–æ–∏ –û–ª–∏–º–ø–∞ üèÜ
                                        </button>
                                        <div className="grid grid-cols-2 gap-4">
                                            <button onClick={() => setOlympusScreen('treasure')} className="olymp-button text-center">
                                                ‚ö°Ô∏è –°–æ–∫—Ä–æ–≤–∏—â–µ<br/>–û–ª–∏–º–ø–∞ ‚ö°Ô∏è
                                            </button>
                                            <button onClick={() => setOlympusScreen('hephaestus')} className="olymp-button text-center">
                                                üèµÔ∏è –õ–∞–≤–∫–∞<br/>–ì–µ—Ñ–µ—Å—Ç–∞ üèµÔ∏è
                                            </button>
                                        </div>
                                    </div>
                                )}
                                {olympusScreen === 'heroes' && (
                                    <div>
                                        <button onClick={() => setOlympusScreen('main')} className="mb-4 text-yellow-400 hover:text-yellow-300">‚Üê –ù–∞–∑–∞–¥</button>
                                        <h2 className="olymp-header text-center mb-4">üèÜ –ì–µ—Ä–æ–∏ –û–ª–∏–º–ø–∞ üèÜ</h2>
                                        <p className="text-center text-yellow-300 mb-4 text-sm">–¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –æ—Ç–∫—Ä—ã—Ç–∏—è–º –∫–µ–π—Å–∞ –û–ª–∏–º–ø‚ö°Ô∏è</p>
                                        
                                        <div className="space-y-3">
                                            {topOlympusPlayers.map((player, idx) => (
                                                <div key={player.id} className="hero-card">
                                                    <div className="flex items-center gap-3 mb-2">
                                                        {idx === 0 && <span className="text-2xl">ü•á</span>}
                                                        {idx === 1 && <span className="text-2xl">ü•à</span>}
                                                        {idx === 2 && <span className="text-2xl">ü•â</span>}
                                                        {idx > 2 && <span className="text-2xl">{idx + 1}</span>}
                                                        
                                                        <div className="hero-avatar">
                                                            {player.avatar ? <img src={player.avatar} alt="" style={{borderRadius: '50%', width: '100%', height: '100%'}} /> : player.name?.charAt(0).toUpperCase()}
                                                        </div>
                                                    </div>
                                                    <p className="font-bold text-white text-sm">{player.name}</p>
                                                    <p className="text-yellow-400 font-bold text-lg">{player.olympusOpens || 0} –æ—Ç–∫—Ä—ã—Ç–∏–π</p>
                                                </div>
                                            ))}
                                        </div>
                                        <p className="text-center text-yellow-300 text-xs mt-4">–¢–æ–ø 3 –ø–æ–ª—É—á–∞—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã –≤ –∫–æ–Ω—Ü–µ –∏–≤–µ–Ω—Ç–∞!</p>
                                    </div>
                                )}
                                {olympusScreen === 'treasure' && (
                                    <div>
                                        <button onClick={() => setOlympusScreen('main')} className="mb-4 text-yellow-400 hover:text-yellow-300">‚Üê –ù–∞–∑–∞–¥</button>
                                        <h2 className="olymp-header text-center mb-4">‚ö°Ô∏è –°–æ–∫—Ä–æ–≤–∏—â–µ –û–ª–∏–º–ø–∞ ‚ö°Ô∏è</h2>
                                        
                                        <div className="glass rounded-xl p-4 mb-4">
                                            <div className="text-center mb-4">
                                                <div className="text-6xl mb-2">‚ö°Ô∏è</div>
                                                <h3 className="text-yellow-300 font-bold mb-2">–ö–µ–π—Å –û–ª–∏–º–ø</h3>
                                                <p className="text-yellow-400 text-sm mb-3">–¶–µ–Ω–∞: 77‚≠êÔ∏è | –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö: {cases.olympus?.freeCount || 0}</p>
                                                
                                                <div className="progress-bar mb-3">
                                                    <div className="progress-fill" style={{width: `${(olympusOpens / OLYMPUS_PROGRESS[OLYMPUS_PROGRESS.length - 1].opens) * 100}%`}}></div>
                                                </div>
                                                <p className="text-yellow-300 text-xs">–û—Ç–∫—Ä—ã—Ç–æ: {olympusOpens} –∏–∑ {OLYMPUS_PROGRESS[OLYMPUS_PROGRESS.length - 1].opens}</p>
                                            </div>
                                            <button onClick={() => handleSelectCase(cases.olympus)} disabled={cases.olympus?.freeCount === 0 && balance < 77} className="w-full bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-600 hover:to-orange-700 py-3 rounded-xl font-bold text-white disabled:opacity-50 transition mb-4">
                                                üé∞ –û—Ç–∫—Ä—ã—Ç—å ({getCasePrice('olympus') === 0 ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : getCasePrice('olympus') + '‚≠êÔ∏è'})
                                            </button>
                                        </div>
                                        <h3 className="text-yellow-300 font-bold text-center mb-3">üìä –õ–µ—Å—Ç–Ω–∏—Ü–∞ –ù–∞–≥—Ä–∞–¥</h3>
                                        <div className="space-y-2">
                                            {OLYMPUS_PROGRESS.map((step, idx) => (
                                                <div key={idx} className="glass rounded-lg p-3" style={{background: olympusOpens >= step.opens ? 'linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(22, 163, 74, 0.2))' : 'linear-gradient(135deg, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.2))', borderColor: olympusOpens >= step.opens ? '#22c55e' : 'rgba(251, 191, 36, 0.3)'}}>
                                                    <div className="flex justify-between items-center">
                                                        <span className="text-sm font-bold">{step.opens} –æ—Ç–∫—Ä.</span>
                                                        <span className="text-xs text-yellow-300">{step.name}</span>
                                                        {olympusOpens >= step.opens && <span className="text-green-400">‚úÖ</span>}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                                {olympusScreen === 'hephaestus' && (
                                    <div>
                                        <button onClick={() => setOlympusScreen('main')} className="mb-4 text-yellow-400 hover:text-yellow-300">‚Üê –ù–∞–∑–∞–¥</button>
                                        <h2 className="olymp-header text-center mb-2">üèµÔ∏è –õ–∞–≤–∫–∞ –ì–µ—Ñ–µ—Å—Ç–∞ üèµÔ∏è</h2>
                                        <p className="text-center text-yellow-300 text-sm mb-4">–û–±–º–µ–Ω—è–π —Å–≤–æ–∏ –ø—Ä–µ–¥–º–µ—Ç—ã –Ω–∞ —Ü–µ–Ω–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã!</p>
                                        <p className="text-center text-yellow-400 text-xs mb-4">–°–∫–æ—Ä–æ –±—É–¥—É—Ç –æ–±–º–µ–Ω—ã...</p>
                                    </div>
                                )}
                            </div>
                        )}
                        {currentScreen === 'profile' && (
                            <div>
                                <h2 className="text-2xl font-bold mb-4 text-center">üë§ –ú–æ–π –ü—Ä–æ—Ñ–∏–ª—å</h2>
                                <div className="glass rounded-xl p-5 text-center mb-4">
                                    <div className="w-20 h-20 mx-auto rounded-full bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center text-3xl mb-3 overflow-hidden border-2 border-white/20">
                                        {user?.avatar ? <img src={user.avatar} alt="" className="w-full h-full object-cover" /> : user?.name?.charAt(0).toUpperCase()}
                                    </div>
                                    <h3 className="text-lg font-bold">{user?.name}</h3>
                                    {user?.username && <p className="text-gray-400 text-sm">{user.username}</p>}
                                </div>
                                <div className="glass rounded-xl p-4">
                                    <h3 className="font-bold mb-2 text-sm">üéÅ –ü—Ä–æ–º–æ–∫–æ–¥</h3>
                                    <div className="flex gap-2">
                                        <input type="text" placeholder="–ü–†–û–ú–û–ö–û–î" value={promoCode} onChange={e => setPromoCode(e.target.value)} className="flex-1 bg-gray-700/50 border border-gray-600 rounded-lg px-3 py-2 text-center uppercase text-sm" />
                                        <button onClick={checkPromo} className="bg-indigo-600 hover:bg-indigo-500 px-4 py-2 rounded-lg font-bold transition text-sm">OK</button>
                                    </div>
                                    {promoError && <p className="text-red-400 text-xs mt-2 text-center">{promoError}</p>}
                                    {promoSuccess && <p className="text-green-400 text-xs mt-2 text-center">{promoSuccess}</p>}
                                </div>
                            </div>
                        )}
                    </main>
                    {selectedCase && (
                        <div className="fullscreen-modal flex items-center justify-center p-4">
                            <div className="w-full max-w-lg" ref={rouletteContainerRef}>
                                <div className="flex justify-between items-center mb-5">
                                    <h3 className="text-2xl font-bold">{selectedCase.emoji} {selectedCase.name}</h3>
                                    <button onClick={() => { setSelectedCase(null); setSpinResult(null); setFakeItems([]); }} className="text-3xl hover:text-red-400 transition">√ó</button>
                                </div>
                                <div className="roulette-container mb-5">
                                    <div className="roulette-pointer" />
                                    <div key={rouletteKey} className="roulette-inner" style={{ transform: `translateX(${rouletteOffset}px)` }}>
                                        {fakeItems.length > 0 ? fakeItems.map((item, i) => (
                                            <div key={i} className="roulette-item">
                                                <div className="emoji">{item.emoji}</div>
                                                <div className="name">{item.name}</div>
                                            </div>
                                        )) : [...Array(80)].map((_, i) => <div key={i} className="roulette-item"><div className="emoji">‚ùì</div></div>)}
                                    </div>
                                </div>
                                <div className="glass rounded-xl p-4 mb-5 max-h-40 overflow-y-auto">
                                    <p className="font-bold mb-2 text-center text-sm">–í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã:</p>
                                    <div className="space-y-1">
                                        {CASE_REWARDS[selectedCase.id]?.map((r, i) => (
                                            <div key={i} className="flex justify-between py-1 border-b border-white/10 last:border-0 text-xs">
                                                <span>{r.emoji} {r.name}</span>
                                                <span className="text-yellow-400 font-bold">{r.displayChance}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                {spinResult ? (
                                    <div className="text-center">
                                        <p className="text-xl font-bold mb-2">üéâ –í—ã–ø–∞–ª–æ: {spinResult.name}!</p>
                                        <button onClick={() => { setSpinResult(null); openCase(selectedCase.id); }} className="w-full bg-green-600 hover:bg-green-500 py-3 rounded-xl font-bold mb-2 transition">–ó–∞–±—Ä–∞—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç—å –µ—â—ë</button>
                                        <button onClick={() => { setSelectedCase(null); setSpinResult(null); setFakeItems([]); }} className="w-full bg-gray-600 hover:bg-gray-500 py-2.5 rounded-xl font-bold transition text-sm">–ö –∫–µ–π—Å–∞–º</button>
                                    </div>
                                ) : (
                                    <button onClick={() => openCase(selectedCase.id)} disabled={isSpinning || (selectedCase.id === 'daily' && selectedCase.freeCount === 0)} className="w-full bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 py-4 rounded-xl font-bold text-lg disabled:opacity-50 shadow-lg transition">
                                        {isSpinning ? 'üåÄ –ö—Ä—É—Ç–∏–º...' : `–û—Ç–∫—Ä—ã—Ç—å –∑–∞ ${getCasePrice(selectedCase.id) === 0 ? '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' : getCasePrice(selectedCase.id) + '‚≠êÔ∏è'}`}
                                    </button>
                                )}
                            </div>
                        </div>
                    )}
                    {showOlympusChoiceModal && (
                        <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
                            <div className="glass rounded-2xl p-6 max-w-sm w-full text-center">
                                {olympusChoiceType === 'poseidon' && (
                                    <>
                                        <div className="text-6xl mb-4">üî±</div>
                                        <h3 className="text-xl font-bold mb-2">–ü–æ—Å–µ–π–¥–æ–Ω üî±</h3>
                                        <p className="text-sm mb-4">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–≥—Ä–∞–¥—É:</p>
                                        <div className="space-y-2">
                                            <button onClick={() => handleOlympusChoice('stars')} className="w-full bg-yellow-600 hover:bg-yellow-500 py-3 rounded-xl font-bold">200‚≠êÔ∏è</button>
                                            <button onClick={() => handleOlympusChoice('cases')} className="w-full bg-purple-600 hover:bg-purple-500 py-3 rounded-xl font-bold">5 –∫–µ–π—Å–æ–≤ –ü–ª–∞—Ç–∏–Ω–∞</button>
                                        </div>
                                    </>
                                )}
                                {olympusChoiceType === 'hades' && (
                                    <>
                                        <div className="text-6xl mb-4">üî•</div>
                                        <h3 className="text-xl font-bold mb-2">–ê–∏–¥ üî•</h3>
                                        <p className="text-sm mb-4">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–≥—Ä–∞–¥—É:</p>
                                        <div className="space-y-2">
                                            <button onClick={() => handleOlympusChoice('stars')} className="w-full bg-yellow-600 hover:bg-yellow-500 py-3 rounded-xl font-bold">250‚≠êÔ∏è</button>
                                            <button onClick={() => handleOlympusChoice('collector')} className="w-full bg-pink-600 hover:bg-pink-500 py-3 rounded-xl font-bold">–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä üé©</button>
                                        </div>
                                    </>
                                )}
                                {olympusChoiceType === 'zeus' && (
                                    <>
                                        <div className="text-6xl mb-4">‚ö°Ô∏è</div>
                                        <h3 className="text-xl font-bold mb-2">–ó–µ–≤—Å ‚ö°Ô∏è</h3>
                                        <p className="text-sm mb-4">2 –∫–µ–π—Å–∞ –ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä + –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞!</p>
                                        <button onClick={() => handleOlympusChoice('accept')} className="w-full bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-600 hover:to-orange-700 py-3 rounded-xl font-bold">‚ú® –ü—Ä–∏–Ω—è—Ç—å</button>
                                    </>
                                )}
                            </div>
                        </div>
                    )}
                    {showTopUp && (
                        <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
                            <div className="glass rounded-2xl p-5 max-w-sm w-full">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-bold">üí≥ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
                                    <button onClick={() => setShowTopUp(false)} className="text-2xl hover:text-red-400 transition">√ó</button>
                                </div>
                                <p className="text-center text-xs text-gray-400 mb-3">–í—Å–∫–æ—Ä–µ –ø–æ—è–≤—è—Ç—Å—è —Å–ø–æ—Å–æ–±—ã –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è</p>
                                <button onClick={() => setShowTopUp(false)} className="w-full bg-gray-600 hover:bg-gray-500 py-2 rounded-xl">–ó–∞–∫—Ä—ã—Ç—å</button>
                            </div>
                        </div>
                    )}
                    {showAdminLogin && (
                        <div className="fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4">
                            <div className="glass rounded-2xl p-6 max-w-sm w-full">
                                <h2 className="text-xl font-bold text-center mb-4">üîê –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                                <input type="text" placeholder="–õ–æ–≥–∏–Ω" value={adminLogin} onChange={e => setAdminLogin(e.target.value)} className="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 mb-3 text-center text-sm" />
                                <input type="password" placeholder="–ü–∞—Ä–æ–ª—å" value={adminPassword} onChange={e => setAdminPassword(e.target.value)} className="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 mb-4 text-center text-sm" />
                                <button onClick={checkAdminLogin} className="w-full bg-indigo-600 hover:bg-indigo-500 py-3 rounded-xl font-bold mb-2">–í–æ–π—Ç–∏</button>
                                <button onClick={() => setShowAdminLogin(false)} className="w-full bg-gray-700 hover:bg-gray-600 py-2 rounded-xl text-sm">–û—Ç–º–µ–Ω–∞</button>
                            </div>
                        </div>
                    )}
                    
                    <nav className="fixed bottom-0 left-0 right-0 glass border-t border-white/10 p-2 z-40">
                        <div className="max-w-md mx-auto flex justify-around">
                            {[ { id: 'cases', emoji: 'üéÅ', label: '–ö–µ–π—Å—ã' }, { id: 'events', emoji: 'üèõÔ∏è', label: '–ò–≤–µ–Ω—Ç—ã' }, { id: 'profile', emoji: 'üë§', label: '–ü—Ä–æ—Ñ–∏–ª—å' } ].map(s => (
                                <button key={s.id} onClick={() => setCurrentScreen(s.id)} className={`flex flex-col items-center p-2 rounded-lg transition ${currentScreen === s.id ? 'text-yellow-400 scale-110' : 'text-gray-400 hover:text-white'}`}>
                                    <span className="text-2xl">{s.emoji}</span>
                                    <span className="text-xs font-bold">{s.label}</span>
                                </button>
                            ))}
                        </div>
                    </nav>
                </div>
            );
        }
        
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
